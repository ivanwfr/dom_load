javascript: (function (){ 
/* dom_load */
/* TOOLS ALREADY LOADED {{{*/
if((typeof DOM_TOOLS_JS_ID) != "undefined") {
    let   msg = "*** TOOLS ALREADY LOADED";
    try { msg += "\n*** DOM_TOOLS_JS_ID\n*** "+DOM_LOAD_ID ; alert(msg); } catch(ex) { console.log(msg); }
    return null;
}
/*}}}*/
DOM_LOAD_ID         = "dom_load";
DOM_LOAD_TAG        =  DOM_LOAD_ID +" (190105:19h)"; let tag = DOM_LOAD_TAG;
DOM_HOST_CSS_ID     = "dom_host_css";
DOM_TOOLS_CSS_ID    = "dom_tools_css";
DOM_GRID_CSS_ID     = "dom_grid_css";
DOM_TOOLS_HTML_ID   = "dom_tools_html";
/* CONSOLE TEMPLATE TO BE IMPLEMENTED BY EMBEDDING LAYER {{{*/
      DOUBLE_QUOTE  = String.fromCharCode(34);
      LF            = String.fromCharCode(10);
      CR            = String.fromCharCode(13);
      BACKSLASH     = String.fromCharCode(92);
      FORESLASH     = String.fromCharCode(47);
      CS            = "font-size:150%; font-weight:900; border:1px solid gray; color:yellow; background-color:navy; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #000 0%, #223 50%, #000 100%);";
      console_clear = function(  msg=null) { try { console.clear(); if(msg) console.warn("%c=== CLEARED BY: "+msg,CS);                 } catch(ex) {} };
      console_dir   = function(o,msg=null) { try {                  if(msg) console.log (          "%c"+msg      ,CS); console.dir(o); } catch(ex) {} };
      console_log   = function(  msg     ) { try {                          console.log (               msg         );                 } catch(ex) {} };
      console_warn  = function(  msg=null) { try {                          console.warn(               msg         );                 } catch(ex) {} };
/*}}}*/

/* INJECT DATA */
  /**   1  HOST   CSS dom_host_css_data {{{*/
/*
../stylesheet/dom_host.css
*/
dom_host_css_data ="data:text/css,"+ escape(`
/*{{{*/

#dom_host_css_tag   { content: "dom_host_css (190103:19h)"; }

.overflow_visi *    { overflow         : visible !important; }

.wall_of_text_parent                 { outline     : 3px dashed pink       !important; }
.wall_of_text_split                  { word-wrap   : break-word                      ; }
.wall_of_text_split                  { white-space : pre-wrap                        ; }
.wall_of_text_split                  { padding     : 0                     !important; }
.wall_of_text_split                  { margin      : 0                     !important; }

.wall_of_text_split:nth-of-type( 1n) { background  : rgba(150, 75,  0,0.1) !important; }
.wall_of_text_split:nth-of-type( 2n) { background  : rgba(255,  0,  0,0.1) !important; }
.wall_of_text_split:nth-of-type( 3n) { background  : rgba(255,165,  0,0.1) !important; }
.wall_of_text_split:nth-of-type( 4n) { background  : rgba(255,255,  0,0.1) !important; }
.wall_of_text_split:nth-of-type( 5n) { background  : rgba(154,205, 50,0.1) !important; }
.wall_of_text_split:nth-of-type( 6n) { background  : rgba(100,149,237,0.1) !important; }
.wall_of_text_split:nth-of-type( 7n) { background  : rgba(238,130,238,0.1) !important; }
.wall_of_text_split:nth-of-type( 8n) { background  : rgba(160,160,160,0.1) !important; }
.wall_of_text_split:nth-of-type( 9n) { background  : rgba(255,255,221,0.1) !important; }
.wall_of_text_split:nth-of-type(10n) { background  : rgba(192,192,192,0.1) !important; }

/* collapsed {{{*/
.collapsed {
    height           : 2em;
    transform-origin : 0 0;
    transform        : scale(.8,.8);
    overflow         : hidden;
    filter           : blur(2px);
    cursor           : pointer;
}
.collapsed:hover {
    height           : 4em;
    transform        : scale(1,1);
    filter           : none;
}
.collapse_pin {
    position         : relative; top : -.5em; left : 10%;
    cursor           : pointer;
    background-color : transparent;
    font-size        : 200%;
    color            : red;
}
.collapse_pin:hover {
    box-shadow       : 0 0 .5em black;
}

/*}}}*/
/* node_to_hide_mask {{{*/
.node_to_hide_mask             { z-index             : 2147483646                           !important; }
.node_to_hide_mask.last_hidden { z-index             : 2147483647                           !important; }
.node_to_hide_mask             { cursor              : pointer                              !important; }
.node_to_hide_mask             { user-select         : none                                 !important; }
.node_to_hide_mask             { position            : absolute                             !important; }
.node_to_hide_mask             { overflow            : hidden                               !important; }
.node_to_hide_mask             { margin              : 0                                    !important; }
.node_to_hide_mask             { padding             : 0                                    !important; }
.node_to_hide_mask             { box-shadow          : rgba(255,255,255) 3px 3px 3px inset  !important; }
.node_to_hide_mask             { background-color    : rgba(200,200,255,0.9)                !important; }
.node_to_hide_mask.last_hidden { background-color    : rgba(255,200,200,0.9)                !important; }
.node_to_hide_mask             { transition-duration : 200ms;                                           }
/*{{{
.node_to_hide_mask             { color               : transparent                          !important; }
}}}*/

/*{{{*/
.node_to_hide_mask     {
    color          : #AAA                     !important;
    font-size      : 100%                     !important;
    font-weight    : 900                      !important;

}
.node_to_hide_mask>*   {
    position       : absolute                 !important;
    top            : 0                        !important;
    left           : 0                        !important;
    margin:0 !important;
    padding:0 !important;
    line-height: 1em !important;
/*{{{
    position       : absolute                 !important;
    top            : 0.5em                    !important;
    left           : 0.5em                    !important;
    width          : 100%                     !important;
    height         : 100%                     !important;
    border         : 1px black solid          !important;
    z-index        : -1                       !important;
    pointer-events : none                     !important;

    transform      : translate(-0.5em,-0.5em) !important;
    line-height    : 1em                      !important;
    line-height    : 100%                     !important;
    vertical-align : middle                   !important;
    text-align     : center                   !important;
}}}*/
}
/*}}}*/


/*}}}*/
/* node_to_hide_not_visible {{{*/
.node_to_hide_not_visible      { display      : none !important; }

/*}}}*/
/* last_hidden {{{*/
.last_hidden                   { transition-duration : 100ms;                                           }
.last_hidden                   { outline             : 5px rgba(255,000,000,0.3) solid   !important;    }
.last_hidden                   { cursor              : pointer   !important;                            }
.last_hidden                   { user-select         :    none;                                         }
/*
.last_hidden                   { box-shadow          : 0 0 16px 8px rgba(255,  0,  0, .8) !important;   }
*/

/*}}}*/
/* node_to_hide marked_to_dimm {{{*/
.marked_to_hide    { user-select      : none                                 !important; }
.marked_to_dimm    { transition       : opacity    500ms                               ; }
.marked_to_hide    { transition       : opacity    500ms                               ; }
.marked_to_dimm    { transition       : outline    0ms                          100ms  ; }
/*...................transition       : <property> <duration> <timing-function> <delay>; */

.marked_to_dimm    { outline          : 3px dashed rgba(068,000,255,1)       !important; }
.marked_to_dimm    { opacity          : 0.3                                  !important; }
.marked_to_dimm    { background-color : pink                                 !important; }
.marked_to_dimm    { user-select      : none                                 !important; }
.marked_to_dimm    { box-shadow       : 0   0 16px 8px    rgba(  0,255,  0, .8);         }
/* .................................. ox oy blur spread color ................*/

/*}}}*/

.containers_hi .viewable { outline             : red 5px solid !important; };
.containers_hi .viewable { transition-duration : 500ms; }

/* zoom {{{*/
.zoom_70  { zoom :  70%; }
.zoom_80  { zoom :  80%; }
.zoom_90  { zoom :  90%; }

.zoom_100 { zoom : 100%; }
.zoom_110 { zoom : 110%; }
.zoom_120 { zoom : 120%; }

.zoom_130 { zoom : 130%; }
.zoom_150 { zoom : 150%; }
.zoom_160 { zoom : 160%; }

.zoom_180 { zoom : 180%; }
.zoom_200 { zoom : 200%; }
.zoom_220 { zoom : 220%; }

/*}}}*/
/* scale {{{*/
/*
.scale_70  { transform : scale(0.70); transform-origin : 0 0 0; }
.scale_80  { transform : scale(0.80); transform-origin : 0 0 0; }
.scale_90  { transform : scale(0.90); transform-origin : 0 0 0; }

.scale_100 { transform : scale(1.00); transform-origin : 0 0 0; }
.scale_110 { transform : scale(1.10); transform-origin : 0 0 0; }
.scale_120 { transform : scale(1.20); transform-origin : 0 0 0; }

.scale_130 { transform : scale(1.30); transform-origin : 0 0 0; }
.scale_150 { transform : scale(1.50); transform-origin : 0 0 0; }
.scale_160 { transform : scale(1.60); transform-origin : 0 0 0; }

.scale_180 { transform : scale(1.80); transform-origin : 0 0 0; }
.scale_200 { transform : scale(2.00); transform-origin : 0 0 0; }
.scale_220 { transform : scale(2.20); transform-origin : 0 0 0; }
*/
/*}}}*/

.pat_div {
    display       : inline-block !important;
    margin        : 1em;
    border-radius : 1ex;
    border        : 3px solid #aaa;
    padding       : 1em;
}

#shadow_host {
    position : absolute;
    left     : 0;
    top      : 0;
    margin   : 0;
    border   : 0;
    padding  : 0;
    width    : 0px;
    height   : 0px;
}

/* TYPE {{{*/

em {
    background-color  : #fafafa;
    border            : 0px solid #aaa;
    border-radius     : 5px;
    color             : #444;
    font-style        : normal;
}

input       { border  : 6px #eee solid;        }
input:focus { outline : 0;                     }
input:focus { border  : 6px solid transparent; }

/* }}} */
/* COLOR CODED {{{ */
.cc1 , .select1 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc2 , .select2 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc3 , .select3 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc4 , .select4 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc5 , .select5 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc6 , .select6 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc7 , .select7 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc8 , .select8 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc9 , .select9 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset !important; }
.cc0 , .select0 { box-shadow: #FFF               0 0.1em 0.1em inset; }

/* ECC #964B00 #FF0000 #FFA500 #FFFF00 #9ACD32 #6495ED #EE82EE #A0A0A0 #FFFFFF #CFB53B #C0C0C0 */
/*      111111  222222  333333  444444  555555  666666  777777  888888  999999  000000  111111 */
.cc1 , .select1 , .select1 em { color: #FFF !important; background-color:#964B00 !important; padding:0 0px 0 0px !important; }
.cc2 , .select2 , .select2 em { color: #FFF !important; background-color:#FF0000 !important; padding:0 0px 0 0px !important; }
.cc3 , .select3 , .select3 em { color: #000 !important; background-color:#FFA500 !important; padding:0 0px 0 0px !important; }
.cc4 , .select4 , .select4 em { color: #000 !important; background-color:#FFFF00 !important; padding:0 0px 0 0px !important; }
.cc5 , .select5 , .select5 em { color: #000 !important; background-color:#9ACD32 !important; padding:0 0px 0 0px !important; }
.cc6 , .select6 , .select6 em { color: #000 !important; background-color:#6495ED !important; padding:0 0px 0 0px !important; }
.cc7 , .select7 , .select7 em { color: #000 !important; background-color:#EE82EE !important; padding:0 0px 0 0px !important; }
.cc8 , .select8 , .select8 em { color: #000 !important; background-color:#A0A0A0 !important; padding:0 0px 0 0px !important; }
.cc9 , .select9 , .select9 em { color: #000 !important; background-color:#FFFFFF !important; padding:0 0px 0 0px !important; }
.cc0 , .select0 , .select0 em { color: #000 !important; background-color:#888    !important; padding:0 0px 0 0px !important; }

.select_words_exact     { border:0px red         !important; border-radius:.5ex;                            }
.select_words_segment   { border:0px transparent !important; border-radius: 0  ;                            }
.select_words_segment   { border:0px             !important;       outline: 3px rgba(128,128,128,.5) solid; }
.select_words_head_tail { border:0px             !important; border-radius: 1ex;                            }

/* }}} */
/* big small {{{*/
/*{{{
*** clash with https://www.google.fr/search:
.big   { font-size : 200% !important; vertical-align : middle; }
.small { font-size :  80% !important; vertical-align : middle; }
}}}*/
/*}}}*/
/* cursor {{{ */

em.select1,
em.select2,
em.select3,
em.select4,
em.select5,
em.select6,
em.select7,
em.select8,
em.select9,
em.select0 { cursor : all-scroll !important; }

.select1,
.select2,
.select3,
.select4,
.select5,
.select6,
.select7,
.select8,
.select9,
.select0 { white-space : nowrap !important; }

/*}}}*/
/* container_dark container_light {{{*/
/* ............................................................... ox oy blur spread color ................*/
.scroll_smooth { scroll-behavior  : smooth  !important; }
/* .scrolling {{{
@media only screen and (max-resolution :  16dpi)
{
               .scrolling .container_dark  ,
               .scrolling .container_light { transition-duration :  100ms; }
                          .container_dark  ,
                          .container_light { transition-duration :  100ms; }

.scroll_smooth .scrolling .container_dark  ,
.scroll_smooth .scrolling .container_light { transition-duration :  250ms; }
.scroll_smooth            .container_dark  ,
.scroll_smooth            .container_light { transition-duration :  500ms; }

               .scrolling .container_dark  { box-shadow          : 0   0  2px 8px    rgba(255,  0,  0, .8); }
               .scrolling .container_light { box-shadow          : 0   0  2px 8px    rgba(  0,  0,255, .8); }
.scroll_smooth .scrolling .container_dark  { box-shadow          : 0   0 16px 8px    rgba(255,  0,255, .8); }
.scroll_smooth .scrolling .container_light { box-shadow          : 0   0 16px 8px    rgba(  0,255,  0, .8); }
}
}}}*/

.containers_hi       :not(.container_light):not(.container_dark ):not(em):not(.node_to_hide_mask) { background-image: none !important; box-shadow:none !important; text-shadow:none !important; }
.containers_hi.dark                        :not(.container_dark ):not(em):not(.node_to_hide_mask) { background-color: #222 !important; color :rgba(255,255,255,0.5) !important; }
.containers_hi.light                       :not(.container_light):not(em):not(.node_to_hide_mask) { background-color: #EEE !important; color :rgba(  0,  0,  0,0.5) !important; }

.container_dark, .container_light { border        : 0px;                               }
.container_dark, .container_light { border-radius : 5px !important;                    }
.container_dark, .container_light { box-shadow    : 2px 2px 6px rgba(000,000,000,0.7); }

.container_dark                   { color         : white !important; }
.container_light                  { color         : black !important; }

.container_dark                   { background    : linear-gradient(110deg, rgba( 68, 28,  0,.3), rgba(255, 106, 26,.3)) !important; }
.container_light                  { background    : linear-gradient(110deg, rgba(255,130,  0,.3), rgba(  0,   0,  0,.3)) !important; }

.container_selected               { outline       : 1px dashed orange; }

/*}}}*/

.on_work_el_left  { outline : .5em dotted  green !important; }
.on_work_el_right { outline : .5em dotted  red   !important; }
.num_selected     { outline : .5em dotted  #A0F  !important; }
/*
*/
body.dimmed {
    filter : blur(2px) grayscale(100%) !important;
}
body.dimmed { transition : filter 250ms; }

body *::selection {
/*
    background: rgba(192,192,255,0.3);
*/
    background:black;
    color:white;
}
body.cannot_expand_to_selection *::selection {
    background: red;
/*
    background: navy !important;
    font-weight:900;
*/
}
/* .transcript {{{*/

.transcript            { transform-origin     : 0% 0% 0;         }
.transcript            { cursor               : pointer;         }
.transcript            { margin               : .2em;            }
.transcript            { padding              : 1ex;             }
.transcript            { min-height           : 1em;             }

.transcript            { max-width            :  80%;            }
.transcript            { max-height           :  90%;            }

.transcript            { overflow             : hidden; }
#transcript1           { overflow             :   auto; }
#transcript2           { overflow             :   auto; }

.transcript::-webkit-scrollbar                       { width         :  3em; }
.transcript::-webkit-scrollbar                       { height        :  3em; }
.transcript::-webkit-scrollbar-thumb                 { border-radius : 96px; }
.transcript::-webkit-scrollbar-track                 { border-radius : 96px; }
.transcript::-webkit-scrollbar-thumb                 { box-shadow    : inset 0 0 6px rgba(0,0,0,0.5); }
.transcript::-webkit-scrollbar-track                 { box-shadow    : inset 0 0 6px rgba(0,0,0,0.3); }
.transcript::-webkit-scrollbar-thumb                 { box-shadow    : rgba(  0,  0,  0,0.5) 0 8px 24px; }
.transcript::-webkit-scrollbar-thumb                 { background    : rgba( 24, 24, 24,0.5); }
.transcript::-webkit-scrollbar-thumb:window-inactive { background    : rgba( 24, 24, 24,0.2); }
.transcript::-webkit-scrollbar-track                 { background    : rgba( 96, 96, 96,0.4); }
.transcript::-webkit-scrollbar-track:window-inactive { background    : rgba(128,128,128,0.2); }

.transcript>div        { margin               : .2em;            }

.transcript *          { user-select  : none;            }
.transcript *          { vertical-align       : middle;          }
.transcript *          { font-family          : monospace;       }

.transcript blockquote { margin               : .2em;                     }
.transcript blockquote { padding              : 1ex;                      }
.transcript blockquote { white-space          : normal !important;        }
.transcript blockquote { width                : 48em;                     }

.transcript div        { cursor               : pointer;         }
/*
.transcript div        { display              : inline-block;    }
*/
.transcript div        { display              : table-cell;      }
.transcript div        { margin               : .2em;            }
.transcript div        { overflow             : hidden;          }
.transcript div        { padding              : 1ex;             }

.transcript em         { line-height          : 1.50em;          }

.transcript pre        { background           : initial;         }
.transcript pre        { padding              : 0 0 0 1ex;       }
.transcript pre        { text-align           : left;            }

.transcript sub        { vertical-align       : sub;             }
.transcript sup        { color                : white;           }
.transcript sup        { vertical-align       : super;           }

.transcript table      { user-select  : none;            }
.transcript table      { margin               : 0;               }
.transcript tr.slot    { font-size            : 200%;            }
.transcript th         { font-size            : 120%;            }
.transcript th         { padding              : 1ex;             }
.transcript th         { text-align           : left;            }
.transcript th         { text-shadow          : rgba( 50, 50, 50, 0.9) 1px 1px 2px !important; }
.transcript th         { font-weight          : 700; }
.transcript hr         { height               : 5px; }

.transcript td         { padding              : 1ex;             }
.transcript td         { text-align           : left;            }

.transcript ul         { line-height          : 0.75em;          }
.transcript ul         { margin               : .2em;            }
.transcript ul         { padding              : 0 0 0 2em;       }

.transcript_msg .info  {
    box-shadow  : 2px 2px 6px rgba(000,000,000,0.7) inset;
    font-family : "Comic sans ms";
}

      .transcript_msg { color       : #200; }
.dark .transcript_msg { color       : #FA0 !important; }

#table_params *   {     text-align : right  ; }

.div_match {
    border: solid 8px black !important;
}
.div_match div {
    border:solid 1px !important;
}

.em_match {
    box-shadow    : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
    font-size     : 200%;
}
.em_missing {
    color            : red;
    background-color : transparent;
    font-weight      : 700;
    box-shadow       : rgba(255, 0, 0, 0.3) 0 0.3em 0.3em inset;
}

.em_log {
    padding          : .2em;
    border-radius    : 50%;
    box-shadow       : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
}
.em_log span {
    border-radius    : .5em;
/*
    padding          : .5em;
*/
}

/*}}}*/
/* outlined_divs {{{*/
.outlined_divs {
    position         : absolute             !important;
    pointer-events   : none                 !important;
    margin           : 0                    !important;
    border-radius    : 16px                 !important;
    border-style     : solid                !important;
    border-width     : 7px                  !important;
    padding          : 0                    !important;
    background-color : transparent          !important;
}
.outlined_dots {
    position         : absolute             !important;
    pointer-events   : none                 !important;
    margin           : 0                    !important;
    border-radius    : 1em                  !important;
    padding          : 1em                  !important;
    transform        : translate(-50%,-50%) !important;
    text-shadow      : white    1px 1px 2px !important;
}
/*}}}*/

/*}}}*/
/*# sourceURL=dom_host.css */
`
);
/*}}}*/
  /**  2  TOOLS  CSS dom_tools_css_data {{{*/
/*
../stylesheet/dom_tools.css
*/
dom_tools_css_data ="data:text/css,"+ escape(`
/*{{{*/

#dom_tools_css_tag  { content: "dom_tools_css (181226:18h)"; }
/* display_delayed {{{*/
.display_delayed {
    opacity             : 0.1;
    transition-duration : 500ms;
    visibility : hidden !important;
    display    : none   !important;
/*
*/
}
/*}}}*/
/*{{{*/
#dom_tools_css_tag  {
    border        : 5px dashed #FFAA00;
    border-radius : 2em;
    margin        : 1em;
}
/*}}}*/
/* zoom {{{*/
.zoom_70  { zoom :  70%; }
.zoom_80  { zoom :  80%; }
.zoom_90  { zoom :  90%; }

.zoom_100 { zoom : 100%; }
.zoom_110 { zoom : 110%; }
.zoom_120 { zoom : 120%; }

.zoom_130 { zoom : 130%; }
.zoom_150 { zoom : 150%; }
.zoom_160 { zoom : 160%; }

.zoom_180 { zoom : 180%; }
.zoom_200 { zoom : 200%; }
.zoom_220 { zoom : 220%; }

/*}}}*/
/* HTML {{{*/

global-box { margin: 0 0 5px 0; }

input {
    border               : 2px solid transparent;
    user-select          : none ;
}
input:focus {
    border               : 2px solid black;
}
.focussed {
    border               : 2px solid transparent !important;
    outline              : 2px solid red         !important;
               color     : white                 !important;
    background-color     : rgba(000,000,000,0.3) !important;
}

em {
    border           : 1px solid #aaa;
    border-radius    : 5px;
    color            : #444;
    background-color : #fafafa;
    font-style       : normal;
}
/*}}}*/
/* NOTE {{{ */
.todo { color:red; }

/* }}} */
/* COLOR-CODED {{{ */
.cc1 , .select1 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc2 , .select2 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc3 , .select3 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc4 , .select4 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc5 , .select5 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc6 , .select6 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc7 , .select7 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc8 , .select8 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc9 , .select9 { box-shadow: rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset; }
.cc0 , .select0 { box-shadow: #FFF               0 0.1em 0.1em inset; }

/* ECC #964B00 #FF0000 #FFA500 #FFFF00 #9ACD32 #6495ED #EE82EE #A0A0A0 #FFFFFF #CFB53B #C0C0C0 */
/*      111111  222222  333333  444444  555555  666666  777777  888888  999999  000000  111111 */
.cc1 , .select1 , .select1 em { color: #FFF; background-color:#964B00 !important; }
.cc2 , .select2 , .select2 em { color: #FFF; background-color:#FF0000 !important; }
.cc3 , .select3 , .select3 em { color: #000; background-color:#FFA500 !important; }
.cc4 , .select4 , .select4 em { color: #000; background-color:#FFFF00 !important; }
.cc5 , .select5 , .select5 em { color: #000; background-color:#9ACD32 !important; }
.cc6 , .select6 , .select6 em { color: #000; background-color:#6495ED !important; }
.cc7 , .select7 , .select7 em { color: #000; background-color:#EE82EE !important; }
.cc8 , .select8 , .select8 em { color: #000; background-color:#A0A0A0 !important; }
.cc9 , .select9 , .select9 em { color: #000; background-color:#FFFFFF !important; }
.cc0 , .select0 , .select0 em { color: #FFF; background-color:#202020 !important; }

.bg1 { background-color : rgba(150,  75,   0, .9); }
.bg2 { background-color : rgba(255,   0,   0, .9); }
.bg3 { background-color : rgba(255, 165,   0, .9); }
.bg4 { background-color : rgba(255, 255,   0, .9); }
.bg5 { background-color : rgba(154, 205,  50, .9); }
.bg6 { background-color : rgba(100, 149, 237, .9); }
.bg7 { background-color : rgba(238, 130, 238, .9); }
.bg8 { background-color : rgba(160, 160, 160, .9); }
.bg9 { background-color : rgba(255, 255, 255, .9); }
.bg0 { background-color : rgba(128, 128, 128, .9); }

.fg1 {            color : rgba(150,  75,   0, .9); }
.fg2 {            color : rgba(255,   0,   0, .9); }
.fg3 {            color : rgba(255, 165,   0, .9); }
.fg4 {            color : rgba(255, 255,   0, .9); }
.fg5 {            color : rgba(154, 205,  50, .9); }
.fg6 {            color : rgba(100, 149, 237, .9); }
.fg7 {            color : rgba(238, 130, 238, .9); }
.fg8 {            color : rgba(160, 160, 160, .9); }
.fg9 {            color : rgba(255, 255, 255, .9); }
.fg0 {            color : rgba( 64,  64,  64, .9); }

.select1,
.select2,
.select3,
.select4,
.select5,
.select6,
.select7,
.select8,
.select9,
.select0 { cursor : all-scroll; }

/* }}} */
/* simplify-paint-complexity {{{*/
/*
:!start explorer https://developers.google.com/web/fundamentals/performance/rendering/simplify-paint-complexity-and-reduce-paint-areas
:!start explorer https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count
:!start explorer https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/
...Warning: Do not promote elements unnecessarily.
*/

/*}}}*/

/* dom_tools_html ... {{{ */
/*
fails in webview at load time...
#dom_tools_html   {          visibility : hidden; }
*/
#dom_tools_html * { user-select : none;   }
#dom_tools_html * { -webkit-tap-highlight-color: rgba(255,0,0,.05); }

 #pat_bag
,#sel_bag
,#headsup
,#dom_traversal
,#dev_log_map
,#test_panel
,#dom_load_tags
,#transcript1
,#transcript2
{
    min-width     : 8em;
    min-height    : 6em;
    margin-bottom : 5em;
    font-weight   : 900;
}

 #pat_bag.scrolled
,#sel_bag.scrolled
,#headsup.scrolled
,#dom_traversal.scrolled
,#dev_log_map.scrolled
,#test_panel.scrolled
,#dom_load_tags.scrolled
,#transcript1.scrolled
,#transcript2.scrolled
{
    border:1px dashed red;
/*
    width:36em;
*/
}
#transcript1 { border: 3px #964B00 solid !important; }
#transcript2 { border: 3px #FF0000 solid !important; }

#pat_bag.scrolled           { background-color: rgba(255,  0,  0,.1); }
#sel_bag.scrolled           { background-color: rgba(255,  0,  0,.1); }
#headsup.scrolled           { background-color: rgba(  0,255,  0,.1); }
#dom_traversal.scrolled     { background-color: rgba(  0,255,  0,.1); }
#dev_log_map.scrolled       { background-color: rgba(  0,  0,255,.1); }
#test_panel.scrolled        { background-color: rgba(  0,  0,255,.1); }
#dom_load_tags.scrolled     { background-color: rgba(  0,  0,255,.1); }
#transcript1.scrolled       { background-color: rgba(255,255,  0,.1); }
#transcript2.scrolled       { background-color: rgba(255,255,  0,.1); }

 #pat_bag       label
,#sel_bag       label
,#headsup       label
,#dom_traversal label
{
    line-height   :  3em;
}

 #pat_bag>div>div
,#sel_bag>div>div
,#headsup>div>div
,#dom_traversal>div>div
{
    color         : #050505;
}

.toolbag_button {
    display       : inline-block;
    padding-left  : 1ex;
    padding-right : 1ex;
    cursor        : pointer;
}

/*}}}*/

/* pat_bag {{{ */
#pat_bag { float     : left;    }
#pat_bag { min-width :  8em;    }
#pat_bag { overflow  :  hidden; }

/*}}}*/
/* sel_bag {{{ */
#sel_bag { float : left; }

#sel_bag          { color                      : green; }
#sel_bag.back     { color                      : red; }
/*
#sel_bag>div      { margin-left                : 2em; }
*/
#sel_bag>div      { margin                     : 0 0 0 2em; }
/*
#sel_bag.back>div { border-color               : red; }
*/

/*}}}*/

/* headsup {{{ */

#headsup {
    float          : left;
    margin         : 0 !important;
/*
    min-width      : 32em;
    padding        : 10px 20px;
*/

    color          : #050505;
    font-family    : Arial, Helvetica, sans-serif;
    font-size      : 14px;
    text-shadow    : 0px -1px 0px rgba(000,000,000,0.4), 0px 1px 0px rgba(255,255,255,0.3);
    vertical-align : top;
}

#headsup>* { float:left; }

#headsup    em,
#headsup_w  em,
#headsup_ds em {
    margin     : 0;
    padding    : 0.1em;
    min-width  : 1.5em;
}

#headsup em:hover { box-shadow : rgba(128, 128, 128, 0.9) 0 0.1em 0.1em inset; }

/*}}}*/
/* headsup>em {{{*/
#headsup>em, #headsup_w>em, #headsup_ds>em { margin        : 3px;                  }
#headsup>em, #headsup_w>em, #headsup_ds>em { border        : rgba(255,255,255,.9); }
#headsup>em, #headsup_w>em, #headsup_ds>em { border-radius : 2em;                  }
#headsup>em, #headsup_w>em, #headsup_ds>em { color         : rgba(  0,  0,  0,.7); }
#headsup>em, #headsup_w>em, #headsup_ds>em { font-size     : 200%;                 }
#headsup>em, #headsup_w>em, #headsup_ds>em { text-align    : center;               }

/*}}}*/
/* headsup>em.checked {{{*/
#headsup>em.checked, #headsup_w>em.checked, #headsup_ds>em.checked { margin        : 0              ; }
#headsup>em.checked, #headsup_w>em.checked, #headsup_ds>em.checked { background    : linear-gradient(to bottom, #AAA, #200); }
#headsup>em.checked, #headsup_w>em.checked, #headsup_ds>em.checked { color         : #000           ; }

#anchor_freeze.checked { color         : #D00 !important; }
#containers_hi.checked { color         : #FC0 !important; }
/*}}}*/
/* headsup thumb_p {{{*/
#thumb_p {
    margin           : -.3em 1ex 0 -.3em !important;
    min-width        :   3em             !important;
    border           : 0;
    background-color : transparent;
    padding          : 0                 !important;
    color            : rgba(0,0,0,.9)    !important;
    font-size        : 200%;
}
/*}}}*/
/* headsup words_exact, ... {{{*/
#headsup_w em {
    border        : rgba(255,255,255,.2) solid;
    border-radius : 2em !important;
    font-size     : 160%;
    margin        : 0 !important;
    text-align    : center;
    text-shadow   : none;
    font-weight   : 900 !important;
}

/*{{{
#headsup_w em         { box-shadow : 0px 2px 4px rgba(  0,  0,  0,0.3)           ; }
#headsup_w em.checked { box-shadow : 0px 3px 3px rgba(255,255,255,0.3) !important; }
}}}*/

/* words_drop_s {{{*/
#words_drop_s         { font-size     : 120% !important; }
#words_drop_s         { padding       : .1em .5em .1em .5em !important; }
#words_drop_s::after  {
    content             : 'S';
    position            : absolute;
    transition-duration : 500ms;
}

#words_drop_s                { opacity    : 0.5; }
#words_drop_s.checked        { opacity    : 1.0; }
#words_drop_s.checked        { background : linear-gradient(to bottom, #F00, #800) !important; }

#words_drop_s::after         { transform  : translate(-80%,  5%) rotate(90deg); }
#words_drop_s.checked::after { transform  : translate(-80%,  5%) rotate( 0deg); }
#words_drop_s.checked::after { opacity    : 1.0; }

/*}}}*/
/* words_drop_ing {{{*/
#words_drop_ing         { font-size     : 120% !important; }
#words_drop_ing         { padding       : .1em .5em .1em .5em !important; }
#words_drop_ing::after  {
    content             : 'ing';
    position            : absolute;
    transition-duration : 500ms;
}

#words_drop_ing                { opacity    : 0.5; }
#words_drop_ing.checked        { opacity    : 1.0; }
#words_drop_ing.checked        { background : linear-gradient(to bottom, #F00, #800) !important; }

#words_drop_ing::after         { transform  : translate(-60%,  5%) rotate(90deg); }
#words_drop_ing.checked::after { transform  : translate(-60%,  5%) rotate( 0deg); }
#words_drop_ing.checked::after { opacity    : 1.0; }

/*}}}*/

#words_opcycle.checked                 { border-radius              : 50% 50% 10% 10%        !important; }
#words_opcycle.checked                 { transition-duration        : 100ms;                             }
#words_opcycle.checked                 { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
#words_opcycle.checked.words_exact     { transform                  : rotate(-45deg)         !important; }
#words_opcycle.checked.words_head_tail { transform                  : rotate( 45deg)         !important; }
#words_opcycle.checked.words_segment   { transform                  : rotate(  0deg)         !important; }

      #words_regex                     { color : #000 !important; }
.dark #words_regex                     { color : #CCC !important; }

/*}}}*/
/* headsup recycle {{{*/
#recycle {
    color         : green;
    box-shadow    : 2px 2px 4px rgba(000,000,000,0.3);
    border-radius : 1.5em;
    text-align    : center;
    font-size     : 250%;
}
/*}}}*/
/* headsup tools_scroll {{{*/
#tools_scroll {
    float : left;
    clear : left;

    background    : linear-gradient(to bottom, #FFF   , #EB0   );
    border        : 0 !important;
    border-radius : 2em;
    box-shadow    : rgba(0, 0, 0, 0.3) 0 0.1em 0.5ex inset;
    font-size     : 300%;
    text-align    : center;
}
/*}}}*/
/* headsup wording {{{*/
 #wording
,#theme_dark
{
    background    : linear-gradient(to bottom, #FFF, #FF0);
    color         : #000;
}

 #wording
,#theme_dark
{
    border        : 0;
    border-radius : 2em;
    box-shadow    : rgba(0, 0, 0, 0.3) 0 0.1em 0.5ex inset;
    font-size     : 200%;
    margin        : 3px !important;
    text-align    : center;
}

 #wording.checked
,#theme_dark.checked {
    background    : linear-gradient(to bottom, #AAA, #200);
    color         : #FC0;
    margin        : 0   !important;
}

/*}}}*/
/* headsup tools_extras {{{*/
#tools_extras {
    background       : linear-gradient(to bottom, #FFF   , #EB0   );
    border        : 0 !important;
    border-radius : 2em;
    box-shadow    : rgba(0, 0, 0, 0.3) 0 0.1em 0.5ex inset;
    font-size     : 150%;
    text-align     : center;
    transform     : translate(   0%, 20%);
}
/*}}}*/
/* headsup scroll_smooth {{{*/
#scroll_smooth::after {
/*{{{
    content          : '\\26AB';
}}}*/
    content          : '\\21c9';
    position         : absolute;
    transform        : translate(-80%, 5%) scale(1.5) rotate(90deg);
/*{{{
    margin-right     : 50%;
    font-size        : 200%;
    margin           : 0;
    top              : 15%;
    left             : 25%;
    transform-origin : 50% 50% 0;
    position         : absolute;
    top              : .2em;
    left             : .4em;
    line-height      : .8em;
    vertical-align   : middle;
    background-color : transparent;
    text-shadow      : none;
    font-weight      :  100;
    font-weight      : 100;
    }}}*/
}

#scroll_smooth.checked::after {
    content          : '\\2933';
    transform        : translate(-80%, 10%) scale(1.5) rotate(90deg);
}
/*}}}*/
/* headsup overflow_visi {{{*/
#overflow_visi::after {
/*{{{
content          : '\\26AB';
content          : '\\25AC';
content          : '\\2756';
}}}*/
    /* BLACK SQUARE */
    content          : '\\2750';
    position         : absolute;
    transform        : translate(-80%, 5%) scale(1.0) rotate(90deg);
    opacity          : 0.5;
/*{{{
    margin-right     : 50%;
    font-size        : 200%;
    margin           : 0;
    top              : 15%;
    left             : 25%;
    transform-origin : 50% 50% 0;
    position         : absolute;
    top              : .2em;
    left             : .4em;
    line-height      : .8em;
    vertical-align   : middle;
    background-color : transparent;
    text-shadow      : none;
    font-weight      :  100;
    font-weight      : 100;
}}}*/
}

#overflow_visi.checked::after {
    content          : '\\25A0';
    transform        : translate(-100%, -5%) scale(1.5);
    opacity          : 1.0;
}
/*}}}*/
/* headsup show_seekzone {{{*/
#show_seekzone::after {
    position         : absolute;
    content          : '\\29EE';
    transform        : translate(-80%, 5%) scale(1.0) rotate(90deg);
    opacity          : 0.5;
/*{{{
    content          : '\\29C9';
}}}*/
}

#show_seekzone.checked::after {
    content          : '\\29EF';
    transform        : translate(-80%,-10%) scale(1.5) rotate( 0deg);
    opacity          : 1.0;
/*{{{
    content          : '\\29C9';
}}}*/
}
/*}}}*/
/* headsup pin_seekspot {{{*/
#pin_seekspot::after {
    content          : '\\2295';
    position         : absolute;
    transform        : translate(-80%,  5%) scale(0.5) rotate(90deg);
    opacity          : 0.5;

}

#pin_seekspot.checked::after {
    transform        : translate(-70%,  0%) scale(1.0) rotate(-45deg);
    opacity          : 1.0;
}
/*}}}*/
/* headsup log_seekspot {{{*/
#log_seekspot::after {
    content          : '\\33D2';
    position         : absolute;
    transform        : translate(-80%,  5%) scale(0.5) rotate(90deg);
    opacity          : 0.5;
}

#log_seekspot.checked::after {
    transform        : translate(-80%, 10%) scale(1.0) rotate( 0deg);
    opacity          : 1.0;
}
/*}}}*/
/* headsup_ds .. deny_or_allow mask_or_hide edit_or_stage dom_hide1_reset site_or_page target... {{{*/

#headsup_ds *::after            { transition : all ease-in 250ms; }

#site_or_page::after            { content :  'Page'; position : absolute; transform : translate(-60%,  5%) scale(0.5) rotate(-10deg); }
#site_or_page.checked::after    { content :  'Site'; color    : red;      transform : translate(-60%,  5%) scale(0.7) rotate( 10deg); }

#mask_or_hide::after            { content :  'Hide'; position : absolute; transform : translate(-60%,  5%) scale(0.5) rotate(-10deg); }
#mask_or_hide.checked::after    { content :  'Mask'; color    : red;      transform : translate(-60%,  5%) scale(0.7) rotate( 10deg); }

#deny_or_allow::after           { content : 'Allow'; position : absolute; transform : translate(-60%,  5%) scale(0.5) rotate(-10deg); }
#deny_or_allow.checked::after   { content :  'Deny'; color    : red;      transform : translate(-60%,  5%) scale(0.7) rotate( 10deg); }

#edit_or_stage::after           { font-size: 300%; }
#edit_or_stage::after           { content : '\\2699'; position : absolute; transform : translate(-60%,  5%) scale(0.5) rotate(-10deg); }
#edit_or_stage.checked::after   { content : '\\2699'; color    : red;      transform : translate(-60%,  5%) scale(0.7) rotate( 10deg); }

#dom_hide1_reset::after         { font-size: 300%; }
#dom_hide1_reset::after         { content : '\\267B'; position : absolute; transform : translate(-60%,  5%) scale(0.5) rotate(-10deg); }
#dom_hide1_reset.checked::after { content : '\\267B'; color    : red;      transform : translate(-60%,  5%) scale(0.7) rotate( 10deg); }

#targeteer::after               { font-size: 300%; }
#targeteer::after               { content : '\\2295'; position : absolute; transform : translate(-60%,  0%) scale(0.5) rotate(-45deg); }
#targeteer.checked::after       { content : '\\2295'; color    : red;      transform : translate(-59%, -7%) scale(0.7) rotate(  0deg); }

#target_01::after               { font-size: 200%; }
#target_01::after               { content : '1'  ;   position : absolute; transform : translate(-60%,  0%) scale(0.5) rotate(-45deg); }
#target_01.checked::after       { content : '1'  ;   color    : red;      transform : translate(-59%, -7%) scale(0.7) rotate(  0deg); }

#target_02::after               { font-size: 200%; }
#target_02::after               { content : '2'  ;   position : absolute; transform : translate(-60%,  0%) scale(0.5) rotate(-45deg); }
#target_02.checked::after       { content : '2'  ;   color    : red;      transform : translate(-59%, -7%) scale(0.7) rotate(  0deg); }

#target_03::after               { font-size: 200%; }
#target_03::after               { content : '3'  ;   position : absolute; transform : translate(-60%,  0%) scale(0.5) rotate(-45deg); }
#target_03.checked::after       { content : '3'  ;   color    : red;      transform : translate(-59%, -7%) scale(0.7) rotate(  0deg); }

/*}}}*/

/* dom_traversal - NodeIterator TreeWalker childNodes pageNodes {{{*/
#dom_traversal {
/*
    margin-top  : 3em;
*/
    float       : left;
    clear       : left;
    white-space : nowrap;
}

#dom_traversal>table {
    width       : 100%;
    margin-top  :  1em;
}
#tools_node {
    outline    : 2px dashed red;
}

/*}}}*/

/* dev_log_map test_panel dom_load_tags - dev_log_map RELOAD CLEAR t_log_regex  dom_load_tags {{{*/

 #dev_log_map   em
,#test_panel    em
,#dom_load_tags em
{
/*
    display     : inline-grid;
*/
    display     : inherit;
}

 #dev_log_map
,#test_panel
,#dom_load_tags
{
    float       : left;
}

 #dev_log_map
,#test_panel
{
    color       : #eee;
    font-family : "Comic sans ms";
    text-align  : left;
}
 #dev_log_map   em
,#test_panel    em
{
    text-align  : center;
}

 #dom_load_tags em
{
    text-align  : right;
}

   #transcript                      { padding       : 1em; }

 #pat_bag           em
,#sel_bag           em
,#headsup           em
,#dom_traversal     em
,#dev_log_map       em
,#test_panel        em
,#dom_load_tags     em
,#transcript1       em
,#transcript2       em
{
    white-space    : nowrap;
    margin-top     : 2px;
    z-index        : 1;
}

#dom_load_tags em
{
    min-width      : 8em;
    padding-right  : 1em;
    vertical-align : super;
}

/*}}}*/

/* big small {{{*/
.big   { font-size : 200% !important; vertical-align : middle; }
.small { font-size :  80% !important; vertical-align : middle; }

/*}}}*/
/* sym_XXX {{{*/
.sym_showing, .sym_hiding , .sym_backing, .sym_alting
.sym_colide , .sym_dismiss, .sym_binning,
.sym_bagger , .sym_docker ,
.sym_update , .sym_staged , .sym_result
{
    font-size    : 300% !important;
    font-weight  : 900  !important;
    text-shadow  : rgba(0,0,0, 0.4) .1em .1em .2em;
    line-height  : .6em;
    min-width : 1em !important;
    display : inline-block;
}

.sym_colide  { color : #F0F; }
.sym_dismiss { color : #F0F; }

.sym_update  { color : #FFA500; }
.sym_staged  { color : #6495ED; }
.sym_result  { color : #FFFF00; }

.sym_showing { color : black; text-shadow: 1px 1px 1px #FF0; font-weight:100 !important; }
.sym_hiding  { color : black; text-shadow: 1px 1px 1px #0F0; font-weight:100 !important; }
.sym_backing { color : black; text-shadow: 1px 1px 1px #F00; font-weight:100 !important; }
.sym_alting  { color : black; text-shadow: 1px 1px 1px #00F; font-weight:100 !important; }
.sym_binning { color : #444 ; text-shadow: 1px 1px 1px #DDD; font-weight:100 !important; }

.sym_bagger  { color : #58C; }
.sym_docker  { color : #C80; }

/*
.sym_bag     { text-shadow      : .1em .1em .5em rgba(255,255,255, 0.5); }
.sym_bag     { padding: 0 0 0 .5em; }
.sym_bag     { font-size:200% !important; }
*/

/*}}}*/
/* log {{{*/
.log_num_thumb {
    color : #aaa;
}

           .log_node_toString { display : inline-block; width:24em; }
.div_match .log_node_toString { display : inline !important;        }

.log_sep_line {
    border-radius  : 5em !important;
    box-shadow     : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
    min-height     : 5em;
    min-width      : 5em;
    font-size      : 200%;
}
.log_sep_line * {
    text-align     : center !important;

}
/*}}}*/
/* badge {{{*/
.badge {
    position       :  relative;

    border-radius  : 8em !important;
    box-shadow     : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em !important;

    min-height     : 8em   !important;
    min-width      : 8em   !important;

    padding        : 1em    !important;

    font-size      : 200%   !important;
    line-height    : 100%   !important;

    text-align     : center !important;
    vertical-align : middle !important;
}

.badge p {
    position       : absolute;
    margin         : 0;
    margin-right   :-50%;
    top            : 50%;
    left           : 50%;
    transform      : translate(-50%,-50%);

    text-align     : center !important;
    white-space    : normal !important;
}

/*}}}*/
/* checked {{{*/
.checked {
    border           : black solid !important;
    box-shadow       : none !important;
}

/*}}}*/

/* box-shadow {{{*/

.scrolled      >div { transition-duration        : 100ms; }
.scrolled      >div {
    box-shadow                 : 3px 3px 6px rgba(000,000,000,0.0) !important;
    transition-property        : all;
    transition-timing-function : ease-in;
/*
    border        : dotted 5px !important;
    transform     : translate(2px,2px);
*/
}

/*}}}*/

/* background {{{*/
.badge                 { background       : linear-gradient(to bottom, #FC0, #FF0); }
.info                  { background       : rgba(000,000,000,0.2); }

      .current_slot_num { color:white; background:linear-gradient(to bottom, #000, #0F0) !important; }
.back .current_slot_num { color:white; background:linear-gradient(to bottom, #F00, #000) !important; }

#sel_bag>div                  { border     : 2px solid transparent    !important; }

#sel_bag>div                  { opacity    :  0.7; }
#sel_bag>div.current_slot     { opacity    :  1.0; }
#sel_bag>div.current_slot     { box-shadow : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em      ; }
#sel_bag>div.current_slot     { border     : 4px solid #000000 !important; }

/*
#sel_bag>div.current_slot     { height     : 150%; }
#sel_bag>div.current_slot     { text-shadow: rgba( 0, 0, 0, 0.4) 1px 1px 3px; };
#sel_bag  em                  { opacity : 0.2; }
#sel_bag  em                  { opacity : 0.2; }
#sel_bag  em.current_slot_num { opacity : 1.0; }
*/

/*}}}*/

/* bag {{{*/
.bag     { padding        : 1em; }
.bag div { padding        : 0;   }
.bag  em {

    min-width   :  9px;
    min-height  :  9px;
    width       :  9px;
    height      :  9px;
/*
    margin      :  2px           ;
    box-shadow  : 2px 2px 4px rgba(000,000,000,0.9);
    border      :    0 !important;
*/   border      :    0;
}
/*
.bag em:first-of-type { font-size  : 150%; }
*/
.bag em:nth-of-type(   1) { font-size  : 150%; }
.bag em:nth-of-type(   2) { font-size  : 140%; }
.bag em:nth-of-type(   3) { font-size  : 130%; }
.bag em:nth-of-type(   4) { font-size  : 120%; }
.bag em:nth-of-type(   5) { font-size  : 110%; }
.bag em:nth-of-type(   6) { font-size  : 100%; }
.bag em:nth-of-type(   7) { font-size  :  90%; }
.bag em:nth-of-type(   8) { font-size  :  80%; }
.bag em:nth-of-type(   9) { font-size  :  70%; }
.bag em:nth-of-type(n+10) { font-size  :  60%; }

/*}}}*/

/* current_slot_num {{{*/
.current_slot_num {
    box-shadow : 0px 3px 6px rgba(000,000,000,0.8) !important;
    font-size  : 150%;
}
/*}}}*/
/* border-radius {{{*/
.bag                  { border-radius : 2em; }
.transcript_msg div   { border-radius : 1ex; }
.bag div              { border-radius : 2ex; }

#headsup              { border-radius : 2em; }
#pat_bag              { border-radius : 2em; }
#sel_bag              { border-radius : 2em; }
#dom_traversal        { border-radius : 2em; }

#headsup>div>div      { border-radius : 2em; }
#headsup>div>div      { border        : 5px solid #000000; }
#headsup>div>div div  { border-radius : 1em; }

#dom_traversal>div>div     { border-radius : 2em; }
#dom_traversal>div>div     { border        : 5px solid #000000; }
#dom_traversal>div>div div { border-radius : 1em; }

#pat_bag>div>div     { border-radius : 2em; }
#pat_bag>div>div     { border        : 5px solid #000000; }
#pat_bag>div>div div { border-radius : 1em; }
#sel_bag>div>div     { border-radius : 2em; }
#sel_bag>div>div     { border        : 5px solid #000000; }
#sel_bag>div>div div { border-radius : 1em; }

/*}}}*/

/* eso_div {{{*/
.eso_div { transition-duration         : 900ms !important; }
.eso_div { transition-delay            :   0ms !important; }
.eso_div {
    display       : inline-block           !important;
    border        : 1px solid #404040      !important;
    border-radius : 5px 5px 5px 5px        !important;
    box-shadow    : 0 0 10px #000000 inset !important;
    background    : rgba(16,16,16,.5)      !important;
    min-width     : 8em;
    min-height    : 8em;

    color         : orange !important;
    font-weight   : 700;

    transition-property : all !important;
}

/*}}}*/
/*pulse_in pulse_out {{{*/
.pulse_in { transition-duration         : 200ms !important; }
.pulse_in { transition-delay            :   0ms !important; }
.pulse_in {
    transform                   : translate(-10px, 10px) scale(2.0) !important;
    transition-property         :   all !important;
    transition-timing-function  :  ease !important;
}

.pulse_out { transition-duration         : 200ms !important; }
.pulse_out { transition-delay            :   0ms !important; }
.pulse_out {
    transform                   : scale(1) rotate(0) !important; /* restoration */
    transition-property         :   all !important;
    transition-timing-function  :  ease !important;
}

/*}}}*/

/* LI {{{*/
li:nth-child( 5n+0) { margin-bottom:.5em !important; }
li:nth-child(10n+0) { margin-bottom:.8em !important; }
li { white-space: nowrap; }

/*}}}*/
/* headsup_l {{{*/
#headsup_l {
    clear:left;
 white-space    : nowrap;
 cursor         : pointer;
 user-select    : none;
}

#dom_grid_playground_grid_sized {
 white-space    : nowrap;
 cursor         : pointer;
 user-select    : none;
}

#headsup_l_check {
 cursor         : pointer;
}

/*}}}*/

/* tool parents layout {{{*/
/* translated tools */
#headsup    { width : 270px; height  : 130px; }
#headsup_w  { width : 200px; height  : 130px; }
#headsup_ds { width : 160px; height  : 100px; }

/* inlined tools */
/*
#headsup_l  { display : inline-block; }
*/
/*}}}*/

/* GRID {{{*/
.grid_caption { /*{{{*/
    cursor              : pointer;
    display             : inline-block;
    border-radius       : 16px;
    background          : rgba( 32, 32, 64,0.9);
    text-align          : center;
    vertical-align      : middle;

}/*}}}*/
.grid_caption em { /*{{{*/
    position       : absolute;
    margin         : 0;
    margin-right   :-50%;
    top            : 50%;
    left           : 50%;
    transform      : translate(-50%,-50%);

    text-align     : center;
    white-space    : normal;
    font-family    : "Comic sans ms";
    font-weight    : 700;
    font-size      : 100%;
    background     : rgba(255,192,192,.2);
    color          : rgba(0,0,0, 1);
    border-radius  : 1em;
    padding        : 0 1ex 0 1ex;

}
/*}}}*/

/* grid_caption_hide {{{*/
.grid_caption_hide { animation-duration        : 250ms; }
.grid_caption_hide { animation-delay           : 250ms; }
.grid_caption_hide {
                     transform-origin          : 0% 0% 0;
                     animation-name            : grid_caption_hide;
                     animation-timing-function : ease-out;
                     animation-fill-mode       : both; /* retain resulting styles for both class add and remove */
}

@keyframes grid_caption_hide {
    100% { top       :        0; }
    100% { left      :        0; }
    100% { opacity   :       .1; }
    100% { transform : scale(.5) translate(-100%,-100%); }
}
/*}}}*/
.grid_caption_show  { animation-duration        :                      250ms; }
.grid_caption_show  { animation-delay           :               250ms; }
.grid_caption_show  { /*{{{*/
    animation-name            : grid_caption_show;
    animation-timing-function :                            ease-out;
    animation-fill-mode       :                                     both; /* retain resulting styles for both class add and remove */
}

@keyframes grid_caption_show {
      0% { top       :        0 ; }
      0% { left      :        0 ; }
      0% { opacity   :       .1 ; }
    100% { opacity   :       1  ; }
      0% { transform : scale(.1); }
    100% { transform : scale(1 ); }
}
/*}}}*/
.grid_caption_see_through { transition-duration : 200ms; }
.grid_caption_see_through { /*{{{*/
    background          : rgba(192,192,192,0.1);
}
/*}}}*/

/* @keyframes on_grid_enter {{{*/
   @keyframes on_grid_enter {
    100%       { transform    :  scale(0.9 ); }
}
/*}}}*/
/*}}}*/

/* index {{{*/
.index {
    font-size     : 180%;
    border-radius : 1em;
    padding-left  : .4em;
    padding-right : .4em;
    width         : 2em;
}
/*}}}*/

/* rotate {{{*/
/*
#headsup       { transform : rotate( 1deg);               }
#pat_bag       { transform : rotate( 1deg)  skewY( 1deg); }
#sel_bag       { transform : rotate(-1deg)  skewY(-1deg); }
#dom_traversal { transform : rotate( 1deg);               }
*/

/*}}}*/
/* pivot_panel {{{*/
.pivot_panel {
    /* to override dark background */
/*
    background           : linear-gradient(to bottom, #00F, #004) !important;
    border: blue dashed 4px !important;
    border: blue dotted 8px !important;
    outline: blue dotted 18px !important;
    outline: blue solid 1px !important;
    box-shadow : 0px 0px 32px rgba(128,128,255,0.9) !important;
*/
    box-shadow : 4px 4px 12px rgba(0,0,48,0.7) !important;

/*{{{
    transition-delay           : 0       !important;
    transition-duration        : 250ms   !important;
    transition-property        : all     !important;
    transition-timing-function : ease-in !important;
}}}*/
}
/*{{{
// performance drain
.pivot_panel      { border : 3px solid black; }
.pivot_panel.dark { border : 3px solid #FA0;  }
}}}*/

/*}}}*/

.pinned          {  filter :           none                  !important; }
.pivot_panel     {  filter :           none                  !important; }
.on_grid         {  filter : grayscale(50%)                  !important; }
.fully_spread    {  filter : grayscale(80%) brightness( 90%) !important; }
.dimmed_panel    { opacity : 0.1                             !important; }

/* dimmed_panel transition {{{*/
.dimmed_panel { transition : opacity  300ms ease-out; }
/*{{{
.dimmed_panel { transition : opacity  300ms cubic-bezier(0,.88,1,-0.09); }
}}}*/
/*}}}*/
/* dimmed_panel animation {{{*/
/*{{{
  .dimmed_panel { animation-name      : dimmed_panel; }
  .dimmed_panel { animation-delay     :          0ms; }
  .dimmed_panel { animation-duration  :       1000ms; }
  .dimmed_panel { animation-fill-mode :         both; }

@keyframes dimmed_panel {
      0% { opacity   :      0.9; }
     10% { opacity   :      0.5; }
     90% { opacity   :      0.5; }
    100% { opacity   :      0.1; }
}
}}}*/
/*}}}*/

/* fully_spread {{{
// performance drain
 .fully_spread { box-shadow : 0 0 .5em .5em white !important; }
}}}*/

/* standby {{{*/
.standby                 { background : linear-gradient(to bottom, #666, #222) !important; }
#sel_bag.standby         { background : linear-gradient(to bottom, #F00, #400) !important; }
#sel_bag.standby::before { content    : '\\2699'; } /* GEAR */

/*}}}*/

/* INPUT (dimmed_panel on_grid)  {{{*/
  .dimmed_panel INPUT { pointer-events      :        none; }
  .dimmed_panel INPUT { cursor              :     inherit; }

  .on_grid      INPUT { pointer-events      :        none; }
  .on_grid      INPUT { cursor              :     inherit; }
/*}}}*/

/* ########################################################################## */
/* HOTSPOT {{{*/

/* pivspot {{{*/
#pivspot   {
    pointer-events   : none;
    position         : fixed;
    transform        : translate(-50%,-50%);
    transform-origin : 50% 50% 0;

}
#pivspot.hidden { opacity : 0; }
/*}}}*/
/* pivspot_c {{{*/
#pivspot_c {
    border-radius    : 50%;
    border           : 2px solid white;
    text-shadow      : rgba( 0, 0, 0, 0.8) 1px 1px 3px;
    box-shadow       : rgba( 0, 0, 0, 0.2) 2px 2px 16px 5px;
    background       : rgba( 32, 32, 32,0.2);
    color            : white;
    font-size        : 42px;
    width            : 32px;
    height           : 32px;
}
/*}}}*/

/* hotspot {{{*/
#hotspot               { transform       : translate(-50%,-50%); }
#hotspot               { align-items     : center;               }
#hotspot               { box-sizing      : border-box;           }
#hotspot               { cursor          : pointer;              }
#hotspot               { justify-content : center;               }

#hotspot      *:after  { background      : #777;                 }
#hotspot.dark *:after  { background      : #AAA;                 }


/*}}}*/
/* hotspot::after {{{
#hotspot::after {
    float:left;
    clear:left;
    content     : "headsup::after";
    background  : red;
    border      : 2px yellow dashed;
    min-width   : 10em;
    min-height  : 10em;
    max-width   : 10em;
    max-height  : 10em;
    transform   : translate(0,100%);
    transition  : transform ease-in 500ms;
}
}}}*/
/* hotspot_c {{{*/
#hotspot_c { pointer-events   : none;                             }
#hotspot_c { border           : 2px solid white;                  }
#hotspot_c { border-radius    : 50%;                              }
#hotspot_c { box-shadow       : rgba(0,0,0,0.2) 2px 2px 16px 5px; }

#hotspot_c { margin-left      : 14px;                             }
#hotspot_c { margin-top       : 14px;                             }
#hotspot_c { width            : 12px;                             }
#hotspot_c { height           : 12px;                             }

#hotspot_c { font-weight      : 100;                              }
#hotspot_c { font-size        : 22px;                             }
#hotspot_c { text-shadow      : rgba(0,0,0,0.8) 1px 1px 3px;      }
#hotspot_c { background       : rgba( 32, 32, 32,0.2);            }

/*}}}*/
/* hotspot_c::after {{{*/
#hotspot_c::after { position         : absolute;                        }
#hotspot_c::after { left             :   0px;                           }
#hotspot_c::after { top              :  -13px;                           }
#hotspot_c::after { font-size        :   9px;                           }
#hotspot_c::after { text-shadow      : rgba( 0, 0, 0, 0.8) 1px 1px 3px; }
#hotspot_c::after { background-color : transparent;                     }

/*}}}*/
/* hotspot_c color {{{*/
      #hotspot_c        { color : #000; }
.dark #hotspot_c        { color : #FFF; }
      #hotspot_c::after { color : #000; }
.dark #hotspot_c::after { color : #FFF; }

/*}}}*/
/* hotspot_c.rotate NE SE SW NW {{{*/
#hotspot_c.rotate_NE::after { content : " NE"; }
#hotspot_c.rotate_SE::after { content : " SE"; }
#hotspot_c.rotate_SW::after { content : " SW"; }
#hotspot_c.rotate_NW::after { content : " NW"; }

.rotate_NE { transform : rotate( -45deg); }
.rotate_SE { transform : rotate( +45deg); }
.rotate_SW { transform : rotate(+135deg); }
.rotate_NW { transform : rotate(-135deg); }

.rotate_NE { background-color : rgba(150,  75, 0, .7) !important; color:#964B00; }
.rotate_SE { background-color : rgba(255,   0, 0, .7) !important; color:#FF0000; }
.rotate_SW { background-color : rgba(255, 165, 0, .7) !important; color:#FFA500; }
.rotate_NW { background-color : rgba(255, 255, 0, .7) !important; color:#FFFF00; }

.rotate_NE { transition-delay           : 100ms; }
.rotate_SE { transition-delay           : 100ms; }
.rotate_SW { transition-delay           : 100ms; }
.rotate_NW { transition-delay           : 100ms; }

.rotate_NE { transition-duration        : 300ms; }
.rotate_SE { transition-duration        : 300ms; }
.rotate_SW { transition-duration        : 300ms; }
.rotate_NW { transition-duration        : 300ms; }

.rotate_NE { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
.rotate_SE { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
.rotate_SW { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
.rotate_NW { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
/*}}}*/

/* tools_trap {{{*/
#tools_trap {
    background    :             rgba( 32, 32, 32,0.3)  !important;
    box-shadow    : 0px 3px 3px rgba(000,000,000,0.5)  !important;
    border-radius : 50%                                !important;
    border        : 0                                  !important;
    text-align    : right                              !important;
    font-size     : 500%                               !important;
    font-weight   : 900                                !important;
    padding       : .1em                               !important;
    line-height   : 50%                                !important;
    min-width     : initial                            !important;
}
#tools_trap.scrolled { box-shadow    : none            !important; }
#tools_trap.dark     { color         : #888            !important; }

/*{{{
#tools_trap.dark         { background : linear-gradient(to bottom, #211, #553); }
#tools_trap.dark.checked { background : linear-gradient(to bottom, #100, #221); }
#tools_trap                  { transition-delay            :   0ms; }
#tools_trap                  { transition-duration         :   0ms; }
#tools_trap.checked          { transition-delay            :   0ms; }
#tools_trap.checked          { transition-duration         :   0ms; }
#tools_trap.scrolled         { transition-delay            :   0ms; }
#tools_trap.scrolled         { transition-duration         :   0ms; }
}}}*/
/*}}}*/
/* .trapped  tools_trap hotspot_c pivspot_c {{{*/
#tools_trap.trapped  { border-radius : 10% 50% 50% 10% !important; }

#hotspot_c.trapped   { border-radius : 10% 50% 50% 10% !important; }
#hotspot_c.trapped   { border-radius : 50% 10% 10% 50% !important; }

#pivspot_c.trapped   { border-radius : 10% 50% 50% 10% !important; }


/*}}}*/


/* hotwave {{{*/

.hotwave {
    position           : absolute;
    background         : none !important;
/*
    height             : 3em;
*/
}

.hotwave::before {
    border-radius      : 50%;
    border             : .15em solid rgba(255,255,255, .9);
    content            : '';
    height             : 100%;
    left               : 0;
    top                : 0;
    opacity            : 0;
    position           : absolute;
    transform          : scale(2);
    transition         : transform .25s, opacity .2s;
    width              : 100%;
}

.hotwave::after {
    border-radius      : 50%;
    content            : '';
    height             : 100%;
    left               : 0;
    position           : absolute;
    top                : 0;
    width              : 100%;
/*
    background         : #fff;
*/
}

/*}}}*/
/* PULSE {{{*/
.pulse_in    { animation-name            : flyUp;  }
.pulse_in    { animation-duration        : 3s;     }
.pulse_in    { animation-timing-function : linear; }

.pulsing     { border     : #444 3px dotted;                 }
.pulsing     { background : rgba(255,000,000,.8) !important; }

@keyframes flyUp {
      0% { transform : translate(100%, -100%) scale(2.5); }
    100% { transform : translate(100%, -400%) scale(1.0); }
     10% { opacity   :.9; }
    100% { opacity   : 0; }
}
/*}}}*/
/* WAVE PULSE {{{*/
#hotspot       .hotring        { background      : linear-gradient(to bottom, #FF0, #FB0); }
#hotspot.dark  .hotring        { background      : linear-gradient(to bottom, #443, #211); }
/*
.hotring:hover                 { border             : .5em solid black !important;      }
*/
.hotwave:hover .hotring::after { opacity            : 0;                                }
.hotwave:hover .hotring::after { opacity            : 1;                                }
.hotwave:hover .hotring::after { transform          : translate(-50%, 0) scale(1);      }

/*
:!start explorer "https://developer.mozilla.org/en-US/docs/Web/CSS/animation"
:!start explorer "http://cubic-bezier.com/\#.86,1.67,.83,.67"
*/
         .hotwave::after { animation                : 3s       infinite ease-out normal wave ; }
         .hotring        { animation                : 3s       infinite linear   normal pulse; }

.freezed .hotwave::after { animation-play-state     : paused;                                  }
.freezed .hotring        { animation-play-state     : paused;                                  }
/*...progressed by the absolute value of the delay == .. negative value */
#hotspot.freezed>div>div { animation                : 12s -11s infinite steps(2) normal flash; border: 3px #000 solid !important; }
.freezed>*               { color                    : transparent !important;                  }
/*
*/

/* @keyframes pulse {{{*/
   @keyframes pulse {
      0%       { transform    : scale(1.0 ); }
      2%       { transform    : scale(0.95); }
     10%       { transform    : scale(1.1 ); }
    100%       { transform    : scale(1.0 ); }
}
/*}}}*/
/* @keyframes wave{{{*/
   @keyframes wave {
      2%       { transform    : scale(1  ); }
    100%       { transform    : scale(2  ); }
      0%       { opacity      : 1;          }
    100%       { opacity      : 0;          }
}
/*}}}*/
/* @keyframes flash{{{*/
   @keyframes flash {
      0%       { box-shadow : 0 0 3em .5em black; }
    100%       { box-shadow : 0 0 3em .5em white; }
}
/*}}}*/
/* @keyframes borderColor {{{*/
   @keyframes borderColor {
      0%       { border-color : #888;       }
    100%       { border-color : #000;       }
}
/*}}}*/

/*}}}*/
/* NE NW SE SW {{{*/
       .layout_NE>div  { margin:   0   32em    0   -32em !important; }
       .layout_NW>div  { margin:   0     0     0     0   !important; }
       .layout_SE>div  { margin:   0     0     0     0   !important; }
       .layout_SW>div  { margin:   0   32em    0   -32em !important; }

.gutter.layout_NE>div  { margin:   0     0     0     0   !important; }
.gutter.layout_NW>div  { margin:   0   32em    0   -32em !important; }
.gutter.layout_SE>div  { margin:  20em   0   -20em   0   !important; }
.gutter.layout_SW>div  { margin:  20em 32em  -20em -32em !important; }

/*}}}*/
/* GUTTER HIDE MASK PAGE SITE {{{*/
                       .dom_editing #hotring          { opacity             : 0.0                           ; }
                       .dom_editing #hotring          { width               : 2em                           ; }
                       .dom_editing #hotring          { height              : 2em                           ; }

                                    .hotwave::before  { transition-duration : 500ms                         ; }
                       .dom_editing .hotwave::before  { transition-duration : 500ms                         ; }
                       .dom_editing .hotwave::before  { opacity             : 1                   !important; }

                       .dom_editing #hotspot_c::after { text-align          : center              !important; }
                       .dom_editing #hotspot_c::after { font-size           : 16px                          ; }
                       .dom_editing #hotspot_c::after { font-weight         : 700                           ; }
                       .dom_editing #hotspot_c::after { opacity             : 1                             ; }

/* [MASK or HIDE] .. [SITE or PAGE] {{{*/

/*{{{
                       .dom_editing .hotwave::before  { outline            : 3px dashed rgba(068,000,255,.5); }
  .marked_to_hide                   .hotwave::before  { outline            : none; }
                       .dom_editing .hotwave::before  { border             : 2px dashed orange;                       }
                       .dom_editing .hotwave::before  { box-shadow         : 1px 1px  2px     0px rgba(32,32,32, .9) inset; }
                       .dom_editing .hotwave::before  { background-color   : rgba(128,  96,  96,1.0); }
  .marked_to_hide                   .hotwave::before  { background-color   : rgba( 32,  32,  32,1.0) !important; }
                       .dom_editing .hotwave::before  { background-color   : rgba( 96, 32, 32,1.0) !important; }
   .marked_to_hide     .dom_editing .hotwave::before  { background-color   : rgba(  0,  0,  0,1.0) !important; }

                       .dom_editing .hotwave::before  { border             : 1px dashed black; }
                       .dom_editing .hotwave::before  { border             : none; }
                       .dom_editing .hotwave::before  { border             : none; }
                       .dom_editing .hotwave::before  { background-color   :                      #222;       }
                       .dom_editing .hotwave::before  { background-color   :                      rgba(200, 200, 255, 0.9);       }
                       .dom_editing .hotwave::before  { border             : 2px solid black;            }
}}}*/

/*{{{
                       .dom_editing .hotwave::before  { border            : 2px solid rgba(200,200,255,1.0); }
                       .dom_editing .hotwave::before  { box-shadow        : 1px 1px  1px     0px #888 inset; }
                       .dom_editing .hotwave::before  { background-color  :                      #222      ; }
                       .dom_editing .hotwave::before  { border            : 2px solid            #AFA      ; }
.site_localstorage     .dom_editing .hotwave::before  { border            : 2px solid            #FBB      ; }
}}}*/

                       .dom_editing .hotwave::before  { border              : 2px solid            #DDD       ; }

                       .dom_editing #hotspot_c::after { color               :                      #00F       ; }
                 .site_localstorage #hotspot_c::after { color               :                      #E00       ; }

                       .dom_editing #hotspot_c::after { text-shadow         : -1px -1px 1px        #FFF       ; }
                 .site_localstorage #hotspot_c::after { text-shadow         : -1px -1px 1px        #FFF       ; }

                       .dom_editing .hotwave::before  { background-color    :                      #AAF       ; }
                  .marked_to_hide   .hotwave::before  { background-color    :                      #FFF       ; }

                       .dom_editing .hotwave::before  { box-shadow          : 1px 1px  1px     1px #FFF inset ; }/* ox oy blur spread color */
                  .marked_to_hide   .hotwave::before  { box-shadow          : 1px 1px  1px     1px #FFF inset ; }/* ox oy blur spread color */

                       .dom_editing                   { transition-duration : 250ms; }
                       .dom_editing #hotspot_c::after { margin              : 0em  0   0  -1em !important; }
                       .dom_editing #hotspot_c        { transform           : rotate(-15deg)             ; }
     .site_localstorage.dom_editing #hotspot_c        { transform           : rotate( 15deg)   !important; }

                       .dom_editing                   #hotspot_c::after { content : "PAGE\\AMASK"; }
        .marked_to_hide.dom_editing                   #hotspot_c::after { content : "PAGE\\AHIDE"; }
                       .dom_editing.site_localstorage #hotspot_c::after { content : "SITE\\AMASK"; }
        .marked_to_hide.dom_editing.site_localstorage #hotspot_c::after { content : "SITE\\AHIDE"; }

/*}}}*/

/*}}}*/
/* hotring {{{*/

#hotring {
    position           : relative;
    width              : 3em;
    height             : 3em;
    border-radius      : 50%;
    box-shadow         : 0 2px 10px rgba(0,0,0, .2);
    font-weight        : 600;
    justify-content    : center;
    text-align         : center;
/*{{{
    align-items        : center;
}}}*/
}
#hotring.all_page_items_removed  { background : red !important; } /* to override dark */

.hotring>* {
    /* skip inherited properties */
    text-align         : initial;
/*{{{
    align-items        : flex-end;
    justify-content    : initial;
    transition         : background .3s;
}}}*/
    /* add children properties  */
    transition         : background .3s;
}

.hotring>*  { transform : translate(0,-15em) scale(1.0); }
/*{{{
.hotring>*                 { transform : translate(100%,-80%) scale(1.0);  }
.hotring>*:nth-child(1)    { transform : translate(5em,-100%) scale(1.0); }
.hotring>*:nth-child(2)    { transform : translate(5em,-200%) scale(1.0); }
.hotring>*:nth-child(3)    { transform : translate(5em,-300%) scale(1.0); }
.hotring>*:nth-child(4)    { transform : translate(5em,-400%) scale(1.0); }
.hotring>*:nth-child(5)    { transform : translate(5em,-500%) scale(1.0); }

.floatlog>*:nth-child(1)   { transform : scale(0.5); }
.floatlog>*:nth-child(2)   { transform : scale(0.6); }
.floatlog>*:nth-child(3)   { transform : scale(0.7); }
.floatlog>*:nth-child(4)   { transform : scale(0.8); }
.floatlog>*:nth-child(5)   { transform : scale(0.9); }
.floatlog>*:nth-child(6+0) { transform : scale(1.5); }

.floatlog>*                { transform: translate(0,-15em) scale(1.0); }
.floatlog.layout_NW>div    { transform: translate( 100%,0) !important; }
.floatlog.layout_NE>div    { transform: translate(-100%,0) !important; }
.floatlog.layout_SE>div    { transform: translate(-100%,0) !important; }
.floatlog.layout_SW>div    { transform: translate( 100%,0) !important; }

}}}*/
/*}}}*/

/*}}}*/
/* fly_div {{{*/
#fly_div    {
    border-radius    :                 0.5em;
    background       : rgba(000,000,255,0.3);
    display          :          inline-table;
    position         :                 fixed;
    top              :                   1em;
    right            :                   1em;
    transform-origin :             100%    0;
/*
    transform        :     translate(-50%,0);
*/
}

#fly_div em {
    border      : none;
    background  : transparent;
    box-shadow  : 0.1em 0.1em 0.1em rgba(0,0,0,0.8);
}

#fly_div .closepin { position : relative; }

/*}}}*/
/* floatlog {{{*/
/*
/[^-]\(top\|left\|bottom\|right\)
/translate
*/
/*{{{
.floatlog     { display     : grid;         } .. BIG MESS ..
.floatlog>div { display     : inline-block; }
.floatlog>div { line-height :   1em;        }
.floatlog>div {  min-height : 1.5em;        }
}}}*/

.floatlog>div {
/*{{{
    height     :  1em;
    margin     : 0          !important;
}}}*/
    box-sizing : initial    !important;
    width      : 24em;
    padding    : .3em;
}
.floatlog>div { box-shadow : rgba(0,0,0,.5) .2em .2em .9em !important; }
.floatlog em  { font-size            : 80%;                    }
.floatlog>*   { white-space          : nowrap;                 }
.floatlog>*   { transform-origin     : 0 0 0;                  }

/* STAGE {{{*/

.stage_1_input , .stage_1_missed, .stage_1_more { background :linear-gradient(to top   , rgba(0,0,0,.6) 0%, rgba(0,0,0,.4) 50%, rgba(0,0,0,.5) 80%, rgba(0,0,0,.5) 95%, #111 100%); }
.stage_2_action, .stage_2_missed                { background :linear-gradient(to top   , rgba(0,0,0,.6) 0%, rgba(0,0,0,.4) 50%, rgba(0,0,0,.5) 80%, rgba(0,0,0,.5) 95%, #111 100%); }
.stage_3_result, .stage_3_missed, .stage_3_more { background :linear-gradient(to bottom, rgba(0,0,0,.6) 0%, rgba(0,0,0,.4) 50%, rgba(0,0,0,.5) 80%, rgba(0,0,0,.5) 95%, #111 100%); }

.floatlog>div.stage_1_input  { border-top                 : 2px solid #AAA              ; }
.floatlog>div.stage_1_input  { border-left                : 1px solid #AAA              ; }
.floatlog>div.stage_1_input  { border-right               : 1px solid #AAA              ; }
.floatlog>div.stage_1_input  { border-bottom              : 0         #AAA              ; }
.floatlog>div.stage_1_missed { border-top                 : 2px solid #AAA    !important; }

.floatlog>div.stage_2_action { border-top                 : 0         #AAA              ; }
.floatlog>div.stage_2_action { border-left                : 1px solid #AAA              ; }
.floatlog>div.stage_2_action { border-right               : 1px solid #AAA              ; }
.floatlog>div.stage_2_action { border-bottom              : 0         #AAA              ; }
.floatlog>div.stage_2_missed { border                     : 1px solid #AAA    !important; }

.floatlog>div.stage_3_result { border-top                 : 0         #AAA              ; }
.floatlog>div.stage_3_result { border-left                : 1px solid #AAA              ; }
.floatlog>div.stage_3_result { border-right               : 1px solid #AAA              ; }
.floatlog>div.stage_3_result { border-bottom              : 2px solid #AAA              ; }
.floatlog>div.stage_3_missed { border-bottom              : 2px solid #AAA    !important; }

.floatlog>div.stage_1_input  { border-top-left-radius     : 1em                          ; }
.floatlog>div.stage_1_input  { border-top-right-radius    : 1em                          ; }
.floatlog>div.stage_1_missed { border-top-left-radius     : 1em                !important; }
.floatlog>div.stage_1_missed { border-top-right-radius    : 1em                !important; }
.floatlog>div.stage_1_more   { border-top-left-radius     : 0                  !important; }
.floatlog>div.stage_1_more   { border-top-right-radius    : 0                  !important; }

.floatlog>div.stage_3_result { border-bottom-left-radius  : 1em                          ; }
.floatlog>div.stage_3_result { border-bottom-right-radius : 1em                          ; }
.floatlog>div.stage_3_missed { border-bottom-left-radius  : 1em                !important; }
.floatlog>div.stage_3_missed { border-bottom-right-radius : 1em                !important; }

.floatlog>div.stage_3_more   { border-bottom-left-radius  : 0                  !important; }
.floatlog>div.stage_3_more   { border-bottom-right-radius : 0                  !important; }

.floatlog>div.stage_3_more   { border-bottom              : 2px solid #888    !important; }
.floatlog>div.stage_3_more   { padding-bottom             : 2px                !important; }


.stage_0_log        { background                 : linear-gradient(to top   , rgba(0,0,0,.9) 0%, rgba(0,0,0,.7) 50%, rgba(0,0,0,.8) 80%, rgba(0,0,0,.8) 95%, #111 100%); }
.stage_0_log        { color                      : white                       ; }
.stage_0_log        { font-weight                : 700                         ; }
.stage_0_log        { border-bottom              : 2px solid #AAA              ; }
.stage_0_log        { border-left                : 1px solid #AAA              ; }
.stage_0_log        { border-right               : 1px solid #AAA              ; }
.stage_0_log        { border-top                 : 2px solid #AAA              ; }
/*{{{
.stage_0_log        { border-top-left-radius     : 0                           ; }
.stage_0_log        { border-top-right-radius    : 0                           ; }
.stage_0_log        { border-bottom-left-radius  : 0                           ; }
.stage_0_log        { border-bottom-right-radius : 0                           ; }
}}}*/
.stage_0_log        { border-radius              : 1em                         ; }
.stage_0_log        { width                      : 24em                        ; }
.stage_0_log.fading { animation                  : none              !important; }
.stage_0_log>*      { margin-right : .1em; }

/*}}}*/

/*}}}*/
/* pause_animation {{{*/
.pause_animation       { animation          : none !important; }

/*}}}*/
/* stacking {{{*/
         .floatlog>*   { animation           : 2s    ease-out forwards stacking; }
.stacking.floatlog>*   { animation-duration  : 1s   !important;                  } /* less time out of the way */

@keyframes stacking {
       0% { opacity   :.1; }
      20% { opacity   :.5; }
     100% { opacity   : 1; }
       0% { transform : translate(-25em, 13em) scale(0.5 ); }
      10% { transform : translate( -5em,  5em) scale(0.9 ); }
/*{{{
      70% { transform : translate(-20em, 13em) scale(0.9 ); }
      75% { transform : translate(  0em,  0em) scale(0.9 ); }
      80% { transform : translate(  3em,  0em) scale(0.9 ); }
     100% { transform : translate(  0em,  0em) scale(1.0 ); }
}}}*/
      20% { transform : translate(-.5em,  2em) scale(1.03); }
      40% { transform : translate(-.5em,  1em) scale(1.03); }
      80% { transform : translate(-.5em, .3em) scale(1.03); }
     100% { transform : translate(  0em,  0em) scale(1.0 ); }
}

/*}}}*/
/* removing {{{*/
.removing              {             opacity : .1; }
.removing              { transform           : translate(  0em, 12em) scale(1.0); }
.removing              { transition-property : transform;                         }
.removing              { transition-duration : 3s;                                }

.removing              { animation           : 3s 1s  ease-out forwards removing; }
@keyframes removing    {
    100% { opacity   : 0; }
    100% { border    : 0; }
    100% { height    : 0; }
    100% { padding   : 0; }
}
/*}}}*/
/* fading {{{*/
.pin_seekspot { }
.fading      { transition-duration : 3s;                          }
.fading      { animation           : 5s ease-out forwards fading; }

@keyframes fading {
      0% { height    : 1em; }
      0% { opacity   : 1  ; }

     90% { height    : 1em; }
     90% { opacity   : .8 ; }

    100% { height    :.2em; }
    100% { opacity   :  .8; }

    100% { padding   : 0; }
    100% { border    : 0; }
}
/*}}}*/

/* ########################################################################## */
/* standby {{{*/
.standby {
    box-shadow    : 0 0 1em 1em #FDD !important;
/* padding-right : 8em !important; */
}
.standby::before {
    position      : absolute;
    right         : .5em;
    top           : .1em;
    color         : black;
    font-size     : 300%;
    text-shadow   : #AAA 1px 1px 1px;
}
.standby::before { transform-origin   : 50% 55% 0; }
.standby::before { animation-name     : cycle;  }
.standby::before { animation-duration : 1s;     }

/* @keyframes cycle {{{*/
   @keyframes cycle {
      0% { transform : rotate(  0deg); }
    100% { transform : rotate(360deg); }
}
/*}}}*/
/*}}}*/
/* panel_pressed_glowing {{{*/
.panel_pressed_glowing { transition-duration         :   1750ms; }
.panel_pressed_glowing { transition-delay            :   1250ms; }
.panel_pressed_glowing {
    box-shadow                  : 0 0 1em 0em #FFF !important;
    transform                   : scale(2.1);

    transition-property         : transform, box-shadow;
    transition-timing-function  : ease-in  , ease-in   ;
}

.panel_magnifying_glass::before {
    position      : absolute;
    right         : .5em;
    top           : .1em;
    color         : black;
    font-size     : 500%;
    content       : '\\1f50D';
    text-shadow   : #AAA 1px 1px 1px;
}
/*
    color         : rgba(255,255,255,.8);
*/

/* {{{
    box-shadow                  : 3px 3px 6px rgba(FFF,FFF,FFF,0.5) !important;

    background                  : white;
    background                  : black;
    transition                  : Property Duration Function Delay, D P F D, ...;

    transition                  : 500ms;
    transition-delay            : 500ms;

    background : linear-gradient(to bottom, rgba(0,0,0,1), rgba(255,255,255,.1));
    background : linear-gradient(to bottom, rgba(0,0,0,1), rgba(255,255,255,.1));
    background : linear-gradient(to    top, rgba(0,0,0,.5) 0%,rgba(0,0,0, 1) 8%, rgba( 0, 0, 0,.9) 80%, rgba(32,32,32,.6) 95%, #111 100%);
    background : linear-gradient(to    top, rgba(0,0,0,.5) 0%,rgba(0,0,0,.9) 8%, rgba(32,32,32,.6) 95%,                        #111 100%);

    transition-duration         : 500ms;
    transition-timing-function  : ease-in;

    border-radius               : .2em !important;
    border-radius               : 50% !important;

    border                      : 1em solid black !important;
    border                      : 1em solid transparent !important;

    outline                     : 2em navy   solid  !important;
    outline                     : 2em orange solid  !important;

    background:#DDD;
    background:#AAA;
    background:transparent;

    transition-timing-function  : ease-out;
    transition-timing-function  : cubic-bezier(0.080, 1.015, 0.055, 0.930);
    transition-timing-function  : cubic-bezier(0.250, 0.250, 0.900, 1.200);
    transition-timing-function  : cubic-bezier(1.000, 0.500, 0.300, 1.000);

    transition-delay            : 500ms;

    transition-property         : border;
    transition-property         : border;
}}}*/
/*}}}*/

/* ############################################################### dimm_mask  */
/* dimm_mask {{{*/
#dimm_mask {
    cursor              : not-allowed;
    background-color    : rgba(64,64,64,0.4);
    overflow            : auto;
    transition          : background-color 500ms;
}

.dimm_light { background : linear-gradient(to left,rgba(0,0,0,0.3), rgba(64,64,64,0.5) 50%, rgba(032,032,032,0.8)); }
.dimm_dark  { background : linear-gradient(to left,rgba(0,0,0,0.8), rgba(64,64,64,0.9) 50%, rgba(032,032,032,1.0)); }

/* buttons {{{*/
/* ..................................assume 1em===80px .................... */

#dimm_mask          >EM      { cursor           : pointer;                   }
#dimm_mask          >EM      { pointer-events   : auto;                      }
#dimm_mask          >EM      { transition       : all 250ms ease-out;        }
                             
#dimm_mask          >EM      { border           : none;                      }
#dimm_mask          >EM      { font-size        : 80px;                      }

#dimm_mask          >EM      { opacity          : 0.3;                       }
#dimm_mask          >EM      {            color : black;                     }
#dimm_mask          >EM      { background-color : transparent;               }

/*{{{
#dimm_mask          >EM.left { height           : 20%                   !important; }
}}}*/
#dimm_mask          >EM.left { background-color : rgba(0,0,0,0.2) !important; }


/* layout */

 .button_prev              { display:none; position:fixed; top:120px; bottom:unset; left:unset; right: 40px; margin:0 0 0 0; }
 .button_next              { display:none; position:fixed; top:240px; bottom:unset; left:unset; right: 40px; margin:0 0 0 0; }

 .button_prev.left         { display:none; position:fixed; top:unset; bottom:240px; left:  0px; right:unset; margin:0 0 0 -40px; width:80px; padding-right:30px; }
 .button_next.left         { display:none; position:fixed; top:unset; bottom:120px; left:  0px; right:unset; margin:0 0 0 -40px; width:80px; padding-left :30px; }

 .button_mono              { display:none; position:fixed; top:360px;  left:unset; right: 40px; margin:0 0 0 0; }

 .button_next.left         { border-radius    :  0px 40px 40px  0px; }
 .button_prev.left         { border-radius    : 40px  0px  0px 40px; }

 .button_prev              { transform        : rotate(180deg) translate( 0px,0px) !important; }
 .button_prev.pressed      { transform        : rotate(190deg) translate(10px,0px) !important; }
 .button_next              { transform        : rotate(  0deg) translate( 0px,0px) !important; }
 .button_next.pressed      { transform        : rotate( 10deg) translate(10px,0px) !important; }

 .button_prev.left         { transform        : rotate(180deg) translate( 0px,0px) !important; }
 .button_prev.left.pressed { transform        : rotate(180deg) translate(10px,0px) !important; }
 .button_next.left         { transform        : rotate(  0deg) translate( 0px,0px) !important; }
 .button_next.left.pressed { transform        : rotate(  0deg) translate(10px,0px) !important; }

 .button_mono              { transform        : rotate(  0deg) !important; }
 .button_mono.pressed      { transform        : rotate(180deg) !important; }

/*}}}*/
/*}}}*/
/* div_slot_containers {{{*/

#div_slot_containers                         { transition     : all 250ms ease-out !important; }

#div_slot_containers>*                       { transition     : all 250ms ease-out !important; }

#div_slot_containers {
    display               : grid;

    user-select           : none;
    cursor                : copy;

    position              : relative;

    grid-template-columns : repeat(3, 1fr); /* i.e. 1fr 1fr 1fr .. 3 fragments of available space*/
    grid-template-rows    : 1fr auto;
/*{{{
    grid-template-rows    : repeat(3, 1fr);
    grid-auto-flow        : column;
}}}*/

    margin                : 0 !important;

    box-shadow            : 2px 2px 32px rgba(0,0,0,0.2) !important;

    padding               : 0 !important;

    background-color      : rgba(64,64,64,1.0);
    transition            : all 500ms ease-in;
}
#div_slot_containers.fullscreen     { grid-template-columns : auto; } /* single child */
#div_slot_containers.fullscreen     {
    opacity          : 1     !important;
    background       : #AAA  !important;
    transition       : all 250ms ease-out;
}

/*{{{
    transition : all 500ms ease-out;
    opacity    : 1 !important;
}}}*/

/*}}}*/
/* div_slot_containers>div {{{*/
#div_slot_containers>div {

    min-width             : 8em;
    margin                : 1ex 1ex 1ex 1em;

    box-shadow            : 0 0 .5em #333;

    border-radius         : 0 1em 1em 0;
    border-left-style     : solid;
    border-left-width     : .5em;

    padding               : 1ex 1em 1ex 1em;

    opacity               : 0.8;
    color                 : #000;
    overflow              : hidden;
    font-weight           : 700;
    font-weight           : 600;
}

#div_slot_containers            div { cursor         : all-scroll; }
#div_slot_containers.fullscreen>div { cursor         : grab;       }
#div_slot_containers   .button_copy { cursor         : pointer;    }

.button_copy em                     { pointer-events : none; }
.button_copy em                     { padding-left:1em; padding-right:1em; color:white; background:#0008; }

#div_slot_containers>div {             color : black; }

                  .note1 {  background-color : rgba(150,075,000,0.2); border-color : #964B00;                      }
                  .note2 {  background-color : rgba(255,000,000,0.2); border-color : #FF0000;                      }
                  .note3 {  background-color : rgba(255,165,000,0.2); border-color : #FFA500;                      }
                  .note4 {  background-color : rgba(255,255,000,0.2); border-color : #FFFF00;                      }
                  .note5 {  background-color : rgba(154,205,050,0.2); border-color : #9ACD32;                      }
                  .note6 {  background-color : rgba(100,149,237,0.2); border-color : #6495ED;                      }
                  .note7 {  background-color : rgba(238,130,238,0.2); border-color : #EE82EE;                      }
                  .note8 {  background-color : rgba(160,160,160,0.2); border-color : #A0A0A0;                      }
                  .note9 {  background-color : rgba(221,221,221,0.2); border-color : #DDDDDD; border-style:double; }
                  .note0 {  background-color : rgba(128,128,128,0.2); border-color : #202020; border-style:double; }
/*}}}*/
/* .container_selected {{{*/
#div_slot_containers>.container_selected { border   : 0.5em #222 solid; }
#div_slot_containers>.container_selected { opacity  : 1.0;              }
#div_slot_containers>.container_selected { color    : #000;             }

/*{{{
.content_is_too_big::before              {          content : "content_is_too_big"; }
}}}*/
.content_is_too_big                      {       font-style : italic;               }
.content_is_too_big                      {            color : #888  !important;     }
.content_is_too_big                      { background-color : #DDD  !important;     }
/*}}}*/
/* .button_magnify {{{*/
            .button_magnify { pointer-events   : auto    !important; } /* override div_slot_containers blocked links */
.fullscreen .button_magnify { pointer-events   : none    !important; } /* but not when in fullscreen */

            .button_magnify { cursor           : pointer !important; }
            .button_magnify { border           : none;               }
            .button_magnify { float            : right;              }
            .button_magnify { margin-right     : 0;                  }
            .button_magnify { margin-top       : 0;                  }

            .button_magnify { font-size        : 80px    !important; }
            .button_magnify {            color : black   !important; }
            .button_magnify { background-color : transparent;        }
            .button_magnify { opacity          : 0.8;                }

.fullscreen .button_magnify { transform        : rotate(90deg);      }

            .button_magnify { transition       : all 250ms ease-in;  }
/*}}}*/
/* .button_COPY {{{*/

/* override div_slot_containers blocked links */
/*{{{
.button_COPY       { pointer-events   : auto !important; }
}}}*/

.button_COPY       { display          : inline;          }
.button_COPY       { margin           : 0                            !important; }
.button_COPY       { cursor           : copy                         !important; }
.button_COPY       { opacity          : 0.3; }
.button_COPY       { background-color : white;                                   }
.button_COPY       { color            : #444                         !important; }
.button_COPY       { border-radius    : 0 1em 1em 0;                             }
.button_COPY       { padding          : 0.1em                        !important; }

.button_COPY:hover { opacity          : 1.0; }
.button_COPY:hover { box-shadow       : 2px 2px 32px rgba(0,0,0,0.9);            }

/*{{{
.button_COPY:hover { transform        : scale(1.1) translate(0,-50%) !important; }
.button_COPY:hover { margin-left      : 0.5em     !important; }
.button_COPY:hover { margin-bottom    : 0.5em     !important; }
.button_COPY *     {            color : inherit !important; }
.button_COPY *     { background-color : inherit !important; }
}}}*/

/*}}}*/
/* .div_copy_content {{{*/
.div_copy_content         { pointer-events   : none; } /* block links */

.div_copy_content         { margin           : 0.5em 80px .5em 1em !important; } /* dimm_mask tools EM to the right */

/*{{{
.div_copy_content         { outline          : 5px dotted lime     !important; }

.div_copy_content         { border-radius    : 1em; }
.div_copy_content         { box-shadow       : rgba(0, 0, 0, 0.3) 0.3em 0.3em 0.3em inset; }
}}}*/

/*}}}*/
/* ################################################################## pat_bag */
/* pat_bag .. border {{{*/
#pat_bag                  { padding-right  : 1.5em; } /* some room for [bag_rot] */
#pat_bag.wide_panel       { padding-right  : 4.5em; }
/*{{{
#pat_bag.tall_panel       { padding-top    : 3em; }
}}}*/

#pat_bag                  { padding-bottom : 5.0em; } /* some room for bot_div absolute position */
#pat_bag {
    border-top    : 1px solid rgba(255,255,255,1 ) !important;
    border-left   : 3px solid rgba(255,255,255,.5) !important;
}
#pat_bag.dark {
    border-top    : 1px solid rgba(255,255,192,.3) !important;
    border-left   : 3px solid rgba(255,255,192,.1) !important;
}

/*}}}*/
/* pat_bag .. padding {{{*/

/*}}}*/
/* pat_bag .. bot_div {{{*/
/* position {{{*/
#bot_div { position:absolute; bottom:0;  left:.5em !important; width:100% !important;   }
#bot_div { overflow  : visible !important; }

/*}}}*/
/* display {{{*/
#bot_div>* { display:inline !important; }

/*}}}*/
/* border {{{*/

#fly_log           { font-size     : 150%; }
#bag_rot           { font-size     : 100%; }
#pat_sort          { font-size     : 150%; }

#fly_log           { position      : absolute; right:0.9em; bottom:  0  ; }
#bag_rot           { position      : absolute; right:0.9em; bottom:  1em; }
#pat_sort          { position      : absolute; right:3.8em; bottom:  0  ; }

#fly_log           { margin        :     0  .2em -.4em 0 !important; }
#pat_sort          { margin        : -.7em -.3em     0 0 !important; }
#bag_rot           { margin        : 0 1em 1em 0         !important; }

#bag_rot           { min-width     :    5em; }
#pat_sort          { min-width     :  1.7em; }

#bag_rot           { text-align    : center; }
#pat_sort          { text-align    : center; }

#bag_rot           { margin        : 0 1em 2.5em 0        !important; }
#bag_rot *         { pointer-events: none                 !important; }

#bag_rot           { padding       : .1em                !important; }
#pat_sort          { padding       : .3em  0em .3em  0em !important; }
#fly_log           { padding       : .6em                !important; }


#bag_rot           { border        : none                !important; }
#pat_sort          { border        : none                !important; }
#fly_log           { border        : none                !important; }
#bag_rot           { border-radius : 0.5em               !important; }
#pat_sort          { border-radius : 0.9em               !important; }
#fly_log           { border-radius : 1.8em   0    0   0  !important; }

/*}}}*/
/* hover & disabled .. background & box-shadow {{{*/
#bag_rot:hover           { box-shadow : 0 0 .3em .2em #F00 !important; }
#pat_sort:hover          { box-shadow : 0 0 .3em .2em #F00 !important; }
#fly_log:hover           { box-shadow : 0 0 .3em .2em #F00 !important; }

#bag_rot.disabled        { background : rgba(128,128,128,.2)        !important; }
#pat_sort.disabled       { background : rgba(128,128,128,.2)        !important; }
#fly_log.disabled        { background : rgba(128,128,128,.2)        !important; }

#bag_rot.disabled:hover  { background : transparent        !important; }
#bag_rot.disabled:hover  { box-shadow : none               !important; }
#pat_sort.disabled:hover { background : transparent        !important; }
#pat_sort.disabled:hover { box-shadow : none               !important; }
#fly_log.disabled:hover  { background : transparent        !important; }
#fly_log.disabled:hover  { box-shadow : none               !important; }

/*}}}*/
/* vertical-align {{{*/
#bot_div   { vertical-align: bottom !important;}
#bot_div>* { vertical-align: bottom !important;}

/*}}}*/
/* white-space {{{*/

/*}}}*/
/* font {{{*/
.txt_log {
    position       : absolute; left : .1em; bottom : .1em;
    pointer-events : none;

    border         : none             !important;
    padding        : 0 1em 0 1em      !important;

    text-shadow    : #008 1px 1px 3px !important;
    font-family    : "Comic sans ms"  !important;
    font-size      : 60%              !important;
    font-style     : oblique          !important;
    font-weight    : 100              !important;
    white-space    : pre;
}

/*}}}*/
/* background {{{*/

.txt_log          { background : linear-gradient(to top, rgba(255,255,255,.1) 2%, transparent 25%, rgba(  0,  0,  0,.1) 80%, rgba(255,255,255,.1) 100%); }

#bag_rot          { background : linear-gradient(to top, rgba(  0,  0,  0,.1) 20%, rgba(  0,  0,  0,.3) 80%, rgba(  0,  0,  0,.9) 100%); }
#bag_rot.checked  { background : linear-gradient(to top, rgba(255,  0,  0,.1) 20%, rgba(255,  0,  0,.3) 80%, rgba(255,255,255,.9) 100%); }

#pat_sort         { background : linear-gradient(to top, rgba(  0,  0,  0,.1) 20%, rgba(  0,  0,  0,.3) 80%, rgba(  0,  0,  0,.9) 100%); }
#pat_sort.checked { background : linear-gradient(to top, rgba(255,  0,  0,.1) 20%, rgba(255,  0,  0,.3) 80%, rgba(255,255,255,.9) 100%); }
/*{{{
#pat_sort.user_set{ background : linear-gradient(to top, rgba(255,255,  0,.1) 20%, rgba(255,255,  0,.3) 80%, rgba(255,255,255,.9) 100%); }
}}}*/
#pat_sort.user_set{ background : none; }

#fly_log          { background : linear-gradient(to top, rgba(  0,  0,  0,.1) 20%, rgba(  0,  0,  0,.3) 80%, rgba(255,255,255,.3) 100%); }
#fly_log.checked  { background : linear-gradient(to top, rgba(255,  0,  0,.1) 20%, rgba(255,  0,  0,.3) 80%, rgba(255,255,255,.3) 100%); }
/*}}}*/
/* color {{{*/

      #bot_div>*{ color : #000 !important; }
.dark #bot_div>*{ color : #CCC !important; }

      #bag_rot  { color : #000 !important; }
.dark #bag_rot  { color : #CCC !important; }

      #pat_sort { color : #000 !important; }
.dark #pat_sort { color : #CCC !important; }

      #fly_log  { color : #000 !important; }
.dark #fly_log  { color : #CCC !important; }

/*}}}*/
/*}}}*/
/* pat_bag .. pat_span {{{*/
.pat_span          { float : left; clear  : left; }

.pat_clicked       { box-shadow : 0 0 .1em .1em rgba(0,0,0,0.8) inset !important; }
.pat_clicked       { opacity    : .3                                  !important; }
/*
.want    , .have                { vertical-align   : super; }
*/
.bags    , .want    , .have    , .done     { background       : linear-gradient(to bottom, rgba(034,034,034,0) 0%, rgba(034,034,034,0.6) 20%, rgba(034,034,034,0) 88%) !important; }
.bags.cc1, .want.cc1, .have.cc1, .done.cc1 { background-color : #964B00 !important; }
.bags.cc2, .want.cc2, .have.cc2, .done.cc2 { background-color : #FF0000 !important; }
.bags.cc3, .want.cc3, .have.cc3, .done.cc3 { background-color : #FFA500 !important; }
.bags.cc4, .want.cc4, .have.cc4, .done.cc4 { background-color : #FFFF00 !important; }
.bags.cc5, .want.cc5, .have.cc5, .done.cc5 { background-color : #9ACD32 !important; }
.bags.cc6, .want.cc6, .have.cc6, .done.cc6 { background-color : #6495ED !important; }
.bags.cc7, .want.cc7, .have.cc7, .done.cc7 { background-color : #EE82EE !important; }
.bags.cc8, .want.cc8, .have.cc8, .done.cc8 { background-color : #A0A0A0 !important; }
.bags.cc9, .want.cc9, .have.cc9, .done.cc9 { background-color : #FFFFFF !important; }
.bags.cc0, .want.cc0, .have.cc0, .done.cc0 { background-color : #202020 !important; }

#off_bag .pat_span .cc0         { background-color : rgba(  0, 32,  0,0.30) !important; }
#bak_bag .pat_span .cc0         { background-color : rgba(032,  0,  0,0.30) !important; }
#alt_bag .pat_span .cc0         { background-color : rgba(  0,  0, 32,0.30) !important; }

#off_bag .pat_span .cc0         {            color : rgba(255,255,255,0.66) !important; }
#bak_bag .pat_span .cc0         {            color : rgba(255,240,255,0.53) !important; }
#alt_bag .pat_span .cc0         {            color : rgba(240,255,255,0.53) !important; }

#off_bag .pat_span .cc0         { font-weight      : 100                    !important; }
#bak_bag .pat_span .cc0         { font-weight      : 300                    !important; }
#alt_bag .pat_span .cc0         { font-weight      : 300                    !important; }

#off_bag .pat_span .cc0         { box-shadow       : .05em .05em    0      rgba(255,255,255,0.7)       !important; }
#bak_bag .pat_span .cc0         { box-shadow       : .05em .05em    0      rgba(255,255,255,0.7)       !important; }
#alt_bag .pat_span .cc0         { box-shadow       : .05em .05em    0      rgba(255,255,255,0.7)       !important; }

.want { border : 1px dashed white  !important; }
.have { border : 1px solid  white !important; }
.want, .have {
    border-top-left-radius     : .8em;
    border-top-right-radius    : .8em;
    border-bottom-left-radius  : .3em;
    border-bottom-right-radius : .3em;
    padding-top                : .1em;
    padding-bottom             : .0em;
}
/*{{{
}}}*/

.bags {
    border-top-left-radius     : .3em;
    border-top-right-radius    : .3em;
    border-bottom-left-radius  : .8em;
    border-bottom-right-radius : .8em;
    padding-top                : .1em;
    padding-bottom             : .3em;
}

/*
.done     { background       : linear-gradient(to right, rgba(034,034,034,0) 0%, rgba(034,034,034,0.6) 20%, rgba(034,034,034,0) 88%) !important; }
*/
.done {
    border-top-left-radius     : .1em;
    border-bottom-left-radius  : .1em;
    border-top-right-radius    : 1em;
    border-bottom-right-radius : 1em;
    border: .1em solid white !important;
}

/*
.want              { border           : 2px solid magenta  !important; }
.have              { border           : 2px solid yellow !important; }
.done              { border           : 2px solid red    !important; }
*/

/*
.pat_span          { width          :  15.4em; }
*/
/*}}}*/
/* pat_bag .. num_em {{{*/
.num_em {
    pointer-events   : none;
    font-family      : monospace;
    background-color : rgba(192,192,192,.1);
    border-radius    : .3em;
    padding          : .1em;
    margin           : .1em;
}

/*}}}*/
/* pat_bag .. place_holder {{{*/
            .place_holder { display    : none;                            }
            .place_holder { opacity    : 0;                               }
/*}}}*/
/* pat_bag .. has_moving_child {{{*/
.has_moving_child          em {   position : relative;                    }
/*
.has_moving_child #off_bag em { box-shadow : 1px 1px 3px #F00 !important; }
.has_moving_child #bak_bag em { box-shadow : 1px 1px 3px #00F !important; }
.has_moving_child #alt_bag em { box-shadow : 1px 1px 3px #0F0 !important; }
*/
/*}}}*/
/* pat_bag .. mov_div {{{*/
#mov_div { position  : absolute; }
#mov_div { top       :        0; }
#mov_div { left      :        0; }
/*{{{
#mov_div { width     : initial !important; }
#mov_div { height    : initial !important; }
#mov_div { transition-timing-function : cubic-bezier(0.5, 0.05, 0.9, 1.2); }
#mov_div { opacity   : .6; }
#mov_div { font-size : 200%; }
#mov_div { position : relative; }
#mov_div { float:left; }
}}}*/

#mov_div.moving     { transition-duration :       100ms ; }

#mov_div.grayed_out { opacity             :         0.3 ; }
#mov_div.grayed_out { transform           : scale(  0.5); }
#mov_div.grayed_out { transition-duration :       100ms ; }

/*}}}*/
/* pat_bag .. mov_src {{{*/
.mov_src {
    background : linear-gradient(to bottom, rgba(  0,  0,  0,.9) 20%, rgba(  0,  0,  0,.7) 80%, rgba(  0,  0,  0,.9) 100%);
    color: gray !important;

/*{{{
background : linear-gradient(to bottom, rgba(  0,  0,  0,.9) 20%, rgba(  0,  0,  0,.7) 80%, rgba(  0,  0,  0,.9) 100%);
background : linear-gradient(to bottom, rgba(  0,  0,  0,.9) 20%, rgba(  0,  0,  0,.7) 80%, rgba(255,255,255,.9) 100%);

border     : 5px solid black !important;

color      : #AAA            !important;
color      : transparent !important;

margin     : 0px             !important;

opacity    : .5 !important;

outline    : 2px dotted red  ;
outline    : 5px dotted white;
outline    : blue 2px dotted;

padding    : 5px             !important;

}}}*/
}
/*}}}*/
/* pat_bag .. mov_dst {{{*/
#mov_dst {

/*
    font-size : 100%;
    position  : absolute;
    width     : initial !important;
    height    : initial !important;
*/
}
/*}}}*/
/* pat_bag .. hov1-hov4 {{{*/
#hov1 { position : absolute; display:none; color: #00F; font-size:12px; transform: translate( -85%,-70%); margin:0; padding:0; }
#hov2 { position : absolute; display:none; color: #F40; font-size:12px; transform: translate( -10%,-33%); margin:0; padding:0; }
#hov3 { position : absolute; display:none; color: #F00; font-size:12px; transform: translate( -85%,-70%); margin:0; padding:0; }
#hov4 { position : absolute; display:none; color: #40F; font-size:12px; transform: translate( -10%,-33%); margin:0; padding:0; }

/*}}}*/

/* MODES */
/* pat_bag .. dimmed {{{*/
.dimmed>.pat_span { opacity    : .2    !important;  }

/*}}}*/
/* pat_bag .. standby {{{*/
#pat_bag.standby::before  { content          : '\\267B';         } /* recycle */
#pat_bag.standby          { background       : linear-gradient(to bottom, #F00, #400) !important; }
#pat_bag.standby em       { background-color : #F88 !important; }
#pat_bag.standby em       { color            : #000;            }
#pat_bag.standby em       { box-shadow       : none;            }

/*}}}*/

/* PATTERNS */
/* pat_bag .. open_bag {{{*/
/*{{{
#pat_bag.open_bag  { width      :  26em; }
#pat_bag.open_bag  { min-height :   7em; }
}}}*/
/*}}}*/
/* pat_bag .. grid_bag {{{*/
/*{{{*/
          .full               { transition-duration   : 1000ms;          }
          .grid_bag           { transition-duration   : 1000ms;          }
          .grid_bag #off_bag  { border-radius         : 1em 1em 1em 1em; }
          .grid_bag #bak_bag  { border-radius         : 1em 1em 1em 1em; }
          .grid_bag #alt_bag  { border-radius         : 1em 1em 1em 1em; }
          .grid_bag           { display               : grid !important;         }
          .grid_bag           { grid-gap              :    0;                    }
          .grid_bag           { grid-auto-columns     : minmax(12em, auto);      }
/*}}}*/

.grid_bag>.pat_span                 { grid-column-start     :  1;                      }
      span.pat_span:nth-of-type( 1) {                             grid-row-start :  1; }
      span.pat_span:nth-of-type( 2) {                             grid-row-start :  2; }
      span.pat_span:nth-of-type( 3) {                             grid-row-start :  3; }
      span.pat_span:nth-of-type( 4) {                             grid-row-start :  4; }
      span.pat_span:nth-of-type( 5) {                             grid-row-start :  5; }
      span.pat_span:nth-of-type( 6) {                             grid-row-start :  6; }
      span.pat_span:nth-of-type( 7) {                             grid-row-start :  7; }
      span.pat_span:nth-of-type( 8) {                             grid-row-start :  8; }
      span.pat_span:nth-of-type( 9) {                             grid-row-start :  9; }
      span.pat_span:nth-of-type(10) {                             grid-row-start : 10; }

          #off_bag                  { grid-column-start     :  1 !important; grid-row-start : 11; }
          #bak_bag                  { grid-column-start     :  2 !important; grid-row-start :  1; grid-row-end : 12; }
          #alt_bag                  { grid-column-start     :  3 !important; grid-row-start :  1; grid-row-end : 12; }

/*{{{
.grid_bag #off_bag                  { grid-column-start     :  1; grid-row-start :  1; grid-row-end : 12; }
.grid_bag #off_bag                  { grid-column-start     :  1; grid-row-start :  1; }
          #off_bag.empty            { display               : none;                    }
.grid_bag #bak_bag                  { grid-column-start     :  2; grid-row-start :  1; grid-row-end : -1; }

          #off_bag.full             {                             grid-row-start :  1; }
          .grid_bag           { grid-template-columns : 1fr 2fr 3fr   ;   }
          .grid_bag           { grid-auto-rows        : minmax(100px, auto);      }
          .grid_bag           { grid-template-columns : repeat(3, 1fr);   }
}}}*/

/*}}}*/
/* off_bag {{{*/
          #off_bag          { float   : left; clear : left; }

          #bak_bag          { float   : left; clear : left; }
          #bak_bag          { display : none;               } /* depends on open_bag */

          #alt_bag          { float   : left; clear : left; }
          #alt_bag          { display : none;               } /* depends on open_bag */

          #off_bag          { padding : .5em !important;    }
          #bak_bag          { padding : .5em !important;    }
          #alt_bag          { padding : .5em !important;    }

/*{{{

.open_bag #off_bag          { min-height : 2em;             }
          #off_bag          {    opacity : 0;               }
.open_bag #off_bag          {    opacity : 1    !important; }
          #off_bag          {      width : 0; height :    0; }
}}}*/
.open_bag #off_bag          {      width : 14em; height : auto; }
/*}}}*/
/* bak_bag {{{*/
.open_bag #bak_bag          { display : block; }
.open_bag #bak_bag          { width : 14em; }
/* {{{
.open_bag #bak_bag          {      width : 14em; height : auto; }
.open_bag #bak_bag          {      width : 14em; height : 1em !important; }
          #bak_bag>*        {      display : none; }
.open_bag #bak_bag>*        {      display : initial; }
          #bak_bag          {      display :   none; }
.open_bag #bak_bag          {      display :  block; }
.open_bag #bak_bag          { transition : opacity,height,width      250ms              ease     0ms; }
}}}*/
/* DEPENDENT on open_bag {{{
.open_bag #bak_bag          { min-height : 7em; }
}}}*/
/* KEEP IT VISIBLE AT ALL TIMES {{{
          #bak_bag          {    opacity : 0; }
.open_bag #bak_bag          {    opacity : 1 !important; }
}}}*/
/* KEEPT IT SIZED AT ALL TIMES {{{
          #bak_bag          {      width : 0; height :    0; }
}}}*/
/*}}}*/
/* alt_bag {{{*/
.open_bag #alt_bag          { display : block; }
.open_bag #alt_bag          { width   :  14em; }
/*}}}*/
/* off_bag bak_bag alt_bag .. margin {{{*/

          #off_bag          { border-radius    : 1em 1em 0 0;                      }
          #off_bag          { margin-bottom    : 0;                                }

          #bak_bag          { margin-top       : 0;                                }
          #bak_bag          { border-radius    : 0 0 1em 1em;                      }

          #alt_bag          { margin-top       : 0;                                }
          #alt_bag          { border-radius    : 0 0 1em 1em;                      }

/*}}}*/
/* off_bag bak_bag alt_bag .. border {{{*/
          #off_bag          { border-top       : 3px solid rgba(034,034,034,0.07); }
          #off_bag          { border-left      : 2px solid rgba(034,034,034,0.07); }
          #off_bag          { border-right     : 2px solid rgba(034,034,034,0.07); }
          #off_bag          { border-bottom    : 1px solid rgba(034,034,034,0.07); }

          #bak_bag          { border-top       : 1px solid rgba(034,034,034,0.07); }
          #bak_bag          { border-left      : 2px solid rgba(034,034,034,0.07); }
          #bak_bag          { border-right     : 2px solid rgba(034,034,034,0.07); }
          #bak_bag          { border-bottom    : 3px solid rgba(034,034,034,0.07); }

          #alt_bag          { border-top       : 1px solid rgba(034,034,034,0.07); }
          #alt_bag          { border-left      : 2px solid rgba(034,034,034,0.07); }
          #alt_bag          { border-right     : 2px solid rgba(034,034,034,0.07); }
          #alt_bag          { border-bottom    : 3px solid rgba(034,034,034,0.07); }

/*}}}*/
/* off_bag bak_bag alt_bag .. background {{{*/
/*{{{
          #bak_bag          { background : linear-gradient(to bottom, rgba(034,034,034,0.07) 0%, rgba(000,000,000,0.53) 85%, rgba(034,034,034,0.13) 95%, rgba(000,000,000,0.07) 100%); }
          #off_bag          { background : linear-gradient(to top   , rgba(034,034,034,0.07) 0%, rgba(034,034,034,0.53) 85%, rgba(034,034,034,0.13) 95%, rgba(034,034,034,0.07) 100%); }
          #off_bag          { background : linear-gradient(to top   , rgba(034,034,034,0.07) 0%, rgba(255,255,255,0.53) 98%, rgba(034,034,034,0.07) 100%); }
          #off_bag          { background : linear-gradient(to top   , rgba(25, 25, 25, 0.65) 25%, rgba(0, 0, 0, 0.28) 95%, rgba(255, 255, 255, 0.64) 95%); }
          #off_bag          { background : linear-gradient(to top, rgba(0,0,0,.2) 0%,rgba(0,32,0,.5) 8%, rgba(0,0,0,.5) 85%, rgba(32,32,32,.2) 95%, #111 100%); }
          #off_bag          { background : linear-gradient(to top, rgba(0,0,0,.2) 0%,rgba(32,0,0,.5) 8%, rgba(0,0,0,.5) 85%, rgba(32,32,32,.2) 95%, #111 100%); }
}}}*/

          #off_bag          { background       : linear-gradient(to top   , rgba(034,034,034,0.07) 0%, rgba(034,034,034,0.53) 98%, rgba(034,034,034,0.07) 100%); }
          #bak_bag          { background       : linear-gradient(to bottom, rgba(034,034,034,0.07) 0%, rgba(034,034,034,0.53) 98%, rgba(034,034,034,0.07) 100%); }
          #alt_bag          { background       : linear-gradient(to bottom, rgba(034,034,034,0.07) 0%, rgba(034,034,034,0.53) 98%, rgba(034,034,034,0.07) 100%); }

.open_bag #off_bag          { animation        : 500ms ease-out forwards off_flash; }
@keyframes off_flash        {
     10% { background-color : rgba(000,224,000,0.90); }
     30% { background-color : rgba(000,224,000,0.50); }
    100% { background-color : rgba(000,224,000,0.27); }
}

.open_bag #bak_bag          { animation        : 500ms ease-out forwards bak_flash; }
@keyframes bak_flash        {
     10% { background-color : rgba(255,000,000,0.90); }
     30% { background-color : rgba(255,000,000,0.50); }
    100% { background-color : rgba(255,000,000,0.27); }
}

.open_bag #alt_bag          { animation        : 500ms ease-out forwards alt_flash; }
@keyframes alt_flash        {
     10% { background-color : rgba(000,000,255,0.90); }
     30% { background-color : rgba(000,000,255,0.50); }
    100% { background-color : rgba(000,000,255,0.27); }
}


/*}}}*/
/* pat_bag .. hovering .. nearing {{{*/

#pat_bag          { transition : width 500ms, height 500ms; }
/*{{{
#pat_bag          { transition : all 250ms; }
}}}*/
#off_bag          { transition : all 250ms; }
#bak_bag          { transition : all 250ms; }
#alt_bag          { transition : all 250ms; }

        .nearing  { transition-duration : 250ms; }
#pat_bag.nearing  { box-shadow          : 0 0 .3em .3em rgba(000,000,000,0.4) inset !important; }
#off_bag.nearing  { background-color    :               rgba(000,224,000,1.0)                 ; }
#bak_bag.nearing  { background-color    :               rgba(255,000,000,1.0)                 ; }
#alt_bag.nearing  { background-color    :               rgba(000,000,255,1.0)                 ; }

          #off_bag { transform-origin    : 50% 100%;                          }
          #bak_bag { transform-origin    : 50%   0%;                          }
.grid_bag #bak_bag { transform-origin    : 50%  50%;                          }
          #alt_bag { transform-origin    : 50%   0%;                          }
.grid_bag #alt_bag { transform-origin    : 50%  50%;                          }

          #off_bag.nearing  { animation           : 400ms ease-out forwards squeezing; }
          #bak_bag.nearing  { animation           : 400ms ease-out forwards squeezing; }
          #alt_bag.nearing  { animation           : 400ms ease-out forwards squeezing; }

@keyframes squeezing    {
     10% { transform  : scale(1,1.008); }
     30% { transform  : scale(1,1.015); }
    100% { transform  : scale(1,1.020); }
}
/*{{{
#off_bag.nearing  { border-radius       : 1em; }
#bak_bag.nearing  { border-radius       : 1em; }
#off_bag.nearing  {          transform  : rotate(5deg); }
#bak_bag.nearing  {          transform  : rotate(5deg); }
#off_bag.nearing  {          transform  : scale(0.8); }
#bak_bag.nearing  {          transform  : scale(0.8); }
#off_bag.nearing  {          transform  : scale(1.02); }
#bak_bag.nearing  {          transform  : scale(1.02); }
#off_bag.nearing  { margin       : .5em; }
#bak_bag.nearing  { margin       : .5em; }
#off_bag.nearing  { border-radius       : .1em; }
#bak_bag.nearing  { border-radius       : .1em; }
}}}*/

        .outline  { transition-duration : 500ms; }

#pat_bag.hovering {          outline    : black 8px dashed !important; }
#off_bag.hovering {          outline    : green 8px dashed !important; }
#bak_bag.hovering {          outline    : red   8px dashed !important; }
#alt_bag.hovering {          outline    : blue  8px dashed !important; }

/*{{{
#pat_bag.hovering { border     : 1em solid black !important; }

#pat_bag.hovering { background : linear-gradient(to bottom, rgba(000,000,000,0.53) 0%, rgba(000,000,000,0.53) 5%, rgba(000,000,000,0.53) 95%, rgba(000,000,000,1.00) 100%); }
#pat_bag.hovering { background : linear-gradient(to bottom, rgba(255,221,000,0.53) 0%, rgba(034,034,034,0.53)  8%, rgba(034,034,034,0.00) 100%) !important; }
#pat_bag.hovering { background : rgba(000,000,255,1.00) !important; }
        .hovering { background : rgba(255,255,000,0.13) !important; }
        .hovering { background : rgba(255,255,255,0.33);            }

#pat_bag.hovering { box-shadow : 0 0 .05em .1em rgba(136,255,136,1.0) inset !important; }
#pat_bag.hovering { box-shadow : 0 0  .5em      rgba(255,255,255,1.0) inset !important; }
#bak_bag.hovering { box-shadow : 0 0   1em      rgba(000,000,000,0.5) !important; }
#off_bag.hovering { box-shadow : 0 0   1em      rgba(000,000,000,0.5) !important; }
#pat_bag.hovering { box-shadow : 0 0   1em      rgba(000,000,000,0.5) !important; }

#bak_bag.hovering {           transform : translate(0.5em,0);                          }
#off_bag.hovering {           transform : translate(0.5em,0);                          }

        .hovering {               color : #0F0                             !important; }
        .hovering {             outline : rgba(255,000,255,0.53) 5px solid;            }

        .hovering>.place_holder { opacity : .5;             }
        .hovering>.place_holder { outline : 2px #F00 solid; }
        .hovering>.place_holder { outline : 2px #FFF solid; }

      .mov_em_div>.place_holder { opacity : 0;              }

}}}*/
/*}}}*/

/* SEEKER */
/*{{{*/
/*{{{*/
/* seeker_PU display position border align {{{*/
#seeker_PU               { border-radius    : 50%; }
#seeker_PU               { display          : none; }
#seeker_PU               { position         : absolute; top:10em; left:14em; }
#seeker_PU               { vertical-align   : middle; }
#seeker_PU.show_seekzone { transform-origin : 50% 100%; }

/*}}}*/
/* seeker_PD display position border align {{{*/
#seeker_PD               { border-radius    : 50%; }
#seeker_PD               { display          : none; }
#seeker_PD               { position         : absolute; top: 5em; left:14em; }
#seeker_PD               { vertical-align   : middle; }
/*}}}*/
/* seeker_PU transition {{{*/
/*{{{
#seeker_PU               { transition-duration        :        900ms; }
#seeker_PU               { transition-timing-function :     ease-out; }
#seeker_PU               { transition                 : all             250ms, box-shadow 2000ms; }
#seeker_PU               { transition                 : top 150ms, left 150ms, box-shadow 150ms, color 150ms, opacity 150ms; }
}}}*/
/*{{{
#seeker_PU               { transition                 : top 150ms, left 150ms, box-shadow 150ms, color 150ms; }
}}}*/

/*}}}*/
/* long_press_arm::after [ANIMATION] {{{*/
/*
#seeker_CU.long_press_arm::after {
    animation-name            : long_press_arm;
    animation-duration        : 1000ms;
    animation-timing-function : ease-in;
    animation-fill-mode       : both;
}
@keyframes long_press_arm {
    20% {
        content       : '\\25A4';
        transform     : rotate(0);
        border-radius : 0 .2em .2em 0;
        border        : .1em solid black;
        line-height   : 1em;
    }
    100% {
        content       : '\\25A4';
        transform     : rotate(0);
        border-radius : 0 .2em .2em 0;
        border        : .1em solid black;
        line-height   : 1em;
        color         : #000;
    }
}
*/
/*}}}*/

/*}}}*/
/* .seeker_P {{{*/
.seeker_P           { background     : transparent; }
.seeker_P           { margin         : 0; }
.seeker_P           { cursor         : pointer; }
.seeker_P:hover     { color          : red; }
.seeker_P:hover     { font-weight    : bold; }

/* OUT */
.seeker_P      >div { position       : relative; }
.seeker_P      >div { margin         : 0; }
.seeker_P      >div { border         : none; }
.seeker_P      >div { border-radius  : 1em; }
/* IN */
.seeker_P      >div { width          : 120px; }
.seeker_P      >div { padding        : 0; }
.seeker_P      >div { font-size      : 500%; }
.seeker_P      >div { font-weight    : 800; }
.seeker_P      >div { height         : 120px; }
.seeker_P      >div { line-height    : 120px; }
.seeker_P      >div { text-align     : center; }
.seeker_P      >div { background     : linear-gradient(to bottom, rgba(255,255,255,.8), rgba(255,172,  0,.1)); }
.seeker_P.dark >div { background     : linear-gradient(to bottom, rgba( 64, 64, 48,.8), rgba( 32, 16, 16,.1)); }

/*}}}*/
/* .standby {{{*/
#seeker_PD.standby                     { background : linear-gradient(to bottom, rgba(255,0,0,1), #400) !important; }
#seeker_PU.standby                     { background : linear-gradient(to bottom, rgba(255,0,0,1), #400) !important; }

          .standby .seeker_handle      { transform  : rotate( -15deg) !important; }
          .standby .seeker_handle.back { transform  : rotate(-165deg) !important; }
/*}}}*/
/* box-shadow {{{*/
/*....................................................  ox     oy   blur  spread color........................*/
#seeker_PD                              { box-shadow : 12px 12px  24px        rgba(  0,  0,  0,0.5); }
.seeker_P               >div            { box-shadow : -3px  -3px  6px    0px rgba(  0,  0,  0,0.5) inset; }
.seeker_P.scroll_smooth >div            { box-shadow :  0px   0px  2px    8px rgba(255,255,255,0.5) inset; }

/*....................................................  ox     oy   blur  spread color........................*/
#seeker_PU                              { box-shadow :   0px  24px 24px       ; }
#seeker_PU.seek1_onSlotEL               { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek2_onResume               { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek3_onJumpEL               { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek4_onSeeker               { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek5_onTarget               { box-shadow :   0px   0em  0px   32px; }

#seeker_PU.seek5_onTarget                   { transform  : scale(0.3); }
#seeker_PU.seek5_onTarget #seeker_CU::after { display    : none !important;       }

/*{{{
#seeker_PU.seek1_onSlotEL.scroll_smooth { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek2_onResume.scroll_smooth { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek3_onJumpEL.scroll_smooth { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek4_onSeeker.scroll_smooth { box-shadow :   0px   0em  0px   32px; }
#seeker_PU.seek5_onTarget.scroll_smooth { box-shadow :   0px   0em  0px   32px; }
}}}*/

/*....................................................  ox     oy   blur  spread color........................*/
.seeker_PU2_look_up                     { box-shadow :   0px -32px  0px   32px !important; }
.seeker_PU3_look_right                  { box-shadow :  32px   0px  0px   32px !important; }
.seeker_PU4_look_down                   { box-shadow :   0px  32px  0px   32px !important; }
.seeker_PU5_look_left                   { box-shadow : -32px   0px  0px   32px !important; }

/*}}}*/

/* slot_color .. (the surrounding stretched circle) {{{*/
#seeker_PU                  { transform-origin : 50% 100%;        }

/* RESTING STATE */
#seeker_PU                  { color      : rgba(064,064,064,0.1); }

/* STRETCHED URDL .. PREV-NEXT .. SLOT-NUM */
#seeker_PU.slot_color1      { color      : rgba(150,075,000,0.5) !important; }
#seeker_PU.slot_color2      { color      : rgba(255,000,000,0.5) !important; }
#seeker_PU.slot_color3      { color      : rgba(255,165,000,0.5) !important; }
#seeker_PU.slot_color4      { color      : rgba(255,255,000,0.5) !important; }
#seeker_PU.slot_color5      { color      : rgba(154,205,050,0.5) !important; }
#seeker_PU.slot_color6      { color      : rgba(100,149,237,0.5) !important; }
#seeker_PU.slot_color7      { color      : rgba(238,130,238,0.5) !important; }
#seeker_PU.slot_color8      { color      : rgba(160,160,160,0.5) !important; }
#seeker_PU.slot_color9      { color      : rgba(255,255,255,0.5) !important; }
#seeker_PU.slot_color0      { color      : rgba(032,032,032,0.5) !important; }

/* WHILE MOVING FROM ONE TO ANOTHER .. TODO */
/*{{{
#seeker_PU.on_cooldown      { color      : transparent          ; }
#seeker_PU.on_cooldown      { transition : all   300ms 500ms    ; }
#seeker_PU.on_cooldown      { transform  : scale(0.2) !important; }
#seeker_PU.on_cooldown *    { transform  : scale(0.2) !important; }
}}}*/

/*}}}*/

/* seeker_PU {{{*/
#seeker_PU                        { transition : transform 500ms      , top 250ms, left 250ms; }
#seeker_PU.show_seekzone          {              transform: scale(0.5)                       ; }

/* seeker_PU animation {{{
#seeker_PU.show_seekzone { animation-duration  :         500ms; }
#seeker_PU.show_seekzone { animation-delay     :           0ms; }
#seeker_PU.show_seekzone { animation-name      : show_seekzone; }
#seeker_PU.show_seekzone { animation-timing-function : ease-out; }
#seeker_PU.show_seekzone { animation-fill-mode       : forwards; }

@keyframes show_seekzone {
      0% { transform : scale(1.0); }
    100% { transform : scale(0.2); }
}
}}}*/
/*.on_cooldown {{{
  #seeker_PU.on_cooldown               { box-shadow : none                                        !important; }
  #seeker_PU.on_cooldown               { outline    : dotted  24px rgba(192,192,192, .5)          !important; }
  #seeker_PU.on_cooldown               { opacity    : 0.1; }
  #seeker_PU.on_cooldown               { transform  : scale(0.5)                                  !important; }
  #seeker_PU.on_cooldown               { transform  : scale(0.5) rotate3D(0,1,1,45deg)            !important; }
  #seeker_PU.on_cooldown               { box-shadow : none                                        !important; }
  #seeker_PU.on_cooldown               { opacity    : 0.2                                         !important; }
}}}*/
/*}}}*/
/* .fading {{{*/

    .fading *        { opacity                    : 0.5                        !important; }
    .fading *        { transform-origin           : 50%  120%;                             }
    .fading *        { transform                  : scale(0.05);                           }
    .fading *::after { transform                  : scale(0.50) rotate(-90deg) !important; }

    .fading *        { transition-delay           : 600ms;                                 }
    .fading *        { transition-duration        : 300ms;                                 }
    .fading *::after { transition-duration        : 300ms                      !important; }

    .fading *        { transition-timing-function : ease-in;                               }
    .fading *::after { transition-timing-function : ease-in;                               }

/*}}}*/
/* #seeker_CU {{{*/
      #seeker_CU                       { color          : #40D;   }
.dark #seeker_CU                       { color          : pink;   }
      #seeker_CU sup                   { font-size      :  30%;   }
      #seeker_CU sup                   { pointer-events : none;   }
/*
      #seeker_CU                       { white-space    : nowrap; }
*/
/*}}}*/
/* #seeker_CD {{{*/
      #seeker_CD                       { width          : 360px; }
      #seeker_CD                       { height         : 360px; }
      #seeker_CD                       { line-height    : 360px !important; }
      #seeker_CD                       { border-radius  : 50%; }

      #seeker_CD em                    { line-height : 150%;  }
      #seeker_CD em                    { font-size   : 36px;  }
      #seeker_CD .seeker_handle        { font-size   : 192px; }
      #seeker_CD .seeker_handle.left   { font-size   : 192px; }
      #seeker_CD .seeker_handle.right  { font-size   : 192px; }
      #seeker_CD .seeker_handle.top    { font-size   :  48px; }
      #seeker_CD .seeker_handle.bottom { font-size   :  48px; }

/*{{{
      #seeker_CD div                   { line-height :  32px !important; }
      #seeker_CD div                   { font-size   :  32px !important; }
      #seeker_CD div                   { background  : black !important; }
      #seeker_CD div                   { color       :  #DDD !important; }
}}}*/

/*}}}*/
/* #seeker_thumbs {{{*/
#seeker_thumbs         {
    display          : inline-block;
    position         : absolute;
    margin           : 0;
    margin-right     :-50%;
    top              : 50%;
    left             : 50%;
    transform        : translate(-50%,-50%);

    font-weight      : 900;
    font-size        : 16px;
    line-height      : 28px;
    vertical-align   : middle;

    border-radius    : 2em;
    background       : transparent;

}
#seeker_thumbs * {
    vertical-align   : middle;
}
#seeker_thumbs .ellipsis {
    display          : block;
}

/*}}}*/
/* .seeker_handle {{{*/

#sel_bag     .seeker_handle                { position   : absolute;    top :  0  ;     left : 0;                 }
#seeker_CD   .seeker_handle.left           { position   : absolute;    top :-.2em;     left : 0;                 }
#seeker_CD   .seeker_handle.right          { position   : absolute;    top :-.2em;    right : 0;                 }
#seeker_CD   .seeker_handle.top            { position   : absolute;    top : 1em; transform : translate(-50%,0); }
#seeker_CD   .seeker_handle.bottom         { position   : absolute; bottom : 1em; transform : translate(-50%,0); }

#seeker_CD   .seeker_handle.bottom  {
    border-width : 2px 0 2px 0 !important;
    border-style : dashed      !important;
    width        : 2em         !important;
    line-height  : 1em         !important;
}

#seeker_CD   .seeker_handle.top     {
    border       : 0           !important;
    line-height  : 1em         !important;
}

             .seeker_handle                { color                       :   green !important; }
.back        .seeker_handle                { color                       :     red !important; }
             .seeker_handle.bottom         { color                       :    gray !important; }
             .seeker_handle.bottom.checked { color                       :     red !important; }
             .seeker_handle.bottom.checked { border-color                :     red !important; }
             .seeker_handle.top            { color                       :   black !important; }
             .seeker_handle.top.checked    { color                       :    navy !important; }
             .seeker_handle.top.checked    { border-color                :    navy !important; }

             .seeker_handle                { font-size                   :    64px; }
             .seeker_handle                { font-weight                 :     300; }
             .seeker_handle                { margin                      :       0; }
             .seeker_handle                { padding                     :       0; }

             .seeker_handle                { transform-origin            : 50% 50% 0; }
             .seeker_handle.back           { transform                   : translate(0, 20%) rotate(-180deg); }
             .seeker_handle.right.back     { transform                   : translate(0, 20%) rotate( 180deg); }

             .seeker_handle                { transition-duration         : 200ms; }
             .seeker_handle.back           { transition-duration         : 200ms; }

             .seeker_handle                { transition-delay            :   0ms; }
             .seeker_handle.back           { transition-delay            :   0ms; }
             .seeker_handle.left           { transition-delay            : 200ms; }
             .seeker_handle.left.back      { transition-delay            : 200ms; }
             .seeker_handle.right          { transition-delay            : 400ms; }
             .seeker_handle.right.back     { transition-delay            : 400ms; }
             .seeker_handle.bottom         { transition-delay            : 600ms; }
             .seeker_handle.bottom.checked { transition-delay            : 600ms; }
             .seeker_handle.top            { transition-delay            : 600ms; }
             .seeker_handle.top.checked    { transition-delay            : 600ms; }

             .seeker_handle                { transition-timing-function  : ease-in;  }
             .seeker_handle.back           { transition-timing-function  : ease-out; }

             .seeker_handle.back           { transition-property         : all; }

/*}}}*/
/* SEEK ON INVISIBLE NODE {{{*/
#seeker_PU.on_hiden_node { transition-duration : 500ms; }
#seeker_PU.on_hiden_node { transform           : scale(0.5) rotate(-45deg) !important; }

#seeker_PD.on_hiden_node { transition-duration : 500ms; }
#seeker_PD.on_hiden_node { transform           : scale(0.5) rotate(-45deg) !important; }

/*}}}*/
/* seeker_CU::after {{{*/
#seeker_CU::after { content          : "?"; }
/*
*/
#seeker_CU::after { position         : absolute; }
#seeker_CU::after { font-size        : 100%; }
#seeker_CU::after { text-align       : center !important; }
#seeker_CU::after { vertical-align   : middle !important; }
#seeker_CU::after { padding          : 0      !important; }
#seeker_CU::after { margin           : 0      !important; }
#seeker_CU::after { transform-origin : -100% 50% 0; }
#seeker_CU::after { content          : '\\2699'; /* GEAR */ }
#seeker_CU::after { text-shadow      : rgba(0,0,0,0.5) .02em .02em .1em !important; }
#seeker_CU::after { transition-duration        : 500ms; }
#seeker_CU::after { transition-timing-function : cubic-bezier(.22,1.39,.02,1.22); }

/*}}}*/
/* num<1-12>::after {{{*/
#seeker_CU.num1::after  { /*content :  "1";*/ transform : rotate( -60deg); }
#seeker_CU.num2::after  { /*content :  "2";*/ transform : rotate( -30deg); }
#seeker_CU.num3::after  { /*content :  "3";*/ transform : rotate(   0deg); }
#seeker_CU.num4::after  { /*content :  "4";*/ transform : rotate(  30deg); }
#seeker_CU.num5::after  { /*content :  "5";*/ transform : rotate(  60deg); }
#seeker_CU.num6::after  { /*content :  "6";*/ transform : rotate(  90deg); }
#seeker_CU.num7::after  { /*content :  "7";*/ transform : rotate( 120deg); }
#seeker_CU.num8::after  { /*content :  "8";*/ transform : rotate( 150deg); }
#seeker_CU.num9::after  { /*content :  "9";*/ transform : rotate( 180deg); }
#seeker_CU.num10::after { /*content : "10";*/ transform : rotate( 210deg); }
#seeker_CU.num11::after { /*content : "11";*/ transform : rotate( 240deg); }
#seeker_CU.num12::after { /*content : "12";*/ transform : rotate( 270deg); }

/*}}}*/
/* seek1_onSlotEL seek3_onJumpEL seek5_onTarget seek4_onSeeker seek2_onResume {{{*/
          .seek1_onSlotEL #seeker_CU    { border-radius  : 50%  50%  45%  45% !important; }
          .seek2_onResume #seeker_CU    { border-radius  : 50%  50%  45%  45% !important; }
          .seek3_onJumpEL #seeker_CU    { border-radius  : 0                  !important; }
          .seek4_onSeeker #seeker_CU    { border-radius  : 50%  50%  25%  25% !important; }
          .seek5_onTarget #seeker_CU    { border-radius  : 50%  50%  45%  45% !important; }

/*}}}*/
/*long_press_arm::after [TRANSITION] {{{*/
#seeker_CU::after                { line-height   : 1.5em; }
#seeker_CU::after                { padding       : 0; }

#seeker_CU.long_press_arm::after { content       : '\\25A4'; }
#seeker_CU.long_press_arm::after { border-radius : 0 .2em .2em 0     !important; }
#seeker_CU.long_press_arm::after { border        : .07em solid black !important; }

#seeker_CU.long_press_arm::after { transition    : transform 250ms       , line-height  250ms   150ms, color  500ms  500ms, padding ease-in 1750ms  250ms, background-color 1000ms 0ms; }
#seeker_CU.long_press_arm::after {                                                                                                                         background-color:#BAB;    }
#seeker_CU.long_press_arm::after {                                                                                          padding: 0 1em 0 1em !important; }
#seeker_CU.long_press_arm::after {                                                                     color:#000;       }
#seeker_CU.long_press_arm::after {                                         line-height:  1em;       }
#seeker_CU.long_press_arm::after {                 transform:rotate(0); }
/*
*/
/*}}}*/
/* long_press_arm::after [ANIMATION] {{{*/
/*
#seeker_CU.long_press_arm::after {
    animation-name            : long_press_arm;
    animation-duration        : 1000ms;
    animation-timing-function : ease-in;
    animation-fill-mode       : both;
}
@keyframes long_press_arm {
    20% {
        content       : '\\25A4';
        transform     : rotate(0);
        border-radius : 0 .2em .2em 0;
        border        : .1em solid black;
        line-height   : 1em;
    }
    100% {
        content       : '\\25A4';
        transform     : rotate(0);
        border-radius : 0 .2em .2em 0;
        border        : .1em solid black;
        line-height   : 1em;
        color         : #000;
    }
}
*/
/*}}}*/
/* top bottom left right {{{
#seekzone.gutter.top               { background    : linear-gradient(to bottom, rgba(255,  0,  0,0.9), rgba(0,0,0,.1)) !important; }
#seekzone.gutter.bottom            { background    : linear-gradient(to top   , rgba(0  ,255,  0,0.9), rgba(0,0,0,.1)) !important; }
#seekzone.gutter.left              { background    : linear-gradient(to right , rgba(0  ,  0,255,0.9), rgba(0,0,0,.1)) !important; }
#seekzone.gutter.right             { background    : linear-gradient(to left  , rgba(255,255,  0,0.9), rgba(0,0,0,.1)) !important; }
}}}*/
/* #seekzone.container_selected {{{
#seekzone.container_selected       { border     : 3px rgba(32,32,32,0.5) solid;                                  }
#seekzone.container_selected.dark  { border     : 3px rgba(96,96,96,0.5) solid;                                  }
#seekzone.container_selected       { background : linear-gradient(to bottom, rgba(32,32,32,.9), rgba(32,32,32,0) 10%, rgba(32,32,32,0) 90%, rgba(32,32,32,.9)); }
#seekzone.container_selected.dark  { background : linear-gradient(to bottom, rgba(96,96,96,.9), rgba(96,96,96,0) 10%, rgba(96,96,96,0) 90%, rgba(96,96,96,.9)); }
}}}*/
/* outline {{{
#seekzone                    { outline:24px dotted rgba(255,255,255,.5); }
#seekzone.container_selected { outline:48px dotted rgba(255,255,255,.8); }
#seekzone                    { outline          :  2px rgba(255,255,255,1.00) dashed;                                               }
}}}*/
/* seekspot_UD .. log {{{*/
#seekspot_U, #seekspot_D { display          :  none; }
#seekspot_U, #seekspot_D { pointer-events   :  none; }
#seekspot_U, #seekspot_D { position         : fixed; }
#seekspot_U, #seekspot_D { left             :     0; }
#seekspot_U, #seekspot_D { color            : white; }

#seekspot_U              { top              :     0; }
             #seekspot_D { bottom           :     0; }
#seekspot_U, #seekspot_D { width            :   99%; }
#seekspot_U, #seekspot_D { height           : 100px; }

#seekspot_U>*              { position:absolute; left:1.3em; bottom:0; margin:0; padding: 1em; }
             #seekspot_D>* { position:absolute; left:1.3em;    top:0; margin:0; padding: 1em; }

/*}}}*/
/* seekspot_A .. arrow {{{*/
#seekspot_A { position       : fixed;                           }
#seekspot_A { display        : none;                            }
#seekspot_A { pointer-events : none;                            }

#seekspot_A { transform      : translate(-50%,-36%) !important; }
#seekspot_A { font-size      : 100px                !important; }
#seekspot_A { color          : red                  !important; }
/*
#seekspot_A { border         : none                 !important; }
#seekspot_A { padding        : 0                    !important; }
#seekspot_A { box-shadow     : none                 !important; }
#seekspot_A { background     : transparent          !important; }
*/
/*{{{
#seekspot_A { text-shadow    : rgba(  0,  0,  0, 0.7) 2px 1px 5px !important; }
#seekspot_A { font-weight    : 900   !important;                              }
#seekspot_A { background     : transparent !important;                        }
#seekspot_A { font-stretch   : ultra-expanded !important;                     }
#seekspot_A { width          : 70px;                                          }
#seekspot_A { height         : 70px;                                          }
#seekspot_A { width          : 70px !important;                               }
#seekspot_A { height         : 70px !important;                               }
#seekspot_A { line-height    : 80px;                                          }
#seekspot_A { width          : 20px;                                          }
#seekspot_A { line-height    : 80px;                                          }
#seekspot_A { width          : 70px;                                          }
#seekspot_A { height         : 70px;                                          }
#seekspot_A { font-size      : 70px;                                          }
#seekspot_A { text-shadow    : rgba( 50, 50, 50, 0.9) 2px 1px 5px;            }
#seekspot_A { line-height    : 1px;                                           }
}}}*/
/*{{{
#seekspot_A { margin-top     : -.5em;                                         }
#seekspot_A { line-height    : 70px;                                          }
#seekspot_A { vertical-align : top;                                           }
}}}*/
/*{{{
      #seekspot_A { background : linear-gradient(to bottom, rgba( 32, 32, 32,.02), rgba(255,255, 96,.9)) !important; }
.dark #seekspot_A { background : linear-gradient(to bottom, rgba( 16, 16, 16,.02), rgba(196, 96, 96,.9)) !important; }
}}}*/
/*}}}*/
/* margin {{{
#seekspot_U { margin-right                  : 1em; }
#seekzone   { margin-right                  : 1em; }
#seekspot_D { margin-right                  : 1em; }

#seekspot_U, #seekspot_D { margin           :   1em; }
}}}*/
/* border-radius {{{*/

/*{{{
#seekspot_U { border-radius :  3em  3em .5em .5em; }
#seekspot_D { border-radius : .5em .5em  3em  3em; }
}}}*/
#seekspot_U>*              { border-radius : 0em 3em 0em 0em; }
             #seekspot_D>* { border-radius : 0em 0em 3em 0em; }

#seekspot_U >*              { box-shadow       : rgba( 0, 0, 0, 0.2) 5px -5px 16px 0px; } /* x y blur spread */
             #seekspot_D >* { box-shadow       : rgba( 0, 0, 0, 0.2) 5px  5px 16px 0px; }
/*}}}*/
/* background {{{*/
#seekspot_U                   { background : linear-gradient(to bottom, rgba( 64, 64, 64,.7) 50%, rgba( 64, 64, 64,.1)); }
             #seekspot_D      { background : linear-gradient(to top   , rgba( 64, 64, 64,.7) 50%, rgba( 64, 64, 64,.1)); }
#seekspot_U.dark              { background : linear-gradient(to bottom, rgba(  0,  0,  0,.7) 50%, rgba(  0,  0,  0,.1)); }
             #seekspot_D.dark { background : linear-gradient(to top   , rgba(  0,  0,  0,.7) 50%, rgba(  0,  0,  0,.1)); }

#seekspot_U>*                 { background : linear-gradient(to left, rgba( 96,128, 96,.8) 10%, rgba( 96,128, 96,.9)); }
             #seekspot_D>*    { background : linear-gradient(to left, rgba( 96, 96,255,.8) 10%, rgba( 96, 96,255,.9)); }

/*{{{
#seekspot_U                        { background       : linear-gradient(to left  , rgba( 96,255, 96,.5 )    , rgba( 64,255, 64,.01) 2%, rgba( 64,255, 64,.01) 98%, rgba( 96,255, 96,.5)); }
                  #seekspot_D      { background       : linear-gradient(to left  , rgba( 96, 96,255,.5 )    , rgba( 64, 64,255,.01) 2%, rgba( 64, 64,255,.01) 98%, rgba( 96, 96,255,.5)); }

#seekspot_U                        { background       : rgba(000,255,000,0.66); }
                  #seekspot_D      { background       : rgba(255,000,000,0.66); }

#seekspot_U     , #seekspot_D      { background-color : rgba(192,192,192,0.5); }
#seekspot_U.dark, #seekspot_D.dark { background-color : rgba( 48, 48, 48,0.5); }

}}}*/
/* caption_U caption_D {{{
#seekzone           { background                    : linear-gradient(to left  , rgba(255, 96, 96,.5 )    , rgba(255, 64, 64,.01) 2%, rgba(255, 64, 64,.01) 98%, rgba(255, 96, 96,.5)); }
#seekzone.caption_U { background                    : linear-gradient(to top   , rgba( 96,255, 96,.01) 90%, rgba( 96,255, 96,.3)); }
#seekzone.caption_D { background                    : linear-gradient(to bottom, rgba( 96, 96,255,.01) 90%, rgba( 96, 96,255,.3)); }
}}}*/
/*}}}*/
/*}}}*/

/* MEDIA */
/*{{{*/
@media only screen and (max-resolution :  96dpi) { #headsup { border : 4px groove #AAA; } }
@media only screen and (min-resolution : 120dpi) { #headsup { border :            none; } }
@media only screen and (min-resolution : 120dpi) {
/*{{{*/
/*
#dimm_mask.dimm_light       { transition-duration  :  200ms; }
#dimm_mask.dimm_dark        { transition-duration  :  200ms; }
#mov_div.moving             { transition-duration  :  150ms; }
#seeker_PD                  { transition-duration  :  100ms; }
#seeker_PD.invisible        { transition-duration  :  100ms; }
#seeker_PD.magnified        { transition-duration  :  100ms; }
#words_opcycle.checked      { transition-duration  :  100ms; }
.eso_div                    { transition-delay     :    0ms; }
.eso_div                    { transition-duration  :  100ms; }
.fading                     { transition-duration  :  200ms; }
.grid_caption_hide          { animation-delay      :  150ms; }
.grid_caption_hide          { animation-duration   :  150ms; }
.grid_caption_see_through   { transition-duration  :    0ms; }
.grid_caption_see_through   { transition-duration  :  100ms; }
.grid_caption_show          { animation-delay      :  150ms; }
.grid_caption_show          { animation-duration   :  150ms; }
.hidden                     { transition-duration  :  150ms; }
.on_grid                    { transition-delay     :    0ms; }
.on_grid                    { transition-duration  :    0ms; }
.dimmed_panel               { transition-duration  :  200ms; }
.panel_pressed_glowing      { transition-delay     :  100ms; }
.panel_pressed_glowing      { transition-delay     :  150ms; }
.panel_pressed_glowing      { transition-duration  :  150ms; }
.pulse_in                   { animation-duration   :  200ms; }
.pulse_in                   { transition-delay     :    0ms; }
.pulse_in                   { transition-duration  :  100ms; }
.pulse_out                  { transition-delay     :    0ms; }
.pulse_out                  { transition-duration  :  100ms; }
.removing                   { transition-duration  :  200ms; }
.rotate_NE                  { transition-delay     :  100ms; }
.rotate_NE                  { transition-duration  :  100ms; }
.rotate_NW                  { transition-delay     :  100ms; }
.rotate_NW                  { transition-duration  :  100ms; }
.rotate_SE                  { transition-delay     :  100ms; }
.rotate_SE                  { transition-duration  :  100ms; }
.rotate_SW                  { transition-delay     :  100ms; }
.rotate_SW                  { transition-duration  :  100ms; }
.scrolled      >div         { transition-duration  :  100ms; }
.seeker_handle              { transition-delay     :    0ms; }
.seeker_handle              { transition-duration  :  100ms; }
.seeker_handle.back         { transition-delay     :    0ms; }
.seeker_handle.back         { transition-duration  :  100ms; }
.seeker_handle.left         { transition-delay     :  100ms; }
.seeker_handle.left.back    { transition-delay     :  100ms; }
.seeker_handle.right        { transition-delay     :  100ms; }
.seeker_handle.right.back   { transition-delay     :  100ms; }
.seeker_handle.bottom       { transition-delay     :  100ms; }
.seeker_handle.bottom.back  { transition-delay     :  100ms; }
.seeker_handle.top          { transition-delay     :  100ms; }
.seeker_handle.top.back     { transition-delay     :  100ms; }
.stacking.floatlog>*        { animation-duration   :  200ms; }
.standby::before            { animation-duration   :  200ms; }
.grid_bag                   { transition-duration  :  200ms; }
*/
/*}}}*/
}
/*}}}*/

/* .pressed {{{*/

.pressed { transform        : scale(0.95); }
.pressed { opacity          :       0.8  ; }
.pressed { transform-origin :   50% 50%  ; }

/*}}}*/
/* div_slot_containers pressed {{{*/
#div_slot_containers>.pressed {
    transform        : none  !important;
    opacity          : 1     !important;
    background       : #AAA  !important;
    transition       : all 250ms ease-out;
}
/*}}}*/
/* NOTES {{{
 * transition: <property> <duration> <timing-function> <delay>;
}}}*/

/* .div_match {{{*/
.div_match {
    border: solid 8px black !important;
}
.div_match div {
    border:solid 1px !important;
}
/*}}}*/
/* .em_match .em_missing .em_log {{{*/
.em_match {
    box-shadow    : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
    font-size     : 200%;
}
.em_missing {
    color            : red;
    background-color : transparent;
    font-weight      : 700;
    box-shadow       : rgba(255, 0, 0, 0.3) 0 0.3em 0.3em inset;
}

.em_log {
    padding          : .2em;
    border-radius    : 50%;
    box-shadow       : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
}
.em_log span {
    border-radius    : .5em;
/*
    padding          : .5em;
*/
}
/*}}}*/

/* TRANSCRIPT */
/*.transcript {{{*/
.transcript            { display              : inline-block;    }
/*{{{
.transcript            { position             : fixed !important; top :  0px; left : 0px; }
.transcript            { display              : inline-block;    }
.transcript            { display              : inline-grid;     }
.transcript *          { display              : initial;         }
}}}*/
/* .transcript align {{{*/
.transcript *          { vertical-align       : middle;          }

/*}}}*/
/* .transcript cursor {{{*/
.transcript            { cursor               : pointer;         }
.transcript div        { cursor               : pointer;         }
/*}}}*/
/* .transcript border {{{*/
.transcript            { border-color           : #444             }
.transcript            { border-radius          : 1em;             }
.transcript ul         { border                 : 0px;             }
.transcript>div        { border                 : 0px;             }
.transcript div        { border                 : 0px;             }
.transcript pre        { border                 : 0px;             }
.transcript tr         { border-bottom          : 2px black solid; }
.transcript td         { border-radius          : 2em;             }

/*}}}*/
/* .transcript box-shadow {{{*/
.transcript            { box-shadow                 : 3px 3px 6px rgba(000,000,000,0.5);        }
/*}}}*/
/* .transcript width height {{{*/
.transcript            { min-height           :  4em; }
.transcript            { min-width            : 10em; }
/*}}}*/
/* .transcript filter {{{*/
.transcript            { filter              : contrast(25%) brightness(125%); }
.transcript.dark       { filter              : contrast(50%) brightness( 35%); }
/*}}}*/
/* .transcript background dark {{{*/
.transcript          { background    : linear-gradient(to bottom, #FF0, #FB0); }
.transcript.dark     { background    : linear-gradient(to bottom, #443, #211); }
/*         .dark div { background    : linear-gradient(to bottom, #443, #211); } useless and disrupts dom_grid.html["Grid ON"] ? */
/*         .dark div { color         : white;                                  } */
#headsup.dark        { background    : linear-gradient(to bottom, #443, #211); }
#dom_traversal.dark  { background    : linear-gradient(to bottom, #443, #211); }
#dev_log_map.dark    { background    : linear-gradient(to bottom, #443, #211); }
#test_panel.dark     { background    : linear-gradient(to bottom, #443, #211); }
#dom_load_tags.dark  { background    : linear-gradient(to bottom, #443, #211); }
/*}}}*/
/* .transcript padding {{{*/
.transcript            { padding              : 1ex;             }
.transcript pre        { padding              : 0 0 0 1ex;       }
.transcript ul         { padding              : 0 0 0 2em;       }
/*}}}*/
/* .transcript font {{{*/
.transcript *          { font-family          : monospace;       }
/*}}}*/
/* .transcript line-height {{{*/
.transcript em         { line-height          : 1.50em;          }
.transcript ul         { line-height          : 0.75em;          }
/*}}}*/
/* .transcript scrollbar {{{*/
.transcript::-webkit-scrollbar                               { width         :  3em; }
.transcript::-webkit-scrollbar                               { height        :  3em; }
.transcript::-webkit-scrollbar-thumb                         { border-radius : 96px; }
.transcript::-webkit-scrollbar-track                         { border-radius : 96px; }
.transcript::-webkit-scrollbar-thumb                         { box-shadow    : inset 0 0 6px rgba(0,0,0,0.5); }
.transcript::-webkit-scrollbar-track                         { box-shadow    : inset 0 0 6px rgba(0,0,0,0.3); }
.transcript::-webkit-scrollbar-thumb                         { box-shadow    : rgba(  0,  0,  0,0.5) 0 8px 24px; }
.transcript::-webkit-scrollbar-thumb                         { background    : rgba( 24, 24, 24,0.5); }
.transcript::-webkit-scrollbar-thumb:-webkit-window-inactive { background    : rgba( 24, 24, 24,0.2); }
.transcript::-webkit-scrollbar-track                         { background    : rgba( 96, 96, 96,0.4); }
.transcript::-webkit-scrollbar-track:-webkit-window-inactive { background    : rgba(128,128,128,0.2); }
/*}}}*/
/* .transcript user-select {{{*/
.transcript *          { user-select  : none;            }
.transcript table      { user-select  : none;            }
/*}}}*/
/* .transcript transform {{{*/
.transcript            { transform-origin     : 0% 0% 0;         }
/*}}}*/
/* .transcript transition {{{*/
/*...................... transition: <property> <duration> <timing-function> <delay>; */

.transcript                      { transition : transform 300ms cubic-bezier(0.080, 1.015, 0.055, 0.930), padding 150ms ease-in; }
/*{{{
.transcript.tall_panel           { transition : transform 300ms cubic-bezier(0.080, 1.015, 0.055, 0.930), padding 150ms ease-in; }
.transcript.wide_panel           { transition : transform 300ms cubic-bezier(0.080, 1.015, 0.055, 0.930), padding 150ms ease-in; }
}}}*/

            .transcript.on_grid  { transition :       all 300ms ease-out 200ms; }
.regrouping .transcript          { transition :       all 300ms cubic-bezier(.35,1.1,.79,.69); }

/*}}}*/
/* .transcript on_grid {{{*/
.transcript.on_grid {
    display                    : inline-block  !important; /* .. so as to override hidden */
    z-index                    : 51            !important; /* above dimm_mask = ZINDEX_TOOL_PANEL_ZERO = 50 */

    border-radius              : 16px          !important;
    margin                     : 0             !important;
    transform                  : rotate(0deg)  !important;

    padding                    : 0             !important;
    margin-bottom              : 0             !important;
/*
    min-width                  : 0             !important;
    min-height                 : 0             !important;
*/
    overflow                   : hidden        !important;


/* {{{
    display             : fixed          !important;
    display             : flex           !important;

    position            : fixed          !important;
    float               : none           !important;

    border              : 2px red dotted !important;
    border                     : 9px red dashed !important;
    border-radius              : 1em            !important;

    margin              : 0              !important;
    min-height          : 8em            !important;
    min-width           : 8em            !important;
    width               : 8em            !important;
    height              : 8em            !important;

    transform                  : rotate(0deg)  !important;
    transform                  : scale(.7) rotate(0) !important;

}}}*/
/*  animation {{{
    animation-duration         : 900ms;
    animation-timing-function  : ease-out;
    animation-fill-mode        : forwards;
}}}*/
}
/*}}}*/
/* .transcript  div {{{*/
.transcript>div        { margin               : 0;            }
.transcript div        { margin               : 0;            }
.transcript div        { display              : table-cell;   }
.transcript div        { overflow             : hidden;       }
.transcript div        { padding              : 1ex;          }
/*
.transcript div        { display              : inline-block; }
*/

/*}}}*/
/* .transcript  blockquote {{{*/
.transcript blockquote { margin      : .2em;              }
.transcript blockquote { width       : 48em;              }
.transcript blockquote { border      : 0px;               }
.transcript blockquote { padding     : 1ex;               }
.transcript blockquote { white-space : normal !important; }
/*}}}*/
/* .transcript  table {{{*/
.transcript table      { margin               : 0;               }
.transcript tr.slot    { font-size            : 200%;            }
.transcript th         { font-size            : 120%;            }
.transcript th         { padding              : 1ex;             }
.transcript th         { text-align           : left;            }
.transcript th         { text-shadow          : rgba( 50, 50, 50, 0.9) 1px 1px 2px !important; }
.transcript th         { font-weight          : 700; }
.transcript hr         { height               : 5px; }

.transcript td         { padding              : 1ex;             }
.transcript td         { text-align           : left;            }
/*}}}*/
/* .transcript  pre {{{*/
.transcript pre        { background           : initial;         }
.transcript pre        { text-align           : left;            }

/*}}}*/
/* .transcript  ul {{{*/
.transcript ul         { margin               : .2em;            }
/*}}}*/
/* .transcript  sub {{{*/
.transcript sub        { vertical-align       : sub;             }
.transcript sup        { color                : white;           }
.transcript sup        { vertical-align       : super;           }

/*}}}*/
/* .transcript_msg {{{*/
.transcript_msg .info  {
    box-shadow  : 2px 2px 6px rgba(000,000,000,0.7) inset;
    font-family : "Comic sans ms";
}

      .transcript_msg { color       : #200; }
.dark .transcript_msg { color       : #FA0 !important; }
/*}}}*/
/* #transcript1 #transcript2 {{{*/
#transcript1,#transcript2 { max-width  :  80%; }
#transcript1              { max-height :  18%; }
             #transcript2 { max-height :  78%; }
#transcript1,#transcript2 { overflow   : auto; }
#transcript1 {
    float : left;
}
#transcript2 {
    float : left;
    clear : left;
}
#table_params * { text-align : right; }
/*}}}*/
/*}}}*/
/* .transcript  push_pin closepin scalepin clearpin {{{*/

.push_pin { position : absolute; top:0.1em; right:0.1em; display:none; }
.closepin { position : absolute; top:0.1em; right:0.1em; display:none; }
.scalepin { position : absolute; top:0.1em; right:0.1em; display:none; }
.clearpin { position : absolute; top:0.1em; right:0.1em; display:none; }

/* margin {{{*/
            .push_pin  { margin-right           : 0.0em               !important; }
            .push_pin  { margin-top             : 0.0em               !important; }
            .push_pin  { min-width              : 1.5em               !important; }
            .push_pin  { min-height             : 1.5em               !important; }

            .closepin  { margin-right           : 0.0em               !important; }
            .closepin  { margin-top             : 0.0em               !important; }
            .closepin  { min-width              : 1.5em               !important; }
            .closepin  { min-height             : 1.5em               !important; }

            .scalepin  { margin-right           : 0.0em               !important; }
            .scalepin  { margin-top             : 0.0em               !important; }
            .scalepin  { min-width              : 1.5em               !important; }
            .scalepin  { min-height             : 1.5em               !important; }

            .clearpin  { margin-right           : 0.0em               !important; }
            .clearpin  { margin-top             : 0.0em               !important; }
            .clearpin  { min-width              : 1.5em               !important; }
            .clearpin  { min-height             : 1.5em               !important; }

/*}}}*/
/* padding {{{*/
            .push_pin  { padding                : 0                   !important; }
            .closepin  { padding                : 0                   !important; }
            .scalepin  { padding                : 0                   !important; }
            .clearpin  { padding                : 0                   !important; }

/*}}}*/
/* border {{{*/

            .push_pin  { border                    : none             !important; }
            .push_pin  { border-bottom-left-radius : 1em              !important; }
            .push_pin  { border-radius             : 1em              !important; }
            .push_pin  { border-top-right-radius   : 1.5em            !important; }
.pinned   em.push_pin  { border-radius             : 50%                        ; }

            .closepin  { border                    : none             !important; }
            .closepin  { border-radius             : 1em              !important; }
.pinned   em.closepin  { border-radius             : 50%                        ; }

            .scalepin  { border                    : none             !important; }
            .scalepin  { border-radius             : 1em              !important; }
.pinned   em.scalepin  { border-radius             : 50%                        ; }

            .clearpin  { border                    : none             !important; }
            .clearpin  { border-radius             : 1em              !important; }
.pinned   em.clearpin  { border-radius             : 50%                        ; }

/*}}}*/
/* box-shadow {{{*/
                .push_pin       { box-shadow     : none;                                         }
.pinned       em.push_pin       { box-shadow     : 1px -2px 3px 0px rgba(000,000,000,0.2) inset; } /*ox oy blur spread color [inset] */
.pinned.dark  em.push_pin       { box-shadow     : 1px -2px 3px 0px rgba(255,255,255,0.2) inset; } /*ox oy blur spread color [inset] */
.pinned         .push_pin:hover { box-shadow     : none  !important;                             }

                .closepin       { box-shadow     : none  !important; }
                .scalepin       { box-shadow     : none  !important; }
                .clearpin       { box-shadow     : none  !important; }
/*}}}*/

/* color {{{*/

            .push_pin                { color    : #AAA                !important; }
            .push_pin:hover          { color    : #800                !important; }
            .push_pin:hover .pressed { color    : #F00                !important; }
.pinned     .push_pin:hover          { color    : #F00                !important; }
.pinned     .push_pin                { color    : #F00                !important; }
            .closepin                { color    : #000                !important; }
            .closepin:hover          { color    : #888                !important; }
            .closepin:hover .pressed { color    : #FFF                !important; }
.pinned     .closepin:hover          { color    : #BBB                !important; }
.pinned     .closepin                { color    : #FFF                !important; }

            .scalepin                { color    : #000                !important; }
            .scalepin:hover          { color    : #888                !important; }
            .scalepin:hover .pressed { color    : #FFF                !important; }
.pinned     .scalepin:hover          { color    : #BBB                !important; }
.pinned     .scalepin                { color    : #FFF                !important; }

            .clearpin                { color    : #000                !important; }
            .clearpin:hover          { color    : #888                !important; }
            .clearpin:hover .pressed { color    : #FFF                !important; }
.pinned     .clearpin:hover          { color    : #BBB                !important; }
.pinned     .clearpin                { color    : #0A0                !important; }
/*}}}*/
/* background {{{*/
                .push_pin       { background-color  : transparent           !important; }
                .closepin       { background-color  : transparent           !important; }
                .scalepin       { background-color  : transparent           !important; }
                .clearpin       { background-color  : transparent           !important; }

/*{{{
.pinned         .push_pin       { background-color  : rgba(255,255,255,0.3) !important; }
.pinned.dark    .push_pin       { background-color  : rgba(255,255,255,0.1) !important; }

.pinned         .push_pin       { background        : linear-gradient(45deg, rgba( 96,255, 96,.5), rgba( 64,255, 64,.01) 20%, rgba( 64,255, 64,.01) 80%, rgba( 96,255, 96,.5)) !important; }
.pinned.dark    .push_pin       { background        : linear-gradient(45deg, rgba( 96,255, 96,.5), rgba( 64,255, 64,.01) 20%, rgba( 64,255, 64,.01) 80%, rgba( 96,255, 96,.5)) !important; }
}}}*/
.pinned         .push_pin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.40) 50%, rgba(000,000,000,0.07)) !important; }
.pinned.dark    .push_pin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.13) 50%, rgba(000,000,000,0.07)) !important; }
.pinned         .push_pin:hover { background        : rgba(136,136,136,0.3) !important; }

.pinned         .closepin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.40) 50%, rgba(000,000,000,0.07)) !important; }
.pinned.dark    .closepin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.13) 50%, rgba(000,000,000,0.07)) !important; }
.pinned         .closepin:hover { background        : rgba(136,136,136,0.3) !important; }

.pinned         .scalepin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.40) 50%, rgba(000,000,000,0.07)) !important; }
.pinned.dark    .scalepin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.13) 50%, rgba(000,000,000,0.07)) !important; }
.pinned         .scalepin:hover { background        : rgba(136,136,136,0.3) !important; }

.pinned         .clearpin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.40) 50%, rgba(000,000,000,0.07)) !important; }
.pinned.dark    .clearpin       { background        : linear-gradient(-45deg, rgba(000,000,000,0.07), rgba(255,255,255,0.13) 50%, rgba(000,000,000,0.07)) !important; }
.pinned         .clearpin:hover { background        : rgba(136,136,136,0.3) !important; }
/*}}}*/

/* align {{{*/
                .push_pin       { text-align             : center           !important; }
                .closepin       { text-align             : center           !important; }
                .scalepin       { text-align             : center           !important; }
                .clearpin       { text-align             : center           !important; }

/*}}}*/
/* font {{{*/
            .push_pin           { font-size              : 150%             !important; }
            .push_pin           { font-size              : 200%             !important; }

            .closepin           { font-size              : 120%             !important; }
            .closepin           { font-weight            :  100             !important; }

            .scalepin           { font-size              : 120%             !important; }
            .scalepin           { font-weight            :  100             !important; }

            .clearpin           { font-size              : 120%             !important; }
            .clearpin           { font-weight            :  100             !important; }

/*}}}*/
/* text-shadow {{{*/
.pinned   em.push_pin           { text-shadow       : black 1px 1px 2px               ; }
.pinned   em.push_pin:hover     { text-shadow       : none                  !important; }

.pinned   em.closepin           { text-shadow       : black 1px 1px 2px               ; }
.pinned   em.closepin:hover     { text-shadow       : none                  !important; }

.pinned   em.scalepin           { text-shadow       : black 1px 1px 2px               ; }
.pinned   em.scalepin:hover     { text-shadow       : none                  !important; }

.pinned   em.clearpin           { text-shadow       : black 1px 1px 2px               ; }
.pinned   em.clearpin:hover     { text-shadow       : none                  !important; }
/*}}}*/

/* pin_on_panel {{{*/
.wide_panel.pin_on_panel { padding-right : 3em; }
.tall_panel.pin_on_panel { padding-top   : 3em; }

.pin_on_panel>.push_pin,
.pin_on_panel>.closepin,
.pin_on_panel>.scalepin,
.pin_on_panel>.clearpin   { display       : inline !important; }

.open_bag.pin_on_panel>.push_pin,
.open_bag.pin_on_panel>.closepin,
.open_bag.pin_on_panel>.scalepin,
.open_bag.pin_on_panel>.clearpin   { display       : none !important; }

/*}}}*/
/* wide_panel tall_panel {{{*/


.wide_panel .closepin,
.tall_panel .closepin,
.wide_panel .scalepin,
.tall_panel .scalepin,
.wide_panel .clearpin,
.tall_panel .clearpin {
    animation-delay           : 200ms;
    animation-duration        : 150ms;
    animation-timing-function : ease-out;
    animation-fill-mode       : forwards;
    opacity                   : 0;          /* revealed by one of the animations below */
}

.tall_panel .closepin { animation-name : wide_to_tall_closepin; }
.wide_panel .closepin { animation-name : tall_to_wide_closepin; }
.tall_panel .scalepin { animation-name : wide_to_tall_scalepin; }
.wide_panel .scalepin { animation-name : tall_to_wide_scalepin; }
.tall_panel .clearpin { animation-name : wide_to_tall_clearpin; }
.wide_panel .clearpin { animation-name : tall_to_wide_clearpin; }

@keyframes tall_to_wide_closepin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate( 0em, 2.5em); }
}
@keyframes wide_to_tall_closepin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate(-2.5em, 0em); }
}

@keyframes tall_to_wide_scalepin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate( 0em, 4.0em); }
}
@keyframes wide_to_tall_scalepin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate(-4.0em, 0em); }
}

@keyframes tall_to_wide_clearpin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate( 0em, 5.5em); }
}
@keyframes wide_to_tall_clearpin {
     50% { opacity   : .5;                      }
    100% { opacity   :  1;                      }
    100% { transform :  translate(-5.5em, 0em); }
}

/*}}}*/
/* magnified {{{*/
           .scalepin::after { content : '\\1F50D'; }
.magnified .scalepin::after { content : '\\1F50E'; }
.magnified .scalepin::after { color   :      red; }

/*}}}*/
/* on_grid {{{*/
.on_grid                 { padding-right : 0em; }
.on_grid                 { padding-top   : 0em; }

.on_grid>.push_pin,
.on_grid>.closepin,
.on_grid>.scalepin,
.on_grid>.closepin       { display       : none  !important; }
/*}}}*/

/*}}}*/
/*.transcript @media {{{*/
@media only screen and (min-resolution : 120dpi) {
}
/*}}}*/

/* #seeker_PD .magnified {{{*/
#seeker_PD           { opacity             :         1.0; }
#seeker_PD           { transform-origin    :     50% 0 0; }

#seeker_PD           { transition-duration :       200ms; }
#seeker_PD.magnified { transition-duration :       200ms; }

#seeker_PD           { transform           : scale(0.33); }
#seeker_PD.magnified { transform           : scale(1   ); }

/*}}}*/

/* #div_slot_containers {{{*/
#div_slot_containers.fullscreen             >div { font-size : 100%; }
#div_slot_containers.fullscreen.magnified_0 >div { font-size :  50%; }
#div_slot_containers.fullscreen.magnified_1 >div { font-size :  75%; }
#div_slot_containers.fullscreen.magnified_2 >div { font-size : 100%; }
#div_slot_containers.fullscreen.magnified_3 >div { font-size : 125%; }
#div_slot_containers.fullscreen.magnified_4 >div { font-size : 150%; }
#div_slot_containers.fullscreen.magnified_5 >div { font-size : 200%; }
#div_slot_containers.fullscreen.magnified_6 >div { font-size : 300%; }
#div_slot_containers.fullscreen.magnified_7 >div { font-size : 350%; }
#div_slot_containers.fullscreen.magnified_8 >div { font-size : 400%; }
#div_slot_containers.fullscreen.magnified_9 >div { font-size : 450%; }

#div_slot_containers.button_monospace       >div { font-family : monospace !important; }
#div_slot_containers.button_monospace          * { white-space : pre-wrap  !important; }
/*{{{
#div_slot_containers.button_onospace        >div { white-space : pre       !important; }
}}}*/
/*}}}*/
/* .back {{{*/
#sel_bag.back     { color                      : red; }
#sel_bag.back>div { border-color               : red; }

.back .current_slot_num { color:white; background:linear-gradient(to bottom, #F00, #000) !important; }
          .standby .seeker_handle.back { transform  : rotate(-165deg) !important; }
.back        .seeker_handle                { color                       :     red !important; }
             .seeker_handle.back           { transform                   : translate(0, 20%) rotate(-180deg); }
             .seeker_handle.right.back     { transform                   : translate(0, 20%) rotate( 180deg); }
             .seeker_handle.back           { transition-duration         : 200ms; }
             .seeker_handle.back           { transition-delay            :   0ms; }
             .seeker_handle.left.back      { transition-delay            : 200ms; }
             .seeker_handle.right.back     { transition-delay            : 400ms; }
             .seeker_handle.back           { transition-timing-function  : ease-out; }
             .seeker_handle.back           { transition-property         : all; }
.seeker_handle.back         { transition-delay     :    0ms; }
.seeker_handle.back         { transition-duration  :  100ms; }
.seeker_handle.left.back    { transition-delay     :  100ms; }
.seeker_handle.right.back   { transition-delay     :  100ms; }
.seeker_handle.bottom.back  { transition-delay     :  100ms; }
.seeker_handle.top.back     { transition-delay     :  100ms; }
/*}}}*/

/* z-index {{{*/
/* javascript/dom_tools.js */
.pinned.on_grid                 { z-index : 50; } /* above dimm_mask .. ZINDEX_BELOW_TOOLS */
#hotspot                        { z-index : 99; }
#fly_div                        { z-index : 99; }
#seekzone                       { z-index : 99; }
#pivspot                        { z-index : 80; } /* above tools */
#seekspot_A                     { z-index : 80; }
#seeker_PU                      { z-index : 80; }
#seeker_PD                      { z-index : 80; }

.hotwave::after                 { z-index : -1; }
#bot_div                        { z-index : -1; }
#seeker_CD .seeker_handle       { z-index :  1; }
#seekspot_U, #seekspot_D        { z-index : -1; } /* bellow seeker_P */

.clearpin                       { z-index :  0; }
.closepin                       { z-index :  0; }
.panel_magnifying_glass::before { z-index :  2; }
.push_pin                       { z-index :  0; }
.scalepin                       { z-index :  0; }
.txt_log                        { z-index :  2; }
.mov_src                        { z-index :  1; }
#hov1                           { z-index :  2; }
#hov2                           { z-index :  2; }
#hov3                           { z-index :  2; }
#hov4                           { z-index :  2; }

#transcript2                 em { z-index :  1; }
#transcript1                 em { z-index :  1; }
#test_panel                  em { z-index :  1; }
#sel_bag                     em { z-index :  1; }
#pat_bag                     em { z-index :  1; }
#headsup                     em { z-index :  1; }
#dom_traversal               em { z-index :  1; }
#dom_load_tags               em { z-index :  1; }
#dev_log_map                 em { z-index :  1; }

/* DYNAMIC .. [javascript/dom_tools.js] {{{
#dimm_mask                      { z-index :  0; }
}}}*/

/*}}}*/

/* CSS-ANIMATIONS{{{
:!start explorer "https://drafts.csswg.org/css-animations-1"

    Setting the display property to none
    will terminate any running animation applied
    to the element
    and its descendants.

    If an element has a display of none
    , updating display to a value other than none
    will start all animations applied to the element by the animation-name property
    , as well as all animations applied to descendants with display other than none.

}}}*/

/* .transcript magnified {{{*/
.magnified                  { transform           : scale(2   )           ; }
.magnified.too_large        { transform           : scale(1.25) !important; }

/*
.tall_panel.magnified { transition : transform 300ms cubic-bezier(0.080, 1.015, 0.055, 0.930), padding 150ms ease-in; }
.wide_panel.magnified { transition : transform 300ms cubic-bezier(0.080, 1.015, 0.055, 0.930), padding 150ms ease-in; }
*/
/*}}}*/
/* .transcript hidden {{{*/
.hidden                     { display             : none !important       ; }

/*
.hidden                     { opacity             :       0.25            ; }
.hidden                     { transform           : scale(0.25)           ; }
.hidden                     { transition-duration :      350ms            ; }
.hidden.magnified           { transform           : scale(0.25)           ; }
.hidden.magnified.too_large { transform           : scale(0.25) !important; }

.transcript.hidden                     { position : fixed !important; top : -10000px !important; left : -10000px !important; }
.transcript.hidden.magnified           { position : fixed !important; top : -10000px !important; left : -10000px !important; }
.transcript.hidden.magnified.too_large { position : fixed !important; top : -10000px !important; left : -10000px !important; }
*/
/*}}}*/

/* SEEKER */
/* #seekzone {{{*/
#seekzone                       { transform           : translate(-50%,-50%); }
#seekzone.on_container          { transform           : translate(   0,  0 ); }

#seekzone.gutter                { transform           : translate(   0,  0 ); }
#seekzone.gutter                { transition-duration : 250ms; transition-delay : 100ms; transition-timing-function : cubic-bezier(.21,.38,.74,.36); }
#seekzone.gutter.marked_to_hide { box-shadow          : 0 0 9px 9px rgba( 32, 32, 32, 0.5) inset; }
#seekzone.gutter.marked_to_hide { transition-duration : 250ms; }

/*{{{
#seekzone.gutter                { border-radius       : 20px !important; }
#seekzone.gutter                { box-shadow          : 0 0 9px 9px rgba(068,000,255, 0.5) inset; }
#seekzone.gutter                { background          : rgba(255,000,000,0.13)                !important; }
}}}*/
#seekzone.gutter                { box-shadow          : 0 0 2px 2px rgba(068,000,255, 0.9) inset; }
#seekzone.gutter                { border-radius       : 0px !important; }

/* #seekzone {{{*/
#seekzone    { display          : none;             }
#seekzone    { position         : fixed;            }
#seekzone    { pointer-events   : none;             }
#seekzone    { padding          : 0     !important; }
#seekzone    { transform-origin : 50% 50%;          }

#seekzone>EM { position:absolute; top :-2em; white-space : nowrap; }
/*}}}*/
/* #seekzone margin {{{*/
/*{{{
}}}*/
/*{{{
}}}*/
/*{{{
#seekzone           { margin-left   : -1em; }
#seekzone           { margin-top    : -1em; }
#seekzone.misclick  { margin-left   :  0em; }
#seekzone.misclick  { margin-top    :  0em; }
#seekzone.container_selected  { margin-left   :    0; }
#seekzone.container_selected  { margin-top    :    0; }
}}}*/
#seekzone.pressed   { margin-left   : -4em; }
#seekzone.pressed   { margin-top    : -4em; }
/*{{{
}}}*/
/*}}}*/
/* #seekzone border {{{*/
#seekzone                    { border-radius :   2em           ; }
#seekzone.pressed            { border-radius :   4em !important; }
#seekzone.misclick           { border-radius :   2em !important; }

/*}}}*/
/* #seekzone box-shadow {{{*/
/* .............................................. ox oy blur spread color_______________________ */
#seekzone                          { box-shadow : 0  0  0    5px    rgba(  0,  0,  0, 0.2) inset; }

#seekzone.pressed                  { box-shadow : none !important; }
#seekzone.misclick                 { box-shadow : none !important; }

#seekzone.container_selected       { box-shadow : 0  0  5px 5px   rgba( 32, 32, 32, 0.5) inset; }
#seekzone.container_selected.dark  { box-shadow : 0  0  5px 5px   rgba(128,128,128, 0.5) inset; }

/*}}}*/
/* #seekzone opacity {{{*/

#seekzone.pressed                  { opacity    : 0.7; }
#seekzone.misclick                 { opacity    : 0.7; }
/*}}}*/
/* #seekzone transition {{{*/
#seekzone                          { transition          : top 100ms ease-out, left 100ms ease-out, width   0ms        , background-color   0ms              ; }

/*}}}*/
/* CLASSES */
/* #seekzone pressed {{{*/
#seekzone                 { text-align : center; }
#seekzone *               { text-align : center; vertical-align : middle; }
/* #seekzone pressed animation [pressed_SCALE] {{{*/
#seekzone.pressed::before { content             :  '';             }
#seekzone.pressed         { width               :  8em !important; }
#seekzone.pressed         { height              :  8em !important; }
/*{{{
}}}*/

#seekzone.pressed         { animation-name      : pressed_SCALE;            }
#seekzone.pressed         { animation-duration  :  750ms;                   }
#seekzone.pressed         { animation-delay     :    0ms;                   }
#seekzone.pressed         { animation-fill-mode :   both;                   }
@keyframes pressed_SCALE  {
      0% { transform: scale(1.5); background-color : rgba(  0,  0,  0,0.1); }
     45% { transform: scale(1  ); background-color : rgba(  0,  0,  0,0.5); }
     50% { transform: scale(1  ); background-color : rgba(000,255,000,1  ); }
     55% { transform: scale(1  ); background-color : rgba(000,000,000,1  ); }
    100% { transform: scale(1  ); background-color : rgba(000,000,000,0.3); }
}
/*}}}*/
/*}}}*/
/* #seekzone misclick {{{*/
#seekzone.gutter    { background          : transparent !important; }
#seekzone.misclick  { background-color    : green ; }
#seekzone.misclick3 { background-color    : yellow; }
#seekzone.misclick2 { background-color    : orange; }
#seekzone.misclick1 { background-color    : red   ; }
/*}}}*/
#seekzone.dblclick  { background-color    : rgba(000,000,255,0.13)  ; }
/*}}}*/

/* TARGET */
/* LEGEND {{{*/
/* .pad            .. bg colored rectangle .. from end of the handle */
/* .handle         .. dark pointer         .. between origin and pad */
/* .[handle::after .. gray gradient circle .. between handle and pad */
/* .tt_dir         .. blue   circle  arrow .. between handle and pad */
/*}}}*/
/* parent {{{*/
/*{{{
.target_tool.pinned { display : block !important; }
}}}*/

.target_tool {
    pointer-events : none;
    user-select    : none;
    height         :  72px;
    width          : 128px;
    line-height    : 1em;
}
.target_tool.parked                   { opacity     : 0.2 !important;   }
.target_tool.pressed                  { text-shadow : #000 1px 1px 1px; }
.target_tool.pressed.dark             { text-shadow : #FFF 1px 1px 1px; }
.target_tool .handle {
    pointer-events : auto;
    padding        : 0.2em 0 0.2em 0;
}
.target_tool .handle::after {
    pointer-events : auto;
    line-height    : 1em;
    content        : "";
}
.target_tool .tt_dir {
    line-height    : 1em;
    font-size      : 32px;
    text-align     : center;
}

.target_tool .pad {
    pointer-events : auto;
    color          : black;
    line-height    : 1em;
    color          : #333;
}
.target_tool .tt_pin {
    line-height    : 1em;
    font-size      : 18px;
    text-align     : center;
}
.target_tool .tt_paste {
    line-height    : 1em;
    font-size      : 72px;
    text-align     : center;
}

.target_tool          .handle         { display : block; }
.target_tool          .pad            { display : block; }

.target_tool          .handle::after  { display : block; }
.target_tool.pressed  .handle::after  { display : block; }
.target_tool.lifted   .handle::after  { display : block; }

.target_tool          .tt_dir         { display :  none; }
.target_tool.lifted   .tt_dir         { display : block; }

.target_tool          .tt_pin         { display :  none; }
.target_tool.pressed  .tt_pin         { display :  none; }
.target_tool.lifted   .tt_pin         { display : block; }
            .tt_feed  .tt_pin         { display : block; }

.target_tool          .tt_paste       { display :  none; }
      .pastable:hover .tt_paste       { display : block; }
      .pastable       .pad            { outline : 4px rgba(000,000,255,0.53) dashed; }

/*{{{
}}}*/
.target_tool          .handle         { position:absolute; top: 36px; left : 2px;       width:  74px; height : 16px; }
.target_tool          .handle::after  { position:absolute; top:  50%; left : 50%;       width:  72px; height : 72px; }
.target_tool          .pad            { position:absolute; top:  0px; left :76px;       width: 200px; height : 72px; }

.target_tool          .tt_dir         { transform        : translate( 50%  ,-50% ); }
.target_tool          .tt_dir         { position:absolute; top:  50%; right:  0 ;       width:  32px; height : 32px; }

.target_tool          .tt_pin         { transform        : translate(  0%,         0%); }
.target_tool          .tt_paste       { transform        : translate(  0%,       -50%); }

.target_tool          .tt_pin,
.target_tool.point_EE .tt_pin         { position:absolute;      top: -8px; right: -8px; width:  24px; height : 24px; }
.target_tool.point_SE .tt_pin         { position:absolute;   bottom: -8px; right: -8px; width:  24px; height : 24px; }
.target_tool.point_SW .tt_pin         { position:absolute;   bottom: -8px; left : -8px; width:  24px; height : 24px; }
.target_tool.point_WW .tt_pin         { position:absolute;      top: -8px; left : -8px; width:  24px; height : 24px; }
.target_tool.point_NW .tt_pin         { position:absolute;      top: -8px; left : -8px; width:  24px; height : 24px; }
.target_tool.point_NE .tt_pin         { position:absolute;      top: -8px; right: -8px; width:  24px; height : 24px; }

.target_tool          .handle         { transform        : translate(  0 ,  -50% ); }
.target_tool          .handle::after  { transform        : translate(  0 ,  -50% ); }
.target_tool.point_NE .handle         {                                                 width:  62px; }
.target_tool.point_NW .handle         {                                                 width:  62px; }
.target_tool.point_SE .handle         {                                                 width:  62px; }
.target_tool.point_SW .handle         {                                                 width:  62px; }

.target_tool.tt_feed        .handle   { position   : absolute; top:36px; left:0;        width:42px !important; height:32px !important; }
.target_tool.tt_feed        .handle   { text-align : center; }
.target_tool.tt_feed        .handle   { display    :   none; }
.target_tool.tt_feed.pinned .handle   { display    :  block; }

/*{{{
.target_tool.tt_feed        .handle   { opacity    : 0.1 !important; }
.target_tool.tt_feed.pinned .handle   { opacity    : 1.0 !important; }
}}}*/

/*}}}*/
/* position transform rotate {{{*/

.target_tool                          { transform-origin :  0px 36px; }
.target_tool          .pad            { transform-origin : 35px 35px; }


.target_tool         ,
.target_tool.point_EE                 { transform        : rotate(   0   );                      }
.target_tool.point_SE                 { transform        : rotate(  45deg); }
.target_tool.point_SW                 { transform        : rotate( 135deg); }
.target_tool.point_WW                 { transform        : rotate(-180deg); }
.target_tool.point_NW                 { transform        : rotate(-135deg); }
.target_tool.point_NE                 { transform        : rotate( -45deg); }

.target_tool.point_00                 { transform        : scale(0.01);      }
.target_tool.point_00                 { opacity          : 0.5;              }
.target_tool.point_00                 { transition       : all 300ms  cubic-bezier(.21,.38,.94,.36) !important; }

.target_tool          .pad,
.target_tool.point_EE .pad            { transform        : rotate(   0   );                      }
.target_tool.point_SE .pad            { transform        : rotate( -45deg);                      }
.target_tool.point_NE .pad            { transform        : rotate(  45deg);                      }

.target_tool.point_WW .pad            { transform        : rotate( 180deg) translate(-140px, -4px); }
.target_tool.point_NW .pad            { transform        : rotate( 135deg) translate(-140px, -4px); }
.target_tool.point_SW .pad            { transform        : rotate(-135deg) translate(-140px, -4px); }

.target_tool.tt_feed  .pad .clipboard { position         : relative; top:12px; left :4px; }
                             .flipped { transform        : rotate(180deg); display:inline-block; }

/*}}}*/
/* pad {{{*/
.target_tool *        { vertical-align   : bottom; }

.target_tool .tt_msg  { max-height       :  70%;   }
/*{{{
.target_tool .tt_msg  { overflow         : hidden;   }
}}}*/

.target_tool *        { line-height      : 0.8em; }
.target_tool .tt_msg  { line-height      : 1.2em; }

.target_tool .tt_num  { position         : absolute;  left: 4px;    top:16px; }
.target_tool .tt_msg  { position         : absolute;  left:48px;    top: 1px; }
.target_tool .tt_dat  { position         : absolute; right: 1px; bottom: 1px; }
.target_tool .tt_dat  { background-color : rgba(000,000,000,0.13); }
.target_tool .tt_dat  { padding          : 0    8px 0 8px; }
.target_tool .tt_dat  { border-radius    : 10px 0   0 0  ; }
.target_tool .tt_dat  { color            : #FFF;           }

.target_tool .tt_num  { font-family      : 'Lucida Console'; }
.target_tool .tt_dat  { font-family      : 'monospace'     ; }
.target_tool .tt_msg  { font-family      : 'Comic sans MS' ; }

.target_tool .tt_num  { font-size        : 64px; }
.target_tool .tt_msg  { font-size        : 12px; }

.target_tool .size5   { font-size        : 48px; }
.target_tool .size4   { font-size        : 40px; }
.target_tool .size3   { font-size        : 18px; }
.target_tool .size2   { font-size        : 12px; }
.target_tool .size1   { font-size        :  8px; }

.target_tool .weight3 { font-weight      :  900; }
.target_tool .weight2 { font-weight      :  500; }
.target_tool .weight1 { font-weight      :  100; }

/*}}}*/
/* transition {{{*/
.target_tool                          { transition       : transform 150ms ease-in ; }
.target_tool          .pad            { transition       : transform 150ms ease-out; }
.target_tool.point_NW                 { transition       : transform 300ms ease-in ; }
.target_tool.point_NW .pad            { transition       : transform 300ms ease-out; }
.target_tool.tt_feed                  { transition       : all       400ms cubic-bezier(.21,.38,.94,.36); }

/*}}}*/
/* target_tool z-index {{{*/
.target_tool         .handle { z-index :  1; } /* above pad */
/*{{{
.target_tool.lifted  .handle { z-index :  1; }
}}}*/
.target_tool         .tt_pin { z-index :  1; } /* above pad */

/*}}}*/
/* target_tool V1 radius {{{*/
/*{{{
.target_tool                          { border-radius : 36px; }

.target_tool          .handle,
.target_tool.point_EE .handle         { border-radius : 10px; }
.target_tool.point_NE .handle         { border-radius : 10px; }
.target_tool.point_NW .handle         { border-radius : 10px; }
.target_tool.point_SE .handle         { border-radius : 10px; }
.target_tool.point_SW .handle         { border-radius : 10px; }

.target_tool          .pad            { border-radius : 18px; }

}}}*/
/*}}}*/
/* target_tool V1+V2 radius {{{*/
.target_tool.tt_feed  .handle        { border-radius :  50%;             }

.target_tool          .handle        { border-radius :  50% 0 0 50%;     }
.target_tool          .handle::after { border-radius :  50%;             }
.target_tool          .tt_dir        { border-radius :  50%;             }
.target_tool          .tt_pin        { border-radius :  50%;             }

.target_tool.point_NE .pad           { border-radius : 0    0    0  8px; }
.target_tool.point_NW .pad           { border-radius : 0    0    8px  0; }
.target_tool.point_SW .pad           { border-radius : 0    8px  0    0; }
.target_tool.point_SE .pad           { border-radius : 8px  0    0    0; }
/*}}}*/

/* target_tool V2 handle thickness {{{*/

.target_tool         .handle         { height: 1px; }

/*}}}*/

/* target_tool V1 border {{{*/
/*
.target_tool          .pad           { border      : 3px solid transparent; }
.target_tool          .handle        { border      : 3px solid transparent; }
*/
/*
.target_tool.lifted  .pad            { border      : 1px solid red;         }
.target_tool.lifted  .handle         { border      : 1px solid red;         }
*/
/*}}}*/
/* target_tool V2 border {{{*/
.target_tool         .pad            { border-left : 10px solid rgba(0,0,0,0.2); }

/*}}}*/

/* target_tool V1 background {{{*/
/*{{{
.target_tool          .handle        { background : linear-gradient(to bottom       , rgba(0,0,0,.6) 0%, rgba(0,0,0,.4) 50%, rgba(0,0,0,.5) 80%, rgba(0,0,0,.5) 95%, #111 100%); }
}}}*/
.target_tool          .handle        { background : linear-gradient(to right, rgba(000,000,255,1.00) 0%, rgba(000,000,000,1.00) 30%, rgba(128,128,255,0.5) 30%, rgba(000,000,000,1.00) 100%); }
.target_tool.dark     .handle        { background : linear-gradient(to right, rgba(136,136,136,1.00) 0%, rgba(136,136,136,1.00) 30%, rgba(136,136,136,0.3) 30%, rgba(136,136,136,1.00) 100%); }

.target_tool          .handle::after { background : transparent; }
.target_tool.lifted   .handle::after { background : radial-gradient(circle at center, rgba(000,000,000,0.0) 10%, rgba(000,000,000,0.2) 70%); }
.target_tool.pressed  .handle::after { background : radial-gradient(circle at center, rgba(000,000,000,0.0) 10%, rgba(000,000,000,0.2) 70%); }

.target_tool          .tt_pin        { background  : rgba(255,000,000,0.86); color : white; }
.target_tool          .tt_dir        { background  : rgba(000,000,255,0.86); color : #FFF; }
/*}}}*/
/* target_tool V1 box-shadow {{{*/
/*{{{
.target_tool          .handle { box-shadow : #333 0px 0px 3px 6px inset; }
.target_tool.dark     .handle { box-shadow : #444 0px 0px 6px 6px inset; }

.target_tool          .pad    { box-shadow : #333 0px 0px 1px 3px inset; }
.target_tool.dark     .pad    { box-shadow : #444 0px 0px 1px 6px inset; }
.target_tool.lifted   .pad    { box-shadow : rgba(000,000,000,0.5) 6px 2px 7px 0px; }
}}}*/
.target_tool          .pad    { box-shadow : rgba(000,000,000,0.5) 6px 2px  7px 0px; }
.target_tool.dark     .pad    { box-shadow : rgba(128,128,128,0.5) 2px 2px  2px 0px; }
/*}}}*/

/*}}}*/
/*# sourceURL=dom_tools.css */
`
 .replace(/\\A/g,"\\000A")
)
;
/*}}}*/
  /**   3  GRID   CSS dom_grid_css_data {{{*/
/*
../stylesheet/dom_grid.css
*/
dom_grid_css_data ="data:text/css,"+ escape(`
/*{{{*/

#dom_grid_css_tag   { content: "dom_grid_css (181121:15h)"; }

/* dom_grid_playground {{{*/
#dom_grid_playground {
 border        : 1px solid #333;
 border-radius : 1em;
 padding       : .5em;
 background    : linear-gradient(to bottom, #333, #111) !important;
 position      : fixed; top : 0.2em; right : 0.2em;
 width         : 75%;
}
#dom_grid_playground.collapsed                   { width   : 25%            ; }
#dom_grid_playground.collapsed #traces_div       { display : none !important; }
#dom_grid_playground.collapsed #dom_grid_headsup { display : none           ; }

#dom_grid_headsup>div                            { display : inline-block   ; }

/*}}}*/
/* ol li {{{*/
ol>li{
 margin-bottom: 1em;
  white-space : nowrap;
}

/*}}}*/
/* traces {{{*/

#traces_div>div { margin-left:1em !important; margin-top: 0em !important; }

#traces {
 border-radius : 5px;
 box-shadow    : rgba(0, 0, 0, 0.3) 0 0.3em 0.3em inset;
 border        : 3px dashed #FD8;
 width         : 50em;
 padding       : 1ex;
 overflow      : auto;

 color         : #FD4;
 background    : rgba(16,16,16,.8);
}
/*}}}*/
/* note {{{*/
.note {
 background        : #fff3d4;
 border-color      : #f6b73c;
 border-left-width : 5px;
 border-left-style : solid !important;
 font-family       : "monospace";
 font-weight       : 700;
 font-size         : 100%;
 color             : #AAA;
 padding           : 1ex 1em 1ex 1em;
 display           : inline-block;
 margin            : 1ex 1ex 1ex 0;
}
.note em { padding    : 0.2em; }
.note em { line-height: 2.5em; }
.note pre { margin:0; }
.pat_div { display:none; }
/*}}}*/
/* .box {{{*/
.box {
    display:inline-block;
    position:relative;
    border         : 1px solid #404040      ;
    border-radius  : 5px 5px 5px 5px        ;
    color          : darkgray               ;
    font-weight    : 900                    ;
    background     : rgba(16,16,16,.8)      ;
    vertical-align : middle;
    text-align     : center;
    box-shadow     : 0 0 10px #000000 inset ;
    padding:0 !important;
}
.box  label { cursor: pointer; }
/*}}}*/
/* .cb_slider_pin {{{*/
.cb_slider_pin {
    width          : 80px;
    height         : 30px;
    border-radius  : 50px;
    padding        : 0;
    box-shadow     : inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
}

.cb_slider_pin:after {
    content        : '';
    height         : 2px;
    width          : 52px;
    position       : absolute;
    top            : 14px;
    left           : 14px;
    background     : #111;
    border-radius  : 50px;
    box-shadow     : inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
}

.cb_slider_pin label {
    z-index        : 1;
    width          : 22px;
    height         : 22px;
    position       : absolute;
    top            : 4px;
    left           : 4px;
    border-radius  : 50px;
    transition     : all 0.4s ease;
    background     : #fcfff4;
    background     : linear-gradient(to top, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
    box-shadow     : 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
}

.cb_slider_pin label:after {
    content        : '';
    width          : 10px;
    height         : 10px;
    position       : absolute;
    top            : 6px;
    left           : 6px;
    background     : #333;
    border-radius  : 50px;
    box-shadow     : inset 0px 1px 1px black, 0px 1px 0px rgba(255, 255, 255, 0.9);
}

.cb_slider_pin input[type=checkbox]                       { visibility : hidden;  }
.cb_slider_pin input[type=checkbox]:checked + label       { left       : 54px;    }
.cb_slider_pin input[type=checkbox]:checked + label:after { background : #00Fe00; }

/*}}}*/

/*}}}*/
/*# sourceURL=dom_grid.css */
`
)
 .replace(/\\(\\x+)/g,"\\\\$1")
;
/*}}}*/
  /**   4  LOG     JS dom_log_js_data {{{*/
/*
../javascript/dom_log.js
*/
dom_log_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_log_js */
let DOM_LOG_JS_ID        = "dom_log_js";
let DOM_LOG_JS_TAG       = DOM_LOG_JS_ID  +" (181230:00h)";
/* console_clear_post {{{*/
/*{{{*/
const CONSOLE_CLEAR_COOLDOWN_DELAY = 1000;

let console_clear_cooldown_timeout;
/*}}}*/
let console_clear_post = function(msg=null)
{
    if( console_clear_cooldown_timeout )
    {
        log("%c LOG PRESERVED FOR "+CONSOLE_CLEAR_COOLDOWN_DELAY+"ms", lbB+lbH+lf4);
        return;
    }

    console_clear( msg );

    console_clear_cooldown_timeout
        = setTimeout( function() {
                         console_clear_cooldown_timeout = null;
                     }
                     , CONSOLE_CLEAR_COOLDOWN_DELAY);

};
/*}}}*/
/* ECC (181108) {{{*/
const lbA  = "background-color:inherit;   color:inherit;";

const lbF  = "font-size:120%; font-weight:500; border:2px solid white;";
const lbb  = "font-size:150%; font-weight:900; margin:0 0 0 0;";
const lbB  = "font-size:300%; font-weight:900; margin:0 0 0 0;";
const lbS  = "font-size:800%; font-weight:900; margin:0 0 0 0;";

const lbH  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0 1ex 1ex   0; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #000 0%, #223 50%, #000 100%);";
const lbL  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0   0   0 1ex; padding:0 .5em 0 .5em; border-radius:1em   0   0 1em; background:linear-gradient(to   left, #333 0%           ,#445 100%);";
const lbR  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0 1ex   0   0; padding:0 .5em 0 .5em; border-radius:  0 1em 1em   0; background:linear-gradient(to  right, #333 0%           ,#544 100%);";
const lbC  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0   0   0   0; padding:0 .5em 0 .5em; border-radius:  0   0   0   0;";

const lb1  = "background-color:#964B00; color:black;";
const lb2  = "background-color:#FF0000; color:black;";
const lb3  = "background-color:#FFA500; color:black;";
const lb4  = "background-color:#FFFF00; color:black;";
const lb5  = "background-color:#9ACD32; color:black;";
const lb6  = "background-color:#6495ED; color:black;";
const lb7  = "background-color:#EE82EE; color:black;";
const lb8  = "background-color:#A0A0A0; color:black;";
const lb9  = "background-color:#FFFFFF; color:black;";
const lb0  = "background-color:#000000; color:gray;";
const lbX = [ lb0 ,lb1 ,lb2 ,lb3 ,lb4 ,lb5 ,lb6 ,lb7 ,lb8 ,lb9 ];

const lf1  = "color:#964B00;";
const lf2  = "color:#FF0000;";
const lf3  = "color:#FFA500;";
const lf4  = "color:#FFFF00;";
const lf5  = "color:#9ACD32;";
const lf6  = "color:#6495ED;";
const lf7  = "color:#EE82EE;";
const lf8  = "color:#A0A0A0;";
const lf9  = "color:#FFFFFF;";
const lf0  = "color:#000000;";
const lfX = [ lf0 ,lf1 ,lf2 ,lf3 ,lf4 ,lf5 ,lf6 ,lf7 ,lf8 ,lf9 ];

/*}}}*/

/*{{{*/
let logging_EVENTS;
let logging_HIGHLIGHT;
let logging_TOOLBAR;

let LOG_MAP = {
    LOG_IPC        : false,
    EV0_LISTEN     : false,
    EV1_DOWN       : false,
    EV2_MOVE       : false,
    EV3_UP         : false,
    EV4_LONG_PRESS : false,
    EV5_TOOL_CB    : false,
    EV6_CHANGED    : false,
    EV7_DISPATCH   : false,
    EV8_FLOATLOG   : false,
    S1_RANGE       : false,
    S2_SELECT      : false,
    S3_SLOT        : false,
    T0_STORE       : false,
    T1_DOM_LOAD    : false,
    T2_GRID        : false,
    T3_LAYOUT      : false,
    T4_PIVOT       : false,
    T5_SPREAD      : false,
    T6_SLOT        : false
   };

let LOG_COLORS = [
  [ "#FFFFFF" , "#101010" ] /* 0 */
, [ "#964B00" , "#202020" ] /* 1 */
, [ "#FF0000" , "#101010" ] /* 2 */
, [ "#FFA500" , "#202020" ] /* 3 */
, [ "#FFFF00" , "#101010" ] /* 4 */
, [ "#9ACD32" , "#202020" ] /* 5 */
, [ "#6495ED" , "#101010" ] /* 6 */
, [ "#EE82EE" , "#202020" ] /* 7 */
, [ "#A0A0A0" , "#101010" ] /* 8 */
, [ "#FFFFFF" , "#202020" ] /* 9 */
, [ "#CFB53B" , "#101010" ] /* A */
, [ "#C0C0C0" , "#202020" ] /* B */
];

let log_HTML   =  "";
let log_count  = 0;
/* }}} */
/*  logging_load_LOG_MAP {{{*/
let logging_load_LOG_MAP = function()
{
   if(typeof store_getBool === 'undefined') return;

    LOG_IPC                = store_getBool("LOG_IPC"          ) ? true : false;
    logging_EVENTS         = store_getBool("logging_EVENTS"   ) ? true : false;
    logging_HIGHLIGHT      = store_getBool("logging_HIGHLIGHT") ? true : false;
    logging_TOOLBAR        = store_getBool("logging_TOOLBAR"  ) ? true : false;

    LOG_MAP.EV0_LISTEN     = store_getBool("EV0_LISTEN"       ) ? true : false;
    LOG_MAP.EV1_DOWN       = store_getBool("EV1_DOWN"         ) ? true : false;
    LOG_MAP.EV2_MOVE       = store_getBool("EV2_MOVE"         ) ? true : false;
    LOG_MAP.EV3_UP         = store_getBool("EV3_UP"           ) ? true : false;
    LOG_MAP.EV4_LONG_PRESS = store_getBool("EV4_LONG_PRESS"   ) ? true : false;
    LOG_MAP.EV5_TOOL_CB    = store_getBool("EV5_TOOL_CB"      ) ? true : false;
    LOG_MAP.EV6_CHANGED    = store_getBool("EV6_CHANGED"      ) ? true : false;
    LOG_MAP.EV7_DISPATCH   = store_getBool("EV7_DISPATCH"     ) ? true : false;
    LOG_MAP.EV8_FLOATLOG   = store_getBool("EV8_FLOATLOG"     ) ? true : false;
    LOG_MAP.S1_RANGE       = store_getBool("S1_RANGE"         ) ? true : false;
    LOG_MAP.S2_SELECT      = store_getBool("S2_SELECT"        ) ? true : false;
    LOG_MAP.S3_SLOT        = store_getBool("S3_SLOT"          ) ? true : false;
    LOG_MAP.T0_STORE       = store_getBool("T0_STORE"         ) ? true : false;
    LOG_MAP.T1_DOM_LOAD    = store_getBool("T1_DOM_LOAD"      ) ? true : false;
    LOG_MAP.T2_GRID        = store_getBool("T2_GRID"          ) ? true : false;
    LOG_MAP.T3_LAYOUT      = store_getBool("T3_LAYOUT"        ) ? true : false;
    LOG_MAP.T4_PIVOT       = store_getBool("T4_PIVOT"         ) ? true : false;
    LOG_MAP.T5_SPREAD      = store_getBool("T5_SPREAD"        ) ? true : false;
    LOG_MAP.T6_SLOT        = store_getBool("T6_SLOT"          ) ? true : false;
};
/*}}}*/
/*  logging_toggle {{{ */
let logging_toggle = function(keyword)
{
let caller = "logging_toggle("+keyword+")";
log(caller);

   if(typeof store_set_state === 'undefined') return;

    let changed = "";
    switch( keyword ) {
        case KEY_LOG_IPC       : LOG_IPC                = !LOG_IPC                ; changed = keyword+"="+LOG_IPC               ; store_set_state("LOG_IPC"            , LOG_IPC                ); break;
        case KEY_LOG_EVENTS    : logging_EVENTS         = !logging_EVENTS         ; changed = keyword+"="+logging_EVENTS        ; store_set_state("logging_EVENTS"     , logging_EVENTS         ); break;
        case KEY_LOG_HIGHLIGHT : logging_HIGHLIGHT      = !logging_HIGHLIGHT      ; changed = keyword+"="+logging_HIGHLIGHT     ; store_set_state("logging_HIGHLIGHT"  , logging_HIGHLIGHT      ); break;
        case KEY_LOG_TOOLBAR   : logging_TOOLBAR        = !logging_TOOLBAR        ; changed = keyword+"="+logging_TOOLBAR       ; store_set_state("logging_TOOLBAR"    , logging_TOOLBAR        ); break;
        case "EV0_LISTEN"      : LOG_MAP.EV0_LISTEN     = !LOG_MAP.EV0_LISTEN     ; changed = keyword+"="+LOG_MAP.EV0_LISTEN    ; store_set_state("EV0_LISTEN"         , LOG_MAP.EV0_LISTEN     ); break;
        case "EV1_DOWN"        : LOG_MAP.EV1_DOWN       = !LOG_MAP.EV1_DOWN       ; changed = keyword+"="+LOG_MAP.EV1_DOWN      ; store_set_state("EV1_DOWN"           , LOG_MAP.EV1_DOWN       ); break;
        case "EV2_MOVE"        : LOG_MAP.EV2_MOVE       = !LOG_MAP.EV2_MOVE       ; changed = keyword+"="+LOG_MAP.EV2_MOVE      ; store_set_state("EV2_MOVE"           , LOG_MAP.EV2_MOVE       ); break;
        case "EV3_UP"          : LOG_MAP.EV3_UP         = !LOG_MAP.EV3_UP         ; changed = keyword+"="+LOG_MAP.EV3_UP        ; store_set_state("EV3_UP"             , LOG_MAP.EV3_UP         ); break;
        case "EV4_LONG_PRESS"  : LOG_MAP.EV4_LONG_PRESS = !LOG_MAP.EV4_LONG_PRESS ; changed = keyword+"="+LOG_MAP.EV4_LONG_PRESS; store_set_state("EV4_LONG_PRESS"     , LOG_MAP.EV4_LONG_PRESS ); break;
        case "EV5_TOOL_CB"     : LOG_MAP.EV5_TOOL_CB    = !LOG_MAP.EV5_TOOL_CB    ; changed = keyword+"="+LOG_MAP.EV5_TOOL_CB   ; store_set_state("EV5_TOOL_CB"        , LOG_MAP.EV5_TOOL_CB    ); break;
        case "EV6_CHANGED"     : LOG_MAP.EV6_CHANGED    = !LOG_MAP.EV6_CHANGED    ; changed = keyword+"="+LOG_MAP.EV6_CHANGED   ; store_set_state("EV6_CHANGED"        , LOG_MAP.EV6_CHANGED    ); break;
        case "EV7_DISPATCH"    : LOG_MAP.EV7_DISPATCH   = !LOG_MAP.EV7_DISPATCH   ; changed = keyword+"="+LOG_MAP.EV7_DISPATCH  ; store_set_state("EV7_DISPATCH"       , LOG_MAP.EV7_DISPATCH   ); break;
        case "EV8_FLOATLOG"    : LOG_MAP.EV8_FLOATLOG   = !LOG_MAP.EV8_FLOATLOG   ; changed = keyword+"="+LOG_MAP.EV8_FLOATLOG  ; store_set_state("EV8_FLOATLOG"       , LOG_MAP.EV8_FLOATLOG   ); break;
        case "S1_RANGE"        : LOG_MAP.S1_RANGE       = !LOG_MAP.S1_RANGE       ; changed = keyword+"="+LOG_MAP.S1_RANGE      ; store_set_state("S1_RANGE"           , LOG_MAP.S1_RANGE       ); break;
        case "S2_SELECT"       : LOG_MAP.S2_SELECT      = !LOG_MAP.S2_SELECT      ; changed = keyword+"="+LOG_MAP.S2_SELECT     ; store_set_state("S2_SELECT"          , LOG_MAP.S2_SELECT      ); break;
        case "S3_SLOT"         : LOG_MAP.S3_SLOT        = !LOG_MAP.S3_SLOT        ; changed = keyword+"="+LOG_MAP.S3_SLOT       ; store_set_state("S3_SLOT"            , LOG_MAP.S3_SLOT        ); break;
        case "T0_STORE"        : LOG_MAP.T0_STORE       = !LOG_MAP.T0_STORE       ; changed = keyword+"="+LOG_MAP.T0_STORE      ; store_set_state("T0_STORE"           , LOG_MAP.T0_STORE       ); break;
        case "T1_DOM_LOAD"     : LOG_MAP.T1_DOM_LOAD    = !LOG_MAP.T1_DOM_LOAD    ; changed = keyword+"="+LOG_MAP.T1_DOM_LOAD   ; store_set_state("T1_DOM_LOAD"        , LOG_MAP.T1_DOM_LOAD    ); break;
        case "T2_GRID"         : LOG_MAP.T2_GRID        = !LOG_MAP.T2_GRID        ; changed = keyword+"="+LOG_MAP.T2_GRID       ; store_set_state("T2_GRID"            , LOG_MAP.T2_GRID        ); break;
        case "T3_LAYOUT"       : LOG_MAP.T3_LAYOUT      = !LOG_MAP.T3_LAYOUT      ; changed = keyword+"="+LOG_MAP.T3_LAYOUT     ; store_set_state("T3_LAYOUT"          , LOG_MAP.T3_LAYOUT      ); break;
        case "T4_PIVOT"        : LOG_MAP.T4_PIVOT       = !LOG_MAP.T4_PIVOT       ; changed = keyword+"="+LOG_MAP.T4_PIVOT      ; store_set_state("T4_PIVOT"           , LOG_MAP.T4_PIVOT       ); break;
        case "T5_SPREAD"       : LOG_MAP.T5_SPREAD      = !LOG_MAP.T5_SPREAD      ; changed = keyword+"="+LOG_MAP.T5_SPREAD     ; store_set_state("T5_SPREAD"          , LOG_MAP.T5_SPREAD      ); break;
        case "T6_SLOT"         : LOG_MAP.T6_SLOT        = !LOG_MAP.T6_SLOT        ; changed = keyword+"="+LOG_MAP.T6_SLOT       ; store_set_state("T6_SLOT"            , LOG_MAP.T6_SLOT        ); break;
    }

log_add_TR_LAYOUT("<em class='big'>TOGGLE LOGGING ["+ keyword +"] changed=["+changed+"]</em>");
    if(changed)
    {
        t8_load_LOG_MAP();

        if(keyword == "EV8_FLOATLOG"  ) t_log_set_state( LOG_MAP.EV8_FLOATLOG   ); /* set both [DISPLAY OPTION] and saved [LOGGING OPTION] */

        t_sync_layout(caller);

    }
    return changed;
};
/* }}} */
/* logging_something {{{*/
let logging_something = function()
{
    if(onDown_SHIFT) return false;

    return     logging_EVENTS
        ||     logging_HIGHLIGHT
        ||     LOG_MAP.EV0_LISTEN
        ||     logging_TOOLBAR

    /* EVENTS */
        ||     LOG_MAP.EV1_DOWN
        ||     LOG_MAP.EV2_MOVE
        ||     LOG_MAP.EV3_UP
        ||     LOG_MAP.EV4_LONG_PRESS
        ||     LOG_MAP.EV5_TOOL_CB
        ||     LOG_MAP.EV6_CHANGED
        ||     LOG_MAP.EV7_DISPATCH

    /* LOGGING */
    /*  ||     LOG_MAP.EV8_FLOATLOG*/

    /* SELECTION */
        ||     LOG_MAP.S1_RANGE
        ||     LOG_MAP.S2_SELECT
        ||     LOG_MAP.S3_SLOT

    /*  ||     LOG_MAP.T0_STORE*/

    /* LAYOUT */
        ||     LOG_MAP.T1_DOM_LOAD
        ||     LOG_MAP.T2_GRID
        ||     LOG_MAP.T3_LAYOUT
        ||     LOG_MAP.T4_PIVOT
        ||     LOG_MAP.T5_SPREAD
        ||     LOG_MAP.T6_SLOT

    ;
};
/*}}}*/
/*  log_key_val {{{*/
let log_key_val       = function(name, o, lxx       ) { return log_key_val_group(name, o, lxx, true); };
let log_key_val_group = function(name, o, lxx, group)
{
    if(!o) {
        log(name+": %c null object ", (lxx || lb0));
        return "";
    }

/*{{{                  log("%c"+name, lbH+(lxx || lb0)); }}}*/
    if(group) console.groupCollapsed("%c"+SYMBOL_RIGHT+" "+name+"...", lbH+(lxx || lb0));
    else      console.log           ("%c"+SYMBOL_RIGHT+" "+name      , lbH+(lxx || lb0));
    let s = ""; let n = 1;
    Object.keys(o).forEach(
        function(key) {
            let val = o[key];
            let lbV =    (val ==  null         ) ?     lb2 /* NULL      */
                :        (val == "null_node"   ) ?     lb0 /* UNDEFINED */
                :        (val ==  undefined    ) ?     lb0 /* UNDEFINED */
                :        (val == "NO"          ) ?     lf3 /* NOTHING   */
                :        (val == "[]"          ) ?     lf3 /* NOTHING   */
                :        (val ==  false        ) ?     lf3 /* FALSE     */
                :        (val ==  true         ) ?     lb5 /* TRUE      */
                : (String(val).indexOf(LF) >= 0) ? lbH+lf5 /* SUBSTANCE */
                :                                      lf4 /* SOMETHING */
            ;
            log(" %c|||%c "+mPadStart(key, 32)     +" %c"+ log_object_val_format(o[key]), lb0,(lxx || lb0),lbV);
            s +=   "||| "+key+" <em class='cc"+(++n)+"'>"+ log_object_val_format(o[key]) +"</em><br>"+LF       ;
        }
    );
    if(group) console.groupEnd();
    return s;
};
/*}}}*/
/*_ log_object_val_format {{{*/
let log_object_val_format = function(val)
{
    let                                  text = String(val);
    if     ( !text                     ) text = "[]";
    else if(  typeof val == "object"   ) text = log_json(val, true); /* one_liner */
    else if(  typeof val == "function" ) text = SYMBOL_FUNCTION +" "+ (val.name || "anonymous");
    else if(  text.indexOf(LF) >= 0    ) text = text.replace(regexp_LF, LF);
    return    text;
};
/*}}}*/
/* log_json {{{*/
let regexp_BRACES = new RegExp("^{|}$"                    , "g");
let regexp_BSLASH = new RegExp("\\\\"                     , "g");
let regexp_URL_64 = new RegExp('"url":"([^"]{1,64})[^"]*"', "g");
let regexp_QUOTE  = new RegExp("[\\u0022\\u0027]", "g"); /* "' */
let regexp_COMMA  = new RegExp(" *, *", "g");
let log_json = function(val, one_liner=false)
{
    if(val == null     ) return "null";
    if(val == undefined) return "undefined";
    if(val.id          ) return "#"+val.id;
    if(val.tagName     ) return     val.tagName;

    let result = JSON.stringify(val)
        .        replace(regexp_URL_64, '"url":"$1..."')
        .        replace(regexp_BRACES, "")
        .        replace(regexp_QUOTE , "")
        .        replace(regexp_BSLASH, "")
        .        trim();

    result = result.replace(regexp_COMMA, (one_liner ? " .. " : LF));

    return result;
};

/*}}}*/
/* log {{{ */
/*{{{*/
const LOG_MAX     = 50000;
const CLEAR       = "DEFAULT_TO_CLEAR";
let   log_is_full = false;
/*}}}*/
let s_log = function(first_arg=CLEAR, ...args)
{
    /* [log_msg] {{{*/
    let log_msg = !first_arg ? CLEAR : first_arg.trim();

    /*}}}*/
/*
console.log("@@@")
console.log("@@@ log_msg=["+log_msg+"]")
for(let i=0; i < args.length; ++i) console.log("@@@ args["+i+"]=["+args[i]+"]");
console.log("@@@")
*/
    /* [log_level] {{{*/
    let log_level
        =   log_is_full              ? "warn"
        : (!log_HTML && args.length) ? args[0]
/*
        : (!log_HTML               ) ? "time"
        : (!log_HTML               ) ? "groupCollapsed"
        : (log_msg == CLEAR        ) ? "timeEnd"
        : (log_msg == CLEAR        ) ? "groupEnd"
*/
        :                              "log"
    ;

    /*}}}*/
/*
console.log("@@@ log_level=["+log_level+"]")
*/
    /* console {{{*/
    if(    (log_msg != CLEAR)
        && ((typeof console) != "undefined")
    ) {
        if(arguments[0]) arguments[0] = strip_html(arguments[0]);
/*
console.log("@@@")
console.log("@@@ arguments[0]=["+arguments[0]+"]")
console.log("@@@")
*/
        switch(log_level) {
            default              : console.log            .apply(console, Array.prototype.slice.call(arguments)); /*console.trace();*/ break;

            case "error"         : console.error          .apply(console, Array.prototype.slice.call(arguments)); break;
            case "warn"          : console.warn           .apply(console, Array.prototype.slice.call(arguments)); break;
            case "info"          : console.info           .apply(console, Array.prototype.slice.call(arguments)); break;

            case "time"          : console.time           .apply(console, "selection"                          ); break;
            case "timeEnd"       : console.timeEnd        .apply(console, "selection"                          ); break;
            case "groupEnd"      : console.groupEnd       .apply(console,                                      ); break;
            case "group"         : console.group          .apply(console, Array.prototype.slice.call(arguments)); break;
            case "groupCollapsed": console.groupCollapsed .apply(console, Array.prototype.slice.call(arguments)); break;

        }
    }
    /*}}}*/
    /* CLEAR [log_is_full] {{{*/
    if(log_msg == CLEAR) {
        if(log_is_full) {
            if((typeof console) != "undefined") console.warn("log_is_full");
            log_is_full = false;
        }
        log_HTML = "";
    }
    /*}}}*/
    /* log_HTML ADD {{{*/
    else {
        log_HTML += LF+ strip_pat(log_msg,"%c\\log_msg*");
    }
    /*}}}*/
    /* log_is_full {{{*/
    if(log_HTML.length > LOG_MAX)
    {
        /* WARN ONCE .. (until next init)*/
        if(!log_is_full ) {
            log_is_full = true;
            if((typeof console) != "undefined") console.error("log_is_full: ...LOG_MAX=["+LOG_MAX+"]");
        }
        return;
    }
    /*}}}*/
/*
:!start explorer "https://developers.google.com/web/tools/chrome-devtools/console/console-reference"
*/
};
var log = s_log; /* (global reference) */
/*}}}*/
/*  log_warn {{{*/
/*{{{*/
const LOG_WARN_COOLDOWN_DELAY = 2000;
const LOG_WARN_DIV            = "log_warn_div";
let   log_warn_timer;
let   log_warn_div;

/*}}}*/
let log_warn = function(caller, msg)
{
    console.warn("log_warn from %c"+caller+"%c .. %c"+strip_html(msg), lbH+lf5, lbA, lbH+lbb+lf4);
    /* [log_warn_div] {{{*/
    if(!log_warn_div) {
        let parent = document.body;
        if(!parent ) return;

        log_warn_div                          = document.createElement("DIV");
        log_warn_div.id                       = LOG_WARN_DIV;
        log_warn_div.className                = "big box_panel";
        log_warn_div.style.position           = "absolute";
        log_warn_div.style.background         = "rgba(191,191,191,0.9)";
        log_warn_div.style.transitionDuration = "250ms";
        parent.insertBefore(log_warn_div, parent.firstChild);
    }
    /*}}}*/
    /* SHOW {{{*/
    log_warn_div.innerHTML                    = msg;
    log_warn_div.style.top                    = "0px";
    log_warn_div.style.left                   = "0px";

    /*}}}*/
    /* HIDE {{{*/
    if(log_warn_timer) clearTimeout(log_warn_timer);
    log_warn_timer   =   setTimeout(log_warn_handler, LOG_WARN_COOLDOWN_DELAY);

    /*}}}*/
};

let log_warn_handler = function()
{
    log_warn_timer = null;
    log_warn_div.style.top  = (-2 * log_warn_div.offsetHeight)+"px"  ;
};
/*}}}*/
/* logXXX {{{*/
let logXXX_start_MS;
let razXXX = function(_caller)
{
    logXXX_start_MS = new Date().getTime();
    console.log("%c razXXX: RAZ BY %c "+_caller+"]", lbL, lbR+lf8);
/*{{{
console.trace();
    console_clear("razXXX("+_caller+")");
}}}*/
};
let logXXX = function()
{
/*{{{
    arguments[0] = "XXX "+arguments[0];
}}}*/
    if((typeof onDown_MS) != "undefined") { /*{{{*/
        let start_MS
            = (logXXX_start_MS > onDown_MS)
            ?  logXXX_start_MS
            :  onDown_MS;

        logXXX_start_MS = new Date().getTime();

        let elapsed_MS
            = start_MS
            ? (logXXX_start_MS - start_MS)
            : 0;

        /*{{{
        if(elapsed_MS && (elapsed_MS < 50)) {
            console.log("%c XXX ",lb4);
            console.trace();
        }
        }}}*/

        arguments[0] = "XXX ["+elapsed_MS+"] "+arguments[0];
    }
    else {
        arguments[0] = "XXX "                 +arguments[0];
    }
    /*}}}*/
    console.log.apply(console, Array.prototype.slice.call(arguments));
};
/*}}}*/
/* logBIG {{{*/
let logBIG = function(msg, lfx=lf7)
{
    console.log("%c "+SYMBOL_BLACK_SUN+" %c "+msg, lf3, lbb+lbH+lfx);
};
/*}}}*/
/* log_clear {{{*/
let log_clear = function(caller)
{
    t_clear("log_clear(caller=["+_caller+"])");
};
/*}}}*/
/* log set add clr {{{ */
let log_set_TR_count = 0;

let _log_add_TR1       = function(   msg="", ...args) { log_add_TR(log_tr1, msg, ...args); };
let _log_add_TR2       = function(   msg="", ...args) { log_add_TR(log_tr2, msg, ...args); };
let _log_set_TR1       = function(   msg="", ...args) { log_set_TR(log_tr1, msg, ...args); };
let _log_set_TR2       = function(   msg="", ...args) { log_set_TR(log_tr2, msg, ...args); };

let log_clr_TR1        = function(_caller) { /*logXXX("log_clr_TR1 .. CALLED BY "+_caller);*/ _log_set_TR1(""); };
let log_clr_TR2        = function(_caller) { /*logXXX("log_clr_TR2 .. CALLED BY "+_caller);*/ _log_set_TR2(""); };

let log_add_TR_EVENT   = _log_add_TR1;
let log_add_TR_SELECT  = _log_add_TR1;
let log_set_TR_EVENT   = _log_set_TR1;
let log_set_TR_LAYOUT  = _log_set_TR1;
let log_set_TR_SELECT  = _log_set_TR1;

let log_add_TR_LAYOUT  = _log_add_TR2;
let log_add_TR_STORAGE = _log_add_TR2;

/*}}}*/
/* log_set_TR_RESULT {{{ */
let log_set_TR_RESULT = function(html=log_HTML)
{
    if(!html.trim()) return;

    _log_set_TR2("<hr><table>"
            +   " <tr><td><pre id='html'>"+ html +"</pre></td></tr>"
            +   "</table>"
    );

    t_sync_layout("log_set_TR_RESULT");

    log_HTML = ""; /* NOTE: log() should be called first to clear results to be reported here */
};
/*}}}*/
/* log_set_TR {{{*/
let log_set_TR  = function(tr,msg="", ...args) {
    if(tr) {
        /* removeChild {{{*/
/*{{{
        for(let            i = (tr.childNodes.length-1); i > 0; --i)
        {
            if(!t_is_accessory_node( tr.childNodes[i] ) ) {
                tr.removeChild(      tr.childNodes[i] );
                i =                  tr.childNodes.length;
            }
        }
}}}*/
        /*}}}*/
        /* transcript decoration and step-stamp {{{*/
        t_clear_panel_pined_innerHTML( tr );
        tr.innerHTML += ""
            + "<em class='em_log'>"
            + "<span class='cc"+(++log_set_TR_count % SELECT_SLOT_MAX)+"'>"
            +  log_set_TR_count
            + "</span>"
            + "</em>"
        ;
        /*}}}*/
    }

    if(msg) { del_el_class(tr, "empty"); log_add_TR(tr, msg, args); }
    else    { add_el_class(tr, "empty");                            }

    log();
};
/*}}}*/
/*  log_add_TR {{{*/
let log_add_TR  = function(tr, msg="", ...args)
{
if(msg) console.log("%clog_add_TR%c"+strip_html(msg), lbH+lf8, String(args[0]));
/*{{{
}}}*/
    if(!tr) return;
    if(msg) del_el_class(tr, "empty");
    if(!tr.innerHTML) log_set_TR(tr,"");

    if(msg.trim() == "") msg = "empty msg";

    let s = "<table>";

    /* mStartRange {{{*/
    let mStartRange_str = (mStartRange) ? rangeToString(mStartRange, "mStartRange") : "";
    if(mStartRange) s += ""
        +" <tr><th                       >        mStartRange             </th></tr>"
        +" <tr><td                       ><pre>"+ mStartRange_str +"</pre></td></tr>"
    ;

    /*}}}*/
    /* mEndRange {{{*/
    let mEndRange_str   = (mEndRange  ) ? rangeToString(mEndRange  , "mEndRange"  ) : "";
    if(mEndRange) s += ""
        +" <tr><th                       >        mEndRange               </th></tr>"
        +" <tr><td                       ><pre>"+ mEndRange_str   +"</pre></td></tr>"
    ;

    /*}}}*/

    if(msg) s += ""
        +" <tr><td class='transcript_msg'>"+                    msg    +"</td></tr>"
        +"</table>"
    ;

    s += "<table>";

    tr.insertAdjacentHTML("beforeend", s);

/* send_onchange_event_to( tr ); */
};
/*}}}*/
/* log_layout_TR {{{*/
let log_layout_TR = function(tr)
{
    let x_min =         BOX_MARGIN - tr.offsetWidth ; if(tr.offsetLeft < x_min) tr.style.left = x_min+"px";
    let x_max = window.innerWidth  - BOX_MARGIN     ; if(tr.offsetLeft > x_max) tr.style.left = x_max+"px";

    let y_min =         BOX_MARGIN - tr.offsetHeight; if(tr.offsetTop < y_min) tr.style.top   = y_min+"px";
    let y_max = window.innerHeight - BOX_MARGIN     ; if(tr.offsetTop > y_max) tr.style.top   = y_max+"px";
};
/*}}}*/

/* log_sep top bot clr .. (NESTED COLLAPSED LOGGING) {{{*/
/* STYLE_TOP STYLE_BOT {{{*/
const STYLE_TOP = "font-weight:900; border:0px #000 solid; border-radius:2em 2em .1em .1em; padding:  0 1em 1em 2em; overflow:visible;";
const STYLE_BOT = "color:#0FF8;     border:0px #000 solid; border-radius:.1em .1em 2em 2em; padding:1em 1em 0em 2em; overflow:visible;";

const STYLE_BG_TOP=[];
      STYLE_BG_TOP [1] = " background:linear-gradient(to bottom, #964B0080 0%, #2222 100%);";
      STYLE_BG_TOP [2] = " background:linear-gradient(to bottom, #FF000080 0%, #2222 100%);";
      STYLE_BG_TOP [3] = " background:linear-gradient(to bottom, #FFA50080 0%, #2222 100%);";
      STYLE_BG_TOP [4] = " background:linear-gradient(to bottom, #FFFF0080 0%, #2222 100%);";
      STYLE_BG_TOP [5] = " background:linear-gradient(to bottom, #9ACD3280 0%, #2222 100%);";
      STYLE_BG_TOP [6] = " background:linear-gradient(to bottom, #6495ED80 0%, #2222 100%);";
      STYLE_BG_TOP [7] = " background:linear-gradient(to bottom, #EE82EE80 0%, #2222 100%);";
      STYLE_BG_TOP [8] = " background:linear-gradient(to bottom, #A0A0A080 0%, #2222 100%);";
      STYLE_BG_TOP [9] = " background:linear-gradient(to bottom, #FFFFFF80 0%, #2222 100%);";
      STYLE_BG_TOP [0] = " background:linear-gradient(to bottom, #00000080 0%, #2222 100%);";

const STYLE_BG_BOT=[];
      STYLE_BG_BOT [1] = " background:linear-gradient(to    top, #964B0080 0%, #2222 100%);";
      STYLE_BG_BOT [2] = " background:linear-gradient(to    top, #FF000080 0%, #2222 100%);";
      STYLE_BG_BOT [3] = " background:linear-gradient(to    top, #FFA50080 0%, #2222 100%);";
      STYLE_BG_BOT [4] = " background:linear-gradient(to    top, #FFFF0080 0%, #2222 100%);";
      STYLE_BG_BOT [5] = " background:linear-gradient(to    top, #9ACD3280 0%, #2222 100%);";
      STYLE_BG_BOT [6] = " background:linear-gradient(to    top, #6495ED80 0%, #2222 100%);";
      STYLE_BG_BOT [7] = " background:linear-gradient(to    top, #EE82EE80 0%, #2222 100%);";
      STYLE_BG_BOT [8] = " background:linear-gradient(to    top, #A0A0A080 0%, #2222 100%);";
      STYLE_BG_BOT [9] = " background:linear-gradient(to    top, #FFFFFF80 0%, #2222 100%);";
      STYLE_BG_BOT [0] = " background:linear-gradient(to    top, #00000080 0%, #2222 100%);";

/*}}}*/
/* SDN {{{
let SDN = [
 SD0
,SD1
,SD2+SD2
,SD3+SD3+SD3
,SD4+SD4+SD4+SD4
,SD5+SD5+SD5+SD5+SD5
,SD6+SD6+SD6+SD6+SD6+SD6
,SD7+SD7+SD7+SD7+SD7+SD7+SD7
,SD8+SD8+SD8+SD8+SD8+SD8+SD8+SD8
,SD9+SD9+SD9+SD9+SD9+SD9+SD9+SD9+SD9
];
}}}*/
/*  SDO {{{*/
let SLC = "\u2B55"; /* HEAVY */
let SDO = [
 SLC
,SLC
,SLC+SLC
,SLC+SLC+SLC
,SLC+SLC+SLC+SLC
,SLC+SLC+SLC+SLC+SLC
,SLC+SLC+SLC+SLC+SLC+SLC
,SLC+SLC+SLC+SLC+SLC+SLC+SLC
,SLC+SLC+SLC+SLC+SLC+SLC+SLC+SLC
,SLC+SLC+SLC+SLC+SLC+SLC+SLC+SLC+SLC
];
/*}}}*/

let log_sep_num = 0;
/*_ log_sep_top {{{*/
let log_sep_top = function(arg_line="")
{
    log_sep_num = (log_sep_num+1) % 10;

    let l_1 =       lbB +          lfX[ log_sep_num ];
    let l_2 = STYLE_TOP + STYLE_BG_TOP[ log_sep_num ];
    let sym =                      SDO[ log_sep_num ];
    let txt =               strip_html( arg_line    );

    console.groupCollapsed( "%c"+sym +"%c "+txt,l_1,l_2);
};
/*}}}*/
/*_ log_sep_bot {{{*/
let log_sep_bot = function(arg_line="")
{
    let l_1 =       lbB +          lfX[ log_sep_num ];
    let l_2 = STYLE_BOT + STYLE_BG_BOT[ log_sep_num ];
    let sym =                      SDO[ log_sep_num ];
    let txt =               strip_html( arg_line    );

    console.groupEnd();
    console.log(            "%c"+sym +"%c "+txt,l_1 ,l_2);

    log_sep_num = (log_sep_num <= 0) ? 0 : ((log_sep_num-1) % 10);
};
/*}}}*/
/*_ log_sep_clr {{{*/
let log_sep_clr = function()
{
    while(log_sep_num > 0) log_sep_bot(SYMBOL_RECYCLE);

    s_log( CLEAR );
};
/*}}}*/
/*}}}*/

/*}}}*/
//# sourceURL=dom_log.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**  5  UTIL    JS dom_util_js_data {{{*/
/*
../javascript/dom_util.js
*/
dom_util_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_util_js */
let DOM_UTIL_JS_ID        = "dom_util_js";
let DOM_UTIL_JS_TAG       = DOM_UTIL_JS_ID  +" (181230:00h)";

/* CONSOLE TEMPLATE TO BE IMPLEMENTED BY EMBEDDING LAYER {{{*/
  let DOUBLE_QUOTE  = String.fromCharCode(34);
  let LF            = String.fromCharCode(10);
  let CR            = String.fromCharCode(13);
/*}}}*/
/* SYMBOL {{{ */
/* Surrogate Pair Calculator:
:!start explorer "http://www.russellcottrell.com/greek/utilities/surrogatepaircalculator.htm"
*/
let SYMBOL_EMPTY                = "\u23D8";
let SYMBOL_FUNCTION             = "\u0083"; /*  */

let SYMBOL_RIGHT_PAIR_ARROW     = "\u21C9";
let SYMBOL_RIGHT_WAVE_ARROW     = "\u2933";

let SYMBOL_CIRCLE               = "\u233E";
let SYMBOL_ANCHOR               = "\u2693";
let SYMBOL_BLACK_SUN            = "\u2600";
let SYMBOL_BULB                 = "\ud83d\udca1";
let SYMBOL_TRAFFIC_LIGHT        = "\ud83d\udea6";
let SYMBOL_CHECK_MARK           = "\u2714";
let SYMBOL_CIRCLED_PLUS         = "\u2295";
let SYMBOL_DIRECT_HIT           = "\uD83C\uDFAF"; /* "\u1F3AF"; */
let SYMBOL_CIRCLE_ARROW         = "\u27F3";
let SYMBOL_DOWN_ARROW           = "\u2193";
let SYMBOL_RIGHT_LEFT_ARROW     = "\u21C4";
let SYMBOL_GEAR                 = "\u2699";
let SYMBOL_HEAVY_RIGHT_ARROW    = "\u2794";
let SYMBOL_LEFT_ARROW           = "\u27EA"; /* CHEVRON LEFT */
let SYMBOL_LOWER_RIGHT          = "\u25E2";
let SYMBOL_MENU                 = "\u2630";
let SYMBOL_MOON                 = "\u263D";
let SYMBOL_NOT_CHECKED          = "\u237B";
let SYMBOL_NO_ENTRY             = "\u26D4";
let SYMBOL_RECYCLE              = "\u267B";
let SYMBOL_RIGHT_DBL_A_BRK      = "\u27EB";
let SYMBOL_RIGHT_ARROW          = "\u2192";
let SYMBOL_SAILBOAT             = "\u26F5";
let SYMBOL_UPPER_LEFT           = "\u25E4";
let SYMBOL_UP_WHITE_ARROW       = "\u2191";
let SYMBOL_UP_ARROW             = "\u2191";
let SYMBOL_UP_DOWN_ARROW        = "\u21C5";
let SYMBOL_DOWN_POINTING        = "\u261F";
let SYMBOL_SECTION              = "\u00A7";
let SYMBOL_PARAGRAPH            = "\u00B6";
let SYMBOL_DOUBLE_VBAR          = "\u2590\u2590";
let SYMBOL_ELLIPSIS             = "\u2026";

/*
let SYMBOL_CLIPBOARD            = "\u1F4CB";
let SYMBOL_CLIPBOARD            = "\u2398";
*/
let SYMBOL_CLIPBOARD            = "\uD83D\uDCCB";
let SYMBOL_WASTEBASKET          = "\uD83D\uDDD1"; /* \u1F5D1 */
let SYMBOL_SCISSORS             = "\u2702";

let SYMBOL_EXPAND_IS_ON         = SYMBOL_LEFT_ARROW;
let SYMBOL_EXPAND_IS_OFF        = SYMBOL_RIGHT_DBL_A_BRK;

let SYMBOL_WORDING_IS_ON        = "W";
let SYMBOL_WORDING_IS_OFF       = "w";

let SYMBOL_THEME_DARK_IS_OFF    = SYMBOL_BLACK_SUN;
let SYMBOL_THEME_DARK_IS_ON     = SYMBOL_MOON;

let SYMBOL_STAGE1_INPUT         = SYMBOL_DOWN_POINTING;
let SYMBOL_STAGE2_ACTION        = SYMBOL_CIRCLE_ARROW;
let SYMBOL_STAGE3_RESULT        = SYMBOL_HEAVY_RIGHT_ARROW;
/*
let SYMBOL_EYE                  = "\ud83d\udc41";
let SYMBOL_EYE                  = "\u1F441";
*/
let SYMBOL_EYE                  = SYMBOL_BULB;

let SYMBOL_BLACK_SQUARE         = "\u25A0";
let SYMBOL_SQUARE_HFILL         = "\u25A4";
let SYMBOL_WHITE_SQUARE         = "\u25A1";

let SYMBOL_LEFT_HALF_BLACK      = "\u25E7";
let SYMBOL_RIGHT_HALF_BLACK     = "\u25E8";
let SYMBOL_WHITE_MEDIUM_SQUARE  = "\u25FB";
let SYMBOL_WHITE_SMALL_SQUARE   = "\u25FD";
let SYMBOL_BLACK_MEDIUM_SQUARE  = "\u25FC";
let SYMBOL_BLACK_SMALL_SQUARE   = "\u25FE";

let SYMBOL_REPLACEMENT_CHAR     = "\uFFFD";
let SYMBOL_HEAVY_BALLOT         = "\u2718";
let SYMBOL_BALLOT_CHECK         = "\u2611";
let SYMBOL_CLOCKWISE_OPEN_CIRCLE= "\u21BB";

let SYMBOL_PARTNERSHIP          = "\u26AF";
let SYMBOL_WHITE_SMILEY         = "\u263A";
let SYMBOL_BLACK_SMILEY         = "\u263B";
let SYMBOL_FROWNING_FACE        = "\u2639";
let SYMBOL_TRUCK                = "\u26DF";
let SYMBOL_WRITING_HAND         = "\u270D";
let SYMBOL_BLACK_L_HAND         = "\u261A";
let SYMBOL_BLACK_R_HAND         = "\u261B";
let SYMBOL_WHITE_L_HAND         = "\u261C";

let SYMBOL_DBL_EXCLAM           = "\u203C";
let SYMBOL_EXCLAM_QUESTION      = "\u2049";
let SYMBOL_WARNING              = "\u26A0";
let SYMBOL_LEFT_RIGHT_ARROW     = "\u2194";

let SYMBOL_STAR                 = "\u2B50";
let SYMBOL_CLOUD                = "\u2601";
let SYMBOL_HOURGLASS            = "\u23F3";
let SYMBOL_WATCH                = "\u231A";

let SYMBOL_BLACK_CIRCLE         = "\u25CF";
let SYMBOL_BLMED_CIRCLE         = "\u26AB"; /* MEDIUM */
let SYMBOL_LARGE_CIRCLE         = "\u2B55"; /* HEAVY */
let SYMBOL_WHITE_CIRCLE         = "\u26AA"; /* MEDIUM_WHITE */

let SYMBOL_UP                   = "\u25B2";
let SYMBOL_RIGHT                = "\u25B6";
let SYMBOL_DOWN                 = "\u25BC";
let SYMBOL_LEFT                 = "\u25C0";
/*
:new /LOCAL/DATA/ANDROID/PROJECTS/RTabs/app/src/main/java/ivanwfr/rtabs/Settings.java
*/
let SYMBOL_MAILBOX              = "\uD83D\uDCEC"; /* NO */
let SYMBOL_TRAFFIC              = "\uD83D\uDEA6"; /* NO */
let SYMBOL_MAGNIFY_LEFT         = "\uD83D\uDD0D"; /* 1f50d works */
let SYMBOL_MAGNIFY_RIGHT        = "\uD83D\uDD0E"; /* 1f50e works */
let SYMBOL_CONSTRUCTION         = "\uD83D\uDEA7"; /* works */
/*
let SYMBOL_PAT_BAG              = "<span class='sym_bag'>"+     SYMBOL_SCISSORS         +"</span>";
let SYMBOL_OFF_BAG              = "<span class='sym_bag'>"+     SYMBOL_HOURGLASS        +"</span>";
let SYMBOL_BAK_BAG              = "<span class='sym_bag'>"+     SYMBOL_WATCH            +"</span>";
let SYMBOL_BIN_BAG              = "<span class='sym_bag'>"+     SYMBOL_HEAVY_BALLOT     +"</span>";
*/
let SYMBOL_SEL                  = "<span class='sym_showing'>"+ SYMBOL_CHECK_MARK       +"</span> show";
let SYMBOL_HID                  = "<span class='sym_hiding' >"+ SYMBOL_HEAVY_BALLOT     +"</span> hide";
let SYMBOL_BAK                  = "<span class='sym_backing'>"+ SYMBOL_SQUARE_HFILL     +"</span> save";
let SYMBOL_ALT                  = "<span class='sym_alting'>" + SYMBOL_WHITE_SQUARE     +"</span> save";

let SYMBOL_COLIDE               =   "<em class='sym_colide' >"+ SYMBOL_WARNING          +"</em> SELECTED";
let SYMBOL_DISMISS              =   "<em class='sym_dismiss'>"+ SYMBOL_LEFT_RIGHT_ARROW +"</em> DISMISS" ;

let SYMBOL_CLEAR_BAK            =   "<em class='sym_backing'>"+ SYMBOL_BLACK_CIRCLE     +"</em> <em class='want cc2'>CLRBAK</em>";
let SYMBOL_CLEAR_BIN            =   "<em class='sym_binning'>"+ SYMBOL_BLACK_CIRCLE     +"</em> <em class='want cc0'>CLRBIN</em>";

let SYMBOL_UPDATE               =   "<em class='sym_update' >"+ SYMBOL_EXCLAM_QUESTION  +"</em> <em class='want cc3'>ASSIGN</em>";
let SYMBOL_STAGE                =   "<em class='sym_staged' >"+ SYMBOL_DBL_EXCLAM       +"</em> <em class='have cc6'>STAGED</em>"; /* @see phase_color */
let SYMBOL_RESULT               =   "<em class='sym_result' >"+ SYMBOL_CONSTRUCTION     +"</em> <em class='have cc4'>RESULT</em>"; /* @see phase_color */

let SYMBOL_BAGGER               =   "<em class='sym_bagger' >"+ SYMBOL_BLACK_SMILEY     +"</em>";
let SYMBOL_DOCKER               =   "<em class='sym_docker' >"+ SYMBOL_BLACK_SMILEY     +"</em>";

/* }}} */
/* SYM {{{*/

let SAU = "\u2191"; /* &#x2191; .. SYMBOL ARROW UP       */
let SAR = "\u2192"; /* &#x2192; .. SYMBOL ARROW RIGHT    */
let SAD = "\u2193"; /* &#x2193; .. SYMBOL ARROW DOWN     */
let SAL = "\u21AA"; /* &#x21AA; .. SYMBOL ARROW LEFT     */

let SHV = "\u26A1"; /* &#x26A1; .. HIGH VOLTAGE SIGN     */
let SYN = "\u25CF"; /* &#x25CF; .. SYMBOL BLACK CIRCLE   */
let SBS = "\u2605"; /* &#x2605; .. SYMBOL BLACK STAR     */

let SD0 = "\u24EA"; /* &#x2775; ..       CIRCLED DIGIT  0 */
let SD1 = "\u2776"; /* &#x2776; .. BLACK CIRCLED DIGIT  1 */
let SD2 = "\u2777"; /* &#x2777; .. BLACK CIRCLED DIGIT  2 */
let SD3 = "\u2778"; /* &#x2778; .. BLACK CIRCLED DIGIT  3 */
let SD4 = "\u2779"; /* &#x2779; .. BLACK CIRCLED DIGIT  4 */
let SD5 = "\u277A"; /* &#x277A; .. BLACK CIRCLED DIGIT  5 */
let SD6 = "\u277B"; /* &#x277B; .. BLACK CIRCLED DIGIT  6 */
let SD7 = "\u277C"; /* &#x277C; .. BLACK CIRCLED DIGIT  7 */
let SD8 = "\u277D"; /* &#x277D; .. BLACK CIRCLED DIGIT  8 */
let SD9 = "\u277E"; /* &#x277E; .. BLACK CIRCLED DIGIT  9 */
let SDA = "\u277F"; /* &#x277F; .. BLACK CIRCLED DIGIT 10 */
let SDB = "\u24EB"; /* &#x27EB; .. BLACK CIRCLED DIGIT 11 */
let SDC = "\u24EC"; /* &#x27EC; .. BLACK CIRCLED DIGIT 12 */
let SDD = "\u24ED"; /* &#x27ED; .. BLACK CIRCLED DIGIT 13 */
let SDE = "\u24EE"; /* &#x27EE; .. BLACK CIRCLED DIGIT 14 */
let SDF = "\u24EF"; /* &#x27EF; .. BLACK CIRCLED DIGIT 15 */
let SDX = [ SD0 ,SD1 ,SD2 ,SD3 ,SD4 ,SD5 ,SD6 ,SD7 ,SD8 ,SD9 ];
/*}}}*/
/* [target_tool] {{{*/
let SYMBOL_TT_PIN               = SYMBOL_HEAVY_BALLOT;
let SYMBOL_TT_PASTE             = SYMBOL_DOWN_ARROW;

/*}}}*/

/* HTML */
/* PARENT CHILD {{{*/
/*_ is_el_child_of_class {{{*/
let is_el_child_of_class = function(el, className)
{
    while(el && (el = el.parentElement) && !el.classList.contains(className))
        ;
    return (el != null);
};
/*}}}*/
/*_ is_el_or_child_of_parent_el {{{*/
let is_el_or_child_of_parent_el = function(el, parent_el)
{
    if(!parent_el) return false;

    while(el && (el != parent_el))
        el = el.parentElement;

    return (el == parent_el);
};
/*}}}*/
/*_ is_a_doc_tool_panel {{{*/
let is_a_doc_tool_panel = function(node)
{
    return node.classList.contains("transcript")
};
/*}}}*/
/*_ is_a_doc_tool_button {{{*/
let is_a_doc_tool_button = function(node)
{
    return is_el_child_of_class(node,"transcript")
};
/*}}}*/
/*_ get_el_parent_with_id {{{*/
let get_el_parent_with_id = function(el)
{
    do {
        el = el.parentElement;
    } while(el && !el.id);

    return  el;
};
/*}}}*/
/*_ get_el_parent_with_tag {{{*/
let get_el_parent_with_tag = function(el,tag)
{
    while(el && (el.tagName != tag))
        el = el.parentElement;

    if(    !el                        ) return null;
    return (         tag == el.tagName) ? el : null;
};
/*}}}*/
/*_ get_el_parent_with_class {{{*/
let get_el_parent_with_class = function(el, className)
{
    while(   el ) {
        if(  el.classList.contains( className )) return el;
        el = el.parentElement;
    }
    return null;
};
/*}}}*/
/*_ get_el_child_with_tag {{{*/
let get_el_child_with_tag = function(parent,tag)
{
    for(let     c = 0; c < parent.children.length; ++c) {
        let child = parent.children[c];
        if((child != null) && (child.tagName == tag))
            return child;
    }
    return null;
};
/*}}}*/
/*_ get_el_child_with_class {{{*/
let get_el_child_with_class = function(parent,className)
{
    if(!parent) return null;

    for(let c=0; c < parent.childNodes.length; ++c) {
        let child  = parent.childNodes[c];
        if((child != null) && has_el_class(child, className))
            return child;
    }

    return null;
};
/*}}}*/
/*}}}*/
/* EVENTS {{{*/
/*_ get_onDown_is_on_scrollbar {{{*/
let get_onDown_is_on_scrollbar = function(e)
{
    let result
        =  (e.clientX > document.documentElement.clientWidth )
        || (e.clientY > document.documentElement.clientHeight)
    ;
/*{{{
logXXX("get_onDown_is_on_scrollbar: ...return "+ result);
console.dir(e)
logXXX(".......................e.target=["+ get_n_lbl(e.target)                                                             +"]");
logXXX(".............................XY=["+ e.clientX +" "+ e.clientY                                                       +"]");
logXXX("...document.documentElement. WH=["+ document.documentElement.clientWidth +" "+ document.documentElement.clientHeight+"]");
}}}*/
    return result;
};
/*}}}*/
/*_ get_el_parent_with_any_event_handler {{{*/
let get_el_parent_with_any_event_handler = function(el)
{
    while(el
           && !get_el_mouse_event_handler(el)
           && !get_el_onkey_event_handler(el)
           && !get_el_input_event_handler(el)
         )
        el = el.parentElement;

    return el;
};
/*}}}*/
/*_ get_el_mouse_event_handler {{{*/
let get_el_mouse_event_handler = function(el)
{
    if(!el)                    return null;
    if(el.onmousedown != null) return el.onmousedown;
    if(el.onmouseup   != null) return el.onmouseup  ;
    if(el.touchstart  != null) return el.onmouseup  ;
    if(el.touchend    != null) return el.onmouseup  ;
    if(el.onclick     != null) return el.onclick    ;
    if(el.ondblclick  != null) return el.ondblclick ;
    else                       return null;
};
/*}}}*/
/*_ get_el_onkey_event_handler {{{*/
let get_el_onkey_event_handler = function(el)
{
    if(!el)                    return null;
    if(el.onkeydown   != null) return el.onkeydown  ;
    if(el.onkeypress  != null) return el.onkeypress ;
    if(el.onkeyup     != null) return el.onkeyup    ;
    else                       return null;
};
/*}}}*/
/*_ get_el_input_event_handler {{{*/
let get_el_input_event_handler = function(el)
{
    if(!el)                    return null;
    if(el.onchange    != null) return el.onchange   ;
    if(el.onfocus     != null) return el.onfocus    ;
    if(el.onselect    != null) return el.onselect   ;
    if(el.oninput     != null) return el.oninput    ;
    if(el.onsubmit    != null) return el.onsubmit   ;
    if(el.onblur      != null) return el.onblur     ;
    else                       return null;
};
/*}}}*/
/*_ get_el_event_handler {{{*/
let get_el_event_handler = function(el, _caller)
{
let log_this = (LOG_MAP.EV0_LISTEN || logging_EVENTS);

    /* [e_target_or_parent] with handler {{{*/
    if(!el) return null;

    let e_target_or_parent = get_el_parent_with_any_event_handler( el );

    if(!e_target_or_parent) return   null;
    /*}}}*/
    /* [handler] {{{*/
    let handler
        = (e_target_or_parent             == null) ? null
        : (e_target_or_parent.onclick     != null) ? e_target_or_parent.onclick
        : (e_target_or_parent.ondblclick  != null) ? e_target_or_parent.ondblclick
        : (e_target_or_parent.onmousedown != null) ? e_target_or_parent.onmousedown
        : (e_target_or_parent.onmouseup   != null) ? e_target_or_parent.onmouseup
        : (e_target_or_parent.onkeypress  != null) ? e_target_or_parent.onkeypress
        : (e_target_or_parent.onkeyup     != null) ? e_target_or_parent.onkeyup
        : (e_target_or_parent.onchange    != null) ? e_target_or_parent.onchange
        :                                            null;

    if(!handler) return   null;
    /*}}}*/
    let label = get_el_event_handler_label(el, e_target_or_parent, handler);

if(log_this) log("%c get_el_event_handler("+get_n_lbl(el)+") .. CALLED BY ["+ _caller+"]: ...return handler=["+((handler != null) ? "function" : "null")+"]"+LF+"%c"+label,lb6,lbF);

    return { handler:handler , label:label }
};
/*}}}*/
/*_ get_el_event_handler_label {{{*/
let get_el_event_handler_label = function(el, e_target_or_parent, handler)
{
    let el_label
        =          ( e_target_or_parent               !=  el )
        ? get_n_lbl( e_target_or_parent )+" "+ get_n_lbl( el )
        :                                      get_n_lbl( el )
    ;

    let handler_code = ellipsis(strip_CR_LF( handler.toString() ), 128);

    return "["+el_label +"] "+ handler_code;
};
    /*}}}*/
/*_ send_onchange_event_to {{{ */
let send_onchange_event_to = function(el)
{
    let caller = "send_onchange_event_to("+el.id+")";
    try {
        if("createEvent" in document)
        {
            let evt = document.createEvent("HTMLEvents");
            evt.initEvent("onchange", false, true);
            el.dispatchEvent(evt);
        }
        else {
            el.fireEvent("onchange");
        }
    }
    catch(ex) { log(caller+": "+ex, "error"); }
};
/*}}}*/
/*}}}*/
/* XY {{{*/
/*_ get_el_xy {{{*/
let get_el_xy = function(el, _caller)
{
    if(!el) return null;

    let  x = 0;
    let  y = 0;

    if( el.style.position == "fixed")
    {
        x   = el.offsetLeft;
        y   = el.offsetTop ;
    }
    else {
        while(el) {
            x  += el.offsetLeft;
            y  += el.offsetTop ;
            el  = el.offsetParent;
        }
    }
    return { x: x, y: y };
};
/*}}}*/
/*_ get_el_xy_computed {{{*/
let get_el_xy_computed = function(el, _caller)
{
    let cs = window.getComputedStyle(el);
    let  x = parseInt(cs.Left);
    let  y = parseInt(cs.Top );
    return { x: x, y: y };
};
/*
*/
/*}}}*/
/*}}}*/
/* LAYOUT {{{*/
/*_ getRealTop {{{ */
let getRealTop = function(el)
{
    if(el.nodeType == Node.TEXT_NODE) el = el.parentElement;
    let    y = el.offsetTop;
/*
logXXX("___"+get_n_lbl(el)+".offsetTop=["+el.offsetTop+"]")
*/
    while(el = el.offsetParent) {
/*
logXXX("____"+get_n_lbl(el)+".offsetTop=["+el.offsetTop+"]")
*/
        y   += el.offsetTop;
    }
    return y;
};
/*}}}*/
/*_ getRealBot {{{ */
let getRealBot = function(el)
{
    if(el.nodeType == Node.TEXT_NODE) el = el.parentElement;
    return getRealTop(el) + el.offsetHeight;
};
/*}}}*/
/*_ get_page_height {{{ */
let get_page_height = function()
{
/*
logXXX(    "ocument.body")
logXXX(    document.body.scrollHeight)
logXXX(    document.body.clientHeight)
logXXX(    document.body.offsetHeight)
logXXX(    "ocument.body.parentElement")
logXXX(    document.body.parentElement.scrollHeight)
logXXX(    document.body.parentElement.clientHeight)
logXXX(    document.body.parentElement.offsetHeight)
*/

    return document.body.parentElement.scrollHeight; /* HTML */

/*  return document.body.scrollHeight; */ /* VIEWABLE+OVERFLOW +PADDING                    -border -scrollbar -margin */
/*  return document.body.clientHeight; */ /* VIEWABLE          +PADDING                    -border -scrollbar -margin */
/*  return document.body.offsetHeight; */ /* VIEWABLE          +PADDING +BORDER +SCROLLBAR                    -margin */
/*
    let body = document.body;
    let html = document.documentElement;
    return Math.max(
          body.clientHeight
        , body.offsetHeight
        , body.scrollHeight
        , html.clientHeight
        , html.offsetHeight
        , html.scrollHeight
    );
*/
};
/*}}}*/
/*}}}*/
/* CSS_CLASS {{{*/
let has_el_class     = function(el, className) { if(!el || !el.classList) return false; return el.classList.contains( className );                                   };
let add_el_class     = function(el, className) { if(!el || !el.classList) return      ; if(   !el.classList.contains( className )) el.classList.add   ( className ); };
let del_el_class     = function(el, className) { if(!el || !el.classList) return      ; if(    el.classList.contains( className )) el.classList.remove( className ); };
let set_el_class     = function(el, className) { if(!el || !el.classList) return      ;                                            el.className       = className  ; };
/*_ flip_el_class {{{*/
let flip_el_class = function(el_or_id, className)
{
    let el = (typeof               el_or_id == "object")
        ?                          el_or_id
        :  document.getElementById(el_or_id)
    ;
    if( has_el_class(el, className) ) del_el_class(el, className);
    else                              add_el_class(el, className);
};
/*}}}*/
let flip_id_class = flip_el_class;
/*_ set_id_class_on_off {{{*/
let set_id_class_on_off = function(id, className, on_off)
{
    let el = get_tool(id);
    if(!el) return;

    set_el_class_on_off(el, className, on_off);
};
/*}}}*/
/*_ set_el_class_on_off {{{*/
let set_el_class_on_off = function(el, className, on_off)
{
    if(on_off) add_el_class(el, className);
    else       del_el_class(el, className);
};
/*}}}*/
/*_ set_el_class_removing {{{*/
let set_el_class_removing = function(el_or_id, class_to_add, classes_to_remove)
{
    let el = (typeof               el_or_id == "object")
        ?                          el_or_id
        :  document.getElementById(el_or_id)
    ;
    /* [classes_to_remove] */
    let removed = "";
    for(let i=0; i <              classes_to_remove.length; ++i)
    {
        if(el.classList.contains( classes_to_remove[i] )) {
            el.classList.remove ( classes_to_remove[i] );
            removed =             classes_to_remove[i]  ;
        }
    }

    /* [class_to_add] */
    if(class_to_add)
    {
        if(!el.classList.contains   ( class_to_add ))
            el.classList.add        ( class_to_add );
    }

    return removed;
};
/*}}}*/
/*_ cycle_el_classList {{{*/
let cycle_el_classList = function(el_or_id, classList)
{
    let el = (typeof               el_or_id == "object")
        ?                          el_or_id
        :  document.getElementById(el_or_id)
    ;
    /* REMOVE ALL OF [classList] */
    let next_picked;
    for(let i=0; i <              classList.length; ++i) {
        if(el.classList.contains( classList[i] ))
        {
            el.classList.remove ( classList[i] );
            next_picked    =      classList[i+1];
        }
    }

    /* ADD [next_picked] */
    if(!next_picked) next_picked = classList[0];
    if( next_picked) el.classList.add( next_picked );

/*{{{
let txt = "";
for(let i=0; i < classList.length; ++i) {
    txt += (next_picked == classList[i])
    ? " ["+classList[i]+"]"
    :  " "+classList[i];
}
logXXX(txt);
}}}*/
    return next_picked;
};
/*}}}*/
let cycle_id_classList = cycle_el_classList;
/*}}}*/

/* STRING */
/* REGEX {{{*/
/*_ trim_node_textContent {{{ */
let trim_node_textContent = function(node)
{
    return strip_CR_LF( ellipsis(node.textContent.trim(), 64) );
};
/*}}}*/
/*_ strip_pat {{{*/
let strip_pat = function(text, str)
{
    if(typeof text == "undefined") return text;

    let regexp_char = new RegExp(str, "g");
    return text
        .   replace(regexp_char,  "")
        .   trim()
    ;
};
/*}}}*/
/*_ strip_CR_LF {{{*/
let regexp_CR = new RegExp("\\r", "g");
let regexp_LF = new RegExp("\\n", "g");
let strip_CR_LF = function(text)
{
    return text
        .   replace(regexp_CR,  "")
        .   replace(regexp_LF, " ")
        .   trim()
    ;
};
/*}}}*/
/*_ strip_UL {{{*/
let regexp_ULX = new RegExp("__+", "g");
let regexp_UL  = new RegExp(  "_", "g");
let strip_UL   = function(text)
{
    return text
        .   replace(regexp_ULX, LF    )
        .   replace(regexp_UL , " "   )
        .   trim()
    ;
};
/*}}}*/
/*_ strip_to_lines {{{*/
let strip_to_lines = function(text)
{
    return text
        .   replace(regexp_BRACKET_O, LF)
        .   replace(regexp_COMMA    , LF)
        .   replace(regexp_BRACKET_C, "")
    ;
};
/*}}}*/
/*_ trim_WORDS {{{*/
let regexp_NW_S = new RegExp("^ *[^0-9~A-z\\xC0-\\xFF]+"   , "g");
let regexp_NW_E = new RegExp(   "[^0-9~A-z\\xC0-\\xFF]+ *$", "g");
let trim_WORDS = function(text)
{
    return text
        .   replace(regexp_NW_S, "")
        .   replace(regexp_NW_E, "")
    ;
};
/*}}}*/
/*_ tokenize {{{*/
/* ............................................................... HOSTNAME__________   PATHNAME_______ */
let regexp_NW      = new RegExp("[^0-9~A-z\\xC0-\\xFF]+", "g"); /* www.remotetabs.com _ C://LOCAL/STORE */
let regexp_WORDS   = new RegExp("www|com|html"          , "g"); /* www remotetabs com _ C   LOCAL STORE */
let regexp_HEADS   = new RegExp("^\\w\\s"                    ); /*                    _   C LOCAL_STORE */
let regexp_SPACE   = new RegExp("\\s+"                  , "g"); /*                    _     LOCAL_STORE */
let tokenize = function(text)
{
    return text
        .   replace(regexp_NW   , " ")
        .   replace(regexp_WORDS,  "")
        .   replace(regexp_HEADS,  "")
        .   trim(                    )
        .   replace(regexp_SPACE, "_")
    ;
};
/*}}}*/
/*_ comma_to_vbar    {{{*/
let comma_to_vbar    = function(text)
{
    return text
        .   replace(regexp_COMMA_ASC, "|")
    ;
};
/*}}}*/
/*_ vbar_to_up_arrow {{{*/
let vbar_to_up_arrow = function(text)
{
    return text
        .   replace(regexp_VBAR, SYMBOL_UP_ARROW)
    ;
};
/*}}}*/
/*_ vbar_to_comma    {{{*/
let vbar_to_comma    = function(text)
{
    return text
        .   replace(regexp_VBAR, ",")
    ;
};
/*}}}*/
/*_ escape_CR_LF {{{*/
let escape_CR_LF = function(text)
{
    return text
        .   replace(regexp_CR, SYMBOL_CR   )
        .   replace(regexp_LF, SYMBOL_LF+"<br>"+LF)
        .   trim()
    ;
};
/*}}}*/
/*_ trim_alNum_lines {{{ */
let trim_alNum_lines = function(textContent)
{
    return trim_empty_lines(textContent, true);
};
/*}}}*/
/*_ trim_empty_lines {{{ */
let regexp_AN = new RegExp("[^a-z_ A-Z0-9]", "g");
/*r regexp_nW = new RegExp("\\W"           , "g");*/
let regexp_mS = new RegExp("\\s{2,}"       , "g");
let trim_empty_lines = function(textContent, alnum_filter=false)
{
    let caller = "trim_empty_lines";
    let text = "";
    try {
        if(textContent)
        {
            /* erase CR LF */
            text = strip_CR_LF( textContent.trim() );

            /* keep words only .. (erase non-word chars) */
            if(alnum_filter)
                text = text
                    .  replace(regexp_AN, " ")
                    /* replace(regexp_nW, " ")*/
                    ;

            /* collapse multiple space chars */
            text = text
                .  replace(regexp_mS, " ")
                ;

            if(text > 32)
                text = ellipsis(text, 32);
        }
    }
    catch(ex) { log(caller+": "+ex, "error"); }
    return text.trim();
};
/*}}}*/
/*_ s_get_htmlEntities {{{ */
let regexp_HTML_AMP   = new RegExp("&", "g");
let regexp_HTML_LT    = new RegExp("<", "g");
let regexp_HTML_GT    = new RegExp(">", "g");
let regexp_HTML_QUOTE = new RegExp(DOUBLE_QUOTE, "g");
let s_get_htmlEntities = function(str)
{
    return String(str)
        .replace(regexp_HTML_AMP  , "&amp;")
        .replace(regexp_HTML_LT   , "&lt;")
        .replace(regexp_HTML_GT   , "&gt;")
        .replace(regexp_HTML_QUOTE, "&quot;")
    ;

};
/*}}}*/
/*_ strip_html {{{*/
let regexp_EM_O  = new RegExp("<em[^>]*> *"              , "g");
let regexp_EM_C  = new RegExp(" *</em[^>]*>"             , "g");
let regexp_EOL   = new RegExp("<(ol|ul|/li|/div|br|pre)>", "g");
let regexp_HTML  = new RegExp("<[^>]*>"                  , "g");
let regexp_ENTT  = new RegExp("&\\w+;"                   , "g");
let regexp_HLEAD = new RegExp("\\[\\s*\\["               , "g");
let regexp_HTAIL = new RegExp("\\]\\s*\\]"               , "g");
/*
let regexp_TRUE = new RegExp("=?\\[?true\\]?"           , "g");
let regexp_FALSE= new RegExp("=?\\[?false\\]?"          , "g");
*/
let regexp_LF2  = new RegExp("\\n{2,}"                  , "g");

let LOG_TRUE          = " TRUE_____";
let LOG_FALSE         = " ____false";

let strip_html = function(text)
{
    return text
        .   replace(regexp_EM_O , "["         )
        .   replace(regexp_EM_C , "] "        )
        .   replace(regexp_EOL  , LF          )
        .   replace(regexp_LF2  , LF          )
        .   replace(regexp_HTML , " "         )
        .   replace(regexp_SPACE, " "         )
        .   replace(regexp_ENTT , SYMBOL_EMPTY)
        .   replace(regexp_HLEAD , "["        )
        .   replace(regexp_HTAIL , "]"        )
/*
        .   replace(regexp_TRUE , LOG_TRUE    )
        .   replace(regexp_FALSE, LOG_FALSE   )
*/
        .trim()
    ;
};
/*}}}*/
/*_ bracket_to_em {{{*/
let regexp_BRACKET_O = new RegExp("\\[", "g");
let regexp_BRACKET_C = new RegExp("\\]", "g");
let bracket_to_em = function(text)
{
    return text
        .   replace(regexp_BRACKET_O,  "<em>")
        .   replace(regexp_BRACKET_C, "</em>")
    ;
};
/*}}}*/
/*_ underline_to_space {{{*/
let regexp_UNDERLINE = new RegExp("_", "g");
let underline_to_space = function(text)
{
    return text
        .   replace(regexp_UNDERLINE,  " ")
    ;
};
/*}}}*/
/*_ get_first_word {{{*/
let regexp_FIRST_WORD = new RegExp("(\\w+)", "i");
let get_first_word = function(text, caller)
{
/*
    return strip_CR_LF( text.trim() )
        .  replace(regexp_FIRST_WORD, "$1");
    return text;
*/
    regexp_FIRST_WORD.lastIndex = 0;

    let matches = regexp_FIRST_WORD.exec( text );

    let  result = (matches) ? matches[0] : "";

if(LOG_MAX.S1_RANGE) log("get_first_word(text=["+text+"], caller=["+caller+"]): "+ regexp_FIRST_WORD +" .. return ["+result+"]");
    return result;
};
/*}}}*/
/*_ get_tag_hour {{{*/
let regexp_TAG_HOUR = new RegExp(":\\d(\\d)h", "i"); /* [9] .. (170602:19h11) */
let get_tag_hour = function(text)
{

    regexp_TAG_HOUR.lastIndex = 0;

    let matches = regexp_TAG_HOUR.exec( text );

    let  result = (matches) ? matches[1] : "0";

if(LOG_MAP.S1_RANGE) log("get_tag_hour("+ text +"): "+ regexp_TAG_HOUR +" .. return ["+result+"]");
    return result;
};
/*}}}*/

/*_ replace_character_entities {{{*/
let regexp_egrave_to_char      = new RegExp("\\xE8", "g"); var char_egrave = String.fromCharCode(0xE8); /* E-GRAVE */
let regexp_eacute_to_char      = new RegExp("\\xE9", "g"); var char_eacute = String.fromCharCode(0xE9); /* E-ACUTE */
let character_entities_to_char = function(text)
{
    return text
        .   replace(regexp_eacute_to_char, char_eacute)
        .   replace(regexp_egrave_to_char, char_egrave)
    ;
};
/*}}}*/
/*_ character_entities_to_hex {{{*/
let regexp_egrave_to_hex      = new RegExp(String.fromCharCode(0xE8), "g"); var hex_egrave = "\\xE8"; /* E-GRAVE */
let regexp_eacute_to_hex      = new RegExp(String.fromCharCode(0xE9), "g"); var hex_eacute = "\\xE9"; /* E-ACUTE */
let character_entities_to_hex = function(text)
{
    return text
        .   replace(regexp_eacute_to_hex, hex_eacute)
        .   replace(regexp_egrave_to_hex, hex_egrave)
    ;
};
/*}}}*/

/*}}}*/
/* CSV {{{*/
/*_ csv_add {{{*/
let csv_add = function(csv, val)
{
/*
logXXX("csv_add(csv=[%c"+csv+"%c], val=[%c"+val+"%c])", lb1,lbA, lb2,lbA)
*/
    if(                     !val  ) return csv;
    val = csv_escape(val);
    if(             !csv          ) return val;
    if( csv_contains(csv,    val) ) return csv; /* as a SET (i.e. NOT as a BAG) */
/*
logXXX("___val=[%c"+val+"%c]", lb2,lbA)
logXXX(".return val=[%c"+csv+","+val+"%c]", lb2,lbA)
*/
    return           csv+","+val;
};
/*}}}*/
/*_ csv_ins {{{*/
let csv_ins = function(csv, val)
{
/*
logXXX("csv_ins(csv=[%c"+csv+"%c], val=[%c"+val+"%c])", lb1,lbA, lb2,lbA)
*/
    if(                     !val  ) return csv;
    val = csv_escape(val);
    if(             !csv          ) return val;
    if( csv_contains(csv,    val) ) return csv; /* as a SET (i.e. NOT as a BAG) */
/*
logXXX("___val=[%c"+val+"%c]", lb2,lbA)
logXXX(".return val=[%c"+csv+","+val+"%c]", lb2,lbA)
*/
    return           val+","+csv;
};
/*}}}*/
/*_ csv_del {{{*/
let csv_del = function(csv,val)
{
    if(       !val) return csv;
    if(!csv       ) return csv;
/*
logXXX("csv_del(csv=[%c"+csv+"%c], val=[%c"+val+"%c])", lb1,lbA, lb2,lbA)
*/

    if( csv == val) {
       csv = "";
    }
    else {
        val = csv_escape(val);
/*
logXXX("___val=[%c"+val+"%c]", lb2,lbA)
*/

        let a = csv.split(",");
        csv = "";
        for(let i=0; i < a.length; ++i) {
            if(                 !a[i]) continue;
            if(       val ==     a[i]) continue;
            if(!csv)  csv  =     a[i]; /* first */
                else      csv += ","+a[i]; /*  more */
        }
    }

/*
logXXX(".return csv=[%c"+csv+"%c]", lb1,lbA)
*/
    return csv;
};
/*}}}*/
/*_ csv_del_last {{{*/
let csv_del_last = function(csv)
{
    if(!csv       ) return csv;
/*
logXXX("csv_del_last(csv=[%c"+csv+"%c])", lb1,lbA)
*/

        let a = csv.split(",");
        csv = "";
        for(let i=0; i < (a.length-1); ++i) {
            if(!csv)  csv  =     a[i]; /* first */
            else      csv += ","+a[i]; /*  more */
        }

/*
logXXX(".return csv=[%c"+csv+"%c]", lb1,lbA)
*/
    return csv;
};
/*}}}*/
/*_ csv_contains {{{*/
/*
:new C:/LOCAL/DEV/DEVEL/EMC/Extensions/PJC_SPECS/script/PJC_SPECS.asp
*/
let csv_contains = function(csv, val)
{
    if(!val) return false;
    val = csv_escape(val);
    let c = ","+ csv.trim() +",";
    let v = ","+ val.trim() +",";
    let r =        c.includes(v);
    return r;
};
/*}}}*/
/*_ csv_count {{{*/
let csv_count = function(csv)
{
    if(!csv) return 0;

    return csv.split(",").length;
};
/*}}}*/
/*_ csv_get {{{*/
let csv_get = function(csv,pos)
{
    if(!csv || !pos) return "";
    let   val = "";
    let     v = csv.split(",");
    for(let i = 0; i < v.length; ++i)
        if((i+1) == pos) { val = v[i]; break; }

    val = csv_unescape(val);
/*
logXXX("csv_get(csv=[%c"+csv+"%c], pos=[%c"+pos+"%c])", lb1,lbA, lb2,lbA)
logXXX(".return val=[%c"+val+"%c]", lb2,lbA)
*/
    return val;
};
/*}}}*/
/*_ csv_log {{{*/
let csv_log = function(csv, title="")
{
    if(title) {
        if(csv) log("%c "+title                , lbb+lbH+lf9     );
        else    log("%c "+title+"%c IS  EMPTY ", lbL+lb9, lbR+lb0);
    }

    if(!csv) return;

    let count = csv_count(csv);

    for(let i = 0; i < count; ++i) {
        let v = csv_get(csv,i+1);
        let u = unescape(v);
        if( u == v) log(" "+(i+1)+" %c["+v+"]"                   , lbX[(i+1) % 10]     );
        else        log(" "+(i+1)+" %c["+v+"]%c unescape=["+u+"]", lbX[(i+1) % 10], lb0);
    }
};
/*}}}*/
/*_ csv_escape csv_unescape {{{*/

let APOST_ASC = "'";
let APOST_UTF = "\\u0027";
let APOST_HTM = "&apos;";

let COMMA_ASC = ",";
let COMMA_UTF = "\\u002C";
let COMMA_HTM = "&comma;";

let regexp_COMMA_ASC = new RegExp(COMMA_ASC, "g");
let regexp_COMMA_UTF = new RegExp(COMMA_UTF, "g");
let regexp_COMMA_HTM = new RegExp(COMMA_HTM, "g");
let regexp_APOST_ASC = new RegExp(APOST_ASC, "g");
let regexp_APOST_UTF = new RegExp(APOST_UTF, "g");
let regexp_APOST_HTM = new RegExp(APOST_HTM, "g");
let regexp_VBAR      = new RegExp("\\|"    , "g");

let csv_escape = function(text)
{
    return text
        .   replace(regexp_COMMA_ASC, COMMA_HTM)
        .   replace(regexp_APOST_ASC, APOST_HTM)
    ;
};

let csv_unescape = function(text)
{
    return text
        .   replace(regexp_COMMA_HTM, COMMA_ASC)
        .   replace(regexp_APOST_HTM, APOST_ASC)
    ;
};
/*}}}*/
/*_ csv_cat {{{*/
let csv_cat = function(csv1, csv2)
{
    if(  !csv1) return csv2;
    if(  !csv2) return csv1;
    let   csv = csv1;
    let     v = csv2.split(",");
    for(let i = 0; i < v.length; ++i)
    {
        if(!csv_contains(csv, v[i]) )
            csv      += "," + v[i];
    }
    return csv;
};
/*}}}*/
/*_ csv_sort {{{*/
let csv_sort = function(csv, reverse=false)
{
    if(  !csv) return csv;
/*
csv_log(csv,"csv_sort(csv, reverse="+reverse+"):");
*/

    let     v = csv.split(",");
    if(reverse) v = v.sort( function(a, b) { return a.toLowerCase() > b.toLowerCase() ? -1 : 1; } );
    else        v = v.sort( function(a, b) { return b.toLowerCase() > a.toLowerCase() ? -1 : 1; } );

    csv = "";
    for(let i = 0; i < v.length; ++i) {
        csv += (csv ? "," : "")+ v[i];
    }
/*
csv_log(csv,"===================================");
*/
    return csv;
};
/*}}}*/
/*_ csv_reverse {{{*/
let csv_reverse = function(csv)
{
    return csv_sort(csv, true);
};
/*}}}*/
/*}}}*/
/* STRING {{{*/
/*_ ellipsis {{{*/
const ELLIPSIS_DEFAULT_LEN = 64;
const ELLIPSIS_SHORT_LEN   = 32;

let ellipsis_short = function(msg)
{
    return ellipsis(msg, ELLIPSIS_SHORT_LEN);
};

let ellipsis = function(_msg, len=ELLIPSIS_DEFAULT_LEN)
{
    let msg = String(_msg);
    return (msg.length    <= len)
        ?   msg
        :   msg.substring(0, len-3)+HORIZONTAL_ELLLIPSIS
    ;
};
/*}}}*/
/*_ truncate {{{*/
let truncate = function(_msg, length=80)
{
    let msg = strip_CR_LF( String(_msg) );
    return (msg.length <= length)
        ?   msg
        :   msg.substring(0, length-3)+"..."
    ;
};
/*}}}*/
/*_ mPadStart {{{*/
let mPadStart = function(s,l,c=" ") { s = String(s); while(s.length < l) s = c+s; return s; };
/*}}}*/
/*_ mPadEnd{{{*/
let mPadEnd   = function(s,l,c=" ") { s = String(s); while(s.length < l) s = s+c; return s; };
/*}}}*/
/*_ isAlNum {{{ */
let isAlNum = function(s)
{
    let cp
        = s.codePointAt(0);
    let result
        =  ((cp >=   48) && (cp <=  57 )) /* 0-9 */
        || ((cp >=   65) && (cp <=  90 )) /* A-Z */
        || ((cp ==   95)                ) /*  _  */
        || ((cp >=   97) && (cp <= 122 )) /* a-z */
        || ((cp >= 0xDF) && (cp <= 0xFF)) /* SHARP-S - Y-DIAERESIS */
    ;
    if(result)
        return true;
    else
        return false;
};

let _sAlNum = function(s) { return /[0-9a-z]/.test( s.toLowerCase() ); };

/*}}}*/
/*_ object_label {{{*/
let object_label = function(object)
{
    return object.toString()
        .replace("[object ","")
        .replace(       "]","");
};
/*}}}*/
/*}}}*/

/* DOM NODES */
/*{{{*/
/*_ node_toString {{{ */
let node_toString = function(node)
{
    let caller = "node_toString";
    if(!node) return "<span class='gr'>"+caller+"(null_node)</span>";

    let result = "";
    try {

        let p_str = get_p_str( node          );
        let n_str = get_n_str( node          );
        let t_str = get_t_str( node.nodeType );

        let text  = (           node.nodeType == Node.COMMENT_NODE)
            ?                   node.textContent
            :  truncate(trim_empty_lines(node.textContent))
        ;

        let em_class
            = (node.nodeType == Node.TEXT_NODE   ) ? "cc4"
            : (node.nodeType == Node.COMMENT_NODE) ? "cc8"
            :                                        "cc3" ;

        if(!text) { text = n_str; em_class = "cc2"; }
        else      { text = ellipsis   ( text , 48); }

        result = ""
            + "<span class='log_node_toString'>"+ p_str                +"</span>"
            + " <em  class='"+em_class     +"'>"+ s_get_htmlEntities( text ) +"</em>"
        ;
/*
            + " "                             + mPadEnd     ( p_str ,32," ")
            + " <em   class='"+ em_class +"'>"+ mPadEnd     ( n_str ,16," ") +"</em>"
            + " <em   class='"+ em_class +"'>"+ mPadEnd     ( t_str ,16," ") +"</em>"
*/

    }
    catch(ex) { log(caller+": "+ex, "error"); }
    return result;
};
/*}}}*/
/*_ get_p_str {{{ */
let get_p_str = function(node)
{
    let names = "";

    for(let       parent  = node.parentNode
        ;        (parent != null)
        ;         parent  = parent.parentNode
    ) {
        let n_str         = get_n_str(parent);
        if( n_str) names  =            n_str            + names;
     /* if( n_str) names  = mPadEnd(   n_str,8,".") +"."+ names; */
    }

    return names;
};
/*}}}*/
/*_ get_n_lbl {{{ */
let get_n_lbl = function(node)
{
    if(!node                 ) return "null_node";
    if( node == window       ) return "window";
    if( node == document.body) return "body";

/*{{{
    if(node.id ) try   { return                   node.tagName +"#"+ node.id                                      ; } catch(ex) {}
}}}*/
    if(node.id ) try   { return       get_t_str(node.nodeType) +"#"+ node.id                                      ; } catch(ex) {}

    let                  n_lbl = null;
    try                { n_lbl =                  node.tagName +    (node.className ? ("."+ node.className) : "") ; } catch(ex) {}
    if(   n_lbl ) try  { n_lbl+=" .. TEXT=["+ truncate(node.textContent,  24)+"]"                                 ; } catch(ex) {}
    if(   n_lbl ) return n_lbl;

    try                { return     "TEXT=["+ truncate(node.textContent,  24)+"]"                                 ; } catch(ex) {}
    try                { return                   node.tagName                                                    ; } catch(ex) {}
    try                { return                   node.nodeType                                                   ; } catch(ex) {}

    return "";
};
/*}}}*/
/*_ get_n_str {{{ */
let get_n_str = function(node)
{
    let                h_tag = get_h_tag( node.nodeName );
    let                n_str = null;
/*  if( !n_str ) try { n_str =            node.id              ; if(n_str)  n_str = h_tag+"<sup>"+ellipsis(n_str,16)+"</sup>"; } catch(ex) {} */
/*  if( !n_str ) try { n_str =   truncate(node.textContent, 32);                              } catch(ex) {} */
    if( !n_str ) try { n_str =            h_tag                ;                              } catch(ex) {}
    if( !n_str ) try { n_str =            node.tagName         ;                              } catch(ex) {}
    if( !n_str ) try { n_str = get_t_str( node.nodeType       );                              } catch(ex) {}
    if( !n_str )       n_str = "";
    return             n_str;
};
/*}}}*/
/*_ get_n_txt{{{ */
let get_n_txt = function(node)
{
    if(!node) return "null_node";
    return strip_CR_LF( ellipsis(node.textContent.trim(), 64) );
};
/*}}}*/
/*_ get_h_tag {{{ */
let get_h_tag = function(node_nodeName)
{
    switch(node_nodeName) {

        case "#document"     : return "|"     ; /*"\u2622";*/
        case  "HTML"         : return "_"     ; /*"\u2AFC";*/
        case   "HEAD"        : return "\u265E";
        case   "BODY"        : return "\u26AB"; /*"\u265C";*/

        case    "SCRIPT"     : return "\u2710";

        case    "DIV"        : return "\u2610";
        case    "BLOCKQUOTE" : return "\u275D";
        case    "SPAN"       : return "\u2799";
        case    "EM"         : return "\u2794";

        case    "A"          : return "\u27A4";
        case    "BUTTON"     : return "\u274D";
        case    "INPUT"      : return "\u270B";
        case    "TEXTAREA"   : return "\u2774";

        case    "TABLE"      : return "TA";
        case     "THEAD"     : return "TH";
        case     "TFOOT"     : return "TF";
        case     "TBODY"     : return "TB";
        case      "TR"       : return "tr";
        case      "TH"       : return "th";
        case      "TD"       : return "td";

        case    "UL"         : return "UL";
        case    "OL"         : return "OL";
        case    "LI"         : return "\u26AC";

        default              : return node_nodeName;
    }
};
/*}}}*/
/*_ get_t_str {{{ */
let get_t_str = function(node_nodeType)
{
    switch(node_nodeType)
    {
        case Node.ELEMENT_NODE               : return "ELEMENT"               ; /*  1 Element .. <p> or <div>*/
        case Node.TEXT_NODE                  : return "TEXT"                  ; /*  3 Text of Element or Attr*/
        case Node.PROCESSING_INSTRUCTION_NODE: return "PROCESSING_INSTRUCTION"; /*  7  .. <?xml-stylesheet ... ?> declaration (of an XML document)*/
        case Node.COMMENT_NODE               : return "COMMENT"               ; /*  8 Comment*/
        case Node.DOCUMENT_NODE              : return "DOCUMENT"              ; /*  9 Document*/
        case Node.DOCUMENT_TYPE_NODE         : return "DOCUMENT_TYPE"         ; /* 10 .. <!DOCTYPE html> for HTML5 documents*/
        case Node.DOCUMENT_FRAGMENT_NODE     : return "DOCUMENT_FRAGMENT"     ; /* 11 DocumentFragment*/
        /* DEPRECATED* */
        case Node.ATTRIBUTE_NODE             : return "ATTRIBUTE"             ; /*  2* Attribute of an Element  . The element attributes are no longer implementing the Node interface in DOM4 specification*/
        case Node.CDATA_SECTION_NODE         : return "CDATA_SECTION"         ; /*  4* CDATASection             . Removed in DOM4 specification*/
        case Node.ENTITY_REFERENCE_NODE      : return "ENTITY_REFERENCE"      ; /*  5* XML Entity Reference node. Removed in DOM4 specification*/
        case Node.ENTITY_NODE                : return "ENTITY"                ; /*  6* XML <!ENTITY ...> node   . Removed in DOM4 specification*/
        case Node.NOTATION_NODE              : return "NOTATION"              ; /* 12* XML <!NOTATION ...> node . Removed in DOM4 specification*/

        default: return "[TYPE="+node_nodeType+"]";
    }
};
/*}}}*/
/*_ get_id_or_tag {{{ */
let get_id_or_tag = function(node)
{
    return !node           ? "null_node"
        :   node.id        ? "#"+ node.id
        :   node.className ? node.tagName+"."+ node.className
        :                    node.tagName
    ;
};
/*  get_parentage {{{*/
let get_parentage = function(node)
{
    let names = get_id_or_tag(node);
    while(        node
              && (node != document.body)
              && (node != document.documentElement)
         ) {
        node            = node.parentNode;
        names           = get_id_or_tag(node)+" . "+names;
    }
    return names;
};
/*}}}*/
/*}}}*/
/*}}}*/

/*}}}*/
//# sourceURL=dom_util.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**   6  STORE   JS dom_store_js_data {{{*/
/*
../javascript/dom_store.js
*/
dom_store_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_store_js */
let DOM_STORE_JS_ID        = "dom_store_js";
let DOM_STORE_JS_TAG       = DOM_STORE_JS_ID  +" (181212:17h)";

/* OBSERVERS */
/*  dom_store_add_info_observer {{{*/
/*{{{*/
let store_info_observers = [];

/*}}}*/
let dom_store_add_info_observer = function(observer)
{
/*{{{
logXXX("dom_store_add_info_observer("+observer.name+")")
}}}*/
    if(!store_info_observers.includes( observer ))
        store_info_observers.push    ( observer );
};
let _notify_info = function(info)
{
/*{{{
logXXX("_notify_info("+info+")")
}}}*/
    for(let i=0; i < store_info_observers.length; ++i)
        store_info_observers[i](info);
};
/*}}}*/

/* SET */
/*  store_set_state {{{*/
let store_set_state = function(key, state)
{
/*{{{*/
let caller = "store_set_state(key=["+key+"], state=["+state+"]";
let log_this = LOG_MAP.T0_STORE;

/*}}}*/
    let v = store_getBool(key);
    if( v == state) {
/*{{{
if(log_this) store_key_log("UNCHANGED STATE", key, state);
}}}*/
        return;
    }
    else if(state) {
if(log_this) store_key_log("STORING   STATE", key, state);
        _store_setItem   (key ,"true");
    }
    else if(v) {
if(log_this) store_key_log("REMOVING STATE" , key);
        _store_removeItem(key);
    }
};
/*}}}*/
/*  store_set_value {{{*/
let store_set_value = function(key, value)
{
/*{{{*/
    let caller = "store_set_value(key=["+key+"] value=["+value+"])";
let log_this = LOG_MAP.T0_STORE;

if(log_this) log(caller);
/*}}}*/

    let v = store_getItem(key);
    if( v && (v == value)) {
/*{{{
if(log_this) store_key_log("UNCHANGED VALUE", key, value);
}}}*/

        return;
    }
    else if(value) {
if(log_this) store_key_log("STORING   VALUE", key, value);
        _store_setItem(key , value);
    }
    else if(v) {
if(log_this) store_key_log("REMOVING  VALUE", key);
        _store_removeItem(key);
    }

};
/*}}}*/
/*  _store_setItem {{{*/
let _store_setItem = function(key,value)
{
    localStorage        .setItem(    _store_get_site_or_page_pfx_for_key(key)+"_"+key, value);
};
/*}}}*/
/*  _store_removeItem {{{*/
let _store_removeItem = function(key)
{
    return  localStorage.removeItem( _store_get_site_or_page_pfx_for_key(key)+"_"+key       );
};
/*}}}*/

/* GET */
/*  store_getBool {{{*/
let store_getBool = function(key)
{
    return (localStorage.getItem(    _store_get_site_or_page_pfx_for_key(key)+"_"+key) == "true");
};
/*}}}*/
/*  store_getItem {{{*/
let store_getItem = function(key, site_or_page)
{
    let item
        = (site_or_page == "page") ? localStorage.getItem( _store_get_page_pfx_for_key        ( key )+"_"+key)
        : (site_or_page == "site") ? localStorage.getItem( _store_get_site_pfx_for_key        ( key )+"_"+key)
        :                            localStorage.getItem( _store_get_site_or_page_pfx_for_key( key )+"_"+key)
    ;
    let lfs =                        _store_isa_site_or_page_key        (         key) ? lf5 : lf7;
/*{{{
logXXX("store_getItem %c "+(_store_isa_site_or_page_key(key) ? "PAGE" : "SITE")+" %c"+key+" %c"+ item
    ,                 lbH+lfs                                                    ,lbH+lf4  ,lbH+lfs)
}}}*/
    return item;
};
/*}}}*/
/*  store_parseXY {{{*/
let store_parseXY = function(key)
{
    let caller = "store_parseXY("+key+")";
let log_this = LOG_MAP.T0_STORE;
if( log_this) log(caller);

    let dom_string = store_getItem(key);
    if(!dom_string) return null;
if( log_this) log("...dom_string=["+dom_string+"]");

    let xy = null;
    try {
        xy    = JSON.parse(dom_string);
        let s = ""; Object.keys(xy).forEach( function(key) { s += "["+key+" = "+xy[key]+"]"+LF; });
if( log_this) log("%c"+ caller+":", lb0);
if( log_this) log("%c"+ s         , lb7);
        return xy;
     }
     catch(ex) {
if( log_this) log("%c"+caller+":"                                                  , lb2);
if( log_this) log("%c"+strip_CR_LF(dom_string)                                   , lbF+lb0);
if( log_this) log("%c0123456789_123456789_123456789_123456789_123456789_123456789_", lbF+lb8);
if( log_this) log("%c0_________1_________2_________3_________4_________5_________6", lbF+lb8);
if( log_this) log("%c*** "+ex, lb2);
    }
};
/*}}}*/

/* SCOPE [PAGE] [SITE] */
/*  store_add_page_key  {{{*/
let _store_isa_page_key_array = [];
let  store_add_page_key       = function(key) {        _store_isa_page_key_array.push    ( key ); };
let _store_isa_page_key       = function(key) { return _store_isa_page_key_array.includes( key ); };
/*}}}*/
/*  store_add_site_key  {{{*/
let _store_isa_site_key_array = [];
let  store_add_site_key       = function(key) {        _store_isa_site_key_array.push    ( key ); };
let _store_isa_site_key       = function(key) { return _store_isa_site_key_array.includes( key ); };
/*}}}*/
/*  store_remove_all_page_items {{{*/
let store_remove_all_page_items = function(msg)
{
    /*{{{*/
let   caller = "store_remove_all_page_items";
let log_this = LOG_MAP.T0_STORE;

    /*}}}*/
    /* COLLECT [page_items_keys_to_remove_array] {{{*/
    let page_pfx = _store_get_site_or_page_pfx_for_key("sel_csv"     );
    let site_pfx = _store_get_site_or_page_pfx_for_key("tools_scroll");

    let page_items_keys_to_remove_array = [];
    for(let i=0; i < localStorage.length; ++i)
    {
        let k = localStorage.key    ( i );
        let v = localStorage.getItem( k );

        if( k.startsWith( page_pfx ) )
        {
/*
logXXX((i+1)+" %c "+k+" %c "+ v, lbL+lf3, lbR+lf4)
*/
            page_items_keys_to_remove_array.push(k);
        }
        else {
/*
logXXX((i+1)+" %c "+k+" %c "+ v, lbL+lf8, lbR+lf9)
*/
        }
    }
    /*}}}*/
    /* REMOVE  [page_items_keys_to_remove_array] {{{*/
    if(page_items_keys_to_remove_array.length)
    {
if( log_this) log("%c"+caller, lbb+lbH+lf4);
if( log_this) log("%c localStorage: %c SITE %c"+site_pfx+"%c PAGE %c"+page_pfx +" %c REMOVING PAGE ITEMS:"
                  ,lbH+lf2         ,lbL+lf8,lbR+lf2      ,lbL+lf8,lbR+lf3        ,lbH+lf3                 );

        for(let i=0; i < page_items_keys_to_remove_array.length; ++i)
        {
            let k = page_items_keys_to_remove_array[i];
if(log_this) log((i+1)+"%c removing %c"+k
                 ,      lbL+lf2    ,lbR+lf3);

            localStorage.removeItem(k);
        }
        _notify_info("storage"+LF+"cleared");
    }
    /*}}}*/
};
/*}}}*/
/*  _store_isa_site_or_page_key {{{*/
let _store_isa_site_or_page_key = function(key)
{
    /* currently in SITE mode */
    if( prop_get(SITE_OR_PAGE) )
    {
        /* WHEN IN SITE MODE .. USE SITE PFX */
        if( _store_isa_site_key( key) ) {
/*{{{
logBIG("_store_isa_site_or_page_key("+key+") IN SITE MODE: USE SITE PFX")
}}}*/
            return false;
        }
    }
/*{{{
logXXX("_store_isa_page_key("+key+")=["+_store_isa_page_key(key)+"]")
logXXX("_store_isa_site_key("+key+")=["+_store_isa_site_key(key)+"]")
}}}*/

    /* currently in PAGE mode */
    return  _store_isa_page_key( key ) /* EXPLICIT PAGE SCOPE .. ( IS PAGE) */
    ||     !_store_isa_site_key( key ) /* IMPLICIT PAGE SCOPE .. (NOT SITE)*/
    ;
};
/*}}}*/
/* _store_get_site_or_page_pfx_for_key {{{*/
/*{{{*/
const PAGE_URL_TEMPLATE = "Archives/Public/w3c-wai-ig/2018JanMar/0148.html"; /* test-purpose - tokenizer template */
const SITE_URL_TEMPLATE = "www.localhost.com";                               /* test-purpose - file to http protocol emulation */

/*}}}*/
let _store_get_site_or_page_pfx_for_key = function(key)
{
    return _store_isa_site_or_page_key( key )
        ?  _store_get_page_pfx_for_key( key )
        :  _store_get_site_pfx_for_key( key );
};
/*}}}*/
/*  _store_get_page_pfx_for_key {{{*/
let _store_get_page_pfx_for_key = function(key)
{
/*{{{
logXXX("_store_get_page_pfx_for_key("+key+") .. window.location.pathname=["+window.location.pathname+"]");
}}}*/
        let pathname = _store_get_location_dir_base();

        return tokenize( pathname );
};
/*}}}*/
/*  _store_get_site_pfx_for_key {{{*/
let _store_get_site_pfx_for_key = function(key)
{
/*{{{
logXXX("_store_get_site_pfx_for_key("+key+") .. window.location.hostname=["+window.location.hostname+"]");
}}}*/
    let hostname =  window.location.hostname
        ||          SITE_URL_TEMPLATE;

    return tokenize( hostname );
};
/*}}}*/
/*  _store_get_location_dir_base {{{*/
let _store_get_location_dir_base = function()
{
    let a
        = (window.location.pathname.indexOf(FORESLASH) >= 0)
        ?  window.location.pathname.split  (FORESLASH)
        :  window.location.pathname.split  (BACKSLASH);

    let fileName_or_index
        =  a[a.length-1]
        || "index"
    ;

    let dirName = (  a.length > 1)
        ?          a[a.length - 2]
        :          ""
    ;

/*{{{
logXXX("...a.length=["+ a.length +"]   dirName =["+ dirName  +"]   fileName_or_index=["+ fileName_or_index +"]")
}}}*/

    let result
        = (dirName   !=               "")
        ? (dirName+"_"+fileName_or_index)
        :              fileName_or_index
    ;

    return result || "index";

};
/*}}}*/

/* EVENTS */
/*  store_add_listener {{{*/
let store_add_listener =function()
{
    /*{{{*/
let   caller = "store_add_listener";
let log_this = LOG_MAP.T0_STORE;

if( log_this) log(caller);
    /*}}}*/

    window.addEventListener("storage", _store_storage_listener);
};
/*}}}*/
/*  _store_storage_listener {{{*/
let _store_storage_listener = function(e)
{
    console.log("_store_storage_listener:");
    console.log("...........url=["+ e.url         +"]");
    console.log("...storageArea=["+ e.storageArea +"]");
    console.log("...........key=["+ e.key         +"]");
    console.log("......oldValue=["+ e.oldValue    +"]");
    console.log("......newValue=["+ e.newValue    +"]");
};
/*}}}*/

/* LOG */
/*   store_do_not_log_transient_key {{{*/

let _store_log_transient_key_array  = [];

let  store_do_not_log_transient_key = function(key) {        _store_log_transient_key_array.push    ( key ); };
let _store_isa_transient_key        = function(key) { return _store_log_transient_key_array.includes( key ); };
/*}}}*/
/*  store_key_log {{{*/
let store_key_log = function(msg, key, value="")
{
    if( _store_isa_transient_key( key ) ) {
/*{{{
logBIG(key+" is transient")
}}}*/
        return;
    }

    let site_or_page = _store_isa_site_or_page_key( key ) ? "PAGE" : "SITE";
    let          lbx = (site_or_page == "PAGE") ? lbA : lbb;
    let          lfx = (site_or_page == "PAGE") ? lf5 : lf7;

    log(   "%c STORE SCOPE %c"+ site_or_page +"%c"+ _store_get_site_or_page_pfx_for_key( key )
          +  "%c"             + msg
          +   "%c"            + key +"%c = %c"+ (value || "&nbsp;")
          ,  lbL+lf8       ,lbC+lfx            ,lbR+lfx
          ,    lbH+lfx
          ,     lbx+lfx+lbL,        lbx+lbC,lbx+lbR+lfx
       );

};
/*}}}*/

/*}}}*/
//# sourceURL=dom_store.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**  7  HIDE    JS dom_hide_js_data {{{*/
/*
../javascript/dom_hide.js
*/
dom_hide_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_hide_js */
let DOM_HIDE_JS_ID        = "dom_hide_js";
let DOM_HIDE_JS_TAG       = DOM_HIDE_JS_ID  +" (181230:00h)";

/* DOM_HIDE1_SELECT */
/*  dom_hide1_container_clicked .. (called by onUp_6_DOC_CB.[DOC CLICKED]) {{{*/
let dom_hide1_container_clicked = function( container )
{
/*{{{*/
let   caller = "dom_hide1_container_clicked"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(container)+")", lbH+lf2);
    if(!container) return;
/*{{{
if( log_this) console_clear_post(caller);
}}}*/
/*}}}*/
    let          hiding = !prop_get( MASK_OR_HIDE );
    let     node_hidden = _dom_hide_mark_container( container );
    while(  node_hidden && (node_hidden != document.body))
    {
        if(!_dom_hide_all_siblings_hidden( node_hidden ))
        {
            if( hiding )  _dom_hide_set_visibility( node_hidden,  true);
            break;
        }
        else {
            node_hidden = _dom_hide_mark_container( node_hidden.parentElement );
        }
    }
};
/*}}}*/

/*  dom_hide1_collect_nodes {{{*/
/*{{{*/
let  children_collection = [];

/*}}}*/
let dom_hide1_collect_nodes = function(child_level, _parent, parent_level)
{
/*{{{*/
let   caller = "dom_hide1_collect_nodes(child_level=["+child_level+"], _parent=["+get_n_lbl(_parent)+"], parent_level=["+parent_level+"])";
let log_this = LOG_MAP.T3_LAYOUT;

/*}}}*/
    /* walk body tree nodes {{{*/
    let parent = _parent;
    if(!parent || (parent == document.body)) {
        children_collection = [];
        parent              = document.body;
        parent_level        = 0;
    }
    /*}}}*/
    /* build [children_collection] {{{*/
    let child_collected_count = 0;
    for(let num=0; num < parent.children.length; ++num)
    {
        let child = parent.children[num];
        /* reached child_level .. collect children_collection */
        if(parent_level == (child_level-1))
        {
            if( _dom_hide_is_node_maskable(child, num) )
            {
                children_collection.push( child );
                child_collected_count += 1;
            }
        }
        /* or step down one level */
        else
            dom_hide1_collect_nodes(child_level,  child, parent_level+1);

    }
    /*}}}*/
/*{{{*/
if(log_this && (parent_level == (child_level-1)) && parent.children.length)
    log(caller+": %c level"+child_level+" %c"+get_parentage(parent)+" %c "+ child_collected_count +" children"
        ,        lbH                     ,lbL+lf9                    ,lbR+lf7);

if(log_this && (parent == document.body))
    log("%c "+children_collection.length+" %c level "+child_level+" nodes"
        ,lbH+lbb+lf7                      ,lbH+lf7);
/*}}}*/
    /* hide [children_collection] {{{*/
    _dom_hide_add_children_collection();
    /*}}}*/
};
/*}}}*/
/*  _dom_hide_is_node_maskable( {{{*/
let _dom_hide_is_node_maskable = function(node, num)
{
/*{{{*/
let   caller = "_dom_hide_is_node_maskable";
let log_this = LOG_MAP.T3_LAYOUT;

/*}}}*/
    let                                             not_maskable = "";                    let lfX =  "";
    if(                      !node.clientWidth  ) { not_maskable = "HAS NO WIDTH";            lfX = lf5; }
    if(                      !node.clientHeight ) { not_maskable = "HAS NO HEIGHT";           lfX = lf6; }
    if( is_a_doc_tool_panel ( node )            ) { not_maskable = "IS A DOC TOOL PANEL";     lfX = lf3; }
    if( is_a_doc_tool_button( node )            ) { not_maskable = "IS A DOC TOOL BUTTON";    lfX = lf4; }

    let result = (not_maskable == "");
if(log_this && !result) log(caller+": %c #"+num+" %c"+get_parentage(node)+"%c"+not_maskable
    ,                                 lbL+lf2    ,lbC+lf9                 ,lbR+lfX         );
    return (not_maskable == "");
};
/*}}}*/
/*  _dom_hide_add_children_collection {{{*/
let _dom_hide_add_children_collection = function()
{
/*{{{*/
let   caller = "_dom_hide_add_children_collection";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+": "+children_collection.length+" nodes");
/*}}}*/
    _dom_hide_freeze_history(true, caller);
/*
    for(let i=0                           ; i <  children_collection.length; ++i) dom_hide1_container_clicked(children_collection[i]);
*/
    for(let i=children_collection.length-1; i >= 0                         ; --i) dom_hide1_container_clicked(children_collection[i]);

    _dom_hide_freeze_history(false);
    _dom_hide_csv_stack_push("AFTER _dom_hide_add_children_collection");
};
/*}}}*/

/*  dom_hide1_reset .. (called by onUp_5_TOOL_CB) {{{*/
let dom_hide1_reset = function()
{
/*{{{*/
let   caller = "dom_hide1_reset"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*{{{
if( log_this) console_clear_post(caller);
}}}*/
/*}}}*/
    _dom_hide_csv_stack_clear_history();
    _dom_hide_clear_csv_and_store();
    _dom_hide_clear_display();

    _site_page_or_both_label
        = "ALL RESET"
    ;
    _dom_hide__sync_DOM_HIDE1_RESET();
};
/*}}}*/
/*  _dom_hide_all_siblings_hidden {{{*/
let _dom_hide_all_siblings_hidden = function( node )
{
    if( !node                                ) return false;
    if( !node.parentElement                  ) return false;
    if(  node               == document.body ) return false;
    if(  node.parentElement == document.body ) return false;

    let all_siblings_hidden = true;
    for(let i=0;    i < node.parentElement.childNodes.length; ++i)
    {
        let     child = node.parentElement.childNodes[i];
        if(    !child.classList ) continue; /* TEXT have none */

        if(    !child.classList.contains( NODE_TO_HIDE_NOT_VISIBLE )
            && !child.node_mask
          ) {
            all_siblings_hidden = false;
/*{{{
console.dir(child)
}}}*/
            break;
        }
    }

/*{{{
logXXX("_dom_hide_all_siblings_hidden("+_dom_hide_get_id_or_tag(node)+"): ...return "+all_siblings_hidden+"")
}}}*/
    return all_siblings_hidden;
};
/*}}}*/
/*  _dom_hide_mark_container {{{*/
let _dom_hide_mark_container = function( container )
{
/*{{{*/
let   caller = "_dom_hide_mark_container";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(container)+")", lbH+lf2);
/*{{{
if(log_this) console_clear_post(caller);
}}}*/
/*}}}*/
    /* [node_hidden] [node_mask] {{{*/
    let node_hidden
        = container.node_hidden ? container.node_hidden /* container is a mask        .. with a link to its hidden node */
        : container.node_mask   ? container             /* container is a hidden node .. with a link to its mask */
        :                         container
    ;
if(log_this) console_dir(node_hidden, "node_hidden");

    let node_mask
        = container.node_hidden ? container             /* container is the mask      .. with a link to its hidden node */
        : container.node_mask   ? container.node_mask   /* container is a hidden node .. with a link to its mask */
        :                         null
    ;

if(log_this) console_dir(node_mask, "node_mask");

    /*}}}*/
    /* NO  MASK .. ADD ONE {{{*/
    if( !node_mask ) {
if( log_this) log("...NO  MASK .. ADD ONE");
        /* ADD CSV ...return if already stored {{{*/
        if( !_dom_hide_add_csv ( node_hidden )) return;

        /*}}}*/
        /* DISPLAY {{{*/
        _dom_hide_add_node_mask( node_hidden );

        let hiding = !prop_get( MASK_OR_HIDE );
        if( hiding ) {
            _dom_hide_set_visibility(node_hidden, false);
        }
        /*}}}*/
        /* CLEAR SUBTREE .. (may clear some container hidden children) {{{*/
        if( _dom_hide_clear_subtree( node_hidden ) )
        {
            /* SYNC CSV .. (container hidden children (possibly) cleared) */
            _dom_hide_rebuild_csv_from_hidden_and_masked_nodes();

            let count = csv_count( node_to_hide_csv );
            let em_class = count ? "cc"+(count % 10) : "done cc9";
            _notify_hide_info("<em class='"+em_class+"'>"+(count || "NO")+" HIDDEN SUBTREE NODES</em> <em class='cc2'>SUBTREE REBUILT</em>");
        }
        else {
            let count = csv_count( node_to_hide_csv );
            let em_class = count ? "cc"+(count % 10) : "done cc9";
            _notify_hide_info("<em class='"+em_class+"'>"+(count || "NO")+" NODES MARKED TO HIDE</em>");
        }
        /*}}}*/
    }
    /*}}}*/
    /* HAS MASK .. REMOVE IT {{{*/
    else {
if( log_this) log("...HAS MASK .. REMOVE IT");
        if( has_el_class(node_hidden, LAST_HIDDEN) )
        {
if( log_this) log("...has_el_class(node_hidden, LAST_HIDDEN)");
            del_el_class(node_hidden, LAST_HIDDEN);
            /* TRASH MASK AND UNHIDE NODE {{{*/
            _dom_hide_del_node_mask( node_hidden );

            /*}}}*/

            _dom_hide_csv_stack_pop("REMOVING LAST_HIDDEN"); /* TODO history tool */
        }
        else {
            /* TRASH MASK AND UNHIDE NODE {{{*/
            _dom_hide_del_node_mask( node_hidden );

            /*}}}*/
            /* DEL CSV {{{*/
            _dom_hide_del_csv      ( node_hidden );

            /*}}}*/
        }
        let count = csv_count( node_to_hide_csv );
        let em_class = count ? "cc"+(count % 10) : "done cc9";
        _notify_hide_info("<em class='"+em_class+"'>"+(count || "NO")+" NODES MARKED TO HIDE</em>");
    }
    /*}}}*/
    /* HIGHLIGHT LAST HIDDEN {{{*/
    _dom_hide_highlight_last_hidden();

    /*}}}*/
    let site_page_or_both
        = (          node_to_hide_csv   ? csv_count(node_to_hide_csv) : "NO"  )
        + (prop_get( SITE_OR_PAGE     ) ?                      "SITE" : "PAGE")
    ;
    _dom_hide__sync_DOM_HIDE1_RESET();
    return node_hidden;
};
/*}}}*/

/* DOM_HIDE2_STORE */
/*  dom_hide2_store_reload .. (called by t_store_page_site) {{{*/
let dom_hide2_store_reload = function(site_or_page_or_both="both")
{
/*{{{*/
let   caller = "dom_hide2_store_reload"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+"("+site_or_page_or_both+")", lbH+lf2);
/*}}}*/

    _dom_hide_csv_stack_clear_history();

    _dom_hide_clear_display();

    _dom_hide_localStorage_load( site_or_page_or_both );            /* SITE and-or PAGE */

};
/*}}}*/
/*  dom_hide2_store_save {{{*/
let dom_hide2_store_save = function()
{
/*{{{*/
let   caller = "dom_hide2_store_save"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

    let key   = "node_to_hide_csv";
    let value =  node_to_hide_csv ;

    _notify_hide_store(key, value);

    /* NOTE: node_to_hide_csv_STACK csv history not saved */
};
/*}}}*/
/*  _dom_hide_localStorage_load {{{*/
let _site_page_or_both_label = "";

let _dom_hide_localStorage_load = function(site_or_page_or_both)
{
/*{{{*/
let   caller = "_dom_hide_localStorage_load("+site_or_page_or_both+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* [site_csv] [site_label] {{{*/
    let site_csv   = "";
    let site_label = "";
    if((site_or_page_or_both == "site") || (site_or_page_or_both == "both"))
    {
        site_csv   = store_getItem("node_to_hide_csv", "site"); if(site_csv == null) site_csv = "";
        site_label = (site_csv ? csv_count(site_csv) : "NO")+" SITE";
    }
    /*}}}*/
    /* [page_csv] [page_label] {{{*/
    let page_csv   = "";
    let page_label = "";
    if((site_or_page_or_both == "page") || (site_or_page_or_both == "both"))
    {
        page_csv   = store_getItem("node_to_hide_csv", "page"); if(page_csv == null) page_csv = "";
        page_label = (page_csv ? csv_count(page_csv) : "NO")+" PAGE";
    }
    /*}}}*/

    /* [node_to_hide_csv] = [site_csv + page_csv] {{{*/
    if((site_or_page_or_both == "site"))
    {
        node_to_hide_csv =  site_csv;

if(log_this) csv_log(node_to_hide_csv, "SITE");
    }
    else if((site_or_page_or_both == "page"))
    {
        node_to_hide_csv = page_csv;

if(log_this) csv_log(node_to_hide_csv, "PAGE");
    }
    else {
        node_to_hide_csv = page_csv;

        let csv_array =  site_csv.split(",");
        site_label    = (site_csv ? csv_count(site_csv) : "NO")+" SITE";

        for(let i = csv_array.length-1; i >= 0; --i)
            node_to_hide_csv = csv_ins(node_to_hide_csv, csv_array[i]);
    }
if(log_this) csv_log(node_to_hide_csv, "CURRENT");
    /*}}}*/

    _dom_hide_csv_stack_clear_history();

    _site_page_or_both_label
        = (site_label && page_label) ? (site_label+" and "+page_label)
        :                site_label  ?  site_label
        :                page_label  ?  page_label
        : ""
    ;
    _dom_hide__sync_DOM_HIDE1_RESET();
};
/*}}}*/

/* DOM_HIDE3_OR_MASK */
/*  dom_hide_set_MASK_OR_HIDE {{{*/
let dom_hide_set_MASK_OR_HIDE = function(_hiding)
{
/*{{{*/
let   caller = "dom_hide_set_MASK_OR_HIDE"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

/*}}}*/
    /* HIDE OR MASK SELECTED NODES {{{*/
    let hiding = _hiding || !prop_get( MASK_OR_HIDE );
if( log_this) log("%c HIDE OR MASK %c "+(hiding ? "HIDE" : "MASK"), lbL, lbR);

if( log_this) csv_log(node_to_hide_csv, "node_to_hide_csv");

    let invisible_count = 0;
    if(                         !node_to_hide_csv       ) return;
    let                          node_to_hide_csv_array = node_to_hide_csv.split(","); /* pre_0|div_2 , ul_23|li_8 */
    for(let n_num = 1; n_num <=  node_to_hide_csv_array.length; ++n_num)
    {
        let node_path         =  node_to_hide_csv_array[n_num-1];
        let node              = _dom_hide_get_node_path_target(node_path, n_num);
        if( node ) {
            if( hiding ) {
                _dom_hide_MARKED_TO_HIDE                   ( node,  true);
                _dom_hide_set_visibility                   ( node, false); ++invisible_count;
            }
            else {
                if(!node.node_mask) _dom_hide_add_node_mask( node );
                else                _dom_hide_fit_node_mask( node );
                _dom_hide_set_visibility(                    node, true);
            }
        }
    }
    /*}}}*/
    /* NOTIFY INFO {{{*/
    let       hidden_count = document.querySelectorAll("."+MARKED_TO_HIDE   ).length;
    let       masked_count = document.querySelectorAll("."+NODE_TO_HIDE_MASK).length;
    let              count = csv_count(node_to_hide_csv);
    let                ccx = hiding ? 7 : 2;
    let  hiding_or_masking = hiding ? "HIDING" : "MASKING";

    _notify_hide_info(            " <em class='cc"+ccx         +"'>"+ hiding_or_masking            +      "</em>"
                      +           " <em class='cc"+(count % 10)+"'>"+ (count || "No")              +" Nodes</em>"
                      + (!hidden_count    ? "" : " <em class='cc9'>hidden_count="+ hidden_count    +      "</em>")
                      + (!masked_count    ? "" : " <em class='cc9'>masked_count="+ masked_count    +      "</em>")
                      + (!invisible_count ? "" : " <em class='cc0'> not visible="+ invisible_count +      "</em>")
                     );

    /*}}}*/
    /* HIGHLIGHT LAST HIDDEN {{{*/
    if(!hiding )
        _dom_hide_highlight_last_hidden();

    /*}}}*/
};
/*}}}*/

/* DOM_HIDE4_SCROLL */
/*{{{*/
const SCROLL_TO_LAST_HIDDEN_DELAY =  250;

let _dom_hide_scroll_to_last_hidden_timer;
let _dom_hide_scroll_to_last_hidden_DONE_MS;
let _dom_hide_scroll_to_last_hidden_el;

/*}}}*/
/*  dom_hide4_scroll_to_last_hidden .. (called by t_seek_set_container_selected) {{{*/
let dom_hide4_scroll_to_last_hidden = function( node )
{
/*{{{*/
let   caller = "dom_hide4_scroll_to_last_hidden"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    _dom_hide_scroll_to_last_hidden_el = node;

    if(      _dom_hide_scroll_to_last_hidden_timer ) clearTimeout(_dom_hide_scroll_to_last_hidden_timer);

    if(node) _dom_hide_scroll_to_last_hidden_timer  =  setTimeout(_dom_hide_scroll_to_last_hidden_handler, SCROLL_TO_LAST_HIDDEN_DELAY);
    else     _dom_hide_scroll_to_last_hidden_timer  = null;
};
/*}}}*/
/*  dom_hide4_scroll_to_last_hidden_is_pending .. (called by scroll_listener to cancel pending scroll) {{{*/
let dom_hide4_scroll_to_last_hidden_is_pending = function()
{
    return (_dom_hide_scroll_to_last_hidden_timer != null);
};
/*}}}*/
/*  dom_hide4_scroll_to_last_hidden_handled_recently .. (called by scroll_listener to differentiate SCRIPTED and USER scroll) {{{*/
let dom_hide4_scroll_to_last_hidden_handled_recently = function(delay)
{
    if(_dom_hide_scroll_to_last_hidden_DONE_MS == 0)
        return false;

    let           this_MS = new Date().getTime();
    let elapsed = this_MS - _dom_hide_scroll_to_last_hidden_DONE_MS;

    _dom_hide_scroll_to_last_hidden_DONE_MS = 0;

/*{{{
    _notify_hide_info("<em class='cc7'>SCROLLED TO LAST HIDDEN NODE</em>");
}}}*/

    return (elapsed < delay);
};
/*}}}*/
/*  _dom_hide_scroll_to_last_hidden_handler {{{*/
let _dom_hide_scroll_to_last_hidden_handler = function()
{
    _dom_hide_scroll_to_last_hidden_timer   = null;

    _dom_hide_scroll_to_last_hidden_DONE_MS = new Date().getTime();

    let xy = t_scrollIntoViewIfNeeded_get_scrollXY_with_margin( _dom_hide_scroll_to_last_hidden_el );
    if( xy ) {
        let dx = (xy.x - window.scrollX);
        let dy = (xy.y - window.scrollY);
        if(dx || dy) t_window_scrollTo(xy.x, xy.y);
    }
};
/*}}}*/

/* DOM_HIDE5_START_HISTORY */
/*  dom_hide5_start_history {{{*/
let dom_hide5_start_history = function()
{
/*{{{*/
let   caller = "dom_hide5_start_history"; if(typeof playground_notify != "undefined") playground_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
if( log_this) csv_log(node_to_hide_csv, "REBUILDING STACK HISTORY FROM node_to_hide_csv:");

    node_to_hide_csv_STACK = [];
    let        count       = csv_count( node_to_hide_csv );
    let      tmp_csv       =            node_to_hide_csv;
    node_to_hide_csv       =            "";

    for(let step = 1; step <= count; ++step)
    {
        let    node_path = csv_get(         tmp_csv, step);
        node_to_hide_csv = csv_add(node_to_hide_csv, node_path);

        if(step < count) /* stack all but last step */
            _dom_hide_csv_stack_push("INIT");
    }
if( log_this) csv_log(node_to_hide_csv, "REBUILT STACK HISTORY");

    let site_page_or_both
        = (          node_to_hide_csv   ? csv_count(node_to_hide_csv) : "NO"  )
        + (prop_get( SITE_OR_PAGE     ) ?                      "SITE" : "PAGE")
    ;
    _dom_hide__sync_DOM_HIDE1_RESET();
};
/*}}}*/

/* DOM_HIDE6_OBSERVERS */
/*  dom_hide6_add_container_observer .. (t_seek_set_container_selected) {{{*/
/*{{{*/
let hide_container_observers = [];

/*}}}*/
let dom_hide6_add_container_observer = function(observer)
{
/*{{{
logXXX("dom_hide6_add_container_observer("+observer.name+")")
}}}*/
    if(!hide_container_observers.includes( observer ))
        hide_container_observers.push    ( observer );
};
let _notify_hide_container = function(container, _caller, msg)
{
/*{{{
logXXX("_notify_hide_container("+container+", "+_caller+", "+msg+")")
}}}*/
    for(let i=0; i < hide_container_observers.length; ++i)
        hide_container_observers[i](container, _caller, msg);
};
/*}}}*/
/*  dom_hide6_add_store_set_value_observer .. (store_set_value) {{{*/
/*{{{*/
let hide_store_set_value_observers = [];

/*}}}*/
let dom_hide6_add_store_set_value_observer = function(observer)
{
/*{{{
logXXX("dom_hide6_add_store_set_value_observer("+observer.name+")")
}}}*/
    if(!hide_store_set_value_observers.includes( observer ))
        hide_store_set_value_observers.push    ( observer );
};
let _notify_hide_store = function(key,value)
{
/*{{{
logXXX("_notify_hide_store("+key+", "+value+")")
}}}*/
    for(let i=0; i < hide_store_set_value_observers.length; ++i)
        hide_store_set_value_observers[i](key, value);
};
/*}}}*/
/*  dom_hide6_add_info_observer .. (t_fly) {{{*/
/*{{{*/
let hide_info_observers = [];

/*}}}*/
let dom_hide6_add_info_observer = function(observer)
{
/*{{{
logXXX("dom_hide6_add_info_observer("+observer.name+")")
}}}*/
    if(!hide_info_observers.includes( observer ))
        hide_info_observers.push    ( observer );
};
let _notify_hide_info = function(info)
{
/*{{{*/
    let caller = "node_to_hide_csv("+info+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    for(let i=0; i < hide_info_observers.length; ++i)
        hide_info_observers[i](info);
};
/*}}}*/

/* DOM_HIDE8_LOG */
/*  dom_hide8_log .. (called by t_store0_log_settings) {{{*/
/*{{{*/
let _transcript = null;
let node_to_hide_csv_logged;
let     site_or_page_logged;

let missing_transcript_notified_once;
/*}}}*/
let dom_hide8_log = function()
{
/*{{{
logBIG("dom_hide8_log")
}}}*/

    if( _transcript == null) _transcript = document.getElementById("dom_hide_log");

    /* notify missing log transcript {{{*/
    if(!_transcript) {
        if( !missing_transcript_notified_once)
        {
            logBIG("HTML HAS NO [dom_hide_log] TRANSCRIPT TO LOG TO", lbH+lf3);
            missing_transcript_notified_once = true;
        }
        return;
    }
    /*}}}*/
    let key = "node_to_hide_csv";
    let item = node_to_hide_csv ;
    let lfs =               _store_isa_site_or_page_key(key) ? lf5 : lf7;
/*{{{
logXXX("store_getItem %c "+(_store_isa_site_or_page_key(key) ? "PAGE" : "SITE")+" %c"+key+" %c"+ item
    ,                 lbH+lfs                                                    ,lbH+lf4  ,lbH+lfs)
}}}*/
/*{{{
logXXX("o %c node_to_hide_csv  : %c "+node_to_hide_csv+" ", lbF+lb6, lbA);
}}}*/
    let         site_or_page = _store_isa_site_or_page_key(key);
    let   ccX = site_or_page ?  "cc6" : "cc2" ;
    let scope = site_or_page ? "PAGE" : "SITE";
/*{{{
logXXX("scope=["+scope+"]")
}}}*/

    if(        (site_or_page     ==     site_or_page_logged)
          &&   (node_to_hide_csv == node_to_hide_csv_logged)
      ) return;

    let children_collection_length    =            children_collection   .length ;
    let csv_count_node_to_hide_csv    = csv_count( node_to_hide_csv             );
    let node_to_hide_csv_stack_length =            node_to_hide_csv_STACK.length ;

    /* save first sub-tool */
    let firstElementChild = _transcript.firstElementChild;
    _transcript.innerHTML
        = "<em class='big "+ccX+"'>"+ scope + "</em><br>"
        + "COLLECTION    <em class='big cc8'>"+ children_collection_length    +"</em><br>"
        + "NODES TO HIDE <em class='big cc9'>"+ csv_count_node_to_hide_csv    +"</em><br>"
        + "HISTORY       <em class='big cc7'>"+ node_to_hide_csv_stack_length +"</em><br>"
        + _dom_hide_csv_to_html( node_to_hide_csv )
    ;

    /* restore first sub-tool */
    if(       firstElementChild
       && (   firstElementChild.classList.contains( CSS_CLEARPIN )
           || firstElementChild.classList.contains( CSS_CLOSEPIN )
           || firstElementChild.classList.contains( CSS_PUSH_PIN )
           || firstElementChild.classList.contains( CSS_SCALEPIN )
           || firstElementChild.classList.contains("toolbag_button")
         )
      )
        _transcript.insertBefore(firstElementChild, _transcript.firstElementChild);

    node_to_hide_csv_logged = node_to_hide_csv;
    site_or_page_logged     = site_or_page;
};
/*}}}*/


/* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ PRIVATE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ {{{*/
/* const {{{*/
const LAST_HIDDEN               = "last_hidden";
const MARKED_TO_HIDE            = "marked_to_hide";
const NODE_TO_HIDE_MASK         = "node_to_hide_mask";
const NODE_TO_HIDE_NOT_VISIBLE  = "node_to_hide_not_visible";

let node_to_hide_csv            = "";
/*}}}*/
/* [dom_util] DEPENDENT {{{

/\v\w+\zs(add_el_class|csv_add|csv_contains|csv_count|csv_ins|csv_log|del_el_class|get_el_xy|has_el_class|is_el_or_child_of_parent_el)

get_el_xy
is_el_or_child_of_parent_el

add_el_class
del_el_class
has_el_class

csv_add
csv_contains
csv_count
csv_ins
csv_log

}}}*/

/* UI */
/*  _dom_hide__sync_DOM_HIDE1_RESET {{{*/
/*{{{*/
const DOM_HIDE__SYNC_DOM_HIDE1_RESET_DELAY = 500;

let _dom_hide__sync_DOM_HIDE1_RESET_timer;
/*}}}*/
let _dom_hide__sync_DOM_HIDE1_RESET = function()
{
    if(_dom_hide__sync_DOM_HIDE1_RESET_timer) clearTimeout(_dom_hide__sync_DOM_HIDE1_RESET_timer);
    _dom_hide__sync_DOM_HIDE1_RESET_timer   =   setTimeout(_dom_hide__sync_DOM_HIDE1_RESET_handler, DOM_HIDE__SYNC_DOM_HIDE1_RESET_DELAY);

};
/*}}}*/
/*  _dom_hide__sync_DOM_HIDE1_RESET_handler {{{*/
let _dom_hide__sync_DOM_HIDE1_RESET_handler = function()
{
/*{{{
logBIG("_dom_hide__sync_DOM_HIDE1_RESET_handler: _site_page_or_both_label=["+_site_page_or_both_label+"]", lf3);
}}}*/

    let count = csv_count(node_to_hide_csv);
    prop_init(DOM_HIDE1_RESET, (count > 0));

    let el = prop_get_EL(DOM_HIDE1_RESET);
    if( el )
        el.title
            = _site_page_or_both_label
            + LF+" HIDDEN CONTAINERS"
            + LF+" TO UNHIDE"
    ;

/*{{{
    set_el_class_on_off(prop_get_EL( DOM_HIDE1_RESET ), CSS_CHECKED, have_node_to_hide_csv);
}}}*/
};
/*}}}*/

/* clear */
/*  _dom_hide_clear_display {{{*/
let _dom_hide_clear_display = function()
{
/*{{{*/
let caller = "_dom_hide_clear_display";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*{{{
if( log_this) console_clear_post(caller);
}}}*/
/*}}}*/
    _dom_hide_clear_subtree();

};
/*}}}*/
/*  _dom_hide_clear_subtree {{{*/
let _dom_hide_clear_subtree = function( parent_node=null )
{
/*{{{*/
let   caller = "_dom_hide_clear_subtree";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(parent_node)+")", lbH+lf2);
/*}}}*/
    let hide_count = _dom_hide_clear_mark_subtree_MARKED_TO_HIDE( parent_node );
    let mask_count = _dom_hide_clear_mark_subtree_mask          ( parent_node );

    let count
        = hide_count
        + mask_count
    ;

    let            msg  = "";
    if(hide_count) msg  = "<em class='cc8'>"+hide_count+" HIDDEN NODES CLEARED</em>";
    if(mask_count) msg += "<em class='cc8'>"+mask_count+" MASKED NODES CLEARED</em>";
    if(!msg)       msg  = "<em class='cc8'>            NO HIDDEN NODES</em>";

    _notify_hide_info( msg );

    return count;
};
/*}}}*/
/*  _dom_hide_clear_mark_subtree_MARKED_TO_HIDE {{{*/
let _dom_hide_clear_mark_subtree_MARKED_TO_HIDE = function(parent_node)
{
    let count     = 0;
    let node_hidden_list = document.querySelectorAll("."+MARKED_TO_HIDE);
    for(let     i = 0; i < node_hidden_list.length; ++i)
    {
        if( parent_node == node_hidden_list[i]) continue;
        let node_hidden  = node_hidden_list[i];
        if(!parent_node || is_el_or_child_of_parent_el(node_hidden, parent_node))
        {
            _dom_hide_del_node_mask( node_hidden );
            count   += 1;
        }
    }
    return count;
};
/*}}}*/
/*  _dom_hide_clear_mark_subtree_mask {{{*/
let _dom_hide_clear_mark_subtree_mask  = function( parent_node )
{
    let count     = 0;
    let node_mask_list = document.querySelectorAll("."+NODE_TO_HIDE_MASK);
    for(let     i = 0; i < node_mask_list.length; ++i) {
        if( parent_node == node_mask_list[i].node_hidden) continue;
        let    node_mask = node_mask_list[i];
        let  node_hidden = node_mask.node_hidden;

        if(!parent_node || is_el_or_child_of_parent_el(node_hidden, parent_node))
        {
            _dom_hide_del_node_mask( node_hidden );
            count   += 1;
        }
    }
    return count;
};
/*}}}*/

/* hide visibility xy */
/*  _dom_hide_MARKED_TO_HIDE {{{*/

let _dom_hide_MARKED_TO_HIDE = function(node, state)
{
/*{{{*/
let caller = "_dom_hide_MARKED_TO_HIDE";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c(["+_dom_hide_get_id_or_tag(node)+"], "+state+")", lbH+lf2);
/*}}}*/

    if( state ) add_el_class(node, MARKED_TO_HIDE);
    else        del_el_class(node, MARKED_TO_HIDE);
};

let dom_hide_is_marked_to_hide = function( node )
{
    return has_el_class(node, MARKED_TO_HIDE);

};
/*}}}*/
/*  _dom_hide_is_node_parent_hidden {{{*/
let _dom_hide_is_node_parent_hidden = function( node )
{
    let                     node_hidden_list = document.querySelectorAll("."+MARKED_TO_HIDE);
    for(let i = 0;      i < node_hidden_list.length; ++i) {
        if( node         == node_hidden_list[i]) continue;
        let parent_hidden = node_hidden_list[i];
        if( is_el_or_child_of_parent_el(node, parent_hidden) )
            return                            parent_hidden;
    }
    return null;
};
/*}}}*/
/*  _dom_hide_set_visibility {{{*/
let _dom_hide_set_visibility = function(node, visible)
{
/*{{{*/
let   caller = "_dom_hide_set_visibility";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c(["+_dom_hide_get_id_or_tag(node)+"], "+visible+")", lbH+lf2);
/*}}}*/
/*{{{
    if(!visible && (node == document.body))
    {
        logBIG(caller+"NOT HIDING "+get_id_or_tag(node), lf2);
        console.trace();
        logXXX("NOT HIDING NODE");
        return;
    }
}}}*/

    /* SHOW PARENT THEN CHILD .. (in that order or it wont work) {{{*/
    if(!node) return;
    let mask = node.node_mask;
    if(visible) {
        if(    node.parentElement
           &&  node.parentElement.classList
           &&  node.parentElement.classList.contains( NODE_TO_HIDE_NOT_VISIBLE )
          ) {
/*{{{
logXXX("%c CHILD   VISIBLE .. SHOW PARENT "+_dom_hide_get_id_or_tag(node.parentElement), lbH+lf4)
}}}*/
            del_el_class(node.parentElement, NODE_TO_HIDE_NOT_VISIBLE);
        }

        /* node*/del_el_class(node, NODE_TO_HIDE_NOT_VISIBLE);
        if(mask) del_el_class(mask, NODE_TO_HIDE_NOT_VISIBLE);

        /* MASK DELAYED-SYNC-LAYOUT */
        if(mask) setTimeout(function() { _dom_hide_fit_node_mask(node); }, 100);
    }
    /*}}}*/
    /* HIDE CHILD [AND PARENT .. f(currently no visible child)] {{{*/
    else {
        add_el_class(node, NODE_TO_HIDE_NOT_VISIBLE);
        if( _dom_hide_all_siblings_hidden( node ) )
        {
/*{{{
logXXX("%c HIDE PARENT "+_dom_hide_get_id_or_tag(node.parentElement)+" .. f(no other visible child)", lbH+lf8)
}}}*/
            if(node && (node.parentElement != document.body)) add_el_class(node.parentElement, NODE_TO_HIDE_NOT_VISIBLE);
            if(mask && (mask.parentElement != document.body)) add_el_class(mask.parentElement, NODE_TO_HIDE_NOT_VISIBLE);
        }
    }
    /*}}}*/

/*{{{
if( node.style) {
    node.              style   .visibility =   (visible ? "" : "hidden"           ) ;
    node.setAttribute("style", "visibility : "+(visible ? "" : "hidden !important"));
    node.setAttribute("style",    "display : "+(visible ? "" : "none   !important"));
}
}}}*/
};
/*}}}*/
/*  _dom_hide_is_at_xy {{{*/
let _dom_hide_is_at_xy = function(node, x, y)
{
    let caller = "_dom_hide_is_at_xy";
    if(!node.offsetTop              ) return false;
    if(!node.style.display == "none") return false;

    let    xy = get_el_xy(node, caller);
    let result
        =  (x > xy.x)
        && (x < (xy.x + node.offsetWidth ))
        && (y > xy.y)
        && (y < (xy.y + node.offsetHeight))
    ;
/*{{{
logXXX("%c xy=["+xy.x+" "+xy.y+"] %c "+ _dom_hide_get_id_or_tag(node) +" %c TL=["+ node.offsetLeft +" "+ node.offsetTop  +"] %c WH=["+ node.offsetWidth +" "+ node.offsetHeight+"]"
      ,lbL                       ,lbR+lf4                                   ,lbL                                                ,lbR)
logXXX(caller+": ...return "+result);
}}}*/
    return result;
};
/*}}}*/

/* mask */
/*  _dom_hide_add_node_mask {{{*/
/*{{{*/
let _node_mask_div;

/*}}}*/
let _dom_hide_add_node_mask = function( node )
{
/*{{{*/
let   caller = "_dom_hide_add_node_mask";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(node)+")", lbH+lf2);
/*}}}*/
    /* MASK TEMPLATE TO CLONE FROM {{{*/
    if(!_node_mask_div )
    {
        _node_mask_div           = document.createElement("div");
        _node_mask_div.className = NODE_TO_HIDE_MASK;
    }
    /*}}}*/
    /* ASSOCIATE MASK {{{*/
    let node_mask         = _node_mask_div.cloneNode(true);
    node_mask.innerText   = _dom_hide_get_body_hop_count(node);
    node_mask.title       = get_parentage(node);
    node_mask.node_hidden = node;

    document.body.insertBefore(node_mask, document.lastChild.nextSibling);

    node     .node_mask   = node_mask;
    add_el_class(node, "has_node_mask");

    _dom_hide_fit_node_mask( node );
    /*}}}*/
};
/*}}}*/
/*  _dom_hide_get_body_hop_count {{{*/
let _dom_hide_get_body_hop_count = function(node)
{
    let hop = 0; /* body-level is 0 */
    while(        node
              && (node != document.body)
              && (node != document.documentElement)
         ) {
        node            = node.parentNode;
        hop             = hop + 1;
    }
/*{{{
logXXX("_dom_hide_get_body_hop_count: ...return "+hop+"")
}}}*/
    return hop;
};
/*}}}*/
/*  _dom_hide_fit_node_mask {{{*/
let _dom_hide_fit_node_mask = function( node )
{
/*{{{*/
let   caller = "_dom_hide_fit_node_mask";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(node)+")", lbH+lf2);
/*}}}*/
    if( has_el_class(node.parentElement, NODE_TO_HIDE_NOT_VISIBLE) ) del_el_class(node.parentElement, NODE_TO_HIDE_NOT_VISIBLE);
    if( has_el_class(node              , NODE_TO_HIDE_NOT_VISIBLE) ) del_el_class(node              , NODE_TO_HIDE_NOT_VISIBLE);

    let  xy = get_el_xy(   node);
    let e_W = Math.max(16, node.scrollWidth  || node.offsetWidth );
    let e_H = Math.max(16, node.scrollHeight || node.offsetHeight);

    if( node.node_mask)
    {
        node.node_mask.style.left         =     xy.x +"px";
        node.node_mask.style.top          =     xy.y +"px";
        node.node_mask.style.width        =     e_W  +"px";
        node.node_mask.style.height       =     e_H  +"px";

        node.node_mask.style.zIndex       = 1 + node.style.zIndex;
        node.node_mask.style.borderRadius = parseInt(window.getComputedStyle(node).borderRadius) +"px";
    }

};
    /*}}}*/
/*  _dom_hide_del_node_mask {{{*/
let _dom_hide_del_node_mask = function( node )
{
/*{{{*/
let   caller = "_dom_hide_del_node_mask";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(node)+")", lbH+lf2);
/*}}}*/
    /* TRASH MASK {{{*/
    if( node.node_mask )
    {
        document.body.removeChild( node.node_mask );
        node.node_mask = null;
        del_el_class(node, "has_node_mask");
    }
    /*}}}*/
    /* UNHIDE NODE {{{*/
    del_el_class            (node, MARKED_TO_HIDE);
    _dom_hide_set_visibility(node, true);

    /*}}}*/
};
/*}}}*/
/*  _dom_hide_is_node_parent_masked {{{*/
let _dom_hide_is_node_parent_masked = function( node )
{
    let                     node_mask_list = document.querySelectorAll("."+NODE_TO_HIDE_MASK);
    for(let i = 0;      i < node_mask_list.length; ++i) {
        if( node         == node_mask_list[i].node_hidden) continue;
        let parent_hidden = node_mask_list[i].node_hidden;
        if( is_el_or_child_of_parent_el(node, parent_hidden) )
            return                            parent_hidden;
    }
    return null;
};
/*}}}*/

/* csv */
/*  _dom_hide_add_csv {{{*/
let _dom_hide_add_csv = function( node )
{
/*{{{*/
let   caller = "_dom_hide_add_csv";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(node)+")", lbH+lf2);
/*}}}*/
    /* ...return false if already hidden by parent {{{*/
    let node_parent
        =  _dom_hide_is_node_parent_hidden( node )
        || _dom_hide_is_node_parent_masked( node )
    ;
    if( node_parent )
    {
        _notify_hide_info("<em class='cc9'>"+ _dom_hide_get_id_or_tag(node)          +"</em>"
                   +      "<em class='cc8'>   already hidden by                        </em>"
                   +      "<em class='cc9'>"+ _dom_hide_get_id_or_tag( node_parent ) +"</em>"
                 );

        return false;
    }
    /*}}}*/
    /*  CSV node_path {{{*/
    let node_path = _dom_hide_get_node_path( node );
if(log_this) log("...node_path=["+node_path+"]");

    /*}}}*/
    /* ...return false if already hidden {{{*/
    if( csv_contains(node_to_hide_csv, node_path))
    {
        return false;
    }
    /*}}}*/
    /* PUSH CURRENT CSV [BEFORE ADD] {{{*/
    _dom_hide_csv_stack_push("BEFORE ADD");

    /*}}}*/
    /* ADD CSV {{{*/
    node_to_hide_csv = csv_add(node_to_hide_csv, node_path);
if(log_this) _dom_hide_csv_dump(caller);

    /*}}}*/
    /* STORE CSV ...return true {{{*/
    dom_hide2_store_save();

    return true;
    /*}}}*/
};
/*}}}*/
/*  _dom_hide_del_csv {{{*/
let _dom_hide_del_csv = function( node )
{
/*{{{*/
let caller = "_dom_hide_del_csv";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c("+_dom_hide_get_id_or_tag(node)+")", lbH+lf2);
/*}}}*/
    /*  CSV node_path {{{*/
    let node_path = _dom_hide_get_node_path( node );
if(log_this) log("...node_path=["+node_path+"]");

    /*}}}*/
    /* ...return false if not yet stored {{{*/
    if(!csv_contains(node_to_hide_csv, node_path))
    {
        return false;
    }
    /*}}}*/
    /* PUSH CURRENT CSV [BEFORE DEL] {{{*/
    _dom_hide_csv_stack_push("BEFORE DEL");

    /*}}}*/
    /* DEL CSV {{{*/
        node_to_hide_csv = csv_del(node_to_hide_csv, node_path);
if(log_this) _dom_hide_csv_dump(caller);

    /*}}}*/
    /* STORE CSV ...return true {{{*/
    dom_hide2_store_save();

    return true;
    /*}}}*/
};
/*}}}*/
/*  _dom_hide_clear_csv_and_store {{{*/
let _dom_hide_clear_csv_and_store = function()
{
/*{{{*/
let caller = "_dom_hide_clear_csv_and_store";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* CLEAR CSV {{{*/
    node_to_hide_csv = "";

    /*}}}*/
    /* STORE CSV {{{*/
    dom_hide2_store_save();

    /*}}}*/
};
/*}}}*/
/*  _dom_hide_rebuild_csv_from_hidden_and_masked_nodes {{{*/
let _dom_hide_rebuild_csv_from_hidden_and_masked_nodes = function() {
/*{{{*/
let caller = "_dom_hide_rebuild_csv_from_hidden_and_masked_nodes";
let log_this = LOG_MAP.T3_LAYOUT;
if( log_this) log(caller);
/*}}}*/
    /* CLEAR CSV {{{*/
    _dom_hide_clear_csv_and_store();

    /*}}}*/
    /* ADD MARKED_TO_HIDE {{{*/
    let hidden_count = 0;
    let                      node_hidden_list = document.querySelectorAll("."+MARKED_TO_HIDE);
    for(let i = 0;      i <  node_hidden_list.length; ++i) {
        let node_hidden   =  node_hidden_list[i];
        let     node_path = _dom_hide_get_node_path( node_hidden );
if(log_this) log("...node_path=["+node_path+"]");
        node_to_hide_csv = csv_add(node_to_hide_csv, node_path);
        hidden_count += 1;
    }
if(log_this) log("...hidden_count=["+hidden_count+"]");

    /*}}}*/
    /* ADD NODE_TO_HIDE_MASK {{{*/
    let masked_count = 0;
    let                      node_mask_list = document.querySelectorAll("."+NODE_TO_HIDE_MASK);
    for(let i = 0;      i <  node_mask_list.length; ++i) {
        let node_hidden   =  node_mask_list[i].node_hidden;
        let     node_path = _dom_hide_get_node_path( node_hidden );
if(log_this) log("...node_path=["+node_path+"]");
        node_to_hide_csv = csv_add(node_to_hide_csv, node_path);
        masked_count += 1;
    }
if(log_this) log("...masked_count=["+masked_count+"]");

    /*}}}*/
    /* STORE CSV {{{*/
    dom_hide2_store_save();

    /*}}}*/
if(log_this) _dom_hide_csv_dump(caller);
};
/*}}}*/

/* history */
/*{{{*/
let node_to_hide_csv_STACK = [];
let node_to_hide_csv_pushed_last_on_top;

/*}}}*/
/*   _dom_hide_csv_stack_clear_history {{{*/
let _dom_hide_csv_stack_clear_history = function()
{
    node_to_hide_csv_STACK = [];
};
/*}}}*/
/*_ _dom_hide_freeze_history {{{*/
let _dom_hide_freeze_history_caller;
let _dom_hide_freeze_history = function(state, caller)
{
    if(state) _dom_hide_freeze_history_caller = caller;
    else      _dom_hide_freeze_history_caller =     "";
};
/*}}}*/
/*  _dom_hide_csv_stack_push {{{*/
let _dom_hide_csv_stack_push = function(reason)
{
/*{{{*/
let caller = "_dom_hide_csv_stack_push";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+"(%c "+reason+"):"
                  ,lbH         ,lbL+lf3);
/*}}}*/
    /* PUSH ON TOP OF STACK {{{*/
    if( _dom_hide_freeze_history_caller )
    {

if( log_this) log("...%c HISTORY FREEZED BY "+ _dom_hide_freeze_history_caller, lbH+lf8);
    }
    else if(node_to_hide_csv == node_to_hide_csv_pushed_last_on_top)
    {

if( log_this) log("...%c ALREADY ON TOP OF STACK", lbH+lf3);
    }
    else {
        node_to_hide_csv_STACK.push( node_to_hide_csv   );
        node_to_hide_csv_pushed_last_on_top = node_to_hide_csv;

if( log_this) csv_log(node_to_hide_csv,csv_count(node_to_hide_csv)+" NODES PUSHED ON TOP OF STACK");
    }
    /*}}}*/
};
/*}}}*/
/*  _dom_hide_csv_stack_pop {{{*/
let _dom_hide_csv_stack_pop = function(reason)
{
/*{{{*/
let caller = "_dom_hide_csv_stack_pop";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+" %c "+reason, lbL+lf3,lbR+lf3);
/*{{{
csv_log(node_to_hide_csv, "node_to_hide_csv");
}}}*/
/*}}}*/
    /* [HISTORY BACK] OR [LAST DROPPED] {{{*/
    let popped_csv = node_to_hide_csv_STACK.pop() || "";
/*{{{
csv_log(popped_csv, "popped_csv")
}}}*/

    if(popped_csv) {
if(log_this) log("%c HISTORY BACK", lbH+lf7);

        node_to_hide_csv = popped_csv;
    }
    else {
if(log_this) log("%c LAST DROPPED", lbH+lf3);

        node_to_hide_csv = csv_del_last(node_to_hide_csv);
    }

/*{{{
csv_log(node_to_hide_csv, "node_to_hide_csv");
}}}*/
    /*}}}*/
    /* STORE CSV {{{*/
    dom_hide2_store_save();

    /*}}}*/
    /* HIGHLIGHT LAST HIDDEN {{{*/
    _dom_hide_highlight_last_hidden();

    /*}}}*/

    dom_hide_set_MASK_OR_HIDE();
};
/*}}}*/
/*  _dom_hide_csv_to_html {{{*/
let _dom_hide_csv_to_html = function(csv)
{
    if(!csv) return "";

    let html = "<em class='cc9'>PARENT</em> <em class='cc0 sup'>child-num</em> <em class='cc9'>CHILD</em><br>";

    let            nodes = csv.split(",");
    for(let i=0; i < nodes.length; ++i)
    {
        let path    = "";
        let indent  = "";
        let p_count =  1;
        let            steps = nodes[i].split("|");
        for(let j=0; j < steps.length; ++j)
        {
            let num_child_parent = steps[j].split(" ");
            let              num = num_child_parent[0];
            let            child = num_child_parent[1]; /* of */
            let           parent = num_child_parent[3];
            path += indent
                +   "<em class='cc"+(  p_count)+"'>"+ parent +"</em><em class='sup cc"+(num % 10)+"'>"+num+"</em>"
                +  " <em class='cc"+(++p_count)+"'>"+ child  +"</em>"
                +  "<br>"+LF
            ;
            indent += SYMBOL_RIGHT_ARROW;
        }
        html += path+"<br>";
    }
/*
    logXXX("_dom_hide_csv_to_html: ...return\n"+html)
*/
    return html;
};
/*}}}*/

/* _dom_hide_highlight_last_hidden {{{*/
/*{{{*/
const NODE_TO_HIDE_HIGHLIGHT_LAST_HIDDEN_DELAY = 500;

let _dom_hide_highlight_last_hidden_timer;
/*}}}*/
let _dom_hide_highlight_last_hidden = function()
{
/*{{{*/
let caller = "_dom_hide_highlight_last_hidden";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    if(_dom_hide_highlight_last_hidden_timer) clearTimeout(_dom_hide_highlight_last_hidden_timer);
    _dom_hide_highlight_last_hidden_timer   =   setTimeout(_dom_hide_highlight_last_hidden_handler, NODE_TO_HIDE_HIGHLIGHT_LAST_HIDDEN_DELAY);
};
/*}}}*/
/*  _dom_hide_highlight_last_hidden_handler {{{*/
let _dom_hide_highlight_last_hidden_handler = function()
{
/*{{{*/
let caller = "_dom_hide_highlight_last_hidden_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    _dom_hide_highlight_last_hidden_timer = null;
    let         count = csv_count( node_to_hide_csv );
/*{{{
logXXX("count=["+count+"]");
}}}*/
    if(count < 1) return;
/*{{{
logXXX("node_to_hide_csv=["+node_to_hide_csv+"]");
}}}*/

    let node_list = document.querySelectorAll("."+LAST_HIDDEN);
    for(let i=0; i < node_list.length; ++i)
        del_el_class(node_list[i], LAST_HIDDEN);

    let     node_path = csv_get(node_to_hide_csv, count);
/*{{{
logXXX("node_path=["+node_path+"]");
}}}*/
    let          node = _dom_hide_get_node_path_target(node_path);
    if(!node) return;

/*{{{
console_dir(     node          , "NODE");
}}}*/
    add_el_class(node          , LAST_HIDDEN);
    add_el_class(node.node_mask, LAST_HIDDEN);
/*{{{
console_dir(     node.node_mask, "MASK");
}}}*/

    _notify_hide_container(node, caller, "LAST HIDDEN "+get_id_or_tag(node));
};
/*}}}*/

/* stringify */
/*  _dom_hide_get_node_path {{{*/
let _dom_hide_get_node_path = function( node )
{
    let node_path = "";
    do {
        if( node ) {
            /* count preceding siblings */
            let     child = node;
            let       num = 1;
/*{{{
            while(child = child.previousElementSibling) num += 1;
}}}*/
            for(num = 1; (node.parentElement) && (num <= node.parentElement.children.length); ++num)
            {
                if(node.parentElement.children[num-1] == node) {
/*{{{
logXXX("...(node.parentElement == node.parentNode)=["+(node.parentElement == node.parentNode)+"]")
console.dir(node.parentElement)
logXXX("%c "+num+" of "+_dom_hide_get_id_or_tag(node.parentElement), lbb+lbH+lf7)
console.dir(node)
}}}*/
                    break;
                }
            }

            let   tag_num_str = _dom_hide_tag_num_to_str(node, num);
/*{{{
logXXX("_dom_hide_get_node_path: tag_num_str=["+tag_num_str+"]")
}}}*/
            node_path = csv_ins(node_path, tag_num_str);

            node = node.parentElement;
        }
    }
    while(    node
          && (node != document.body)
          && (node != document.documentElement)
         );

    return comma_to_vbar( node_path );
};
/*}}}*/
/*  _dom_hide_get_node_path_target {{{*/
let _dom_hide_get_node_path_target = function(node_path, log_num=8)
{
/*{{{*/
let caller = "_dom_hide_get_node_path_target";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
if( log_this) log(caller+"("+node_path+")");
/*}}}*/
    /* LOG {{{*/
    let args = [""]; let s = "";
    if( log_this) {
        let lfn = lfX[log_num % 10];

        s += "%c"+log_num; args.push(/*lbb+*/lfn);
    }
    /*}}}*/
    let node_tag_num_array = node_path.split("|");   /* pre_0 | div_2 */
    let          node = document.body;
    for(let s_num = 1; s_num <= node_tag_num_array.length; ++s_num)
    {
        let  node_tag_num = _dom_hide_str_to_tag_num( node_tag_num_array[s_num-1] );
        let       tag     = node_tag_num.tag;
        let           num = node_tag_num.num;
        /* LOG {{{*/
        if( log_this) {
            s      +=     " %c "+tag+" %c"+num;

            let lfs = lfX[s_num % 10];
            args.push( lbL+lfs);
            args.push(            lbR+lfs);
        }
        /*}}}*/
        if( !(node = node.children[num-1]) ) break;
    }
    /* LOG {{{*/
    if( log_this ) {
        let lfs = lfX[(1 + node_tag_num_array.length) % 10];
        s      +=  "%c"+_dom_hide_get_id_or_tag(node); args.push(/*lbb+*/lbH+lfs);
        args[0] = s;
        console.log.apply(console, Array.prototype.slice.call(args));
    }
    /*}}}*/
if(log_this/*|| !node*/) logXXX("%c "+caller+"("+node_path+"): return "+ _dom_hide_get_id_or_tag(node), lbb+lbH+lf7);
    return node;
};
/*}}}*/
/*  _dom_hide_tag_num_to_str - (USAE _dom_hide_get_id_or_tag) {{{*/
let _dom_hide_tag_num_to_str = function(child, num)
{
/*{{{
    let  child_label = _dom_hide_get_id_or_tag( child               );
    let parent_label = _dom_hide_get_id_or_tag( child.parentElement );

    let  child_label = child              .tagName;
    let parent_label = child.parentElement.tagName;
}}}*/
    let  child_label = _dom_hide_get_id_or_tag(child              );
    let parent_label = _dom_hide_get_id_or_tag(child.parentElement);

    return    num                       /* 0 num    */
        +" "+ child_label               /* 1 child  */
        +   " of"                       /* 2 of     */
        +" "+ parent_label              /* 3 parent */
    ;
};
/*}}}*/
/*  _dom_hide_str_to_tag_num {{{*/
let _dom_hide_str_to_tag_num = function( node_tag_num )
{
    let words = node_tag_num.split(" ");

    let num   = parseInt( words[0]);    /* 0 num   */
    /* ----------------------------------- 1 child */
    /* ----------------------------------- 2 of    */
    let tag   =           words[3] ;    /* 3 tag   */
/*
logXXX("_dom_hide_str_to_tag_num("+node_tag_num+") ...return { tag:"+tag+" , num:"+num+" }")
*/
    return { tag:tag , num:num };
};
/*}}}*/

/* log */
/* _dom_hide_csv_dump {{{*/
let _dom_hide_csv_dump = function(_caller)
{
    if(!node_to_hide_csv) return;

    let node_to_hide_csv_array = node_to_hide_csv.split(",");               /* pre_0|div_2 , ul_23|li_8 */
    for(let n_num = 1; n_num  <= node_to_hide_csv_array.length; ++n_num)
    {
        let     node_path = node_to_hide_csv_array[n_num-1];

        _dom_hide_get_node_path_target(node_path, n_num);
    }
};
/*}}}*/
/* _dom_hide_get_id_or_tag {{{ */
let _dom_hide_get_id_or_tag = function(el)
{
    if(!el) return "null_node";
    return el.id || el.tagName;
};
/*}}}*/

/* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ PRIVATE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ }}}*/

/*}}}*/
//# sourceURL=dom_hide.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**  8  SELECT  JS dom_select_js_data {{{*/
/*
../javascript/dom_select.js
*/
dom_select_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_select_js */
let DOM_SELECT_JS_ID        = "dom_select_js";
let DOM_SELECT_JS_TAG       = DOM_SELECT_JS_ID  +" (190102:14h)";
/* CONSOLE TEMPLATE TO BE IMPLEMENTED BY EMBEDDING LAYER {{{*/
/*{{{
  let DOUBLE_QUOTE  = String.fromCharCode(34);
  let LF            = String.fromCharCode(10);
  let CR            = String.fromCharCode(13);
}}}*/
  let BACKSLASH     = String.fromCharCode(92);
  let FORESLASH     = String.fromCharCode(47);
  let CS            = "font-size:150%; font-weight:900; border:1px solid gray; color:yellow; background-color:navy; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #000 0%, #223 50%, #000 100%);";
  let console_clear = function(  msg=null) { try { console.clear(); if(msg) console.warn("%c=== CLEARED BY: "+msg,CS);                 } catch(ex) {} };
  let console_dir   = function(o,msg=null) { try {                  if(msg) console.log (          "%c"+msg      ,CS); console.dir(o); } catch(ex) {} };
  let console_log   = function(  msg     ) { try {                          console.log (               msg         );                 } catch(ex) {} };
  let console_warn  = function(  msg=null) { try {                          console.warn(               msg         );                 } catch(ex) {} };
/*}}}*/
/* let {{{*/
let HORIZONTAL_ELLLIPSIS = "\u2026";

let SYMBOL_U             = "\u25B2";
let SYMBOL_R             = "\u25B6";
let SYMBOL_D             = "\u25BC";
let SYMBOL_L             = "\u25C0";
let SYMBOL_E             = "\u2026";
let SYMBOL_LF            = "\u21B5";
let SYMBOL_CR            = "\u2943";
let SYMBOL_TOFU          = "\uFFFD";
let SYMBOL_PUSH_PIN      = "\uD83D\uDCCC";
let SYMBOL_CLOSEPIN      = "\u2715";

let mStartRange =  null;
let mEndRange   =  null;
let mTouchPoint =  null;

/*}}}*/

/** CCS .. (ecc color coded nodes) */
/*{{{*/
let CCS = function()
{
    /*this.clear {{{*/
    this.clear = function() {
        this.slot         =  0; /* first active slot = 1 */
        this.num_selected =  1;
        this.pattern      = "";
        this.options      = "";
        this.nodes        = [];
        this.thumbs       = [];
        this.containers   = [];
/*
        this.seek_up   = [];
        this.seek_down = [];
*/
    };
    /*}}}*/
    /*this.toString {{{*/
    this.toString = function() {
        return ""
            +  "Slot "+ this.slot              +" "
            +  "num_s"+ this.num_selected      +" "
            +  " "    + this.pattern           +" "
            +  "("    + this.options           +")"
            +  " ["   + this.nodes.length      +" nodes]"
            +  " ["   + this.thumbs.length     +" thumbs]"
            +  " ["   + this.containers.length +" containers]"
        ;
    };
    /*}}}*/
    /*this.num_toHTML {{{*/
    this.num_toHTML = function(num) {
        let slot_em    =              "<em class='cc"+((this.slot) % SELECT_SLOT_MAX)+"'>"+ this.slot + "</em>";
        let num_em     =              "<em class='cc"+((     num ) % SELECT_SLOT_MAX)+"'>"+      num  + "</em>";

        let pattern_em = pattern_toHTML(this.pattern, this.options);

        let empty      = (this.nodes.length < 1);
        let thumb_p_str= empty ? "" : get_thumb_p_str(this.thumbs[num-1]) +"% ";

        let text_em    = empty ? "" : "<em class='cc7'>"                + this.nodes [num-1].textContent + "</em>";

        return ""
            + slot_em + num_em + thumb_p_str.replace(" ","&nbsp;")
            + pattern_em +"="+ text_em
        ;

    };
    /*}}}*/
    this.clear(); /* construction-time-init */
};
let ccs = [];
/*_ s_get_slotted_pattern_count {{{*/
let s_get_slotted_pattern_count = function()
{
    let count = 0;
    for(let slot = 1; slot < ccs.length; ++slot)
    {
        if(!ccs[slot]                 ) continue;
        if( ccs[slot].nodes.length > 0) count += 1;
    }
if(LOG_MAP.S3_SLOT) log("s_get_slotted_pattern_count: ...return "+count);
    return count;
};
/*}}}*/
/*_ ccs_sort_pattern {{{*/
let ccs_sort_pattern = function()
{
    ccs.sort(
        function(a, b) {
            return b.pattern - a.pattern;
        }
    );
};
/*}}}*/
/*_ ccs_log {{{*/
let ccs_log = function()
{
    for(let slot = 0; slot < ccs.length; ++slot)
    {
        if(ccs[slot])
            log(slot+" "+ ccs[slot].toString());
    }
};
/*}}}*/

/*}}}*/

/** SLOT */
/*{{{*/
let SELECT_SLOT_MAX           =  10;
let S_TOUCHED_WORD_LENGTH_MAX = 256;
let last_cleared_slot         =   1;
let next_to_reuse_slot        =   1;
/*_ get_slot_for_range {{{*/
let SEL_CLASS_PREFIX = "select";
let get_slot_for_range = function(range)
{
    /* return range.parentNode highlight slot */

    let caller = "get_slot_for_range("+range+")";

    let slot = -1;

    if(range.startContainer && (range.startContainer.parentNode.id))
    {
        slot = range.startContainer.parentNode.id.startsWith( SEL_CLASS_PREFIX )
            ?  range.startContainer.parentNode.id.substring ( SEL_CLASS_PREFIX.length, SEL_CLASS_PREFIX.length+1)
            :                                                 -1
        ;
    }

if(LOG_MAP.S3_SLOT) log("get_slot_for_range("+range.toString()+"): return ["+slot+"] .. (startContainer: id=["+range.startContainer.id+"] parentNode.id=["+range.startContainer.parentNode.id+"])");

    if((slot >=0) && !ccs[slot]) ccs[slot] = new CCS();

    return slot;
};
/*}}}*/
/*_ get_slot_matching_pattern {{{*/
let get_slot_matching_pattern = function(pattern)
{
    let caller = "get_slot_matching_pattern("+pattern+")";
let log_this = LOG_MAP.S3_SLOT;

    let slot;
    try {
        for(slot = 1; slot < ccs.length; ++slot)
        {
            if( !ccs[slot]         ) continue;
            if( !ccs[slot].pattern ) continue;

            if( pattern ==        ccs[slot].pattern ) {
if(log_this) log(caller+": ...return slot #"+slot+" .. (pattern ==       CCS.PATTERN)");
                return slot;
            }
            if( ccs[slot].pattern.includes( pattern ) ) {
if(log_this) log(caller+": ...return slot #"+slot+" .. (CCS.PATTERN includes pattern)");
                return slot;
            }
            if( pattern.includes( ccs[slot].pattern ) ) {
if(log_this) log(caller+": ...return slot #"+slot+" .. (pattern includes CCS.PATTERN)");
                return slot;
            }

        }
    }
    catch(ex) { log(caller+": slot=["+slot+"]"+LF+" ccs[slot].pattern=["+ccs[slot].pattern+"]"+LF+ex, "error"); }

if(log_this) log(caller+": ...found no pattern matching current filter");
    return 0;
};
/*}}}*/
/*_ get_slot_of_pattern {{{*/
let get_slot_of_pattern = function(pattern)
{
let   caller = "get_slot_of_pattern("+pattern+")";
let log_this = LOG_MAP.S3_SLOT;

    pattern =      unescape(pattern);
    let slot;
    for(slot = 1; slot < ccs.length; ++slot)
    {
        if( !ccs[slot]         ) continue;
        if( !ccs[slot].pattern ) continue;
        if( pattern == unescape(ccs[slot].pattern))
            break;
    }

    if(slot >= ccs.length) slot = 0;

if(log_this) log(caller+": ...return slot=["+slot+"]");
    return slot;
};
/*}}}*/
/*_ set_slot_of_pattern {{{*/
let set_slot_of_pattern = function(new_slot, pattern)
{
let   caller = "set_slot_of_pattern("+new_slot+" ,"+pattern+")";
let log_this = LOG_MAP.S3_SLOT;

    pattern  = unescape(pattern);

    let was_slot;
    for(was_slot = 1; was_slot < ccs.length; ++was_slot)
    {
        if( !ccs[was_slot]         ) continue;
        if( !ccs[was_slot].pattern ) continue;
        if( pattern == unescape(ccs[was_slot].pattern))
            break;
    }

    if(was_slot < ccs.length)
    {
        let ccs_was_in_slot = ccs[new_slot];
        let ccs_new_in_slot = ccs[was_slot];

        ccs[was_slot]      = ccs_was_in_slot;
        ccs[new_slot]      = ccs_new_in_slot;

        if(ccs[was_slot]) ccs[was_slot].slot = was_slot;
        if(ccs[new_slot]) ccs[new_slot].slot = new_slot;

if(log_this) log(caller+":");
if(log_this && ccs[new_slot]) log("...PUSHED IN: ["+ccs[new_slot].slot+"]=["+ccs[new_slot].pattern+"]");
if(log_this && ccs[was_slot]) log("...MOVED OUT: ["+ccs[was_slot].slot+"]=["+ccs[was_slot].pattern+"]");
    }
    else {
if(log_this) log(caller+": nothing to move out from slot #"+new_slot+"");
    }

    return new_slot;
};
/*}}}*/
/*_ get_free_slot {{{ */
let get_free_slot = function()
{
    let caller = "get_free_slot";
let log_this = LOG_MAP.S3_SLOT;

    /* pick first available color slot */

    /* SKIP USED SLOTS  slot=[1..10] .. ccX=[1..0] */
    let slot;
    for(slot = 1; slot <= SELECT_SLOT_MAX; ++slot)
    {
        let ccX       = slot % SELECT_SLOT_MAX;
        let sel_class = SEL_CLASS_PREFIX + ccX;
        let selector  = "."+sel_class;

        let el = document.querySelector( selector ); /* .. (first will do) */
        if(!el) break;
    }

    if(slot <= SELECT_SLOT_MAX) {
        next_to_reuse_slot = slot + 1; if(next_to_reuse_slot > SELECT_SLOT_MAX) next_to_reuse_slot = 1;
if(log_this) log(caller+": 1/2 - FREE  SLOT ["+slot+"] .. next_to_reuse_slot=["+next_to_reuse_slot+"]");
    }
    else {
        slot = next_to_reuse_slot;
        next_to_reuse_slot = slot + 1; if(next_to_reuse_slot > SELECT_SLOT_MAX) next_to_reuse_slot = 1;
if(log_this) log(caller+": 2/2 - REUSE SLOT ["+slot+"] .. next_to_reuse_slot=["+next_to_reuse_slot+"]");
    }

    if(   !ccs[slot] ) ccs[slot] = new CCS();
    else clear_slot(       slot);

    return slot;
};
/*}}}*/
/*_ clear_slot {{{ */
let last_cleared_pattern;
let clear_slot = function(slot)
{
    let caller = "clear_slot("+slot+")";
let log_this = LOG_MAP.S3_SLOT;
if(log_this) log(caller);

    last_cleared_slot = slot;

    let ccX       = slot % SELECT_SLOT_MAX;
    let sel_class = SEL_CLASS_PREFIX + ccX;
    let selector  = "."+sel_class;
    let sel_list  = document.querySelectorAll( selector );
if(log_this && sel_list.length) log("...["+selector+"] sel_list.length=["+sel_list.length+"]");

    if(ccs[slot] && ccs[slot].pattern)
        t_clear_slot_sync(slot, ccs[slot].pattern);

    let cleared_count = 0;
    for(let i = 0; i < sel_list.length; ++i)
    {
        sel_list[i].outerHTML = sel_list[i].innerHTML;
        cleared_count += 1;
    }

    if( ccs[slot] ) {
        last_cleared_pattern = ccs[slot].pattern;
        ccs[slot].clear();
    }

    if(cleared_count) {
        sync_containers_hi();
    }

if(log_this && cleared_count) log("."+selector+": "+cleared_count+" nodes cleared");
    return cleared_count;
};
/*}}}*/
/*_ get_ccs_slot {{{*/
let get_ccs_slot = function(slot)
{
    return ccs[slot];
};
/*}}}*/
/*_ get_prev_populated_slot {{{*/
let get_prev_populated_slot = function(slot)
{
    let slot_with_nodes = 0;
    for(let i = (slot-1); i > (slot-SELECT_SLOT_MAX); --i)
    {
        let s = 1+ ((i-1+SELECT_SLOT_MAX) % SELECT_SLOT_MAX);
        let l = ccs[s]
            ?   ccs[s].nodes.length
            :   0;
        if(l && !slot_with_nodes) slot_with_nodes = s;
    }
    return slot_with_nodes;
};
/*}}}*/
/*_ get_next_populated_slot {{{*/
let get_next_populated_slot = function(slot)
{
    let slot_with_nodes = 0;
    for(let i = (slot+1); i < (slot+SELECT_SLOT_MAX); ++i)
    {
        let s = 1+ ((i-1+SELECT_SLOT_MAX) % SELECT_SLOT_MAX);
        let l = ccs[s]
            ?   ccs[s].nodes.length
            :   0;
        if(l && !slot_with_nodes) slot_with_nodes = s;
    }
    return slot_with_nodes;
};
/*}}}*/
/*}}}*/

/** EVENTS */
/*_ [tse] object usage {{{
    tse.s    .. word start
    tse.e    .. word end
    tse.t    .. word text
    tse.drop .. dropped suffix (as of 181024)
}}}*/
/* SELECT {{{*/
/*_ s_touchedWord {{{ */
/*{{{*/
let s_touchedWord_range_parent;
let s_touchedWord_slot;

/*}}}*/
let s_touchedWord = function(x,y)
{
/*{{{*/
let   caller = "s_touchedWord(x="+x+" , y="+y+")";
let log_this = LOG_MAP.S1_RANGE;

    if(log_this) log(caller);
/*}}}*/
    /* get_range_from_XY {{{ */
    s_touchedWord_range_parent = null;

    let  rangeFromXY = get_range_from_XY(x, y);

    if( !rangeFromXY ) {
if(log_this) log_set_TR_SELECT("<em class='big'>SELECTION: NO RANGE AT ["+x+"@"+y+"]</em>");
        return;
    }
    /*}}}*/
    /* 1/3 CLEAR CLICKED SELECTION {{{*/
    let slot = get_slot_for_range(rangeFromXY);
    if( slot >= 0) {
if(log_this) log_set_TR_SELECT("<em class='big'>SELECTION: CLEAR CLICKED SLOT #"+slot+"</em>");

        clear_slot( slot );

        return;
    }
    /*}}}*/
    /* 2/3 selected word range {{{*/
    let range = s_touchedWord_adjust( rangeFromXY );
    if(!range ) {
if(log_this) log_set_TR_SELECT("<em class='big'>SELECTION: NO WORD RANGE</em>");

        return;
    }
    /*}}}*/
    /* 3/3 CLEAR CLICKED SELECTION (adjusted) {{{*/
if(log_this || log_this) log( rangeToString(range) );

    slot = get_slot_for_range(range);
    if( slot >= 0) {
if(log_this) log_set_TR_SELECT("<em class='big'>SELECTION: CLEAR ADJUSTED SLOT #"+slot+"</em>");
        clear_slot( slot );
        return;
    }
    /*}}}*/
    /* Select new range {{{*/

  /*let touched_text =  get_first_word( range.toString(), caller);*/
    let touched_text =                  range.toString();
if(log_this) log("touched_text=["+touched_text+"]");

    if( touched_text )
    {
if(log_this) log_set_TR_SELECT("<em class='big'>SELECTION: FILTER=["+touched_text+"]</em>");
/*{{{
logXXX("...touched_text=["+touched_text+"]")
}}}*/
        if(!prop_get(WORDS_SEGMENT) ) {
            touched_text = s_escapeREGEX(touched_text);
/*{{{
logXXX("...s_escapeREGEX=["+touched_text+"]")
}}}*/
        }
        /* optional suffix regex */
        if(range.drop) {
            touched_text += "("+range.drop+")?"
/*{{{
logXXX("...range.drop["+range.drop+"] .. touched_text=["+touched_text+"]")
}}}*/
        }

        s_touchedWord_range_parent = range.startContainer.parentNode;

        set_tools_filter( touched_text );

        check_TreeWalker("", touched_text);

        return;
    }
    /*}}}*/
};
/*}}}*/
/*_ s_escapeREGEX {{{*/
/*{{{*/
var s_escapeREGEX_chars
    = {  "\\" : "\\\\"

        ,"^"  :  "\\^"
        ,"$"  :  "\\$"
        ,"."  :  "\\."
        ,"+" :  "\\+"
        ,"*" :  "\\*"

        ,"("  :  "\\("
        ,")"  :  "\\)"
        ,"["  :  "\\["
        ,"]"  :  "\\]"
    };

let regexp_REGEX_CHARS = new RegExp("[\\\\"+"^$"+"\.\+\*"+"\\(\\)\\[\\]]", "g");
/*}}}*/
let s_escapeREGEX = function (text)
{
  return text.replace(regexp_REGEX_CHARS, function(character) { return s_escapeREGEX_chars[character]; });
};
/*}}}*/

/*_ s_touchedWord_adjust {{{ */
let s_touchedWord_adjust = function(range)
{
/*{{{*/
let   caller = "s_touchedWord_adjust";
let log_this = LOG_MAP.S1_RANGE;

/*}}}*/
    /* 1/3 - EXPANDED TO EMBEDDING-CONTAINERS {{{*/
    let node = range.startContainer ? range.startContainer : range.offsetNode;
    let text = strip_CR_LF(node.textContent);
    if(    (text.length > 0)
       &&  !prop_get(WORDS_EXACT  )
       &&  !prop_get(WORDS_SEGMENT)
       &&  s_touchedWord_adjust_1_in_embedding_container(range)
      ) {
if(log_this) log("...EXPANDED TO EMBEDDING-CONTAINERS %c["+ strip_CR_LF(range.toString()) +"]", lb6);
        return range;
    }
    /*}}}*/
    /* 2/3 - EXPANDED TO SELECTION-RANGE {{{*/
    if(s_touchedWord_adjust_2_in_selection(range)) {
        if( prop_get(WORDS_EXACT) ) {
/*{{{
if(log_this) log("%c *** WORDS_EXACT OPTION SELECTED ... CANNOT BE EXPANDED TO SELECTION-RANGE *** ", lbF+lb3);
            s_selection_add_cannot_expand();
            return null;
}}}*/
            t_override_USER_OPTION(WORDS_EXACT    , false);
            t_override_USER_OPTION(WORDS_HEAD_TAIL, false);
            t_override_USER_OPTION(WORDS_SEGMENT  ,  true);
        }
if(log_this) log("...EXPANDED TO SELECTION-RANGE %c["+strip_CR_LF(range.toString())+"]", lb5);
        return range;
    }
     /*}}}*/
    /* 3/3 - GOT WORD FROM SYNTAXIC LOOKUP {{{*/
    let word_range = s_touchedWord_adjust_3_word_syntaxic_lookup(range);
    if( word_range )
    {
if(log_this) log("...GOT WORD FROM SYNTAXIC LOOKUP %c["+strip_CR_LF(word_range.toString())+"]", lb5);
        return word_range;
    }
    /*}}}*/
if(log_this) log("... GOT NO WORD FROM SYNTAXIC LOOKUP %c["+strip_CR_LF(range.toString())+"]", lb5);
    return null;
};
/* }}}*/
/*_ s_touchedWord_adjust_1_in_embedding_container {{{*/
let s_touchedWord_adjust_1_in_embedding_container = function(range)
{
/*{{{*/
let   caller = "s_touchedWord_adjust_1_in_embedding_container";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) console_dir(range, caller+"(range)");
/*}}}*/
    /* INLINING CONTAINER {{{*/
    let node          = range.startContainer ? range.startContainer : range.offsetNode;
    let node_parent   = node.parentNode;
    let node_before   = node.previousSibling;
    let node_after    = node.nextSibling;
    let node_longword = (node_parent.textContent.length > S_TOUCHED_WORD_LENGTH_MAX);
    let node_inline
        =  (node_parent.tagName == "A"     )
        || (node_parent.tagName == "CITE"  )
        || (node_parent.tagName == "CODE"  )
        || (node_parent.tagName == "EM"    )
        || (node_parent.tagName == "I"     )
        || (node_parent.tagName == "LABEL" )
        || (node_parent.tagName == "SMALL" )
        || (node_parent.tagName == "SPAN"  )
        || (node_parent.tagName == "SUP"   )
        || (node_parent.tagName == "U"     )
        || (node_parent.tagName == "VAR"   )
    ;

if( log_this) { /*{{{*/
    log_key_val( caller
                 , {   node          : node
                     , node_parent   : node_parent
                     , node_before   : node_before
                     , node_after    : node_after
                     , node_longword : node_longword ? "node_longword ("+node_parent.textContent.length+" > "+S_TOUCHED_WORD_LENGTH_MAX+")" : false
                     , node_inline   : node_inline +" ("+node_parent.tagName+")"
                 }
                 , lf1
               );
}
/*}}}*/
    /*}}}*/
    /* RETURN FALSE .. RANGE UNCHANGED {{{*/
    let rejected_by = "";
    if     ( !node_parent   ) rejected_by = "!node_parent";
    else if( !node_inline   ) rejected_by = "!node_inline ("+node_parent.tagName+")";
    else if(  node_longword ) rejected_by = "node_longword xtContent.length > "+S_TOUCHED_WORD_LENGTH_MAX+")";
/* else if((!node_before && !node_after)  ) rejected_by = "(!node_before && !node_after)"; */

    if(rejected_by) {
if(log_this) log(caller+": %c "+ rejected_by, lb6);
        return false;
    }
    /*}}}*/
    /* RETURN TRUE: .. RANGE EXPANDED {{{*/
    if( node_inline)
    {
        let text = strip_CR_LF(node.textContent);
        let    s = range.startOffset;
        let    e = range.  endOffset;

/*{{{*/
if(log_this) {
    log(caller+": s=["+s+"] e=["+e+"] "+ node_toString(node));
    log("...%c node_parent=["+get_n_lbl(node_parent)+"]", lb7); if(node_parent) console.dir(node_parent);
    log("...%c node_before=["+get_n_lbl(node_before)+"]", lb3); if(node_before) console.dir(node_before);
    log("...%c text.......=["+text+"]"                         , lb4);
    log("...%c node_after.=["+get_n_lbl(node_after  )+"]", lb5); if(node_after ) console.dir(node_after);
    log("___length=["+node.data.length+"]");
    log("___[123456789_1234567890]");
    log("___["+node.data+"]");
}
/*}}}*/

            range.setStart(node, 0);
            range.setEnd  (node, text.length);

            /* TRIM LEADING spaces {{{*/
            while(range.toString().startsWith(" ") || range.toString().startsWith("\t")) { range.setStart(node, range.startOffset+1); range.setEnd  (node, range.  endOffset+1); }
            while(range.toString().  endsWith(" ") || range.toString().  endsWith("\t")) {                                            range.setEnd  (node, range.  endOffset-1); }
            /*}}}*/

            /* TRIM SURROUNDING BRACKETS {{{*/
            if((text[0] == "[") && (text[text.length-1] == "]"))
            {
if(log_this) log("...TRIM SURROUNDING BRACKETS %c["+ strip_CR_LF(range.toString()) +"]", lb6);
                range.setStart(node, 1);
                range.setEnd  (node, text.length-1);
            }
            /*}}}*/

/*{{{*/
if(log_this) {
    log("...........................range=%c["+strip_CR_LF( range.toString() ) +"]", lb6);
    log_range(range,caller);
}
/*}}}*/
    }
    return true;
    /*}}}*/
};
/*}}}*/

/*_ s_touchedWord_adjust_2_in_selection {{{*/
let s_touchedWord_adjust_2_in_selection = function(range)
{
    /* RETURN FALSE .. NO CURRENT SELECTION OR NO RANGE */
    /*{{{*/
let   caller = "s_touchedWord_adjust_2_in_selection";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller+": onDown_SEL_TEXT=["+onDown_SEL_TEXT+"]");

    let rejected_by = "";
    if((typeof onDown_SELECTION) == "undefined"                         ) rejected_by = "onDown_SELECTION...............: NOT DEFINED";
    else if(  !onDown_SELECTION                                         ) rejected_by = "onDown_SELECTION...............: NONE";
    else if(  !onDown_SELECTION.anchorNode                              ) rejected_by = "onDown_SELECTION.anchorNode....: NONE";
    else if(  !onDown_SELECTION.focusNode                               ) rejected_by = "onDown_SELECTION.focusNode.....: NONE";
    else if(   onDown_SELECTION.anchorNode != onDown_SELECTION.focusNode) rejected_by = "onDown_SELECTION...............: MULTI-NODE-SELECTION";
    else if(   onDown_SELECTION.isCollapsed                             ) rejected_by = "onDown_SELECTION...............: isCollapsed";
    else if(  !range                                                    ) rejected_by = "range........................... NO range";
    else if(  !range.startContainer                                     ) rejected_by = "range.startContainer...........: NO startContainer";
    else if( !(onDown_SELECTION.containsNode(range.startContainer,true))) rejected_by = "onDown_SELECTION.containsNode(): OUT OF SELECTION";

    if(rejected_by)
    {
if(log_this) log(caller+": %c "+ rejected_by, lb5);
        return false;
    }
    /*}}}*/

    /* TRUE .. [focusNode] CONTAINS [startContainer] */
    /*{{{*/
/*{{{
if(log_this) {
    log("...focusNode.....: %c["+ strip_CR_LF(onDown_SELECTION     .focusNode.textContent) +"]", lb4);
    log("...startContainer: %c["+ strip_CR_LF(           range.startContainer.textContent) +"]", lb5);
}
}}}*/
/* comparePoint {{{*/
/*
if(log_this) log("...range.comparePoint( onDown_SELECTION.focusNode     ,0)=["+ range.comparePoint( onDown_SELECTION.focusNode     ,0) +"]");
if(log_this) log("...range.comparePoint(            range.startContainer,0)=["+ range.comparePoint(            range.startContainer,0) +"]");
*/
/*}}}*/
    /* EXPAND TO SELECTION {{{*/
    let node = range.startContainer;
/*{{{
if(log_this) {
    log(caller+": EXPAND TO SELECTION:");
    log("...onDown_SELECTION.anchorOffset=%c["+ onDown_SELECTION.anchorOffset   +"]", lb4);
    log("...onDown_SELECTION.focusOffset.=%c["+ onDown_SELECTION.focusOffset    +"]", lb5);
    log("............................node=%c["+ strip_CR_LF(  node.textContent) +"]", lb6);
    log("...........................range=%c["+ strip_CR_LF( range.toString() ) +"]", lb6);
    log_range(range,caller);
}
}}}*/
    if(onDown_SELECTION.anchorOffset < onDown_SELECTION.focusOffset)
    {
        range.setStart(node, onDown_SELECTION.anchorOffset);
        range.setEnd  (node, onDown_SELECTION.focusOffset );
    } else {
        range.setStart(node, onDown_SELECTION.focusOffset );
        range.setEnd  (node, onDown_SELECTION.anchorOffset);
    }

    /* ADJUST TO WORD START-END {{{*/
    /* s_touchedWord_adjust_2_in_selection_word_bounds(range); */

    /*}}}*/
/*{{{
if(log_this) {
    log("...........................range=%c["+strip_CR_LF( range.toString() ) +"]", lb6);
    log_range(range,caller);
}
}}}*/
    /*}}}*/
    return true;
    /*}}}*/

};
/*}}}*/
/*_ s_touchedWord_adjust_2_in_selection_word_bounds {{{*/
let s_touchedWord_adjust_2_in_selection_word_bounds = function(range)
{
let   caller = "s_touchedWord_adjust_2_in_selection";
let log_this = LOG_MAP.S1_RANGE;

    if(!prop_get(WORDS_SEGMENT) )
    {
if(log_this)
        log(caller+": ADJUSTING TO WORDS BOUNDARIES");

        let node = range.startContainer;
        let t = node.textContent ;
if(log_this) log(".......t=%c["+ strip_CR_LF(escape_CR_LF(t)) +"]", lb3);
if(log_this) log("...range=%c["+ range.toString()             +"]", lb3);

        let s = range.startOffset+1;
        let e = range.endOffset;
        let l = t.length;

        while((s <= l) && !isAlNum( t.charAt(s-1) )         ) s += 1; /* skip leading blanks */
        while((s >= 1) &&  isAlNum( t.charAt(s-1) )         ) s -= 1; /* fore to first-word  left-boundary */
        if(               !isAlNum( t.charAt(s-1) )         ) s += 1; /* back to first-word first-char */

        while((e >= s) && !isAlNum( t.charAt(e-1) )         ) e -= 1; /* skip trailing blanks */
        while(             isAlNum( t.charAt(e) ) && (e < l)) e += 1; /* fore to last-word last-char */

        s = Math.min(s,l);
if(log_this) log("...l=["+l+"] .. s=["+s+"]=[%c"+ t.charAt(s-1) +"%c] .. e=["+e+"]=[%c"+ t.charAt(e-1) +"%c]", lb1+lbF,lbA , lb2+lbF,lbA);

        range.setStart(node, s-1);
        range.setEnd  (node, e  );

if(log_this) log("...range=%c["+ range.toString() +"]", lb3);
    }
};
/*}}}*/
/*_ s_touchedWord_adjust_3_word_syntaxic_lookup {{{*/
let s_touchedWord_adjust_3_word_syntaxic_lookup = function(range)
{
    /* WORD SEARCH LOOP {{{*/
let   caller = "s_touchedWord_word_syntaxic_lookup";
let log_this = LOG_MAP.S1_RANGE;

    let node = range.startContainer ? range.startContainer : range.offsetNode;
    let    s = range.startOffset   ;
    let    e = range. endOffset    ;
    let  tse = {s:0, e:0, t:""};

    for(let loop_num = 0; node != null; ++loop_num)
    {
        /* TERMINATE SEARCH WHEN LOG IS FULL {{{*/
        if(log_is_full) {
            log();
            break;
        }
        /*}}}*/
        /* LOOK FOR CLOSEST TEXT NODE .. (current or previous) {{{*/
        /* SEARCH PREVIOUS TEXT NODE */
        if(    (node.nodeType != Node.TEXT_NODE) /* .. (not a text_node) */
            || (loop_num > 0)                    /* .. (word not found ) */
        ) {
            node = range_setStart_at_end_of_previous_text_node( range );
            if(node == null)
            {
if(log_this) log("...got nothing from range_setStart_at_end_of_previous_text_node");
                break;
            }

if(log_this) {
    if(range.startContainer) log("___.........range.startContainer.=["+  range.startContainer.textContent +"]");
    if(range.offsetNode    ) log("___.........range.....offsetNode.=["+  range.offsetNode                 +"]");
    log("___.node.........................=["+  node.textContent                 +"]");
    if(range.startContainer) log("___(node == range.startContainer)=["+ (node == range.startContainer)    +"]");
    if(range.offsetNode    ) log("___(node == range.....offsetNode)=["+ (node == range.offsetNode    )    +"]");
}
/*{{{
}}}*/

            s = range.startOffset   ;
            e = range. endOffset    ;
        }
        /* }}}*/
        /* RANGE start boundary NODE text {{{*/
        let text =  node.textContent;
        let l    =  node.textContent.length;

        /*}}}*/
        /* WORD START-END {{{*/
        tse.t = text;
        tse.s = s;
        tse.e = e;
        get_word_start_end( tse );
        s = tse.s;
        e = tse.e;
if(log_this) {
    log("...get_word_start_end: s=["+s+"]=["+strip_CR_LF(escape_CR_LF(text.charAt(s-1)))+"] e=["+e+"]=["+text.charAt(e-1)+"]");
    log("<em>"+ mPadStart(""+ loop_num,3," ")
    + " s=["+s+"]=["+ text.charAt(s-1)            +"]"
    + " e=["+e+"]=["+ text.charAt(e-1)            +"]"
    + " l=["+l+"]=["+ trim_node_textContent(node) +"]</em>");
}
        /*}}}*/
        /* WORD NOT FOUND .. CONTINUE {{{*/
        if(e <= s) {
if(log_this) log("%c WORD NOT FOUND", lb3);

        }
        /*}}}*/
        /* WORD FOUND .. BREAK {{{*/
        else {
if(log_this) log("%c WORD FOUND: <em>"+text.substring(s-1, e)+"</em>", lb4);

            break;
        }
        /*}}}*/
    }
    /*}}}*/
    /* RETURN FALSE: WORD NOT FOUND {{{*/
    if( !node ) {

if(log_this) log("%c FOUND NO TEXT NODE", lb2);
        return null;
    }
    /*}}}*/
    /* RETURN TRUE: WORD AS A TEXT RANGE {{{*/
    range.setStart(node, s);
    range.setEnd  (node, e);
    if(tse.drop) range.drop = tse.drop;

    let word = range.toString();
if(log_this) log("SELECTED WORD s=["+s+"] e=["+e+"] l=["+word.length+"] word: <em>"+word+"</em> FROM: <em>"+ truncate(trim_node_textContent(node)) +"</em>");
    return range;
    /*}}}*/
};
/*}}}*/
/*}}}*/
/* WORD {{{*/
/*_ get_word_at_offset {{{*/
let get_word_at_offset = function(text, offset)
{
    let tse = { s:offset, e:offset, t:text };

    get_word_start_end(tse);

    return text.substring(tse.s, tse.e);
};
/*}}}*/
/*_ get_word_start_end {{{*/
let get_word_start_end = function(tse)
{
    /* ..........................10........20........30  */
    /* ................. 123456789_123456789_123456789_  */
    let t = tse.t;
    let s = tse.s;
    let e = tse.e;
    let l = tse.t.length;

    if(s>l) s = l;
    if(s<1) s = 1;

    while((s >= 1) && !isAlNum( t.charAt(s-1) )) s -= 1;
    while((s <= l) && !isAlNum( t.charAt(s-1) )) s += 1;
    while((s >= 1) &&  isAlNum( t.charAt(s-1) )) s -= 1;

    e = s;
    while( isAlNum( t.charAt(e) ) && (e < l)) e += 1;

    tse.s = s;
    tse.e = e;

    get_word_end_up_to_dropped_suffix(tse);
};
/*}}}*/
/*_ get_word_end_up_to_dropped_suffix {{{*/
/*{{{*/

/*}}}*/
let get_word_end_up_to_dropped_suffix = function(tse)
{
/*{{{*/
let    word = tse.t.substring(tse.s, tse.e).toLowerCase();
let  caller = "get_word_end_up_to_dropped_suffix("+word+")";
let log_this = LOG_MAP.S1_RANGE;

if(log_this) logXXX(caller);

    let len = tse.e - tse.s;
    let suffix, must_not_end_with, drop_checked, min_len;
/*}}}*/
/* FACTORIZATION OF AN UNDECIDED NUMBER OF SUFFIXES: {{{
    - property name would start with "words_drop_"
    - new suffix would be added to the end to guess the name of the correponding option the user can check
    ...an attempt to deal with doubled consonants (WIP):
    // {{{ C:/LOCAL/USR/ivan/DICT/linux.words

            e -= (word.endsWith("tting") ? 4
               : (word.endsWith("ssing") ? 4
               : (word.endsWith("ssing") ? 4
            ;
    bbing
    dding
    eeing
    ffing
    gging
    lling
    mming
    nning
    ooing
    pping
    rring
    ssing
    tting
    zzing

    //}}}
}}}*/
    for(let i = 0; i  < WORDS_SUFFIXES.length; ++i) {
        suffix        = WORDS_SUFFIXES[i];
        let prop_name ="words_drop_"+suffix;

        if(!prop_get(prop_name) ) /* whether the user has checked the option to drop this suffix */
        {
if(log_this) log(   "!prop_get("+prop_name+")");
            continue
        }

        min_len           = WORDS_SUFFIXE_MIN_LEN  [suffix] || suffix.length;
        must_not_end_with = WORDS_MUST_NOT_END_WITH[suffix];
        if(   (len >= min_len)
           &&  word.endsWith( suffix )
           && (!must_not_end_with || !word.endsWith(must_not_end_with)) /* .. OK, it does not! */
          ) {
            tse.drop = suffix;
            tse.e   -= suffix.length;
            break;
        }
    }
if(log_this && tse.drop) {
    log("..............suffix=["+ suffix            +"]");
    log(".............min_len=["+ min_len           +"]");
    log("...must_not_end_with=["+ must_not_end_with +"]");
}
if( log_this)
    log("%c"+caller+"%c return ["+tse.t.substring(tse.s, tse.e)+"] %c"+(tse.drop ? " .. drop=["+tse.drop+"]" : "")
       , lbH        ,lbH+lf4                                      ,lbH+lf3                                        );
};
/*}}}*/
/*_ clearSelection {{{ */
let clearSelection = function()
{
    let caller = "clearSelection"; if(LOG_MAP.S1_RANGE) log(caller);
    try {
        window.getSelection().removeAllRanges(); /* REMOVE any [current window selection]*/
    }
    catch(ex) { log(caller+": "+ex, "error"); }
};
/*}}}*/
/*_ range_setStart_at_end_of_previous_text_node {{{ */
let range_setStart_at_end_of_previous_text_node = function(range)
{
    /* GET PREVIOUS TEXT NODE {{{*/
let log_this = LOG_MAP.S1_RANGE;
    let caller = "range_setStart_at_end_of_previous_text_node"; if(log_this) log(caller);

    let node = getPreviousTextNode(range.startContainer ? range.startContainer : range.offsetNode);
    /*}}}*/
    /* AND COLLAPSE RANGE AT THE END {{{*/
    if(node && node.nodeValue)
    {
        let s = node.nodeValue.length;
        let e = s;
        range.setStart(node, s);
        range.setEnd  (node, e);
    }
    /*}}}*/
if(log_this) log(caller+": %c PREVIOUS-TEXT-NODE=["+ node_toString(node) +"]", lbF+lb6);
    return node;
};
/*}}}*/
/*_ getPreviousTextNode {{{ */
let getPreviousTextNode = function(node)
{
    /* CALLER {{{*/
let log_this = LOG_MAP.S1_RANGE;
    let caller = "getPreviousTextNode"; if(log_this) log(caller);

if(log_this) log("...node="+ node_toString(node));
    /*}}}*/

    let previousNode = null;
    try {

        /* TreeWalker root .. (look for a parent having more than this single text-typed child) {{{*/
        let   root = null;
        for(  root  = node.parentNode
            ;(root != null) && (root.children.length < 2)
            ; root  = root.parentNode
        ) {
if(log_this) log("...root="+ node_toString( root ));
        }
        if(root == null)
        {
if(log_this) log("getPreviousTextNode: ...return null");
            return null;
        }

if(log_this) log("SEARCHING ROOT: "+ node_toString(root));
        /*}}}*/

        /* TreeWalker {{{*/
        let mTreeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, mNodeFilter_function);
        mNodeRegexP     = null;

        if(log_this) {
            let root = mTreeWalker.root;
            log("...mTreeWalker.root: "+                          node_toString( mTreeWalker.root ) );
            log("....root.parentNode: "+ (!root.parentNode ? "" : node_toString( root.parentNode  )));
            log("....root.firstChild: "+ (!root.firstChild ? "" : node_toString( root.firstChild  )));
            log("....root. lastChild: "+ (!root. lastChild ? "" : node_toString( root. lastChild  )));
        }
        /*}}}*/

        /* SEEK TO REFERENCE NODE {{{*/
        while(mTreeWalker.nextNode())
        {
            if(node == mTreeWalker.currentNode)
            {
                if(log_this) {
                    log("REACHED REFERENCE NODE");
                    log("|..mTreeWalker.currentNode.............:"+ ( mTreeWalker.currentNode                                                ));
                    log("|..mTreeWalker.currentNode.nodeValue...:"+ (!mTreeWalker.currentNode ? "" : mTreeWalker.currentNode.nodeValue       ));
                    log("|==mTreeWalker.currentNode.textContent=["+ (!mTreeWalker.currentNode ? "" : mTreeWalker.currentNode.textContent +"]"));
                }
                break;
            }
        }
        /*}}}*/

        /* RETURN PREVIOUS NODE {{{*/
        do {
            previousNode = mTreeWalker.previousNode();
            if(log_this) {
                log("mTreeWalker.previousNode():");
                log("|..previousNode.............:"+ ( previousNode                                     ));
                log("|..previousNode.nodeValue...:"+ (!previousNode ? "" : previousNode.nodeValue       ));
                log("|==previousNode.textContent=["+ (!previousNode ? "" : previousNode.textContent +"]"));
            }
        }
        while( ( previousNode != null)
            && (!previousNode.nodeValue || (trim_empty_lines(previousNode.textContent).length < 1))
        );

        /*}}}*/

    }
    catch(ex) { log(caller+": "+ex, "warn"); }

    /* RETURN NODE {{{*/
    if(log_this) {
        if(previousNode) log("getPreviousTextNode: ...return "+node_toString(previousNode));
        else             log("getPreviousTextNode: ...return null");
    }
    return previousNode;
    /*}}}*/
};
/*}}}*/
/*_ pattern_toHTML {{{*/
let pattern_toHTML = function(pattern, options) {

    let words_class
        = (options == WORDS_EXACT  ) ? WORDS_EXACT
        : (options == WORDS_SEGMENT) ? WORDS_SEGMENT
        :                              WORDS_HEAD_TAIL
    ;

    switch(options)
    {
/*
        default:
        case WORDS_EXACT    : return "<em title='EXACT WORD'   class='cc7'>"+       "("+ pattern +")"     +"</em>";
        case WORDS_SEGMENT  : return "<em title='WORD SEGMENT' class='cc7'>"+       "["+ pattern +"]"     +"</em>";
        case WORDS_HEAD_TAIL: return "<em title='HEAD & TAIL'  class='cc7'>"+ SYMBOL_R + pattern +SYMBOL_L+"</em>";
*/

        case WORDS_EXACT    : return "<em title='EXACT WORD'   class='cc1 "+words_class+"'>"+ pattern +"</em>";
        case WORDS_SEGMENT  : return "<em title='WORD SEGMENT' class='cc1 "+words_class+"'>"+ pattern +"</em>";
        default:
        case WORDS_HEAD_TAIL: return "<em title='HEAD & TAIL'  class='cc1 "+words_class+"'>"+ pattern +"</em>";

    }
};
/*}}}*/
/*}}}*/

/** HIGHLIGHT */
/*{{{*/
/*_ scroll_to_slot_num {{{*/
let scroll_to_slot_num = function(slot, num, onSeekXYL)
{
    /*{{{*/
let caller = "scroll_to_slot_num(slot=["+slot+"] num=["+num+"], ["+onSeekXYL.x+" "+onSeekXYL.y+"])";
let log_this = LOG_MAP.S3_SLOT;
if( log_this ) log("%c"+caller, lbH+lf4);

    /*}}}*/
    /* [slot] {{{*/
    if(slot <= 0              ) return false;
    if(slot >  SELECT_SLOT_MAX) return false;

    if(!ccs[slot])              return false;

    let count = ccs[slot].nodes.length;
    if( count < 1)              return false;

    if(  num <=    0)           return false;
    if(  num > count)           return false;

if(log_this) log(".count=["+ count +"]");

    let thumb_p = parseFloat( ccs[slot].thumbs[num-1] );
    /*}}}*/
    /* LOG geometry slot num count {{{*/
    if(LOG_MAP.T3_LAYOUT)
    {
        let page_height = get_page_height();
        let body        = document.body;
        let html        = document.documentElement;
        let page_geometry = ""
            +"<table id='table_params'>"
            +" <tr class='slot'><TH class='cc8'>select</TH> <th>        slot</th><td class='cc"+slot+"'>"+ slot              +"</td> <th>         num</th><td class='cc"+(num % 10)+"'>"+ num               +"</td> <th>       count</th><td class='cc"+(count % 10)+"'>"+ count             +"</td></tr>"
            +" <tr             ><TH class='cc8'>HTML  </TH> <th>scrollHeight</th><td class='cc8'>"       + html.scrollHeight +"</td> <th>offsetHeight</th><td class='cc1'>"             + html.offsetHeight +"</td> <th>clientHeight</th><td class='cc2'>"               + html.clientHeight +"</td></tr>"
            +" <tr             ><TH class='cc8'>BODY  </TH> <th>scrollHeight</th><td class='cc8'>"       + body.scrollHeight +"</td> <th>offsetHeight</th><td class='cc3'>"             + body.offsetHeight +"</td> <th>clientHeight</th><td class='cc4'>"               + body.clientHeight +"</td></tr>"
            +" <tr             ><TH class='cc8'>window</TH> <th> page_height</th><td class='cc8'>"       + page_height       +"</td> <th>     thumb_p</th><td class='cc5'>"             + thumb_p           +"</td> <th>     scrollY</th><td class='cc6'>"               + scrollY           +"</td></tr>"
            +"</table"
        ;

        let info = ""
            +"<div class='info'>"
            +"<em class='cc8'>Scroll state</em><br>"
            +" <u>clientHeight</u> VIEWABLE +PADDING                    -border -scrollbar -margin<br>"
            +" <u>offsetHeight</u> VIEWABLE +PADDING +BORDER +SCROLLBAR                    -margin<br>"
            +" <u>scrollHeight</u> OVERFLOW +PADDING                    -border -scrollbar -margin<br>"
            +"</div>"
        ;

        log_set_TR_LAYOUT(page_geometry +"<br>"+ info);
    }
    else {
        if(log_this) {
            let   count = ccs[slot].nodes.length;
            let    body = document.body;
            let    html = document.documentElement;

            log("select         slot=["+ slot              +"]          num=["+ num               +"]        count=["+ count             +"]");
            log("HTML   scrollHeight=["+ html.scrollHeight +"] offsetHeight=["+ html.offsetHeight +"] clientHeight=["+ html.clientHeight +"]");
            log("BODY   scrollHeight=["+ body.scrollHeight +"] offsetHeight=["+ body.offsetHeight +"] clientHeight=["+ body.clientHeight +"]");
        }
    }
    /*}}}*/
    /* possibly hidden  .. f(hidden_parent) {{{*/
    let el                   = ccs[slot].nodes[num-1];
    let hidden_parent = get_el_parent_with_class(el, MARKED_TO_HIDE);
    if( hidden_parent )
    {
if(log_this) log("..hidden_parent: %c "+ get_n_lbl(hidden_parent), lbb+lbH+lf7);
    }
    else {
        let xy = t_scrollIntoViewIfNeeded_get_scrollXY_with_margin( el );
        if( xy )
        {
            let dx = (xy.x - window.scrollX);
            let dy = (xy.y - window.scrollY);
/*
logXXX("xy=["+dx+" "+dy+"]")
*/
            if(dx || dy)
                t_window_scrollTo(xy.x, xy.y);
        }
/*
        else
            scroll_thumb_p_to_onSeek_XY(thumb_p, slot, onSeekXYL);
*/
    }
    /*}}}*/

    highlight_thumb_p_slot_num(slot, num, thumb_p);
    if((thumb_p <= 0) || hidden_parent) return false;
    else                                return  true;
};
/*}}}*/
/*_ get_parent_with_overflow {{{ */
let get_parent_with_overflow = function(node)
{
    for(let  parent  = node
        ;    parent && parent.style
        ;    parent  = parent.parentNode
    ) {
        let computedStyle = window.getComputedStyle(parent);
        if( computedStyle.overflow && (computedStyle.overflow != "visible"))
        {
/*
*/
logXXX(get_n_lbl(parent)+" %c overflow ["+parent.style.overflow+"] %c COMPUTED ["+computedStyle.overflow+"]"
    ,                      lbL+lf6                                ,lbR+lf7);
            return parent;
        }
    }
    return null;
};
/*}}}*/
/*_ scroll_thumb_p_to_onSeek_XY {{{*/
let scroll_thumb_p_to_onSeek_XY = function(thumb_p, slot, onSeekXYL)
{
let   caller = "scroll_thumb_p_to_onSeek_XY(thumb_p=["+thumb_p+"], slot=["+slot+"], onSeekXYL["+onSeekXYL.x+" "+onSeekXYL.y+"])";
let log_this = LOG_MAP.S3_SLOT;
if( log_this ) log(caller);

    let page_height
        = get_page_height() * (body_zoom_percent / 100.0);

    let scrollX
        = window.scrollX
        - onSeekXYL.x;

    let scrollY
        = page_height * (thumb_p / 100.0)
        - onSeekXYL.y;

    try {
        t_window_scrollTo(scrollX, scrollY);
if(log_this) log("%c PAGE "+page_height+" %c thumb_p "+thumb_p+" %c scrollY "+Math.floor(scrollY)+" "
    ,             lbL+lf9                ,lbC+lf6                ,lbR+lf7);
    }
    catch(ex) {
        console.log(caller+": "+ex);
    }
};
/*
 TODO: sync last slot .. last num to last thumb_p
 TODO: or check window scrollY at next slot-selection-time
 TODO: option to choose between showing thumb_p-values -OR- dot-list
 TODO: swipe over dot-list to scroll forward or backward
*/
/*}}}*/

/*_ highlight_thumb_p_slot_num {{{*/
let last_highlight_thumb_p = 0;
let last_highlight_slot    =-1;
let last_highlight_num     = 0;
let highlight_thumb_p_slot_num = function(slot, num, thumb_p)
{
    let caller = "highlight_thumb_p_slot_num(slot=["+slot+"], num=["+num+"], thumb_p=["+thumb_p+"])";
if(LOG_MAP.S3_SLOT) log(caller);

    highlight_data_thumb_p(thumb_p, slot);

    if(ccs[slot]) set_tools_filter(ccs[slot].pattern);

    last_highlight_slot    = slot;
/*
logXXX("highlight_thumb_p_slot_num: last_highlight_slot=["+last_highlight_slot+"]")
*/
    last_highlight_num     = num;
    last_highlight_thumb_p = thumb_p;
};
/*}}}*/
let s_get_last_highlight_slot = function()
{
    return last_highlight_slot;
};
/*_ s_clear_last_highlight_slot {{{*/
let s_clear_last_highlight_slot = function()
{
    last_highlight_slot    = -1;
    last_highlight_num     = -1;
};
/*}}}*/
/*_ highlight_data_thumb_p {{{*/
let highlight_data_thumb_p = function(thumb_p, slot)
{
    /* text .. f(thumb_p) {{{*/
    let caller = "highlight_data_thumb_p(thumb_p=["+thumb_p+"] slot=["+ slot+"])";
    let log_this = LOG_MAP.S3_SLOT;
if(log_this) log(caller);
/*
console.warn(caller);
*/
    let el;
    let text                     = String(       thumb_p );
    if(               thumb_p < 10) text  = " "+ text     ;
    if     (text.indexOf(".") <  0) text +=          ".00";
    else if(text.length       <  5) text +=            "0";
if(log_this) log(" text=["+text+"]");

    /*}}}*/
    /* unhighlight all [data-thumb_p] {{{*/
    let doc = (shadow_root) ? shadow_root : document;
    let data_selector = "[data-thumb_p]";
    let elements = doc.querySelectorAll( data_selector );
if(log_this) log(" "+ elements.length+" "+data_selector);
    for(let i=0; i < elements.length; ++i)
        del_el_class(elements[i], "current_slot_num");

    /*}}}*/
    /* unhighlight [selbag div] [ellipsis em] {{{*/
    for(let s=0; s < SELECT_SLOT_MAX; ++s)
    {
        let id;
        id = ".select"  +s    ; if(el = get_tool(id)) { if(s == slot) add_el_class(el,"current_slot"); else del_el_class(el,"current_slot"); }
        id = "thumb_p_"+s+"_0"; if(el = get_tool(id)) { if(!(el.innerHTML.includes(SYMBOL_E))) el.innerText = SYMBOL_E; }
        id = "thumb_s_"+s+"_0"; if(el = get_tool(id)) { if(!(el.innerHTML.includes(SYMBOL_E))) el.innerText = SYMBOL_E; }
    }

    /*}}}*/
    /*   highlight   [data-thumb_p=   text   ] .. (both thumb_p and thumb_s) {{{*/
    data_selector = "[data-thumb_p='"+text+"']";
    elements = doc.querySelectorAll( data_selector );
if(log_this) log(" "+ elements.length+" "+data_selector);
    for(let i=0; i < elements.length; ++i) {
        add_el_class(elements[i], "current_slot_num");
    }

    /*}}}*/
    /* highlight ellipsis (fall back) {{{*/
    for(let slot = 1; slot < ccs.length; ++slot)
    {
        if(!ccs[slot]) continue;

        /* ? has thumb_p */
        for(let num = 1; num <= ccs[slot].thumbs.length; ++num)
        {
            let p  = parseFloat(ccs[slot].thumbs[num-1]);
            if( p == thumb_p)
            {
                /* ? [slot_num_id] */
                let slot_num_id = "thumb_p_"+ slot +"_"+ num;
                if( !get_tool(slot_num_id) )
                {
                    /* SEL_BAG */
                    let id = "thumb_p_"+slot+"_0";
                    if( el = get_tool( id ))
                    {
if(log_this) log(".HIGHLIGHT: id=["+id+"]");
                        el.innerText = String(num);
                        add_el_class(el, "current_slot_num");
                    }

                    /* SEEKER */
                    id = "thumb_s_"+slot+"_0";
                    if( el = get_tool( id ))
                    {
if(log_this) log(".HIGHLIGHT: id=["+id+"]");
                        el.innerText = String(num);
                        add_el_class(el, "current_slot_num");
                    }
                }
                else {
if(log_this) log(".DEDICATED SLOT TOOL HIGHLIGHTED: slot_num_id=["+slot_num_id+"]");
                }
                break;
            }
        }
    }
    /*}}}*/
};
/*}}}*/
/*_ s_clear_slot_all {{{ */
let s_clear_slot_all = function()
{
    let caller = "s_clear_slot_all";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.S3_SLOT;

    let cleared_count   = 0;
    let cleared_pat_csv = "";

    for(let slot = 1; slot < ccs.length; ++slot)
    {
        let       pattern    = ccs[slot] ? ccs[slot].pattern : "";

        let clear_slot_count = clear_slot( slot );

        if( clear_slot_count && pattern)
            cleared_pat_csv  = csv_add(cleared_pat_csv, pattern);

        cleared_count       += clear_slot_count;
    }

if(log_this) log(caller+": "+cleared_count+" words highlighting cleared");
    return cleared_pat_csv;
};
/*}}}*/

/*_ s_selection_execCommand {{{ */
let s_selection_execCommand = function(cmd_csv)
{
    let caller = "s_selection_execCommand("+cmd_csv+")";
if(LOG_MAP.S3_SLOT) log(caller);

    document.designMode = "on";
    try {
        if(cmd_csv.indexOf("undo"         ) >= 0) document.execCommand("undo"                , false, null           );

        if(cmd_csv.indexOf("foreColor"    ) >= 0) document.execCommand("foreColor"           , false, "#FF0000"      );
        if(cmd_csv.indexOf("backColor"    ) >= 0) document.execCommand("backColor"           , false, "#00AADD"      );
        if(cmd_csv.indexOf("hiliteColor"  ) >= 0) document.execCommand("hiliteColor"         , false, "pink"         );

        if(cmd_csv.indexOf("bold"         ) >= 0) document.execCommand("bold"                , false, null           );
        if(cmd_csv.indexOf("fontName"     ) >= 0) document.execCommand("fontName"            , false, "Comic sans ms");
        if(cmd_csv.indexOf("fontSize"     ) >= 0) document.execCommand("fontSize"            , false, "400%"         );

        if(cmd_csv.indexOf("strikeThrough") >= 0) document.execCommand("strikeThrough"       , false, null           );
    }
    catch(ex) { log(caller+": "+ex, "error"); }
    document.designMode = "off";

};
/*}}}*/
/*_ s_selection_add_cannot_expand {{{*/
const CANNOT_EXPAND_TO_SELECTION = "cannot_expand_to_selection";
let s_selection_add_cannot_expand = function()
{
log("s_selection_add_cannot_expand");
    s_selection_execCommand("hiliteColor");
    add_el_class(document.body, CANNOT_EXPAND_TO_SELECTION);
};
/*}}}*/
/*_ s_selection_del_cannot_expand {{{*/
let s_selection_del_cannot_expand = function()
{
log("s_selection_del_cannot_expand");
    del_el_class(document.body, CANNOT_EXPAND_TO_SELECTION);
};
/*}}}*/

/*_ get_slot_num_for_thumb_p {{{*/
let get_slot_num_for_thumb_p = function(slot, thumb_p, backward)
{
    let caller = "get_slot_num_for_thumb_p(slot=["+slot+"], thumb_p=["+thumb_p+"], backward=["+backward+"])";
let log_this = LOG_MAP.S3_SLOT;
if( log_this) log(caller);

    if( !ccs[slot] ) {
if( log_this) log(caller+": SLOT "+ slot +" is empty");
        return 0;
    }
    let num_at_or_past_thumb_p = 0;

    let first = 1;
    let  last = ccs[slot].nodes.length;
    let   num = 0;

    if(!backward) {
        for(num    = first; num <= last; num += 1) {
            let p  = parseFloat( ccs[slot].thumbs[num-1] );
            if( p <= thumb_p) num_at_or_past_thumb_p = num;
            if( p >  thumb_p) break;
        }
    }
    else {
        for(num    = last; num >= first; num -= 1) {
            let p  = parseFloat( ccs[slot].thumbs[num-1] );
            if( p >= thumb_p) num_at_or_past_thumb_p = num;
            if( p <  thumb_p) break;
        }
    }

    if((num < first) || (num > last))
        num_at_or_past_thumb_p = 0;

if( log_this) log(caller+": return "+ num_at_or_past_thumb_p);

    return num_at_or_past_thumb_p;
};
/*}}}*/

/*}}}*/

/** RANGE */
/*{{{*/
/*_ get_range_from_XY {{{ */
let get_range_from_XY = function(x, y)
{
    /*{{{*/
    let caller = "get_range_from_XY";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller+"(x="+x+" , y="+y+")");
if( log_this) log("<div class='div_match'>");
    /*}}}*/
    let       range = get_range_from_caret(x,y);
    let not_a_range = (range && !range.setStart); /* !range.setStart (i.e. Firefox) */
    if( not_a_range )
    {
/*{{{*/
if(log_this) {
    console.dir(range);
    log("..!range.setStart .. CREATING RANGE:");
    log("...range.offsetNode....=["+ get_n_txt(range.offsetNode) +"]");
    log("...range.offset........=["+ range.offset     +"]");
}
/*}}}*/
        let new_range = document.createRange();
        new_range.setStart(range.offsetNode, range.offset);
        range = new_range;
    }
/* log {{{*/
if(log_this) {
    if(range) {
        log( rangeToString(range) );
        console_dir(range);
    }
    else {
        log(caller+": ...return null", "warn");
    }
    log("</div>");
}
/*}}}*/
    return range;
};
/*}}}*/
/*_ get_range_from_caret {{{*/
let get_range_from_caret = function(x, y)
{
/*{{{*/
let   caller = "get_range_from_caret";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller+"(x="+x+" , y="+y+")");
/*}}}*/

    let  range = null;
    try {
        /* caretRangeFromPoint {{{*/
if(log_this) log("%c...document.caretRangeFromPoint...=["+ document.caretRangeFromPoint    +"]", lbH+lf4);
        if((!range || !range.commonAncestorContainer)   && document.caretRangeFromPoint)
        {
            range =  document.caretRangeFromPoint(x,y); /* within the current viewport */

/*{{{
if(!range || !range.commonAncestorContainer) log("caretRangeFromPoint failed");
}}}*/
        }
        /* }}}*/
        /* caretPositionFromPoint {{{*/
if(log_this) log("%c...document.caretPositionFromPoint=["+ document.caretPositionFromPoint +"]", lbH+lf3);
        if((!range || !range.commonAncestorContainer)   && document.caretPositionFromPoint)
        {
            range =  document.caretPositionFromPoint(x,y);

/*{{{
if(!range) log("caretPositionFromPoint failed");
}}}*/
        }
        /* }}}*/
    }
    catch(ex) { log(caller+": "+ex, "error"); }

if(log_this) log_range(range, caller);
    return range;
};
/*}}}*/
/*_ rangeToString {{{ */
let rangeToString = function(range, rangeName="RANGE")
{
    if(!range) return "<div>rangeToString(null range)</div>";

    let caller = "rangeToString";
    try {

        let range_str
            = range.toString();

        let range_attr
            = range.collapsed
            ?  "<span class='cc8'>collapsed at "+ range.startOffset                              +"</span>"
            :  "<span class='cc4'>offset "      + ellipsis(range.startOffset,32) +" .. "+ ellipsis(range.endOffset,32) +"</span> "
        ;

        let ancestor = "";
        if(range.commonAncestorContainer)
            ancestor =                         range.commonAncestorContainer.toString()          + " "
            +                                  get_n_attributes(range.commonAncestorContainer)   + " "
            +  range.commonAncestorContainer.length ? ""
            :                        "length=["+ range.commonAncestorContainer.length            +"] "
        ;

        let container_node = range.startContainer ? range.startContainer : range.offsetNode;

        let container;
        container = "";
        if(container_node)
            container =                   container_node.toString()                              + " "
            +                   " nodeName=["+ container_node.nodeName                           +"] "
            +                     " length=["+ container_node.length                             +"] "
            +                                  get_n_attributes(container_node                 ) +"] "
            + !container_node.previousSibling ? ""
            :             "previousSibling: "+ get_n_attributes(container_node.previousSibling ) + " "
        ;

        let endContainer = "";
        if(range.endContainer)
            endContainer =                     range.  endContainer.toString()                   + " "
            +                   " nodeName=["+ range.  endContainer.nodeName                     +"] "
            +                     " length=["+ range.  endContainer.length                       +"] "
            +                                  get_n_attributes(range. endContainer            ) +"] "
            + !container_node.nextSibling ? ""
            :                 "nextSibling: "+ get_n_attributes(range. endContainer.nextSibling) + " "
        ;

        rangeName = "<span class='cc7'>"+rangeName+"</span>";
        range_str = "<div  class='ng'>"+range_str+"</div>";

        container = "";
        if(range.commonAncestorContainer)
            container = node_toString( range.commonAncestorContainer.parentElement );

        return rangeName
            +  "<div class='div_match'>"
            +  " <div>container: "     + container    +"</div>"
            +  " <ul>"
            +  "  <li>"                + range_str    +"</li>"
            +  "  <li>"                + range_attr   +"</li>"
            +  "  <li>Ancestor: "      + ancestor     +"</li>"
            +  "  <li>Start: "         + container    +"</li>"
            +  "  <li>End: "           + endContainer +"</li>"
            +  " </ul>"
            +  "</div>"
        ;
    }
    catch(ex) { log(caller+"("+rangeName+"): "+ex, "error"); }
};
/*}}}*/
/*_ log_range {{{*/
let log_range = function(range, _caller="")
{
    if(!range) {
        log(_caller+": range=["+range+"]");
    }
    else if(range.collapsed) {
        log("%c"+_caller   +"%c"+range.startOffset+"%c"+trim_node_textContent(range.startContainer), lbL+lf8, lbC+lf3, lbR+lf3);
    }
    else {
        log("%c"+_caller    +"%c"+range.startOffset+"%c"+trim_node_textContent(range.startContainer), lbL+lf8, lbC+lf4, lbR+lf4);
        log("%c..endContainer %c"+range.  endOffset+"%c"+trim_node_textContent(range.  endContainer), lbL+lf8, lbC+lf5, lbR+lf5);
    }
};
/*}}}*/
/*}}}*/

/** CHECK */
/*{{{*/
/*{{{*/
let CHECK_LOG_MAX       =  64;

let TOO_MANY_SELECTIONS = 256;
/*
//let WORDS_EXACT         = "words_exact";
//let WORDS_SEGMENT       = "words_segment";
//let WORDS_HEAD_TAIL     = "words_head_tail";
//let WORDS_OPCYCLE       = "words_opcycle";
*/
let mNodeRegexP;
/*}}}*/
/*_ get_traversal_node_array {{{*/
let get_traversal_node_array = function(pattern, options, mDomTraversal)
{
/*{{{*/
let   caller = "get_traversal_node_array(pattern=["+pattern+"], "+options+")";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller);
if( log_this) log_tags();
/*}}}*/

    mNodeRegexP = get_mNodeRegexP(pattern, options);
if( log_this) log("mNodeRegexP........=["+mNodeRegexP        +"]");
    if(!mNodeRegexP) return null;

    mNodeRegexP.pattern =         pattern;
if( log_this)    log("mNodeRegexP.pattern=["+mNodeRegexP.pattern+"]");

    t_words_regex_log( mNodeRegexP.toString() );

    /* clear any to-be-reselected selection */
    let slot;
    if( slot = get_slot_matching_pattern( pattern ))
        clear_slot( slot );

    let node_array = [];
    let node;
    while(node = mDomTraversal.nextNode())
    {
        if( node_has_some_text(  node) ) {
/*
logXXX("___ node.textContent..................=["+                  node.textContent  +"]");
*/
            if(node_array.length >= TOO_MANY_SELECTIONS)
                break;
            node_array.push(node);
        }
        else {
if(log_this) {
log("XXX !node_has_some_text(node).........=["+ node_toString(node)                +"]");
log("XXX node.nodeValue....................=["+                  node.nodeValue    +"]");
log("XXX node.textContent..................=["+                  node.textContent  +"]");
log("XXX trim_alNum_lines(node.textContent)=["+ trim_alNum_lines(node.textContent) +"]");
}
/*
*/
        }
    }
if(log_this) log(caller+": return node_array.length=["+node_array.length+"]");
    return node_array;
};
/*}}}*/
/*_ get_mNodeRegexP {{{*/
let get_mNodeRegexP = function(pattern, options)
{
    let caller = "get_mNodeRegexP <em class='cc5'>"+pattern+"</em> <em class='cc6'>"+options+"</em>";
let log_this = LOG_MAP.S1_RANGE;

    let rx = null;
try {
    switch(options)
    {
        case WORDS_EXACT:
        rx = new RegExp("\\b("+pattern+")\\b", "gi");
        break;

        case WORDS_SEGMENT:
        rx = new RegExp(   "("+pattern+")"   , "gi");
        break;

        case WORDS_HEAD_TAIL:
        let s = pattern;
        if(!pattern.startsWith("\\S" ) ) s = "\\S*"+s       ;
        if(!pattern.endsWith  ("\\S*") ) s =        s+"\\S*";
        if( pattern != s) {
            pattern  = s;
            rx = new RegExp(   "("+pattern+")"   , "gi");
        }
        break;

        default:
if(log_this) log("<em class='cc2'>*** wrong options: ["+ options +"] ***</em>");
    }
} catch(ex) { log(caller+": "+ex, "error"); }
if(log_this) log(caller+": ...return <em class='cc7'>"+rx+"</em>");
    return rx;
};
/*}}}*/

/*_ check_Traversal {{{*/
/*{{{*/
let root_last_used_id;

/*}}}*/
let check_NodeIterator = function(           tag_or_id, pattern) { return check_Traversal("NodeIterator", tag_or_id, pattern); };
let check_TreeWalker   = function(           tag_or_id, pattern) { return check_Traversal("TreeWalker"  , tag_or_id, pattern); };
let check_Traversal    = function(traversal, tag_or_id, pattern)
{
/* {{{*/
let   caller = "check_traversal";
let log_this = LOG_MAP.S3_SLOT;

if(log_this) log("%c"+caller+" %c traversal=["+traversal+"] %c tag_or_id=["+tag_or_id+"] %c pattern=["+pattern+"]"
    ,             lbH         ,lbL                         ,lbC                         ,lbR                      );
if(log_this) log_add_TR_SELECT("<em class='cc3'>caller</em> traversal=<em class='cc3'>"+traversal+"</em> tag_or_id=<em class='cc4'>"+tag_or_id+"</em> pattern=<em class='cc6'>"+pattern+"</em>");
/*}}}*/
if( !check_wall_of_text_done) check_wall_of_text();
    /* pattern {{{*/
    if( !pattern ) {
        log("%c"+caller+" %c no pattern to look for", lbL, lbR+lf3);
        return;
    }

    /*}}}*/
    /* ROOT ID PERSISTENCE .. (unspecified tag_or_id fallback) {{{*/
    if(tag_or_id) {              root_last_used_id = tag_or_id; if(log_this) log("%c SET %c root_last_used_id = tag_or_id %c "+tag_or_id, lbL+lf5, lbC, lbR+lf5); }
    else          { tag_or_id  = root_last_used_id            ; if(log_this) log("%c GET %c tag_or_id = root_last_used_id %c "+tag_or_id, lbL+lf8, lbC, lbR+lf8); }

    /*}}}*/
    /* searched root {{{*/
    let root = pick_tag_or_id_node(tag_or_id, caller);

    let mDomTraversal
        = (traversal == "NodeIterator")
        ?  document.createNodeIterator(root, NodeFilter.SHOW_TEXT, mNodeFilter_function)
        :  document.createTreeWalker  (root, NodeFilter.SHOW_ALL , mNodeFilter_function);

if(log_this) log("<em class='cc3'>"+ object_label(mDomTraversal) +"</em> ID: <em class='cc4'>"+tag_or_id+"</em>");

    /*}}}*/
    /* pattern matching node_array {{{*/

    let options
        = prop_get(WORDS_EXACT  ) ? WORDS_EXACT
        : prop_get(WORDS_SEGMENT) ? WORDS_SEGMENT
        :                           WORDS_HEAD_TAIL
    ;
    let node_array = get_traversal_node_array(pattern, options, mDomTraversal);
/*{{{
    if((node_array.length < 1) && prop_get("words_opcycle"))
    {
        options = (options == WORDS_EXACT  ) ? WORDS_SEGMENT
            :     (options == WORDS_SEGMENT) ? WORDS_HEAD_TAIL
            :                                  WORDS_EXACT
        ;
        node_array  = get_traversal_node_array(pattern, options, mDomTraversal);

        if( node_array.length < 1)
        {
            options = (options == WORDS_EXACT  ) ? WORDS_SEGMENT
                :     (options == WORDS_SEGMENT) ? WORDS_HEAD_TAIL
                :                                  WORDS_EXACT
            ;
            node_array  = get_traversal_node_array(pattern, options, mDomTraversal);
        }
    }
}}}*/
    /*}}}*/
    if(!node_array)
    {
if(log_this) log_set_TR_RESULT();
        return;
    }
    /* collect matching nodes {{{*/

    if(    (node_array.length >= TOO_MANY_SELECTIONS)
        || (node_array.length == 0                  )
    ) {
        let sel_bag;
        if( sel_bag = get_tool("sel_bag"))
        {

            let msg = (node_array.length > 0)
                ? "*** TOO MANY: <em class='cc8'>"+pattern+"</em> .. (max "+TOO_MANY_SELECTIONS+") ***"
                : "--- NO MATCH: <em class='cc8'>"+pattern+"</em> ---"
            ;
            let el;
            if( el = get_tool("sel_bag_warn_div")) el.innerHTML= msg;
            else     sel_bag.innerHTML = "<div id='sel_bag_warn_div' class='cc2'>"+  msg +"</div><br>"
                +    sel_bag.innerHTML;
        }
if(log_this) log_set_TR_RESULT();
        return;
    }
    if(log_this) {
        let msg = ""
            +"<p><em class='cc8'>" + options                          +"</em>"
            +"<br><em class='cc7'>"+ pattern_toHTML(pattern, options) +"</em>"
            +"<br>"                + "has selected"
            +"<br><em>"            + node_array.length                +"</em> nodes"
            +"</p>"
        ;

        log("<div class='badge'>"+msg+"</div>");
    }

    s_touchedWord_slot  = get_free_slot();
    for(let i = 0; i < node_array.length; ++i)
    {
if(log_this) log("<em class='cc0' style='font-size:300%;'>"+(i+1)+"/"+node_array.length+"</em>");
        collect_node_matches_to_slot(s_touchedWord_slot, node_array[i], pattern, options);
    }

    /*}}}*/
if(log_this) log_set_TR_RESULT();
};
/*}}}*/

/*_ check_childNodes {{{*/
let check_childNodes = function(tag_or_id, pattern)
{
    /* [tag_or_id] {{{*/
    let caller = "<em class='cc3'>check_childNodes</em> tag_or_id=<em class='cc4'>"+tag_or_id+"</em> pattern=<em class='cc6'>"+pattern+"</em>";
let log_this = LOG_MAP.S1_RANGE;
if( log_this) log(caller);
if( log_this) log_set_TR_SELECT(caller);

    let root = pick_tag_or_id_node(tag_or_id, caller);
    if(!root) return;

if( log_this) log("<em class='cc3'>check_childNodes</em> <em class='cc4'>ID: "+tag_or_id+"</em> <em class='cc4'>pattern: "+pattern+"</em>");
if( log_this) log_tags();
if( log_this) log("mNodeRegexP=["+mNodeRegexP+"]");
    /*}}}*/
    /* [childNodes] {{{*/
    let node, last_node, count, empty_count=0;
    for(count = 0; count < root.childNodes.length; ++count)
    {
        node         = root.childNodes[count];
        last_node    = node;
        if(count < CHECK_LOG_MAX) check_log_num_thumb(count, node);
    }

    if( log_this && (count >= CHECK_LOG_MAX)) {
        log(mPadStart(" .../..."));
        log(mPadStart(" "+count,3," ") +  node_toString( last_node ));
    }
    if( log_this && (empty_count > 0)) log("...empty_count=["+empty_count+"]");
    /*}}}*/
};
/*}}}*/
/*_ check_tagNodes {{{*/
let check_tagNodes = function(tag, pattern)
{
    /* [tag] .. (getElementById or getElementsByTagName) {{{*/
    if(!tag) tag = "*";
    let caller = "<em class='cc3'>check_tagNodes</em> tag=<em class='cc4'>"+tag+"</em> pattern=<em class='cc5'>"+pattern+"</em>";
let log_this = LOG_MAP.S1_RANGE;
if(log_this) log(caller);
if(log_this) log_set_TR_SELECT(caller);

    /* ELEMENTS */
    let elements = document.getElementsByTagName(tag);
if(log_this) log(caller+" <em class='cc4'>"+elements.length+" "+tag+" elements</em>");

    if(!elements.length) {
        elements = document.querySelectorAll( tag );
if(log_this) log(".document.querySelectorAll("+tag+")=["+elements.length+"]");
    }

    /* FILTER */
    mNodeRegexP  = (pattern) ? new RegExp(pattern, "gi") : null;
if(log_this) log_tags();
if(log_this) log("mNodeRegexP=["+mNodeRegexP+"]");
    /*}}}*/
    /* [getElementsByTagName(tag)] {{{*/
    let node, last_node, count, empty_count=0;
    for(count = 0; count < elements.length; ++count)
    {
        node         = elements[count];
        last_node    = node;
        if(!mNodeRegexP || node.textContent.match(mNodeRegexP))
        {
            if(count < CHECK_LOG_MAX) check_log_num_thumb(count, node);
        }
    }

if(log_this && (count >= CHECK_LOG_MAX)) {
    log(mPadStart(" .../..."));
    log(mPadStart(" "+count,3," ") +  node_toString( last_node ));
}

if(log_this && (empty_count > 0)) log("...empty_count=["+empty_count+"]");
    /*}}}*/
};
/*}}}*/
/*_ check_hasFeature {{{ */
let check_hasFeature = function(feature, version)
{
    let caller = "<em class='cc3'>check_hasFeature</em> feature=<em class='cc4'>"+feature+"</em> version=<em class='cc5'>"+version+"</em>";
let log_this = LOG_MAP.S1_RANGE;
if( log_this) log(caller);

    let result = "";
    try {
        let input_feature = get_tool("input_feature"); var feature = input_feature.value;
        let input_version = get_tool("input_version"); var version = input_version.value;
        result = document.implementation.hasFeature(feature, version);
    }
    catch(ex) {
        result = ex.toString();
    }

if( log_this) log(caller+": ...return "+result);
    return result;
};
/*}}}*/
/*_ check_log_num_thumb {{{*/
let check_log_num_thumb = function(count, node)
{
    let         num = mPadStart(count, 5, " ");

    let thumb_p     = get_node_thumb_p( node    );
    let thumb_p_str = get_thumb_p_str ( thumb_p );
    let      offset = " ["+ thumb_p_str.replace(" ","&nbsp;") +"%]";

    let         val = node_toString(node);

    log("<span class='check_log_num_thumb'>"+num + offset +"</span> "+ val);
};
/*}}}*/

/*_ mNodeFilter_function {{{*/
let mNodeFilter_function = function(node)
{
    let check_result = mNodeFilter_check_node( node );

if(LOG_MAP.S1_RANGE && (check_result != NodeFilter.FILTER_SKIP)) log("mNodeFilter_function: "+ mNodeFilter_toString(check_result) + node_toString(node));

    return check_result;
};
/*}}}*/
/*_ mNodeFilter_check_node {{{*/
let mNodeFilter_check_node = function(node)
{
    /* REJECT == child nodes are also rejected */
    /* SKIP   == children are still considered */

    /* 2. REJECT [parent   == SCRIPT or STYLE] {{{*/
    let parent = node.parentNode;
    if( parent && (parent.nodeType == Node.ELEMENT_NODE))
    {
        if( parent.tagName  == "SCRIPT"             ) return NodeFilter.FILTER_REJECT;
        if( parent.tagName  == "STYLE"              ) return NodeFilter.FILTER_REJECT;
        if( is_node_selected( parent )              ) return NodeFilter.FILTER_REJECT;
    }
/*{{{
        if( parent.className.includes("knob_content") )
        {
            console.log("REJECTING: "+ parent.parentNode.id);
            console.dir(parent);
            return NodeFilter.FILTER_REJECT;
        }
}}}*/

    /*}}}*/
    /* REJECT .. f(node_to_hide parent) */
    if( dom_hide_is_marked_to_hide( node )      ) {
/*
logXXX("%c mNodeFilter_check_node( "+get_id_or_tag(node)+" ) %c IS HIDDEN", lbL+lf6, lbR+lf7);
*/
        return NodeFilter.FILTER_REJECT;
    }
    /* 3. SKIP   [node     != TEXT_NODE] {{{*/
    if(node.nodeType != Node.TEXT_NODE              ) return NodeFilter.FILTER_SKIP  ;

    /*}}}*/
    /* 1. ACCEPT [REGEXP   == textContent] {{{*/
    if(    mNodeRegexP         && node.textContent  )
        if(mNodeRegexP.pattern == node.textContent  ) return NodeFilter.FILTER_ACCEPT;

    /*}}}*/
    /* 4. ACCEPT [ALL WHEN NO REGEX] {{{*/
    if(                       !mNodeRegexP          ) return NodeFilter.FILTER_ACCEPT;

    /*}}}*/
    /* 5. SKIP   [REGEX MISSMATCH or !textContent] {{{*/
    if(!node.textContent                            ) return NodeFilter.FILTER_SKIP  ;
    if(!node.textContent.match(mNodeRegexP)         ) return NodeFilter.FILTER_SKIP  ;

    /*}}}*/
    /* 6. ACCEPT BY FILTER {{{*/
    else                                              return NodeFilter.FILTER_ACCEPT;

    /*}}}*/
};
/*}}}*/
/*_ mNodeFilter_toString {{{*/
let mNodeFilter_toString = function( check_result )
{
    switch( check_result )
    {
        case NodeFilter.FILTER_ACCEPT: return "<em class='cc4'>FILTER_ACCEPT </em>";
        case NodeFilter.FILTER_REJECT: return "<em class='cc1'>FILTER_REJECT </em>";
        case NodeFilter.FILTER_SKIP  : return "<em class='cc8'>FILTER_SKIP   </em>";
        default                      : return "<em class='cc2'>FILTER_ERROR  </em>";
    }
};
/*}}}*/
/*}}}*/

/* CHUNK WALLS OF TEXT */
/*{{{
:!start explorer "https://regexr.com/32oeg"
:!start explorer "https://www.regular-expressions.info/refrepeat.html"
}}}*/
/* check_wall_of_text {{{*/
/*{{{*/
const WALL_OF_TEXT_PARENT = "wall_of_text_parent";
const WALL_OF_TEXT_SPLIT  = "wall_of_text_split";
const WOT_LENGTH          = 512;
const REPORTS_COUNT_MAX   = 3;
let   check_wall_of_text_done;

/*}}}*/
let check_wall_of_text = function()
{
/*{{{*/
let   caller = "check_wall_of_text";

console.time(caller);
/*{{{
}}}*/
/*}}}*/
    /* split up wall of text nodes */
    check_wall_of_text_done = true;
    reports_count           = 0;

    let          root = document.body;
    let mDomTraversal = document.createNodeIterator(root, NodeFilter.SHOW_TEXT, mNodeFilter_wall_of_text_function);
    let    text_node_array = get_wall_of_text_node_array(mDomTraversal);

/*{{{
log("%c"+caller+" %c "+text_node_array.length+" TEXT NODES FILTER_ACCEPT'ed", lbH, lbH+lf3);
}}}*/
    let node_count = 0;
    let char_count = 0;
    let line_count = 0;
    for(let i = 0; i < text_node_array.length; ++i)
    {
        /* PARENT */
        let                       text_node = text_node_array[i];
        let              parent = text_node.parentNode;
        /* already removed .. already handled */
        if(             !parent                        ) continue;
/*{{{
        if( has_el_class(parent , WALL_OF_TEXT_PARENT) ) continue;
}}}*/
        add_el_class    (parent , WALL_OF_TEXT_PARENT);

/*{{{
log("%c"+i, lbb+lbH+lf3);
console_dir(parent   , "parent has "+   parent.children.length+" children");
console_dir(text_node, "text_node");
log("%c "+get_id_or_tag(parent)+" "+parent.textContent.length+" characters", lbH);
}}}*/

        /* REPLACE #TEXT WITH A BUNCH OF <P> */
        let                 split_node = document.createElement("P");
        parent.insertBefore(split_node , text_node);

        char_count                    += text_node.textContent.length;
        parent.removeChild (             text_node );

        /* INJECT #TEXT INTO A P.innerHTML {{{*/
/*{{{
        split_node.outerHTML = split_WALL_OF_TEXT(text_node.textContent, "P");
}}}*/

        let lines      = text_node.textContent.split(LF);
        let innerHTML  = "";
        let   l = 0;
        while(l < lines.length)
        {
            let p = "";

            do {
                let s    = lines[l++];
                if(s) p += escapeHTML(s)+LF;
            }
            while((l < lines.length) && (p.length + lines[l].length) <= WOT_LENGTH);

            innerHTML += "<p class='"+WALL_OF_TEXT_SPLIT+"'>"+p+"</p>";
        }
        /*}}}*/
        split_node.outerHTML =                                        innerHTML       ;

/*{{{
console_dir(parent, "...parent has "+parent.children.length+" children");
}}}*/

        line_count += lines.length;
        node_count += 1;

/*{{{
logXXX("check_wall_of_text: %c node_count=["+node_count+"] %c line_count=["+line_count+"] %c char_count=["+char_count+"]", lbL, lbC, lbR);
}}}*/
    }

/*{{{
if(node_count) log("%c"+node_count+" WALLS OF TEXT %c "+char_count+" characters %c "+line_count+" lines", lbL, lbC, lbR);
if(node_count) console.timeEnd(caller);
}}}*/
};
/*}}}*/
/*_ split_WALL_OF_TEXT {{{*/
let regexp_CHUNK = new RegExp("((.|\\n){32,512}\\n)", "gm");
let split_WALL_OF_TEXT = function(text, tagName)
{
    let result
    = escapeHTML( text )
        .   replace(regexp_CHUNK, "<"+tagName+" class='"+ WALL_OF_TEXT_SPLIT +"'>$1</"+tagName+">")
    ;
/*{{{
log("%c"+result, lbH+lf5);
}}}*/
    return result;
};
/*}}}*/
/*_ escapeHTML {{{*/
/*{{{*/
var escapeHTML_chars = {"<": "&lt;", ">": "&gt;", "&": "&amp;", [DOUBLE_QUOTE] : "&quot;"};

/*}}}*/
let escapeHTML = function (text)
{
  return text.replace(/[<>&"]/g, function(character) { return escapeHTML_chars[character]; });
};
/*}}}*/
/*_ mNodeFilter_wall_of_text_function {{{*/
let   reports_count;
let mNodeFilter_wall_of_text_function = function(node)
{
    let                                                       check_result = NodeFilter.FILTER_ACCEPT, details = "";
    if     ((!node.parentNode                      )      ) { check_result = NodeFilter.FILTER_REJECT; details = "NODE HAS NO PARENT" ; }
    else if(( node.parentNode.tagName  == "SCRIPT" )      ) { check_result = NodeFilter.FILTER_REJECT; details = "SCRIPT TEXT"        ; }
    else if(( node.parentNode.tagName  == "STYLE"  )      ) { check_result = NodeFilter.FILTER_REJECT; details = "STYLE TEXT"         ; }
    else if(( node.nodeType       != Node.TEXT_NODE)      ) { check_result = NodeFilter.FILTER_SKIP  ; details = "NOT A TEXT NODE"    ; }
    else if((!node.textContent                     )      ) { check_result = NodeFilter.FILTER_SKIP  ; details = "NO TEXT CONTENT"    ; }
    else if(( node.textContent.length < WOT_LENGTH )      ) { check_result = NodeFilter.FILTER_SKIP  ; details = "["+ node.textContent.length+" char] <  [WOT_LENGTH "+WOT_LENGTH+"]"; }
    else if(  dom_hide_is_marked_to_hide( node     )      ) { check_result = NodeFilter.FILTER_REJECT; details = "NODE MARKED TO HIDE"; }
    else                                                    { check_result = NodeFilter.FILTER_ACCEPT; details = "FILTER_ACCEPT ["+ node.textContent.length+" char] >= [WOT_LENGTH "+WOT_LENGTH+"]"; }

/*{{{
if((check_result == NodeFilter.FILTER_ACCEPT) && (reports_count++ < REPORTS_COUNT_MAX))
    logXXX("%c WOT ("+reports_count+"/"+REPORTS_COUNT_MAX+"...) "+ node.parentNode.tagName +"."+ node.nodeName +" %c "+details+" %c"+ellipsis(node.textContent, 64), lbL, lbC, lbR);
}}}*/

    return check_result;
};
/*}}}*/
/*_ get_wall_of_text_node_array {{{*/
let get_wall_of_text_node_array = function(mDomTraversal)
{
    let   node_array = [];
    let   node;

    while(node = mDomTraversal.nextNode())
        node_array.push(node);
/*
log("get_wall_of_text_node_array: return node_array.length=["+node_array.length+"]");
*/
    return node_array;
};
/*}}}*/

/** COLLECT */
/*{{{*/
/*_ collect_node_matches_to_slot {{{*/
let collect_node_matches_to_slot = function(slot, node, pattern, options)
{
/*{{{*/
let   caller = "collect_node_matches_to_slot";
let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller+"(slot=["+slot+"], node=["+get_n_txt(node)+"]");
/*}}}*/

if( log_this) log("<div class='div_match'>");
    let matches;
    for(let i = 0; (matches = mNodeRegexP.exec(node.textContent)); ++i)
    {
if( log_this) log("<div class='div_match' style='border:3px dotted yellow !important;'>");

        let num = ccs[slot].nodes.length+1;
if( log_this) log_match(node, slot, num, i, mNodeRegexP, matches);

        let       match = matches[0]; /* the full string */
        let startOffset = matches.index;
        let   endOffset = startOffset + match.length;

        /* select match */
        let       range = document.createRange();
        range.setStart(node, startOffset);
        range.setEnd  (node,   endOffset);

        /* collect match */
        if(ccs[slot].nodes.length < TOO_MANY_SELECTIONS)
        {
            window.getSelection().removeAllRanges();
            window.getSelection().addRange( range );
            if(i == 0) document.execCommand("copy"); /* to clipboard */

            let ccs_node_nextSibling = collect_selection_to_slot(slot, pattern, options);

            if( ccs_node_nextSibling ) {
                node = ccs_node_nextSibling;
                mNodeRegexP.lastIndex = 0;
            }
if( log_this) log("...<blockquote class='cc6'>"+ get_n_txt(node).substring(mNodeRegexP.lastIndex) +"</blockquote>");
        }
        else {
            window.getSelection().addRange( range );
        }
if( log_this) log("</div>");
    }

    window.getSelection().removeAllRanges(); /* .. to dismiss WebView Clipboard-Popup */

if( log_this) log("</div>");
};
/*}}}*/
/*_ log_match {{{*/
let log_match = function(node, slot, num, i, regex, matches)
{
    let s = ""
        + "<blockquote class='cc6'> "+            escape_CR_LF( ellipsis(node.textContent, 128) ) +"</blockquote>"
        + "<em class='cc6 em_match'> "+           matches[0]                                      +"</em>"
        + "<br>"
        + "<em class='cc"+((slot  )%9 + 1)+"'>slot "+   slot                                      +"</em>"
        + "<em class='cc"+(( num-1)%9 + 1)+"'>num "+    num                                       +"</em>"
        + "<em class='cc"+((   i  )%9 + 1)+"'>match #"+ (i+1)                                     +"</em>"
        + " REGEX: "
        + "<em class='cc4'> "+                    regex                                           +"</em>"
        + "<em class='cc5'> index "+              matches.index                                   +"</em>"
        + "<em class='cc8'> lastIndex "+          mNodeRegexP.lastIndex                           +"</em>"
    ;
    log(s);
};
/*}}}*/

/*_ collect_selection_to_slot {{{ */
let collect_selection_to_slot = function(slot, pattern, options)
{
/*{{{*/
    let caller = "collect_selection_to_slot";
let log_this = LOG_MAP.S3_SLOT;

if( log_this) log(caller+"(slot=["+slot+"], pattern=["+pattern+"], options=["+options+"])");
/*}}}*/

    let selection = window.getSelection();
    if(!selection               ) return null;
    if( selection.rangeCount < 1) return null;

    let range     = selection.getRangeAt(0);

    let sel_text  = range.toString().trim();
if(log_this) log(".sel_text=["+sel_text +"]");

    if(!sel_text                ) return null;

    if(!pattern) pattern = sel_text;

    /* inject highlight node */
    let ccs_node        = document.createElement("em");
    ccs_node.innerText  = sel_text;

    collect_ccs_range_node_slot(range, ccs_node, slot, pattern, options);

if(log_this) log("return ccs_node.nextSibling=["+ccs_node.nextSibling+"]");
    return ccs_node.nextSibling;
};
/*}}}*/
/*_ collect_ccs_range_node_slot {{{*/

let some_container_is_too_high;

let collect_ccs_range_node_slot = function(range, ccs_node, slot, pattern, options)
{
    /*{{{*/
let caller = "collect_ccs_range_node_slot";
let log_this = LOG_MAP.S3_SLOT;

if( log_this) log(caller+"(range, ccs_node, slot=["+slot+"])");
    /*}}}*/
    /*  parent_with_overflow {{{*/
    let parent_with_overflow = get_parent_with_overflow( ccs_node );
    if( parent_with_overflow )
    {
if(log_this) log(caller+"%c NOT COLLECTING "+get_n_txt( ccs_node )+" .. parent_with_overflow "+get_n_txt( parent_with_overflow ), lbH+lf2);
        return;
    }
    /*}}}*/
    /* container {{{*/
    let container                      = get_text_container( range.startContainer );
    let container_H                    = container ? container.offsetHeight : 0;
    let container_is_too_high          = (container_H             >  window.innerHeight);
    let container_is_body              = (container               == document.body);
    let container_is_body_direct_child = (container.parentElement == document.body);
    let container_is_body_single_child = (container               == document.body) && (document.body.childNodes.length == 1);
    let container_is_body_first_child  = (container               == document.body) && (document.body.childNodes[0]     == container);

if(log_this && container_is_too_high         ) log("%c container_is_too_high         ", lbH+lf2);
if(log_this && container_is_body             ) log("%c container_is_body             ", lbH+lf3);
if(log_this && container_is_body_direct_child) log("%c container_is_body_direct_child", lbH+lf4);
if(log_this && container_is_body_single_child) log("%c container_is_body_single_child", lbH+lf5);
if(log_this && container_is_body_first_child ) log("%c container_is_body_first_child ", lbH+lf6);

    if(     container_is_too_high         ) some_container_is_too_high = true;
    if(     container_is_too_high         ) container = null;
    else if(container_is_body             ) container = null;
    else if(container_is_body_single_child) container = null;
/*
    if(container_is_body_direct_child) container = null;
    if(container_is_body_first_child ) container = null;
*/
if(log_this) log("%c container %c "+get_n_lbl(container)+"%c H="+container_H, lbL, lbC+lf7, lbR+lf8);
    /*}}}*/
    /* thumb_p .. f(parent container or range.startContainer) {{{*/
/*
    let node = container ? container : range.startContainer;
logXXX("...node=["+get_n_lbl(node)+"]")
*/
/*{{{
    TODO
    ? thumb_p of range.startContainer
    ? thumb_p of selected parent container
    ? thumb_p of ccs_node
}}}*/
/*{{{
    let thumb_p = get_node_thumb_p(container ? container : ccs_node);
    let thumb_p = get_node_thumb_p(range.startContainer );
}}}*/
/*
    let thumb_p   = get_node_thumb_p( node );
    if( thumb_p   < 1)
        thumb_p   = get_node_thumb_p(ccs_node);
*/
    /* CCS INSERT .. (TEMPORARILY REPLACE SELECTION) {{{*/
    range.deleteContents();
    range.insertNode(ccs_node);

    /*}}}*/
    let node    = container ? container : ccs_node;
    let thumb_p = get_node_thumb_p( node );

    if(thumb_p < 0.01)
    {
if(log_this) log(caller+"%c NOT COLLECTING "+get_n_txt(node)+" .. (thumb_p < 0.1)=["+thumb_p+"]", lbH+lf2);

        ccs_node.outerHTML = ccs_node.innerHTML;
        return;
    }
    /*}}}*/
    /* CCS CREATE {{{*/
    let                   next_idx = ccs[slot].nodes.length;
    let                        ccX =     slot % SELECT_SLOT_MAX;
    let                 slot_class = SEL_CLASS_PREFIX +     ccX;
    let                 word_class = SEL_CLASS_PREFIX +"_"+ options;

    ccs_node.id                    = slot_class +"_"+(next_idx+1);
    ccs_node.className             = slot_class +" "+ word_class;
    ccs[slot].slot                 = slot;
    ccs[slot].pattern              = pattern;
    ccs[slot].options              = options;
    ccs[slot].nodes     [next_idx] = ccs_node;
    ccs[slot].containers[next_idx] = container;

if(log_this) log("%c ccs_node: "+ node_toString(ccs_node), "background-color:#880");

    /*}}}*/
    /* CCS [thumb_p] {{{*/
    let thumb_p_str = get_thumb_p_str( thumb_p );
    if(!thumb_p_str)
    {
if(log_this) log("%c *** INVALID thumb_p=["+thumb_p+"] .. container=["+get_n_lbl(container)+"] ccs_node=["+get_n_lbl(ccs_node)+"] ***", lbH+lf2);
        thumb_p_str = "0";
    }
    ccs[slot].thumbs    [next_idx] = thumb_p_str;
/*
if(log_this) log("slot=["+slot+"] num=["+(next_idx+1)+"] thumb_p=["+thumb_p_str+"] ["+ccs_node.textContent+"]");
*/

if(log_this) log( ccs[slot].num_toHTML(next_idx + 1) );
    /*}}}*/
    /* CCS CONTAINER HIGHLIGHT [containers_hi] {{{ */
    if( !prop_get("containers_hi") ) return;
    if( !container     ) return;
    if(  container.classList)
        if(  container.classList.contains( "container_dark" ) || container.classList.contains( "container_light" )) return;

    add_el_class(container , prop_get(THEME_DARK) ? "container_dark" : "container_light");

    /*}}}*/
};
/*}}}*/

/*_ get_text_container {{{*/
let BAIL_OUT_COUNT = 10;
let get_text_container = function(node)
{
    let caller = "get_text_container("+get_n_txt(node)+")";
let log_this = LOG_MAP.S3_SLOT;

    let container = node.parentElement;

    let node_text_length = node.textContent.trim().length;
    if(!node_text_length) return container;

    let count;
    for(count = 0; count < BAIL_OUT_COUNT; ++count)
    {
        if(container == null)
        {
if(log_this) log("%c"+caller+"%c NO PARENT", lbL, lbR+lf2);

            break;
        }

        if( is_text_container_node( container ) )
        {
if(log_this) log("%c"+caller+"%c FOUND CONTAINER ["+get_n_str( container )+"] ("+container.tagName+")", lbL, lbR+lf4);
            break;

/* container_text_length {{{
            let container_text_length = container.textContent.trim().length;
            if( container_text_length > node_text_length) {
                break;
            }
            else {
if(log_this) log("...(container_text_length=["+container_text_length+"] <= node_text_length=["+node_text_length+"]");
            }
}}}*/
        }

        container = container.parentElement;
    }

    if(count >= BAIL_OUT_COUNT)
    {
if(log_this) log("%c"+caller+"%c BAILING OUT ON ["+get_n_str(node)+"] after "+count+" attempts at looking for a container", lbL, lbR+lf1);

    }
/*
if(log_this) logXXX("...container.textContent.length=["+container.textContent.length+"]")
if(log_this) log("%c"+container.textContent, lbH);
*/
    return container;
};
/*}}}*/
/*_ is_text_container_node {{{*/
let is_text_container_node = function(node)
{
let   caller = "is_text_container_node";
let log_this = LOG_MAP.S1_RANGE;

    let tag = node.nodeName.toLowerCase();
if( log_this) log("%c"+caller+" %c tag "+tag+" %c len "+node.textContent.length+" %c text "+get_n_txt(node)
                 ,lbL          ,lbR           ,lbH+lf5                           ,lbH+lf4                  );

    let result
        =      (tag == "p"        )
        ||     (tag == "div"      )
        ||    ((tag == "span"     ) && (node.textContent.length >= 360))
        ||    ((tag == "code"     ) && (node.textContent.length >=  80)) /* only if they contain a wall of text */
        ||    ((tag == "li"       ) && (node.textContent.length >=  80)) /* only if they contain a wall of text */
        ||    ((tag == "ol"       ) && (node.textContent.length >=  80)) /* only if they contain a wall of text */
        ||    ((tag == "ul"       ) && (node.textContent.length >=  80)) /* only if they contain a wall of text */
        ||     (tag == "section"  )
        ||     (tag == "article"  )
        ||     (tag == "aside"    )
        ||     (tag == "header"   )
        ||     (tag == "nav"      )
    /*      ...COULD BE CONTAINERS .. IF NONE OF THE FOLLOWING */
        || (   (tag != "span"     )
            && (tag != "a"        )
            && (tag != "b"        )
            && (tag != "em"       )
            && (tag != "font"     )
            && (tag != "strong"   )
            && (tag != "u"        )
    /*      ...COULD BE CONTAINERS .. ONLY WITH A WALL OF TEXT */
            && (tag != "code"     )
            && (tag != "li"       )
            && (tag != "ol"       )
            && (tag != "ul"       )
        )
    ;

if( log_this) log("is_text_container_node(["+get_n_str(node)+"]...["+get_n_lbl(node)+"]): ...return "+result+" node.textContent.length=["+node.textContent.length+"]");
    return result;
};
/*}}}*/

/*_ sync_containers_hi {{{*/
let sync_containers_hi = function()
{
/*{{{*/
    let caller = "sync_containers_hi";
    let log_this = LOG_MAP.S1_RANGE;

if( log_this) log(caller+": containers_hi=["+prop_get("containers_hi")+"]");
/*}}}*/
    /* 1/2 - forget all current containers */
    let className = "container_light";
    let node_list = document.querySelectorAll("."+className);
    for(let i     = 0; i < node_list.length; ++i)
    {
        del_el_class(node_list[i], className);
    }

    className     = "container_dark";
    node_list     = document.querySelectorAll("."+className);
    for(let i     = 0; i < node_list.length; ++i)
    {
        del_el_class(node_list[i], className);
    }

    /* highlight active containers */
    if(prop_get("containers_hi"))
    {
        let theme_class = prop_get(THEME_DARK) ? "container_dark" : "container_light";
        let container;
        for(let slot = 1; slot < ccs.length; ++slot)
        {
            if( ccs[slot] )
            {
                for(let i = 0; i < ccs[slot].nodes.length; ++i)
                {
                    if(container = ccs[slot].containers[i])
                        add_el_class(container, theme_class);
                }
            }
        }
    }

    /* unhiglight everything else */
/* FIXME .. explain...
    let html = document.getElementsByTagName("HTML")[0];
    if(prop_get("containers_hi")) add_el_class(html             , "containers_hi"  );
    else              del_el_class(html                              , "containers_hi"  );
    del_el_class(                  html, prop_get("theme_dark") ? "light" : "dark" );
    add_el_class(                  html, prop_get("theme_dark") ?  "dark" : "light");
*/

};
/*}}}*/
/*_ get_slot_num_container {{{*/
let get_slot_num_container = function(slot, num)
{
    let s =  slot;
    let n = num-1;

    let node
        = (ccs[s] && ccs[s].containers && ccs[s].containers[n]) ? ccs[s].containers[n] /*   a node parent */
        : (ccs[s] && ccs[s].nodes      && ccs[s].nodes     [n]) ? ccs[s].nodes     [n] /* the node itself */
        :                                                         null
    ;
/*
logXXX("%c get_slot_num_container("+s+","+n+"): %c return "+ get_n_lbl(node) +" .. "+ (!node ? "" : ((node == ccs[s].nodes[n]) ? "THE NODE ITSELF" : "A NODE PARENT")), lbL, lbR+lf4)
console.dir(ccs[s])
*/
    return  node;
};
/*}}}*/
/*}}}*/

/* PAT_BAG */
/*{{{*/
/*_ t_onPatternUpdate {{{*/
/*{{{*/
const  PATTERN_UPDATE_DELAY =  500;/* FIXME 250;*/
let t_onPatternUpdate_timer = null;

/*}}}*/
let t_onPatternUpdate_no_delay = function(msg, caller) { t_onPatternUpdate(msg, caller, 0); };
let t_onPatternUpdate = function(msg, caller, delay=PATTERN_UPDATE_DELAY)
{
let log_this = LOG_MAP.S2_SELECT;
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, msg);

    if(t_onPatternUpdate_timer) {
        clearTimeout(t_onPatternUpdate_timer);
        if( delay ) delay  = 2 * PATTERN_UPDATE_DELAY;
    }
    if(delay) t_onPatternUpdate_timer =   setTimeout(t_onPatternUpdate_handler, delay);
    else                                             t_onPatternUpdate_handler();
};
/*}}}*/
/*_ t_onPatternUpdate_handler {{{*/

let t_onPatternUpdate_handler = function()
{
/*{{{*/
let caller = "t_onPatternUpdate_handler";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log(caller);
/*}}}*/
    t_onPatternUpdate_timer = null;

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_UPDATE, "want");

    t_onPatternUpdate_handler_sync_csv_from_ccs();
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_STAGE , "have");

    t_set_1_sel_bag_innerHTML();

    t_set_4_pat_off_bak_alt_innerHTML(caller);
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_RESULT, "have");

    t_onPatternUpdate_done();

};
/*}}}*/
/*_ t_onPatternUpdate_handler_sync_csv_from_ccs {{{*/
let t_onPatternUpdate_handler_sync_csv_from_ccs = function()
{
    /*{{{*/
    let caller = "t_onPatternUpdate_handler_sync_csv_from_ccs";
let log_this = LOG_MAP.S2_SELECT;
if( log_this ) log(caller);

    /*}}}*/
    /* REBUILD [bak_csv off_csv pat_csv sel_csv] {{{*/
    let old_bak_csv = bak_csv;
    let old_off_csv = off_csv;
    let old_pat_csv = pat_csv;
    let old_sel_csv = sel_csv;
/*
if(log_this) log("...old_bak_csv ["+old_bak_csv+"]");
if(log_this) log("...old_off_csv ["+old_off_csv+"]");
if(log_this) log("...old_pat_csv ["+old_pat_csv+"]");
if(log_this) log("...old_sel_csv ["+old_sel_csv+"]");
*/
    /*}}}*/
    /* ccs[] TO (pat_csv sel_csv) {{{*/
    sel_csv = ""; let sel_csv_count = 0;
    pat_csv = ""; let pat_csv_count = 0;

    for(let slot = 1; slot <= SELECT_SLOT_MAX; ++slot)
    {
        if(           ccs[slot]
            &&        ccs[slot].nodes[0]
            &&        ccs[slot].nodes[0].textContent
        ) {
            let pat = ccs[slot].pattern;
            sel_csv = csv_add(sel_csv, pat); ++sel_csv_count;
            pat_csv = csv_add(pat_csv, pat); ++pat_csv_count;

            bak_csv = csv_del(bak_csv, pat);
        }
    }
    /*}}}*/
    /* [old_pat_csv] TO [pat_csv off_csv bak_csv] {{{*/
    off_csv = ""; let off_csv_count = 0;
    /*.........*/ let bak_csv_count = csv_count(bak_csv);

    let old_pat_count = csv_count( old_pat_csv );
    for(let       pos = 1; pos <=  old_pat_count; ++pos) {
        let       pat = csv_get(   old_pat_csv  ,   pos);

        if(csv_contains(pat_csv, pat)) continue;

        if(pat_csv_count < SELECT_SLOT_MAX) { pat_csv = csv_add(pat_csv, pat); ++pat_csv_count; bak_csv = csv_del(bak_csv, pat); }
        if(off_csv_count < SELECT_SLOT_MAX) { off_csv = csv_add(off_csv, pat); ++off_csv_count; bak_csv = csv_del(bak_csv, pat); }
        else /* pat overload into bak */    {                                                   bak_csv = csv_add(bak_csv, pat); ++bak_csv_count; }
    }
    /*}}}*/
    /* [old_off_csv] TO [pat_csv off_csv bak_csv] {{{*/

    let old_off_count = csv_count( old_off_csv );
    for(let       pos = 1; pos <=  old_off_count; ++pos) {
        let       pat = csv_get(   old_off_csv  ,   pos);

        if(csv_contains(pat_csv, pat)) continue;

        if(pat_csv_count < SELECT_SLOT_MAX) { pat_csv = csv_add(pat_csv, pat); ++pat_csv_count; bak_csv = csv_del(bak_csv, pat); }
        if(off_csv_count < SELECT_SLOT_MAX) { off_csv = csv_add(off_csv, pat); ++off_csv_count; bak_csv = csv_del(bak_csv, pat); }
        else /* off overload into bak */    {                                                   bak_csv = csv_add(bak_csv, pat); ++bak_csv_count; }
    }
    /*}}}*/
    /*{{{*/

if(log_this) if(sel_csv != old_sel_csv) csv_log(sel_csv, "sel_csv [x"+csv_count(sel_csv)+"] "); else log("%c sel_csv [x"+csv_count(sel_csv)+"] %c UNCHANGED ["+sel_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(pat_csv != old_pat_csv) csv_log(pat_csv, "pat_csv [x"+csv_count(pat_csv)+"] "); else log("%c pat_csv [x"+csv_count(pat_csv)+"] %c UNCHANGED ["+pat_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(off_csv != old_off_csv) csv_log(off_csv, "off_csv [x"+csv_count(off_csv)+"] "); else log("%c off_csv [x"+csv_count(off_csv)+"] %c UNCHANGED ["+off_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(bak_csv != old_bak_csv) csv_log(bak_csv, "bak_csv [x"+csv_count(bak_csv)+"] "); else log("%c bak_csv [x"+csv_count(bak_csv)+"] %c UNCHANGED ["+bak_csv+"]", lbF+lb9, lbF+lb0);

    /*}}}*/
};
/*}}}*/
/*_ t_set_4_pat_off_bak_alt_innerHTML {{{*/
let t_set_4_pat_off_bak_alt_innerHTML = function(_caller)
{
    /*{{{*/
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c t_set_4_pat_off_bak_alt_innerHTML: .. %c CALLED BY ["+_caller+"]", lbF+lb3, lbF+lb0);

    if(!pat_bag) return;
    let pat_bag_is_opened = has_el_class( pat_bag, "open_bag");
    /*}}}*/
    /* COLLECT [pat_spans] {{{*/
/*
<span class="pat_span"><em class="num_em">&nbsp;num</em>&nbsp;<em title="pat" class="cc1 ">txt</em></span>
<span.................><em......................num..em>......<em........pat...............txt..em><.span>
................................................num......................pat...............txt............
*/
    let pat_spans=[];
    let pat_count = t_collect_el_class_from_into("pat_span", pat_bag, pat_spans);
    let off_count = t_collect_el_class_from_into("pat_span", off_bag, pat_spans);
    let bak_count = t_collect_el_class_from_into("pat_span", bak_bag, pat_spans);
    let alt_count = t_collect_el_class_from_into("pat_span", alt_bag, pat_spans);

if(log_this) for(let i=0; i < pat_spans.length; ++i) log((i+1)+" %c["+pat_spans[i].innerText+"]", lbF+lbX[(i+1) % 10]);

    /*}}}*/
    /* [innerHTML] {{{*/
/*
  _cleanup_pat_bag();
  _cleanup_div(off_bag);
  _cleanup_div(bak_bag);
*/

    let pat_bag_innerHTML = "";
    let off_bag_innerHTML = "";
    let bak_bag_innerHTML = "";
    let alt_bag_innerHTML = "";
    /*}}}*/
    /* [nil] .. (sucks in all nil.pat_spans from their current container) {{{*/
    let bin_moved_to_count = 0;

    for(let pos = 1; pos <= csv_count(bin_csv); ++pos)
    {
        let pat             = csv_get  (bin_csv, pos);
        let pat_span_index  = t_get_pat_span_index(pat_spans, pat);

        /* DUMP ENTRY */
        if(pat_span_index >= 0)
        {
            let container = pat_spans[pat_span_index].parentNode;
            if( container ) {
                container.removeChild( pat_spans[pat_span_index] );
                pat_spans[pat_span_index] = null;
                bin_moved_to_count += 1;
            }
        }
    }

    /* CONTAINER CLEANUP ALL DONE .. f(one shot) */
    bin_csv = "";

    /*}}}*/
    /* [bak] {{{*/
    let bak_moved_to_count = 0;
    let bak_inserted_count = 0;
    let bak_asserted_count = 0;

    for(let pos = 1; pos<= csv_count(bak_csv); ++pos)
    {
        let pat            = csv_get  (bak_csv, pos);
        let pat_span_index = t_get_pat_span_index(pat_spans, pat);

        if(pat_span_index >= 0)
        {
            /* container  bak_bag .. [CONFIRM bak] {{{*/
            let container  = pat_spans[pat_span_index].parentNode;
            if( container == bak_bag) {
                bak_asserted_count += 1;

            }
            /*}}}*/
            /* container !bak_bag .. [MOVED_TO bak] {{{*/
            else {

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly("MOVED TO <em class='cc2'>BAK</em> FROM <em class='cc9'>"+get_n_lbl(container)+"</em> ["+pat_spans[pat_span_index].innerText+"]");
                bak_moved_to_count += 1;
                bak_bag.appendChild( pat_spans[pat_span_index] );
            }
            /*}}}*/
            t_sync_pat_span_class(pat, pat_spans[pat_span_index]);
            pat_spans[pat_span_index] = null;
        }
        else {
            /* [new pat_span innerHTML] {{{*/
            let  num = mPadStart(pos,2).replace(" ","&nbsp;");
            let  txt = ellipsis(s_get_htmlEntities(pat), 16);
            let  css_class
                = "cc0"
                + ((mov_div.innerText == txt) ? " mov_src" : "")
            ;

            let line = t_get_pat_span_line(num,pat,css_class,txt);
            /*}}}*/
            /* [INSERTED BAK] {{{*/
            bak_bag_innerHTML  += line;
            bak_inserted_count += 1;
            /*}}}*/
        }
    }
    /*}}}*/
    /* [alt] {{{*/
    let alt_moved_to_count = 0;
    let alt_inserted_count = 0;
    let alt_asserted_count = 0;

    for(let pos = 1; pos<= csv_count(alt_csv); ++pos)
    {
        let pat            = csv_get(alt_csv, pos);
        let pat_span_index = t_get_pat_span_index(pat_spans, pat);

        if(pat_span_index >= 0)
        {
            /* container  alt_bag .. [CONFIRM alt] {{{*/
            let container  = pat_spans[pat_span_index].parentNode;
            if( container == alt_bag) {
                alt_asserted_count += 1;

            }
            /*}}}*/
            /* container !alt_bag .. [MOVED_TO bak] {{{*/
            else {

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly("MOVED TO <em class='cc2'>BAK</em> FROM <em class='cc9'>"+get_n_lbl(container)+"</em> ["+pat_spans[pat_span_index].innerText+"]");
                bak_moved_to_count += 1;
                bak_bag.appendChild( pat_spans[pat_span_index] );
            }
            /*}}}*/
            t_sync_pat_span_class(pat, pat_spans[pat_span_index]);
            pat_spans[pat_span_index] = null;
        }
        else {
            /* [new pat_span innerHTML] {{{*/
            let  num = mPadStart(pos,2).replace(" ","&nbsp;");
            let  txt = ellipsis(s_get_htmlEntities(pat), 16);
            let  css_class
                = "cc0"
                + ((mov_div.innerText == txt) ? " mov_src" : "")
            ;

            let line = t_get_pat_span_line(num,pat,css_class,txt);
            /*}}}*/
            /* [INSERTED ALT] {{{*/
            alt_bag_innerHTML += line;
            alt_inserted_count += 1;
            /*}}}*/
        }
    }
    /*}}}*/
    /* [pat] [off] {{{*/

    let pat_moved_to_count = 0;
    let pat_inserted_count = 0;
    let pat_asserted_count = 0;

    let off_moved_to_count = 0;
    let off_inserted_count = 0;
    let off_asserted_count = 0;

    for(let pos = 1; pos<= csv_count(pat_csv); ++pos)
    {
        let pat            = csv_get(pat_csv, pos);
        let pat_span_index = t_get_pat_span_index(pat_spans, pat);
        let pat_off        = csv_contains(off_csv, pat);
        let pat_bak        = csv_contains(bak_csv, pat);

        if(pat_span_index >= 0)
        {
            /* container  pat_bag .. [CONFIRM pat] OR [MOVED_TO off] {{{*/
            let container  = pat_spans[pat_span_index].parentNode;
            if( container == pat_bag)
            {
                let csv_belongs_to_pat = !pat_off /*|| !pat_bag_is_opened*/;
                /* pat CONFIRM {{{*/
                if(csv_belongs_to_pat)
                {
                    pat_asserted_count += 1;

                    /* but move it to the bottom */
                    pat_bag.insertBefore(pat_spans[pat_span_index], off_bag);
                }
                /*}}}*/
                /* pat MOVED_TO off {{{*/
                else {
                    off_moved_to_count += 1;
                    off_bag.appendChild( pat_spans[pat_span_index] );
                }
                /*}}}*/
            }
             /*}}}*/
            /* container  off_bag .. [CONFIRM off] {{{*/
            else if( container == off_bag)
            {
                let csv_belongs_to_pat = !pat_off /*|| !pat_bag_is_opened*/;
                /* off CONFIRM {{{*/
                if(!csv_belongs_to_pat)
                {
                    off_asserted_count += 1;
                }
                /*}}}*/
                /* off MOVED_TO pat {{{*/
                else {
                    pat_moved_to_count += 1;
                    pat_bag.insertBefore(pat_spans[pat_span_index], off_bag);
                }
                /*}}}*/
            }
            /*}}}*/
            /* container  bak_bag .. [MOVED_TO pat] OR [MOVED_TO off] {{{*/
            else if( container == bak_bag)
            {
                /* bak MOVED_TO off {{{*/
                if(pat_off) {
                    off_moved_to_count += 1;
                    off_bag.appendChild( pat_spans[pat_span_index] );
                }
                /*}}}*/
                /* bak MOVED_TO pat {{{*/
                else if(!pat_bak) {
                    pat_moved_to_count += 1;
                    pat_bag.insertBefore(pat_spans[pat_span_index], off_bag);
                }
                /*}}}*/
            }
            /*}}}*/
            /* HIDE pat .. [MOVED_TO off] {{{*/
            else if( pat_off ) {
                off_moved_to_count += 1;
                off_bag.appendChild( pat_spans[pat_span_index] );
            }
            /*}}}*/
            /* SHOW pat .. [MOVED_TO pat] {{{*/
            else if( !pat_bag_is_opened ) {
                pat_moved_to_count += 1;
                pat_bag.insertBefore(pat_spans[pat_span_index], off_bag);
            }
            /*}}}*/
            t_sync_pat_span_class(pat, pat_spans[pat_span_index], pat_off);
            pat_spans[pat_span_index] = null;
        }
        else {
            /* [new pat_span innerHTML] {{{*/
            let num = mPadStart(pos,2).replace(" ","&nbsp;");
            let txt = ellipsis(s_get_htmlEntities( pat ), 16);
            let ccX = get_slot_of_pattern( pat ) % 10;
            let css_class
                = ((pat_off                 ) ? "cc0"      : "cc"+ccX)
                + ((mov_div.innerText == txt) ? " mov_src" : ""      )
            ;

            let line = t_get_pat_span_line(num,pat,css_class,txt);
            /*}}}*/
            /* [INSERTED OFF] .. [to off when OPENED] [to pat when CLOSED] {{{*/
            if(pat_off) {
                if( pat_bag_is_opened ) { off_bag_innerHTML += line; ++off_inserted_count; }
                else                    { pat_bag_innerHTML += line; ++pat_inserted_count; }
            }
            /*}}}*/
            /* [INSERTED SEL] .. [to pat] {{{*/
            else                        { pat_bag_innerHTML += line; ++pat_inserted_count; }
            /*}}}*/
        }

    }
    /*}}}*/
    /* [pat_spans] unmoved [MOVED_TO bak] {{{*/
    for(let pat_span_index=0; pat_span_index < pat_spans.length; ++pat_span_index)
    {
        if(pat_spans[pat_span_index] == null) continue;

        let  el = pat_spans[pat_span_index].childNodes[2];

/*
        let pat = el.title;
*/
        let pat = csv_unescape(el.title);
/*
logXXX("___el.title=["+ el.title +"]")
logXXX("________pat=["+ pat      +"]")
*/
        let parentNode = pat_spans[pat_span_index].parentNode;

        if(csv_count(pat_csv) < SELECT_SLOT_MAX)
        {
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly("MOVED TO <em class='cc5'>OFF</em> <em class='cc8'>LOOSE</em> ["+pat_spans[pat_span_index].innerText+"]");
            csv_move_pattern_to_off(pat);
            off_moved_to_count += 1;
            off_bag.appendChild( pat_spans[pat_span_index] );
        }
        else {
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly("MOVED TO <em class='cc8'>BAK</em> <em class='cc8'>LOOSE</em> ["+pat_spans[pat_span_index].innerText+"]");
            csv_move_pattern_to_bak(pat);
            bak_moved_to_count += 1;
            bak_bag.appendChild( pat_spans[pat_span_index] );
        }

        t_sync_pat_span_class("", pat_spans[pat_span_index]);
        pat_spans[pat_span_index] = null;

    }
/*
*/
    /*}}}*/
    /* LOG {{{*/
    if(LOG_MAP.EV8_FLOATLOG || fly_log_checked)
    {
        let log_msg = "";

        /* PANEL OPEN / CLOSED */
        log_msg += "<em class='cc"+(pat_bag_is_opened ? 9 : 8)+"'>PANEL "+(pat_bag_is_opened ? "OPENED" : "CLOSED")+"</em> ";

        /* BAGS */

        log_msg                   += "<br>"+ SYMBOL_BAGGER+" <em class='done cc1'>HAVE</em>";

        if(!pat_count && !off_count && !bak_count) {
            log_msg               +=     " ALL BAGS EMPTY";
        }
        else {
            if(pat_count) log_msg += " <em class='bags cc1'>pat "+pat_count /*+" "+ SYMBOL_PAT_BAG*/ +"</em>";
            if(off_count) log_msg += " <em class='bags cc5'>off "+off_count /*+" "+ SYMBOL_OFF_BAG*/ +"</em>";
            if(bak_count) log_msg += " <em class='bags cc2'>bak "+bak_count /*+" "+ SYMBOL_BAK_BAG*/ +"</em>";
        }

        log_msg += t_get_docker_bag_msg("pat", pat_moved_to_count, pat_asserted_count, pat_inserted_count);
        log_msg += t_get_docker_bag_msg("off", off_moved_to_count, off_asserted_count, off_inserted_count);
        log_msg += t_get_docker_bag_msg("bak", bak_moved_to_count, bak_asserted_count, bak_inserted_count);
        log_msg += t_get_docker_bag_msg("alt", alt_moved_to_count, alt_asserted_count, alt_inserted_count);
        log_msg += t_get_docker_bag_msg("bin", bin_moved_to_count, 0                 , 0                 );

        t_fly( log_msg );
    }

if(log_this && pat_bag_innerHTML) log("...pat_bag_innerHTML %c"+pat_bag_innerHTML, lb1);
if(log_this && off_bag_innerHTML) log("...off_bag_innerHTML %c"+off_bag_innerHTML, lb2);
if(log_this && bak_bag_innerHTML) log("...bak_bag_innerHTML %c"+bak_bag_innerHTML, lb3);
pat_bag.title
    = "PAT "+csv_count(pat_csv)+LF
    + "OFF "+csv_count(off_csv) + " .. BAK "+csv_count(bak_csv) + " .. ALT "+csv_count(alt_csv)
    ;

    /*}}}*/
    /* [grid_bag] {{{*/
    let needs_grid_bag
        = true
/*{{{
        =  (csv_count(off_csv) >= 10)
        || (csv_count(bak_csv) >= 10)
}}}*/
    ;

    if(has_el_class(pat_bag, "grid_bag") != needs_grid_bag)
    {
        set_el_class_on_off(pat_bag, "grid_bag", needs_grid_bag);

        t_log_transcript_info("<span style='"+ (needs_grid_bag ? "color:red" : "color:green"                 ) +";'>"+SYMBOL_BLACK_CIRCLE+"</span>"
            +                 "<span style='"+ (needs_grid_bag ?          "" : "text-decoration:line-through") +";'>  grid_bag             </span>"
        );
    }

    /*}}}*/
    /* [off_bag.empty] {{{*/
    let empty   = (csv_count(off_csv) == 0);
    set_el_class_on_off(off_bag, "empty", empty);
/*

*/
    /*}}}*/
    /* innerHTML .. [afterbegin beforeend] {{{*/
    if(pat_bag_innerHTML) pat_bag.insertAdjacentHTML("beforeend", pat_bag_innerHTML);
    if(off_bag_innerHTML) off_bag.insertAdjacentHTML("beforeend", off_bag_innerHTML);
    if(bak_bag_innerHTML) bak_bag.insertAdjacentHTML("beforeend", bak_bag_innerHTML);
    if(alt_bag_innerHTML) alt_bag.insertAdjacentHTML("beforeend", alt_bag_innerHTML);

    /*}}}*/
    /* BAGS ORDER {{{*/
    pat_bag.appendChild(off_bag);
    pat_bag.appendChild(bak_bag);
    pat_bag.appendChild(alt_bag);
    pat_bag.appendChild(bot_div);

    /*}}}*/
};
/*}}}*/
/*_ t_get_docker_bag_msg {{{*/
let t_get_docker_bag_msg = function(bag_name, mov_count, ass_count, ins_count)
{
    let ccX
        = (bag_name == "pat") ? "cc1"
        : (bag_name == "off") ? "cc5"
        : (bag_name == "bak") ? "cc2"
        : (bag_name == "bin") ? "cc0"
        : ""
    ;

    let            docker_bag_msg  = "";
    if(ins_count ) docker_bag_msg += " <em class='done "+ccX+"'> INSERTED</em> <em class='bags "+ccX+"'>"+ bag_name +" + "+ ins_count +"</em>";
    if(mov_count ) docker_bag_msg += " <em class='done "+ccX+"'>    MOVED</em> <em class='bags "+ccX+"'>"+ bag_name +" + "+ mov_count +"</em>";
    if(ass_count ) docker_bag_msg += " <em class='done "+ccX+"'>CONFIRMED</em> <em class='bags "+ccX+"'>"+ bag_name +" = "+ ass_count +"</em>";

    if(!docker_bag_msg) return "";
    else                return "<br>"+ SYMBOL_DOCKER+" "+docker_bag_msg;
};
/*}}}*/

/*_ t_set_1_sel_bag_innerHTML {{{*/
let t_set_1_sel_bag_innerHTML = function()
{
    let caller = "t_set_1_sel_bag_innerHTML";
let log_this = LOG_MAP.S3_SLOT;

    let sel_bag = get_tool("sel_bag");
    if(!sel_bag) return;
    let sel_bag_innerHTML = "";

    for(let slot = 1; slot < ccs.length; ++slot) {
        if(       ccs[slot]
            &&    ccs[slot].nodes[0]
            &&    ccs[slot].nodes[0].textContent
        ) {
            sel_bag_innerHTML += t_get_2_sel_bag_line(slot) +"<br>";
        }
    }

    if(sel_bag_innerHTML)
        sel_bag_innerHTML = "<span class='seeker_handle left'></span>"+ sel_bag_innerHTML;

if(log_this) log("%c "+caller+": sel_bag_innerHTML:%c<br>"+sel_bag_innerHTML, lbF+lb1, lb1);

    t_cleanup_div( sel_bag );
    sel_bag.insertAdjacentHTML("beforeend", sel_bag_innerHTML);
};
/*}}}*/
/*_ t_get_2_sel_bag_line {{{*/
let t_get_2_sel_bag_line = function(slot)
{
    let count   = ccs[slot].nodes.length;
    let title   = ccs[slot].toString();
    let pattern = ccs[slot].pattern;

    return "<div class='select"+slot+"'>"
        +   "<em id='thumb_p_"+slot+"' title='"+title     +"'>"+ellipsis(pattern, 32)+"</em>"
        +   t_get_3_sel_bag_thumbs_EM(slot, "thumb_p")
        +  "</div>"
    ;

};
/*}}}*/
/*_ t_get_3_sel_bag_thumbs_EM {{{*/
let BAG_MAX_ELLIPSIS      = 7;
let BAG_MIN_ELLIPSIS      = Math.ceil(BAG_MAX_ELLIPSIS / 3);
let t_get_3_sel_bag_thumbs_EM = function(slot, id_prefix)
{
    let thumbs_line = "";

    let count   = ccs[slot].thumbs.length;

    for(let num = 1; num <= count; ++num)
    {
/*{{{
        if(ccs[slot].thumbs [num-1] <= 0) {
logXXX("t_get_3_sel_bag_thumbs_EM: NOT DISPLAYED: "+ ccs[slot].toString())

        }
}}}*/
        /* ... before and after center-ellipsis */
        if(    (        count <= BAG_MAX_ELLIPSIS )
            || (num <=           BAG_MIN_ELLIPSIS )
            || (num >= (count -  BAG_MIN_ELLIPSIS))
        ) {
            let percent = get_thumb_p_str(ccs[slot].thumbs [num-1]);
            thumbs_line
                += "<em        id='"+id_prefix+"_" +     slot  +"_"+  num    +"'"
                +  " data-thumb_p='"+                ccs[slot].thumbs[num-1] +"'"
                +  "        title='"+                             percent    +"'"
                +  ">"+                                        String(num)   +"</em>"
            ;
        }
        /* insert a center ellipsis */
        else if(num  == (BAG_MIN_ELLIPSIS+1)) {
            thumbs_line
                += "<em        id='"+id_prefix+"_"+slot+"_0'"
                +  " data-thumb_p=''"
                +  "        class='ellipsis'"
                +  "        title='"+SYMBOL_E+"'"
                +  ">"+              SYMBOL_E +"</em>"
            ;
        }
    }

    return thumbs_line;
};
/*}}}*/

/*_ t_collect_el_class_from_into {{{*/
let t_collect_el_class_from_into = function(el_class, from, into)
{
    let spans = from.getElementsByTagName("SPAN");
    let count = 0;
    for(let i=0; i < spans.length; ++i)
    {
        if(              from != spans[i].parentNode  ) continue; /* not a direct child */
        if( t_is_accessory_node( spans[i]           ) ) continue;
        if(!has_el_class(        spans[i], el_class ) ) continue;
        into.push(spans[i]);
        count += 1;
    }
    return count;
};
/*}}}*/
/*_ t_is_accessory_node {{{*/
let t_is_accessory_node = function(node)
{
    return (node == bak_bag             )
        || (node == off_bag             )
        || (node == bot_div             )
        || (node == mov_div             )
/*
        || (node == bak_bag_place_holder)
        || (node == off_bag_place_holder)
        || (node == pat_bag_place_holder)
*/
        || (node == hov1                )
        || (node == hov2                )
        || (node == hov3                )
        || (node == hov4                )

        || has_el_class(node, "seeker_handle")
        || has_el_class(node, "screener"     )

        || has_el_class(node, "push_pin"     )
        || has_el_class(node, "closepin"     )
        || has_el_class(node, "scalepin"     )
        || has_el_class(node, "clearpin"     )

    ;
};
/*}}}*/
/*_ t_sync_pat_span_class {{{*/
let t_sync_pat_span_class = function(pat, pat_span, pat_off=true)
{
    let el = pat_span.childNodes[2];

    let ccX = pat_off ? 0 : (get_slot_of_pattern(pat) % 10);
    let css_class
        = "cc"+ ccX
        + (has_el_class(el, "mov_src") ? " mov_src" : "")
    ;

    set_el_class(el, css_class);
};
/*}}}*/
/*_ t_cleanup_div {{{*/
let t_cleanup_div = function(div)
{
/*{{{*/
    let caller = "t_cleanup_div";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log(caller+"("+get_id_or_tag(div)+")");
/*}}}*/

    let  count = 0;
    let length = div.childNodes.length;
    let node_removed;
    for(let i=0; i < length; i += (node_removed ? 0 : 1))
    {
        let node = div.childNodes[i];
        node_removed = false;
        if( t_is_accessory_node(node) )
        {
if(log_this) log("...KEEPING  %c["+get_n_lbl(node) +"]", lbF+lb1);
        }
        else if(node) {
if(log_this) log("...REMOVING %c "+get_id_or_tag(node)+" %c"+node.textContent, lbL, lbR+lf2);
            div.removeChild(node);
            count += 1;
            node_removed = true;
        }
        else {
/*{{{
if(log_this) log("...SKIPPING %c[undefined]"           , lbF+lb8);
}}}*/
        }
    }
if(log_this) log("..."+count+" ["+get_n_lbl(div)+"] transient nodes removed");
};
/*}}}*/

/*_ t_get_pat_span_line {{{*/
let t_get_pat_span_line = function(num,pat,css_class,txt)
{
/*
logXXX("___________pat_=["+           pat +"]")
logXXX("csv_escape(pat)=["+csv_escape(pat)+"]")
*/
    return "<span class='pat_span'>"
        +  "<em class='num_em'>"+num+"</em>&nbsp;"
        +  "<em class='"+css_class+"' title='"+csv_escape(pat)+"'>"+txt+"</em>"
        +  "</span>"
    ;
};
/*}}}*/
/*_ t_get_pat_span_index {{{*/
let t_get_pat_span_index = function(pat_spans, pat)
{
    for(let pat_span_index=0; pat_span_index < pat_spans.length; ++pat_span_index)
    {
        if(pat_spans[pat_span_index] == null) continue;

        let el = pat_spans[pat_span_index].childNodes[2];

        let el_pat  = csv_unescape(el.title);
        if( el_pat == pat)
        {
/*
logXXX("t_get_pat_span_index: ...return "+pat_span_index+"")
logXXX("___el.title=["+ el.title +"]")
logXXX("_____el_pat=["+   el_pat +"]")
logXXX("________pat=["+      pat +"]")
*/
            return pat_span_index;
        }
    }
    return -1;
};
/*}}}*/
/*}}}*/

/** SEARCH */
/*{{{*/
/*_ getElementsByContent {{{*/
let getElementsByContent = function(text)
{
    let caller = "getElementsByContent";
    let result = null;
    try {
        let elements = document.getElementsByTagName("*");

/*log("getElementsByContent("+text+"): searching "+ elements.length +" elements:", "warn");*/

        let deep_containers=[];
        let container = null;
        let text_toLowerCase = text.toLowerCase();
        for(let i = 0; i < elements.length; ++i)
        {
            let        el = elements[i];
            if(        el.textContent ) {
                if(    el.textContent.includes(text)
                    || el.textContent.toLowerCase().includes(text_toLowerCase)
                ) {
                    /*log(i+" childNodes x"+el.childNodes.length+" nodeName=["+el.nodeName+"] text=["+ get_n_txt(el)+"]");*/
                    if     (!container              ) { container = el;                                   /*log_node("CONTAINER:", container);*/ }
                    else if( container.contains(el) ) { container = el;                                   /*log_node("   DEEPER:", container);*/ }
                    else                              { deep_containers.push( container ); container =el; /*log_node("   NOTHER:", container);*/ }
                }
            }
        }

        if( container )
            deep_containers.push( container );

/*log("deep_containers.length=["+deep_containers.length+"]", "warn");*/
        let result = (deep_containers.length > 0)
            ?   deep_containers[0]
            :   null
        ;

/*log_node("getElementsByContent ...return:", result );*/
    }
    catch(ex) { log(caller+": "+ex, "error"); }
    return result;
};
/*}}}*/
/*_ get_n_children {{{ */
let get_n_children = function(node)
{
    let result = node;
    try {
        for(let  i = 0; i < node.childNodes.length; ++i)
            result += " "+i+" ["+node.childNodes[i]+"]"+LF;
    }
    catch(ex) { return "node=["+node+"]:"+ex; }
    return result;
};
/*}}}*/
/*_ get_n_attributes {{{ */
let get_n_attributes = function(node)
{
    if(!node           ) return "*** get_n_attributes( !node ) ***";
    if(!node.attributes) return "";
    let     result = "";
    try {
        for(let  i = 0; i < node.attributes.length; ++i)
            result += "<span class='cc"+(i % SELECT_SLOT_MAX)+"'>"+node.attributes[i].name+": "+ node.attributes[i].value+"</span>";
    }
    catch(ex) { return "*** get_n_attributes("+node+") "+ex +" ***"; }
    return  result;
};
/*}}}*/
/*_ node_has_some_text {{{*/
let node_has_some_text = function(node)
{
    return node.nodeValue
        && node.textContent
        && (trim_alNum_lines(node.textContent).length > 0)
    ;
};
/*}}}*/
/*_ is_node_selected {{{*/
let is_node_selected = function(node)
{
    if(!node) return false;

    let result = false;
    try {
        result = (node.className && node.className.startsWith( SEL_CLASS_PREFIX ));
    } catch(ex) {
/*
console.dir(node);
*/
    }

if(LOG_MAP.S1_RANGE && result) log("is_node_selected("+get_n_lbl(node)+"): ...return "+result);
    return result;
};
/*}}}*/
/*}}}*/

/** NODES */
/*{{{*/

/* pick */
/*_ pick_tag_or_id_node {{{*/
let pick_tag_or_id_node = function(tag_or_id, _caller)
{
/*{{{*/
    let caller = "pick_tag_or_id_node("+tag_or_id+")";
let log_this = LOG_MAP.S1_RANGE;

if(log_this) log(caller+".. CALLED BY ["+_caller+"]");
/*}}}*/
    /* default to body {{{*/
    let node = (!tag_or_id) ? document.body : null;

    let id = tag_or_id;
    /*}}}*/
    /* Note: LOOK FOR A TAG FIRST .. so as to dismiss ID collisions such as [body or html etc.] {{{*/
    /* getElementsByTagName {{{*/
    if(!node) {
        node =    document.getElementsByTagName(  id  )[0] ;

if(log_this) log("document.getElementsByTagName("+id+")[0].....["+get_id_or_tag(node)+"]");
    }
    /*}}}*/
    /* getElementById {{{*/
    if(!node) {
        node =    document.getElementById      (  id      );

if(log_this) log("document.getElementById      ("+id+")........["+get_id_or_tag(node)+"]");
    }
    /*}}}*/
    /* getElementsByContent {{{*/
    if(!node) {
        node =    getElementsByContent         (  tag_or_id );

if(log_this) log("getElementsByContent         ("+tag_or_id+")...["+get_id_or_tag(node)+"]");
    }
    /*}}}*/
if(log_this) console.dir(node);

    /*}}}*/
    /* querySelector(#id) {{{*/
    let selector;
    if(!node ) {
        selector = "#"+id;
if(log_this) log(caller+": NOT FOUND .. trying selector ["+selector+"]");

        node = document.querySelector( selector );
    }
    /*}}}*/
    /* querySelector(.id) {{{*/
    if(!node ) {
        selector = "."+id;
if(log_this) log(caller+": NOT FOUND .. trying selector ["+selector+"]");

        node = document.querySelector( selector );
    }
    /*}}}*/
    /* default to body {{{*/
    if(!node )
    {
if(log_this) log(caller+": NOT FOUND .. using body");

        node = document.body;
    }
    /*}}}*/
    /* default to document {{{*/
    if(!node )
    {
if(log_this) log(caller+": NOT FOUND .. using document");

        node = document;
    }
    /*}}}*/
/*{{{*/
if(log_this) {
    log("<div class='cc8'>");
    log(caller);
    log_node(SYMBOL_CHECK_MARK +" NODE"       , node           );
    log_node(SYMBOL_CHECK_MARK +" PARENT"     , node.parentNode);
    log_node(SYMBOL_CHECK_MARK +" FIRST CHILD", node.firstChild);
    log_node(SYMBOL_CHECK_MARK +" LAST CHILD" , node.lastChild );
    log("</div>");
    log(caller+": ...return "+get_id_or_tag(node));
console.dir(node);
}
/*}}}*/
    return node;
};
/*}}}*/

/* thumb */
/*_ get_node_thumb_p {{{*/
let THUMB_OFFSET = 0;/*64; NOTE: not needed when using onDown_XY*/
let get_node_thumb_p = function(node)
{
/*
logXXX("%c get_node_thumb_p("+get_n_txt(node)+")",lbb+lbH)
*/
    let      node_top = getRealTop(node) - THUMB_OFFSET;
    let            ph = get_page_height();

/*
logXXX("%c.........ph ["+ ph       +"]"           , lbb+lbH+lf5)
logXXX("%c...node_top ["+ node_top +"]"           , lbb+lbH+lf6)
logXXX("%c....thumb_p ["+ 100 * node_top / ph +"]", lbb+lbH+lf7)
console.dir(node)
*/
    return 100 * node_top / ph;
};
/*}}}*/
/*_ get_thumb_p_str {{{*/
let get_thumb_p_str = function(thumb_p)
{
    if(thumb_p < 0) return "";

    let thumb_i = Math.trunc(       thumb_p           );
    let thumb_f = Math.round(100 * (thumb_p - thumb_i)); /* 2 decimals */

    thumb_i = mPadStart(thumb_i,2," ");
    thumb_f = mPadStart(thumb_f,2,"0");

    return (thumb_i +"."+ thumb_f);
};
/*}}}*/

/* log */
/*_ log_tags {{{*/
let log_tags = function()
{
    let                 s  = "";
    tag = "#document" ; s +=        tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "HTML"      ; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "HEAD"      ; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "BODY"      ; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "SCRIPT"    ; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "DIV"       ; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    tag = "BLOCKQUOTE"; s += "    "+tag +" <em class='cc3'>"+ get_h_tag(tag) +"</em>";
    s +="<br>";;
    tag = "SPAN"      ; s +=        tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "EM"        ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "A"         ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "BUTTON"    ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "INPUT"     ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "TEXTAREA"  ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";
    tag = "LI"        ; s += "    "+tag +" <em class='cc4'>"+ get_h_tag(tag) +"</em>";

    log("<div id='log_tags_div'>"+ s +"</div>");
};
/*}}}*/
/*_ log_node {{{*/
let log_node = function(label, node)
{
    if(!node) {
        log(mPadStart(label,16)+" <em></em>");
        return;
    }
    let em_class
        = (node.nodeType == Node.TEXT_NODE   ) ? "cc4"
        : (node.nodeType == Node.COMMENT_NODE) ? "cc8"
        :                                        "cc3"
    ;
    let n_str = get_n_str( node          );
    let p_str = get_p_str( node          );
    let n_tag =            node.nodeName;

    log(mPadStart(label,16)+" <em>"+n_tag+"</em> <em class='"+em_class+"'>"+ p_str +" "+ n_str +"</em>" +" has "+ node.childNodes.length +" childNodes");
};
/*}}}*/

/*}}}*/

/** TOOLS */
/*{{{*/
/*_ set_tools_filter {{{ */
let set_tools_filter = function(text)
{
    t_set_tool_id_value("tools_filter", text);
};
/*}}}*/
/*_ sayHello {{{ */
let sayHello = function()
{
    let caller = "sayHello"; log(caller);
    log_clear(caller);
    try       { log_HTML = caller+": OK";            }
    catch(ex) { log      ( caller+": "+ex, "error"); }
    return      log_HTML;
};
/*}}}*/
/*}}}*/

/*}}}*/
//# sourceURL=dom_select.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**   9  WORDING  JS dom_wording_js_data {{{*/
/*
../javascript/dom_wording.js
*/
dom_wording_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_wording */
let DOM_WORDING_JS_ID       = 'dom_wording_js';
let DOM_WORDING_JS_TAG      = DOM_WORDING_JS_ID +' (181229:15h)'; let tag = DOM_WORDING_JS_TAG;
let DOM_WORDING_CSS_ID      = 'dom_wording_css';

/*_ dom_wording_cycle {{{*/
let dom_wording_cycle = function(stage='OFF', anchor_freeze=true)
{
    let caller = "dom_wording_cycle(stage=["+stage+"], anchor_freeze=["+anchor_freeze+"])";
let log_this = LOG_MAP.EV5_TOOL_CB;
if( log_this) log(caller);

    if(!dom_wording_css && !dom_wording_inject()) return;

    dom_wording_css.className
        = (    stage          && (stage  != 'CYCLE')) ?  stage  /* stage set argument */
        : (    dom_wording_css.className == 'DARK' )  ? 'LIGHT' /* stage 1 to stage 2 */
        : (    dom_wording_css.className == 'LIGHT')  ? 'OFF'   /* stage 2 to stage 3 */
        :                                               'DARK'  /* ...back to stage 0 */
        ;

/*
    dom_wording_by_href (anchor_freeze);
*/
    dom_wording_activate(anchor_freeze);

};
/*}}}*/
/*_ dom_wording_activate {{{*/
let dom_wording_activate = function(anchor_freeze)
{
/*{{{*/
let   caller = "dom_wording_activate(anchor_freeze "+anchor_freeze+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/
    /* COMPOSE .. [W]ord [A]nchor [L]ight [D]ark {{{*/
    let anchor = anchor_freeze ? "a" : "A";

    let wording, theme;
    switch( dom_wording_css.className ) {
        case 'DARK' : wording = "W" ; theme = "D"; break;
        case 'LIGHT': wording = "W" ; theme = "L"; break;
        default:
        case 'OFF'  : wording = "w" ; theme = "" ; break;
    }
    /*}}}*/
    /* ACTIVATE ONE OF THE PRELOADED WORDING CSS {{{*/
    let key
        = theme
        + wording
        + anchor
    ;
    let el = css_map[key];
    let found = false;
    for(let i = 0; i< css_map.length; ++i) {
        let      id = css_map[i].id;
        let      el = css_map[i].el;
        found      |= (id == key);
        el.disabled = (id != key);
if(log_this && !el.disabled) logBIG("WORDING CSS: "+i+". id ["+css_map[i].id+"] .. el ["+get_id_or_tag(css_map[i].el)+"]");
    }
    /*}}}*/
if(!found) console.warn("*** "+caller+": ["+key+"] NOT FOUND IN PRELOADED [css_map]");
    /* ADD-REMOVE CLICK EVENT LISTENER {{{*/
    if(anchor_freeze) document.body.addEventListener   ('click', dom_wording_capture_click, true);
    else              document.body.removeEventListener('click', dom_wording_capture_click, true);
    /*}}}*/
};
/*}}}*/
/*_ dom_wording_inject {{{*/
let dom_wording_css;
let dom_wording_inject = function()
{
    if(!dom_wording_css) dom_wording_init();
    return dom_wording_css;
};
/*}}}*/
/*_ dom_wording_init {{{*/
let css_map = [];

let anchor_on;
let anchor_off;
let wording_on;
let wording_off;
let light_theme;
let dark_theme;

let dom_wording_init = function()
{
let caller = "dom_wording_init";
let log_this = LOG_MAP.EV5_TOOL_CB;
if( log_this) log(caller+": INSERTING ["+DOM_WORDING_CSS_ID+"]");
    /* anchor on-off {{{*/
    anchor_on
        = ''
/*      + ' html     {                margin : 8px                     !important; }'*/
        + ' a        {                 color : initial;                            }'
        + ' a        {      background-color : initial;                            }'
/*      + ' a        {           font-weight : initial;                            }'*/
        + ' a, input { text-decoration-style : initial;                            }'
/*{{{
            + ' a,  a *  {        pointer-events : initial;                       }'
            + '     a em {        pointer-events : initial;                       }'
}}}*/
    ;

    anchor_off
        = ''
/*      + ' html            {           margin : 8px                   !important; }'*/
        + ' a, a *          {           cursor : text;                             }'
        + ' a               {            color : #FFF                  !important; }'
        + ' a               {      text-shadow : 1px 1px 2px black     !important; }'
        + ' a               { background-color : #888                  !important; }'
        + ' a               {    border-radius : 1em                   !important; }'
        + ' .toolbag_button {           cursor : not-allowed;                      }'
        + ' .toolbag_button {            color : #222                  !important; }'
        + ' .toolbag_button { background-color : rgba(128,128,128,0.5) !important; }'
/*      + ' a              {       font-weight : 800                   !important; }'*/
/*{{{
        + ' a,  a *  {               pointer-events : none             !important; }'
        + '     a em {               pointer-events : none             !important; }'
        + '.select_words_exact     { pointer-events : initial          !important; }'
        + '.select_words_head_tail { pointer-events : initial          !important; }'
        + '.select_words_segment   { pointer-events : initial          !important; }'
}}}*/
    ;
    /*}}}*/
    /* wording on-off {{{*/
    wording_on
        = ''
/*      + ' html     {               outline : 50px dashed rgba(64,0,255,0.7);     }'*/
/*      + ' body     {         margin-bottom : 100%;                               }'*/
        + ' a, input { text-decoration-style : solid;                              }'
/*      + ' *        {         overflow      : visible                 !important; }'*/
    /*{{{
        + ' a *      {                cursor : pointer                !important; }'
        + ' a em     {                cursor : all-scroll             !important; }'
        + ' a, a *   {                cursor : text                   !important; }'
        + ' a, input { text-decoration-line  : line-through           !important; }'
        + ' a:visited{                cursor : cell                   !important; }'
}}}*/
    ;

    wording_off
        = ''
        + ' html     {               outline : 8px dotted #4448;                  }'
/*{{{
        + ' html     {               outline : 8px solid transparent  !important; }'
        + ' body     {                border : initial;                           }'
        + ' *        {                 color : initial                !important; }'
        + ' *        {            background : initial                !important; }'
        + ' a        {                 color : initial                !important; }'
        + ' a, input { text-decoration-color : initial                !important; }'
        + ' a, input { text-decoration-line  : initial                !important; }'
        + ' a:visited{                cursor : initial                !important; }'
}}}*/
    ;


    /*}}}*/
    /* theme light dark {{{*/
    light_theme = ''
        + ' :not(em) {                 color : #333                   !important; }'
        + ' :not(em) {            background : rgba(238,238,238,0.86) !important; }'
/*
        + ' a        {            background : rgba(221,187,187,0.53) !important; }'
        + ' a, input { text-decoration-color : #0AF                   !important; }'
*/
    ;

    dark_theme
        = ''
        + ' :not(em) {                 color : #CCC                   !important; }'
        + ' :not(em) {            background : rgba(017,017,017,0.86) !important; }'
/*
        + ' a        {            background : rgba(051,000,000,0.53) !important; }'
        + ' a, input { text-decoration-color : #0F0                   !important; }'
*/
    ;

    /*}}}*/
    /* DOM_WORDING_JS_TAG {{{*/
    let         sig = "#"+DOM_WORDING_CSS_ID+" { content: "+DOM_WORDING_JS_TAG+"; } ";
    let          id = DOM_WORDING_CSS_ID;
    let          su = "/*# sourceURL=dom_wording.js */";
    let        data = 'data:text/css,'+escape(su +"\\n"+ sig);

    dom_wording_css = dom_wording_inject_css(id, data);
    /*}}}*/
    /* DOM_WORDING CSS PRELOAD .. [W]ord [A]nchor [L]ight [D]ark {{{*/

    let el;
    id="DWA"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +dark_theme  +wording_on  +anchor_on  );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id="LWA"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +light_theme +wording_on  +anchor_on  );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id="DWa"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +dark_theme  +wording_on  +anchor_off );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id="LWa"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +light_theme +wording_on  +anchor_off );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});

    id= "wA"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */"              +wording_off +anchor_on  );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id="DwA"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +dark_theme  +wording_off +anchor_on  );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id="LwA"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */" +light_theme +wording_off +anchor_on  );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});
    id= "wa"; data= 'data:text/css,'+escape("/*# sourceURL="+id+" */"              +wording_off +anchor_off );  el = dom_wording_inject_css(id, data);  css_map.push({id:id , el:el});

/*{{{
for(let [id, el] of css_map) log(". id=["+id+"] el=["+ellipsis(el, 64)+"]");
for(let i = 0; i< css_map.length; ++i) log(i+". id ["+css_map[i].id+"] .. el ["+get_id_or_tag(css_map[i].el)+"]");
}}}*/
    /*}}}*/
};
/*}}}*/
/*_ dom_wording_inject_css {{{*/
let dom_wording_inject_css = function(id, link_or_data)
{
    let el  = document.createElement("link");
    el.id   = id;
    el.type = "text/css";
    el.rel  = "stylesheet";
    el.href = link_or_data;
    document.getElementsByTagName("head")[0].appendChild(el);
    return el;
};
/*}}}*/
/*_ dom_wording_by_href {{{*/
let dom_wording_by_href = function(anchor_freeze)
{
/*
log("dom_wording_by_href(anchor_freeze "+anchor_freeze+")");
*/
    let          sig = "#"+DOM_WORDING_CSS_ID+" { content: "+DOM_WORDING_JS_TAG+"; } ";
    let anchor_style = anchor_freeze ? anchor_off : anchor_on;

    let data;
    switch( dom_wording_css.className )
    {
        default:
        case "DARK" : data = sig + anchor_style + wording_on  + dark_theme ; break;
        case "LIGHT": data = sig + anchor_style + wording_on  + light_theme; break;
        case "OFF"  : data = sig + anchor_style + wording_off              ; break;

    }
    dom_wording_css. href = "data:text/css,"+ escape( data );

    if(anchor_freeze) document.body.addEventListener   ('click', dom_wording_capture_click, true);
    else              document.body.removeEventListener('click', dom_wording_capture_click, true);
};
/*}}}*/
/*_ dom_wording_capture_click {{{*/
let dom_wording_capture_click = function(e)
{
    if( e.ctrlKey ) return;

    if( e.stopPropagation          ) e.stopPropagation();           /* stop bubbling phase #3 handlers */
    if( e.stopImmediatePropagation ) e.stopImmediatePropagation();  /* stop   target phase #2 handlers */
    if( e.preventDefault           ) e.preventDefault();            /* i.e. return false from within on<event> attribute handler */
/*
console.log("dom_wording_capture_click");
console.dir(e);
*/
};
/*}}}*/

/*}}}*/
//# sourceURL=dom_wording.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**   10  GRID  JS dom_grid_js_data {{{*/
/*
../javascript/dom_grid.js
*/
dom_grid_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_grid_js */
let DOM_GRID_JS_ID          = 'dom_grid_js';
let DOM_GRID_JS_TAG         = DOM_GRID_JS_ID    +' (181229:17h)';

/*_ {{{*/
const GRID_CAPTION    = "grid_caption";
const GRID_MARGIN_TOP = 180;

/*}}}*/

/* GRID TOOLS */
/*_ t_grid_TOOLS_SELECT {{{ */
let t_grid_TOOLS_SELECT = function(e)
{
    /* GRID_CAPTION {{{*/
    if(e.ctrlKey) return;
let log_this = LOG_MAP.T2_GRID;

    let caller = "t_grid_TOOLS_SELECT";
    let     el = t_get_event_target(e);
    let     caption = el.classList.contains(GRID_CAPTION) ? el : el.parentNode;
if(log_this) log(caller+": el=["+get_n_lbl(el)+"]");
/*
if(log_this) log("...caption..........=["+ get_n_lbl(caption) +"]");
if(log_this) log("...caption........id=["+ caption.id         +"]");
if(log_this) log("...caption.classList=["+ caption.classList  +"]");
*/
    /*}}}*/
    /* CAPTURE EVENT {{{*/
    let actions = "";
    if( e.preventDefault ) { e.preventDefault();        actions += " preventDefault" ; }
    if( e.stopPropagation) { e.stopPropagation();       actions += " stopPropagation"; }
    /*else*/               { e.cancelBubble = true;     actions += " cancelBubble"   ; }
log_this = logging_something();;
if(log_this) log(caller+": ...actions=["+actions+" ]");

    /*}}}*/
    t_grid_TOOLS_SELECT_caption( caption );
};
/* }}} */
/*_ t_grid_TOOLS_SELECT_caption {{{*/
let t_grid_TOOLS_SELECT_caption = function(caption)
{
    /*{{{*/
    let caller = "t_grid_TOOLS_SELECT_caption";
let log_this = LOG_MAP.T2_GRID;

if(log_this) log(caller+": caption=["+get_n_lbl(caption)+"]");
if(log_this) log("...caption.id=["+caption.id+"]");
    /*}}}*/
    /* SELECTING - DESELECTING {{{*/
    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
        if( panel == hotspot) continue;
        let caption_id  = panel.id+"_"+GRID_CAPTION;
if(log_this) log("...caption_id=["+caption_id+"]");
        if(caption_id == caption.id) {
            t_grid_TOOLS_SELECT_panel(panel, "toggle");
            t_grid_caption_sync_opacity(map.selected, caption);
            break;
        }
    }
    /*}}}*/
};
/*}}}*/
/*_ t_grid_TOOLS_SELECT_panel {{{*/
let t_grid_TOOLS_SELECT_panel = function(panel,new_state="toggle")
{
    let caller = "t_grid_TOOLS_SELECT_panel("+get_n_lbl(panel)+", "+new_state+")";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);

    /* check current panel selection state */
    let      map  = tools_map_get(panel);

    if(new_state == "toggle") new_state = !map.selected;

if( log_this) log("%c "+caller+": new_state=["+new_state+"]",lb9+lbF);

    /* select or deselect panel */
    if(map.selected != new_state)
    {
        map.selected = new_state;
if(log_this) log("... %c "+(map.selected ? "SELECTING" : "DESELECTING") + ": "+panel.id, lbF+(map.selected ? lb4 : lb1));

        store_set_state(panel.id+".selected", map.selected);

        t_cache_init_by(caller);
    }
};
/*}}}*/

/* GRID SELECT */
/*_ t_grid_caption_layout {{{*/
let t_grid_caption_layout = function(num, panel_id, x, y, el)
{
    /* create or get caption element {{{*/
    let caller = "t_grid_caption_layout(num="+num+", panel_id="+panel_id+", x="+x+", y="+y+", el="+el.panel_id+")";
let log_this = LOG_MAP.T2_GRID;
if( log_this) log(caller);

    let           gl = t_getElement(panel_id+"_"+GRID_CAPTION);
    if(!gl) {
        gl           = document.createElement("EM");
        gl.       id = panel_id+"_"+GRID_CAPTION;
        gl.    title = panel_id;
        gl.className = GRID_CAPTION;

        if     (dom_grid_html) { dom_grid_html.appendChild(gl); if(log_this) log("dom_grid_html: "+caller); }
        else if(shadow_root  ) { shadow_root  .appendChild(gl); if(log_this) log(  "shadow_root: "+caller); }
        else                   { document.body.appendChild(gl); if(log_this) log("document.body: "+caller); }
/*
        add_listener_capture_active(gl, "click", t_grid_TOOLS_SELECT);
*/
    }
    /*}}}*/
    /* show control ID {{{*/
    gl.innerHTML       = num+" <em>"+panel_id+"</em>";
    gl.style.zIndex    = ZINDEX_ON_GRID;
    gl.style.position  = "fixed";
    gl.style.left      = (x      )+"px";

    /*}}}*/
    /* Caption layout {{{*/
    gl.style.top       = (y      )+"px";
    gl.style.maxHeight = grid_sized ? (t_gh-t_mg)+"px" : el.clientHeight+"px";
    gl.style.maxWidth  = grid_sized ? (t_gw-t_mg)+"px" : el.clientWidth +"px";
    gl.style.minHeight = grid_sized ? (t_gh-t_mg)+"px" : el.clientHeight+"px";
    gl.style.minWidth  = grid_sized ? (t_gw-t_mg)+"px" : el.clientWidth +"px";

    /*}}}*/
    return gl;
};
/*}}}*/
/*_ t_grid_caption_hide_all {{{*/
let t_grid_caption_hide_all = function()
{
    let caller = "t_grid_caption_hide_all";
let log_this = LOG_MAP.T2_GRID;
if( log_this) log(caller);

    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
        if( panel == hotspot) continue;
        let    gl  = t_getElement(panel.id+"_"+GRID_CAPTION);
        if(!gl)  continue;
        gl.classList.remove("grid_caption_show");
        gl.classList.add   ("grid_caption_hide");
    }
};
/*}}}*/
/*_ t_grid_caption_sync_opacity {{{*/
let t_grid_caption_sync_opacity = function(selected, gl)
{
    if(selected) gl.classList.add   ("grid_caption_see_through");
    else         gl.classList.remove("grid_caption_see_through");
};
/*}}}*/

/* GRID EVENTS */
/*_ t_grid_onresize {{{*/
const T_GRID_ONRESIZE_DELAY = 500;
let t_grid_onresize_timer   = null;

let t_grid_onresize  = function(caller)
{
let log_this = LOG_MAP.T2_GRID;
if( log_this) log("t_grid_onresize(caller "+caller+")");

    if(t_grid_onresize_timer) clearTimeout(t_grid_onresize_timer);
    t_grid_onresize_timer   = setTimeout  (t_grid_onresize_handle, T_GRID_ONRESIZE_DELAY);
};

let t_grid_onresize_handle = function()
{
    let caller = "t_grid_onresize_handle";

    if( t_grid_IS_ON_GRID(caller) )
        _t_grid_LAYOUT_ON();

    t_grid_onresize_timer = null;

    t_grid_onWork_EL_changed(caller);
};
/*}}}*/
/*_ t_grid_onWork_EL_changed {{{*/
/*{{{*/
const T_GRID_ONWORK_EL_CHANGED_TIMER_DELAY = 500;
let   t_grid_onWork_EL_changed_timer       = null;

/*}}}*/
/*_ t_grid_onWork_EL_changed {{{*/
let t_grid_onWork_EL_changed = function(caller)
{
if(LOG_MAP.T2_GRID) log("t_grid_onWork_EL_changed(caller "+caller+")");
    if(t_grid_onWork_EL_changed_timer) clearTimeout(t_grid_onWork_EL_changed_timer);
    t_grid_onWork_EL_changed_timer   = setTimeout  (t_grid_onWork_EL_changed_handler, T_GRID_ONWORK_EL_CHANGED_TIMER_DELAY);
};
/*}}}*/
/*_ t_grid_onWork_EL_changed_handler {{{*/
let t_grid_onWork_EL_changed_handler = function()
{
    let caller = "t_grid_onWork_EL_changed_handler";
if(LOG_MAP.T2_GRID) log("%c "+caller+": LOG_MAP.T2_GRID=["+LOG_MAP.T2_GRID+"]",lb9+lbF);
    /* GRID LOGGING ON-OFF {{{*/
    if(typeof t_get_onWork_EL_last_used == undefined) return;

    let  el = t_getElement("headsup_l_check"); if(!el) return;

    if(!LOG_MAP.T2_GRID) el.innerHTML="GRID LOGGING IS OFF";

    /*}}}*/
    /* [dom_grid_playground] {{{*/
    let dom_grid_playground = t_getElement("dom_grid_playground");
    if(dom_grid_playground) {
        if(!LOG_MAP.T2_GRID) dom_grid_playground.classList.add   ("collapsed");
        else                 dom_grid_playground.classList.remove("collapsed");
    }
    /*}}}*/
    if(!LOG_MAP.T2_GRID) return;
    /* NOT SELECTED {{{*/
    let ol = t_get_onWork_EL_last_used();
    if(!ol) {
        el.innerHTML = "<em>onWork_EL</em> <em class='cc0'>NOT SELECTED</em>";

        return;
    }
    /*}}}*/

    let cw = ol.clientWidth; let ch = ol.clientHeight;
    let ow = ol.offsetWidth; let oh = ol.offsetHeight;
    let sw = ol.scrollWidth; let sh = ol.scrollHeight;

    let t, w, h;
/*
    try {
*/
        let style = getComputedStyle(ol);
        t =          style.transform;
        w = parseInt(style.width );
        h = parseInt(style.height);
/*
    } catch(ex) {
    log(caller+": "+ex.toString());
        t = "";
        w = window.innerWidth;
        h = window.innerHeight;
}
*/

/*
    let mU = ol.style.marginTop;
    let mR = ol.style.marginRight;
    let mD = ol.style.marginBottom;
    let mL = ol.style.marginLeft;
console.dir(ol);
console.dir(style);
*/
    let info
        = " transform    <em class='cc7'>"+ t                      +"</em> "
        + " computed WxH <em class='cc8'>"+ w+" x "+h              +"</em> "
        + " page height  <em class='cc7'>"+ get_page_height()      +"</em> "
/*
        + " margin [URDL]<em class='cc9'>"+ mU+" "+mR+" "+mD+" "+mL+"</em> "
*/
        ;

    el.innerHTML
        = "<table style='border-spacing:1em;'>"
        + " <tr><th class='cc9' style='font-size:200%; font-weight:900;'>"+get_n_lbl(ol)+"</th> <td colspan='4'>"+info+"</td> </tr>"
        + " <tr><th>Offset</th> <td class='cc6'>"+ow  +"</td> <td>x</td> <td class='cc3'>"+oh+"</td> <td><span class='cc1'>+VIEWABLE</span> <span class='cc3'>+PADDING</span> <span class='cc4'>+BORDER</span> <span class='cc5'>+SCROLLBAR</span> <span class='ccA'>-margin</span><td></tr>"
        + " <tr><th>Client</th> <td class='cc7'>"+cw  +"</td> <td>x</td> <td class='cc4'>"+ch+"</td> <td><span class='cc1'>+VIEWABLE</span> <span class='cc3'>+PADDING</span> <span class='ccA'>-border</span> <span class='ccA'>-scrollbar</span> <span class='ccA'>-margin</span><td></tr>"
        + " <tr><th>Scroll</th> <td class='cc8'>"+sw  +"</td> <td>x</td> <td class='cc5'>"+sh+"</td> <td><span class='cc2'>+OVERFLOW</span> <span class='cc3'>+PADDING</span> <span class='ccA'>-border</span> <span class='ccA'>-scrollbar</span> <span class='ccA'>-margin</span><td></tr>"
        + "</table>"
    ;

};
/*}}}*/
/*}}}*/
/*_ t_grid_ON_OFF_CB {{{*/
let t_grid_ON_CB     = function() { t_grid_ON_OFF_CB( true); };
let t_grid_OFF_CB    = function() { t_grid_ON_OFF_CB(false); };
let t_grid_ON_OFF_CB = function(new_state)
{
    let caller = "t_grid_ON_OFF_CB("+new_state+")";

let log_this = LOG_MAP.T2_GRID;

    if(new_state == "toggle") new_state = !t_grid_IS_ON_GRID(caller);
if( log_this) log("%c "+caller+": new_state=["+new_state+"]",lb9+lbF);

    if( new_state ) { if(typeof dimm_start != undefined) dimm_start(caller); }
    else            { if(typeof dimm_stop  != undefined) dimm_stop (caller); }

    if(!new_state )   t_update_TOOLS_MAP_GEOMETRY(caller); /* not when grid_sized */

    if( new_state ) { t_grid_SIZE_ON (); _t_grid_LAYOUT_ON (); }
    else            { t_grid_SIZE_OFF(); _t_grid_LAYOUT_OFF(); }

    call_t_grid_observers(new_state);

};
/*}}}*/
/*_ t_grid_add_observer_callback {{{*/

let t_grid_observer_callbacks = [];

let t_grid_add_observer_callback = function(observer)
{
if(LOG_MAP.T2_GRID) console_log("t_grid_add_observer_callback("+(t_grid_observer_callbacks.length+1)+")");

    if(!t_grid_observer_callbacks.includes( observer ))
        t_grid_observer_callbacks.push    ( observer );
};

let call_t_grid_observers = function(state)
{
if(LOG_MAP.T2_GRID) console_log("call_t_grid_observers("+state+")");

    for(let i=0; i < t_grid_observer_callbacks.length; ++i)
        t_grid_observer_callbacks[i]( state );
};
/*}}}*/
/*_ t_grid_sized_sync {{{*/
let t_grid_sized_sync = function(caller)
{
let log_this = LOG_MAP.T2_GRID;
if( log_this) log("%c t_grid_sized_sync: CALLED BY ["+caller+"] .. grid_sized=["+grid_sized+"]", lb3);

    let n;
    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
        if( panel == hotspot) continue;
        if(!panel           ) continue;
        el = panel;
/*
log("..."+get_n_lbl(el)+": WH"
    +"  style=["+el.style.width+" x "+el.style.height+"]"
    +" client=["+el.clientWidth+" x "+el.clientHeight+"]"
    +" offset=["+el.offsetWidth+" x "+el.offsetHeight+"]"
    +" scroll=["+el.scrollWidth+" x "+el.scrollHeight+"]"
    +"  xy_wh=["+    map.w+" x "+     map.h+"]"
);
*/
/*
console.dir(el);
*/
        el.style.maxHeight = grid_sized ? (t_gh-t_mg)+"px" : "";
        el.style.maxWidth  = grid_sized ? (t_gw-t_mg)+"px" : "";
        el.style.minHeight = grid_sized ? (t_gh-t_mg)+"px" : "";
        el.style.minWidth  = grid_sized ? (t_gw-t_mg)+"px" : "";
/*
*/
        /* clientWidth offsetWidth scrollWidth */
/*
        let scaleX  = grid_sized ? Math.min(t_gw/el.offsetWidth, t_gh/el.offsetHeight) : 1;
        let scaleY  = scaleX;
*/
/*
        let scaleY = grid_sized ?                              t_gh/el.offsetHeight  : 1;
        let scaleX = grid_sized ?          t_gw/el.offsetWidth                       : 1;

        let scaleY = grid_sized ?                              t_gh/map.h     : 1;
        let scaleX = grid_sized ?          t_gw/map.w                         : 1;
*/
/*
        let scaleY = grid_sized ?                              t_gh/panel.offsetHeight : 1;
        let scaleX = grid_sized ?          t_gw/panel.offsetWidth                      : 1;
        el.style.transform = "scale("+scaleX+","+scaleY+")";
log("el=["+get_n_lbl(el)+"].style.transform=["+el.style.transform+"]");
*/
/*
     if(grid_sized) el.style.animation = "on_grid_enter 200ms "+n+"00ms ease-out forwards";
     else           el.style.animation = "on_grid_leave 200ms "+n+"00ms ease-out forwards";
*/

    }
};
/*}}}*/

/* GRID SIZE */
/*_ t_grid_SIZE_TOGGLE {{{*/
let   grid_sized     = false;

let t_grid_SIZE_TOGGLE = function(e)
{
    let caller = "t_grid_SIZE_TOGGLE("+get_n_lbl(e.target)+")";
if(LOG_MAP.T2_GRID) console_log(caller);

    if(!tools_map.length) return;

    /* GRID GEOMETRY */
    t_grid_MEASURE();

    /* TOOLS TOGGLE ON OR OFF GRID GEOMETRY */
    if(grid_sized ) t_grid_SIZE_OFF();
    else            t_grid_SIZE_ON ();

    /* TOOLS TOGGLE ON OR OFF GRID LOCATION */
    let el = tools_map[0].panel;
    if( el.classList.contains("on_grid")) _t_grid_LAYOUT_ON();
    else                                   t_grid_sized_sync("t_grid_SIZE_TOGGLE");

};
/*}}}*/
/*_ t_grid_IS_SIZED {{{*/
let t_grid_IS_SIZED = function(caller)
{
if(LOG_MAP.T2_GRID) console_log("t_grid_IS_SIZED: ...return "+grid_sized+" .. caller=["+caller+"]");

    return grid_sized;
};
/*}}}*/
/*_ t_grid_IS_ON_GRID {{{*/
let t_grid_IS_ON_GRID = function(_caller)
{
let log_this = LOG_MAP.T2_GRID;

    if(!tools_map.length) t_load_TOOLS_MAP("t_grid_IS_ON_GRID");

if( log_this) log("%c t_grid_IS_ON_GRID %c CALLED BY "+_caller+" %c "+grid_sized, lbL, lbR, lbH+(grid_sized ? lf4 : lf8));
    return grid_sized;
};
/*}}}*/
/*_ t_grid_SIZE_[ON/OFF/SET] {{{*/
const GRID_SIZED      = "GRID SIZED";
let t_grid_SIZE_ON    = function() { t_grid_SIZE_STATE(true ); };
let t_grid_SIZE_OFF   = function() { t_grid_SIZE_STATE(false); };
let t_grid_SIZE_STATE = function(state)
{
    let caller = "t_grid_SIZE_STATE("+state+")";
if(LOG_MAP.T2_GRID) log("%c "+caller,lb5+lbF);

    let          checkbox         = t_getElement("headsup_l_size_checkbox");
    if(checkbox) checkbox.checked = state;

    grid_sized = state;

    t_grid_onWork_EL_changed(caller);

    /* TOOLS MAY SHOW DIMMER MASK (when grid_sized) */
};
/*}}}*/

/* GRID LAYOUT */
/*_ _t_grid_LAYOUT_OFF {{{*/
let _t_grid_LAYOUT_OFF = function()
{
    let caller = "_t_grid_LAYOUT_OFF";
if(LOG_MAP.T2_GRID) log("%c "+caller,lb9+lbF);

    if(!tools_map  ) return;

    let n = 1;
    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
        if( panel == hotspot) continue;
        if(!panel           ) continue;
        let    el = panel;

        /* remove grid class */
        el.classList.remove("on_grid");
        if(!map.selected)
            el.classList.add("hidden");
/*
        el.classList.remove("eso_div");
*/
        el.classList.remove("select"+n);

        /* restore top-level saved position */
        if(t_tools_loaded && is_a_tool_container(el))
        {
/*{{{
logXXX("RESTORE SAVED POSITION=["+map.x+" "+map.y+"]")
}}}*/
            el.style.position = map.p     ;
            el.style.left     = map.x+"px";
            el.style.top      = map.y+"px";
        }
        else {
            el.style.position = "initial";
/*
            el.style.left     = "initial";
            el.style.top      = "initial";
*/
        }

        n += 1;
    }
    /* restore size */
    t_grid_sized_sync(caller);

    /* hide grid caption */
    t_grid_caption_hide_all();

};
/*}}}*/
/*_ _t_grid_LAYOUT_ON {{{*/
let _t_grid_LAYOUT_ON = function()
{
    let caller  = "_t_grid_LAYOUT_ON";
let log_this = LOG_MAP.T2_GRID;
if(log_this) log("%c "+caller,lb9+lbF);
    /* UPDATE GRID LAYOUT {{{*/
    t_grid_MEASURE();

    /*}}}*/

    let   x = t_mw;
    let   y = t_mh;
    let num = 1;
    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
        if( panel == hotspot) continue;
        if(!panel           ) continue;
        let el = panel;

/*if(log_this) console_log(num+" [xy_wh]=["+x+" "+y+"] ["+t_gw+"x"+t_gh+"] ["+el.id+"]");*/

        /* set on grid */
        el.style.position = "fixed";
        el.classList.remove("hidden" );
        el.classList.add   ("on_grid");
        el.classList.add   ("cc"+num );

        map.x = el.offsetLeft;
        map.y = el.offsetTop;

/*{{{
logXXX("%c"+caller+"%c "+panel.id+" %c "+map.x+" "+map.y, lbH, lbC+lf3, lbH+lf8);
}}}*/

        /* grid position */
        el.style.left     = x+"px";
        el.style.top      = y+"px";

        /* grid caption show */
        let gl = t_grid_caption_layout(num, panel.id, x, y, el);
        gl.classList.remove("grid_caption_hide");
        gl.classList.add   ("grid_caption_show");

        /* grid caption opacity .. f(selected) */
        t_grid_caption_sync_opacity(map.selected, gl);

        /* next cell */
/*if(log_this && ((num % t_rows)==0)) console_log("---");*/
/*
    let dx = Math.max(el.clientWidth , t_gw);
*/
        let dx =                           t_gw ;
        x      = (num % t_cols) ? x + dx :     t_mw;
        y      = (num % t_rows) ? y      : y + t_gh;

        num += 1;
    }

    /* grid size */
    t_grid_sized_sync(caller);

    /* repeat once */
    /*if(!t_grid_onresize_timer) t_grid_onresize(caller+"[repeat once]");*/
};
/*}}}*/

/* GRID MEASURE */
/*_ t_grid_MEASURE {{{*/

let t_rows = 0;
let t_cols = 0;
let t_gw   = 0; /* grid */
let t_gh   = 0; /* grid */
let t_mw   = 0; /* margin */
let t_mh   = 0; /* margin */
let t_mg   = 0; /* margin gap */

let t_grid_MEASURE = function()
{
    let caller = "t_grid_MEASURE"; if(LOG_MAP.T2_GRID) console_log(caller);
    /* t_rows t_cols {{{*/

    if(!tools_map.length) t_load_TOOLS_MAP(caller);

    t_cols  = Math.round(Math.sqrt(tools_map.length));

    if((t_cols*t_cols) < tools_map.length  ) t_cols += 1;

    t_rows  = t_cols;

    /*}}}*/
    /* grid {{{*/
    let ww = window.innerWidth;
    let wh = window.innerHeight;

    let  cw = Math.round(ww / (t_cols+1));
    let  ch = Math.round(wh / (t_rows+1));
    if((cw == t_gw) && (ch == t_gh)) {
if(LOG_MAP.T2_GRID) console_warn(caller+": GRID UNCHANGED");
        return;
    }

    t_gw =            cw;
    t_gh =            ch;
    t_mw = Math.round(cw/2);
    t_mh = Math.round(ch/2);
    t_mg = Math.round(ch/8);

if(LOG_MAP.T2_GRID && t_grid_IS_ON_GRID(caller)) console_log(" ("+t_mw+"+ "+t_cols+"x"+t_gw+" + "+t_mw+") == "+(t_mw + t_cols*t_gw +t_mw)+" == ww= "+ww+"");
if(LOG_MAP.T2_GRID && t_grid_IS_ON_GRID(caller)) console_log(" ("+t_mh+"+ "+t_rows+"x"+t_gh+" + "+t_mh+") == "+(t_mh + t_rows*t_gh +t_mh)+" == wh= "+wh+"");
    /*}}}*/
    /* headsup_l_table {{{*/

    let msg = "<table>"
            + " <tr> <td>("+t_mw+"</td><td>+</td> <th>"+t_cols+"x<em class='cc0'>"+t_gw+"</em></th> <td>+</td> <td>"+t_mw+")</td> <td>==</td> <th class='cc4'>"+(t_mw + t_cols*t_gw +t_mw)+"</th> <td>==</td> <th class='cc5'>ww= "+ww+"</th></tr>"
            + " <tr> <td>("+t_mh+"</td><td>+</td> <th>"+t_rows+"x<em class='cc0'>"+t_gh+"</em></th> <td>+</td> <td>"+t_mh+")</td> <td>==</td> <th class='cc4'>"+(t_mh + t_rows*t_gh +t_mh)+"</th> <td>==</td> <th class='cc5'>wh= "+wh+"</th></tr>"
            + "</table>"
        ;
if(LOG_MAP.T2_GRID) log(msg);
    let el = t_getElement("headsup_l_table");
    if(el) el.innerHTML = msg;

    /*}}}*/
};
/*}}}*/

/* GRID CSS RULES */
/*_ t_grid_css_list {{{*/
let t_grid_css_list = function()
{
    let caller = "t_grid_css_list"; if(LOG_MAP.T2_GRID) console_log(caller);
    /* traces open {{{*/
    let s = "<div>";
    s    += " document.styleSheets.length=["+document.styleSheets.length+"]";
    s    += " <ol>";

    /*}}}*/
    /* styleSheets {{{*/
    for(let i = 0; i < document.styleSheets.length; ++i)
    {
        let sheet    =  document.styleSheets[i];
        s           += "  <li>";
        s           += "   <ul>";
        /* title {{{*/
        if(sheet.title)
            s       += "    <li> title=["+                          sheet.title             +    "]</li>";

        /*}}}*/
        /* id {{{*/
        if(sheet.ownerNode.id) {
            s       += "    <li> OWNER=<em class='cc"+(i+1)+"'>"+   sheet.ownerNode.id      +    "</em></li>";
        }
        else {
            s       += "    <li> OWNER=<em class='cc"+(i+1)+"'>"+  sheet.ownerNode.tagName +    "</em></li>";
            if(sheet.href)
                s   += "    <li> href=[<a href='"+sheet.href+"'>"+  sheet.href              +    "</a>]</li>";
        }

        /*}}}*/
        /* type {{{*/
        if(sheet.type != "text/css")
            s       += "    <li> type=["+                           sheet.type              +    "]</li>";

        /*}}}*/
        /* disabled {{{*/
        if(sheet.disabled)
            s       += "    <li> disabled=["+                       sheet.disabled          +    "]</li>";

        /*}}}*/
        /* cssRules {{{*/
        try {
            if(sheet.cssRules) {
                s       += "<li>cssRules.length=["+                     sheet.cssRules.length   +    "]";
                s       += " <ol>";

                for(let j = 0; j < sheet.cssRules.length; ++j)
                    s   += " <li><em class='cc"+((j+1) % 10)+"'>"+sheet.cssRules[j].cssText +"</em></li>";

                s       += " </ol>";
                s       += "</li>";
            }
        } catch(ex) {
            s       += "<li style='font-size:50%; color:#AAA;'>"+ex.message+"</li>";
        }
        /*}}}*/
        s           += "   </ul>";
        s           += "  </li>";
    }
    /*}}}*/
    /* traces close {{{*/
    s += " </ol>";
    s += "</div>";

    /*}}}*/
    t_grid_trace(s);
};
/*}}}*/
/*_ t_grid_insertRules {{{*/
let t_grid_insertRules = function()
{
    let caller = "t_grid_insertRules";
if(LOG_MAP.T2_GRID) console_log(caller);

    if( t_grid_css ) t_grid_deleteRules();

    t_grid_get_t_grid_css();

    let s = caller+":<br>";

    if(!t_grid_css) {
        s += caller+": <em class='cc2'>FOUND NO t_grid_css styleSheet</em>";
    }
    else {

        s    += "<div>";
        s    += " <ol>";
        let count = 0;
        let r;
        r    = ".on_grid { min-width  : "+t_gw+"px; }"; s += "  <li>insertRule <em class='cc0'>"+r+"</em></li>"; t_grid_css.insertRule(r, 0); count += 1;
        r    = ".on_grid { min-height : "+t_gh+"px; }"; s += "  <li>insertRule <em class='cc0'>"+r+"</em></li>"; t_grid_css.insertRule(r, 0); count += 1;
        r    = ".on_grid { max-width  : "+t_gw+"px; }"; s += "  <li>insertRule <em class='cc0'>"+r+"</em></li>"; t_grid_css.insertRule(r, 0); count += 1;
        r    = ".on_grid { max-height : "+t_gh+"px; }"; s += "  <li>insertRule <em class='cc0'>"+r+"</em></li>"; t_grid_css.insertRule(r, 0); count += 1;
        s    += " </ol>";
        s    += "</div>";

        if(count > 0) {
            s +=  "<em class='cc"+(count % 10)+"'>"+count+" RULES INSERTED</em><br>";
        }
    }

    t_grid_trace_add(s);

if(LOG_MAP.T2_GRID) console_log(caller+":");
if(LOG_MAP.T2_GRID) console_dir(t_grid_css);
};
/*}}}*/
/*_ t_grid_deleteRules {{{*/
let t_grid_deleteRules = function()
{
    let caller = "t_grid_deleteRules"; if(LOG_MAP.T2_GRID) console_log(caller);

    let        s  = "";
/*
               s += caller+":<br>";
               s += "t_grid_css.........=["+t_grid_css          +"]<br>";
if(t_grid_css) s += "t_grid_css.cssRules=["+t_grid_css.cssRules +"]<br>";
*/
    if(!t_grid_css || !t_grid_css.cssRules)
    {
        s += "<em class='cc2'>NO t_grid_css rules to delete</em><br>";
    }
    else {
        let count = 0;
        /* rules */
        s += "<div>";
        s += " <ol>";
        for(let i = 0; i < t_grid_css.cssRules.length; ++i)
        {
            if(t_grid_css.cssRules[i].cssText.includes(".on_grid") )
            {
                s += " <li><em class='cc0'>"+ t_grid_css.cssRules[i].cssText +"</em></li>";
                t_grid_css.deleteRule(i);
                count += 1;
                i -= 1;
            }
        }
        s += " </ol>";
        s += "</div>";

        if(count > 0) {
            s = caller+": <em class='cc"+(count % 10)+"'>"+count+" RULES DELETED</em><br>"
              + s;
        }
    }
    t_grid_trace(s);
};
/*}}}*/
/*_ t_grid_get_t_grid_css {{{*/
const T_GRID_CSS_ID = "t_grid_css";

let t_grid_css;

let t_grid_get_t_grid_css = function()
{
    if(t_grid_css) return;

    let caller = "t_grid_get_t_grid_css";
if(LOG_MAP.T2_GRID) console_log(caller);

    let s = caller+": CREATING <em>"+T_GRID_CSS_ID+"</em><br>";
    let el   = document.createElement("STYLE");
    el.id    = T_GRID_CSS_ID;
    el.title = T_GRID_CSS_ID;
    el.type  = "text/css";
    el.rel   = "stylesheet";

    document.getElementsByTagName('head')[0].appendChild(el);
    t_grid_css = el.sheet;

    t_grid_trace(s);
if(LOG_MAP.T2_GRID) console_dir(t_grid_css);
};
/*}}}*/

/* GRID LOG */
/*_ t_grid_logging_toggle {{{*/
let t_grid_logging_toggle = function(new_state="toggle")
{
    let caller = "t_grid_logging_toggle";

    LOG_MAP.T2_GRID
    = (new_state == "toggle") ? !LOG_MAP.T2_GRID
    :                            new_state;

log("%c "+caller+": LOG_MAP.T2_GRID set to "+LOG_MAP.T2_GRID, lb7+lbF);

    t_grid_onWork_EL_changed(caller);
    t_sync_tool_clones(caller);
};
/*}}}*/
/*_ t_grid_trace {{{*/
let t_grid_trace = function(s)
{
    let el;
    if( el = t_getElement("traces") ) el.innerHTML = s;
    else                            console_log( strip_html(s) );
};
/*}}}*/
/*_ t_grid_trace_add {{{*/
let t_grid_trace_add = function(s)
{
    let el;
    if( el = t_getElement("traces") ) el.innerHTML += s;
    else                            console_log( strip_html(s) );
};
/*}}}*/
/*_ t_getElement {{{*/
let t_getElement = function(id)
{
/*if(LOG_MAP.T2_GRID) log("t_getElement("+id+")");*/
    let el = null;
try {
    if(shadow_root) el = shadow_root.querySelector("#"+id);
} catch(ex) {}
    if(!el)         el = document.getElementById  (    id);
    return el;
};
/*}}}*/
/*
console_log(DOM_GRID_JS_ID+": ...ready");
*/

/*}}}*/
//# sourceURL=dom_grid.js
`
 .replace(/\\/g,"\\\\")
)
 .replace(/%u/g,"\\u")
;

/*}}}*/
  /**   11 TOOLS HTML dom_tools_html_data {{{*/
/*
../javascript/dom_tools.html
*/
dom_tools_html_data = escape(`
<!--{{{-->
<!DOCTYPE html>
<head><title>dom_tools_html</title></head>
 <span id = "dom_tools_html_tag" style="display:none">dom_tools_html (190102:19h)</span>

 <!-- hotspot {{{-->
 <div   id="hotspot"       title="hotspot"         class="hotspot_frame">
  <div  id="hotwave"                               class="hotwave">
   <div id="hotring"                               class="hotring">&nbsp;</div>
  </div>
  <div id="hotspot_c">&#x00BB;</div>
 </div>
 <!--}}}-->
 <!-- headsup {{{ -->
 <div id="headsup"         title="headsup"         class="transcript hidden">
  <em  id="thumb_p"        title="thumb_p">&#x0020;</em>
  <em  id="theme_dark"     title="theme_dark"      class="toolbag_button cc8" >LIGHT</em>
  <em  id="wording"        title="wording"         class="toolbag_button cc3" >WORDING</em>
  <em  id="anchor_freeze"  title="anchor_freeze"   class="toolbag_button cc9" >&#x26D4;</em>
  <em  id="containers_hi"  title="containers_hi"   class="toolbag_button cc9" >&#x00A7;</em>
  <em  id="overflow_visi"  title="overflow_visi"   class="toolbag_button cc9" >&nbsp;</em>
  <em  id="scroll_smooth"  title="scroll_smooth"   class="toolbag_button cc9" >&nbsp;</em>

  <em  id="tools_extras"    title="tools_extras"    class="toolbag_button cc9">&#x2630;</em>

  <em  id="show_seekzone"  title="show_seekzone"   class="toolbag_button cc9" >&nbsp;</em>
  <em  id="pin_seekspot"   title="pin_seekspot"    class="toolbag_button cc9" >&nbsp;</em>
  <em  id="log_seekspot"   title="log_seekspot"    class="toolbag_button cc9" >&nbsp;</em>

 </div>
 <!-- }}} -->

 <!-- pat_bag {{{ -->
  <div id="pat_bag"        title="PAT BAG"        class="transcript hidden bag"></div>
 <!-- }}} -->
 <!-- headsup_w {{{ -->
 <div    id="headsup_w"       title="headsup_w"       class="transcript hidden"  >
  <input id="tools_filter"    title="tools_filter"    type="text"               />
  <em    id="recycle"         title="recycle"         class="toolbag_button"     >&#x267B;</em>
  <em    id="words_exact"     title="words_exact"     class="toolbag_button cc3" >&#x2261;</em>
  <em    id="words_segment"   title="words_segment"   class="toolbag_button cc4" >&#x2282;</em>
  <em    id="words_head_tail" title="words_head_tail" class="toolbag_button cc5" >&#x2208;</em>
  <em    id="words_opcycle"   title="words_opcycle"   class="toolbag_button cc9" >&#x27F3;</em>
  <em    id="words_drop_ing"  title="words_drop_ing"  class="toolbag_button cc8" >&nbsp;</em>
  <em    id="words_drop_s"    title="words_drop_s"    class="toolbag_button cc8" >&nbsp;</em>
  <div   id="words_regex"                             class="txt_log"            >words_regex</div>
 </div>
 <!-- }}} -->
 <!-- sel_bag {{{ -->
  <div id="sel_bag"        title="sel_bag"        class="transcript hidden bag"><span class="seeker_handle"></span></div>
 <!-- }}} -->

 <!-- headsup_ds {{{ -->
 <div id="headsup_ds"       title="headsup_ds"      class="transcript hidden">
  <em  id="tools_trap"      title="tools_trap"      class="toolbag_button"    >&#x00BB;</em>
  <em  id="tools_scroll"    title="tools_scroll"    class="toolbag_button"    >&#x2693;</em>
  <em  id="site_or_page"    title="site_or_page"    class="toolbag_button cc9">&nbsp;</em>
  <em  id="mask_or_hide"    title="mask_or_hide"    class="toolbag_button cc9">&nbsp;</em>
  <em  id="edit_or_stage"   title="edit_or_stage"   class="toolbag_button cc9">&nbsp;</em>
  <em  id="dom_hide1_reset" title="dom_hide1_reset" class="toolbag_button cc9">&nbsp;</em>
  <em  id="deny_or_allow"   title="deny_or_allow"   class="toolbag_button cc8">&nbsp;</em>
<!--{{{
  <em  id="targeteer"     title="targeteer"     class="toolbag_button cc9">&nbsp;</em>
  <em  id="target_01"     title="target_01"     class="toolbag_button cc1">&nbsp;</em>
  <em  id="target_02"     title="target_02"     class="toolbag_button cc2">&nbsp;</em>
  <em  id="target_03"     title="target_03"     class="toolbag_button cc3">&nbsp;</em>
}}}-->
 </div>
 <!-- }}} -->
 <!-- headsup_bw {{{ -->
 <div id="headsup_bw"      title="headsup_bw"       class="transcript hidden">
  <em id="headsup_bw_value"    class="cc10">BODY WIDTH</em><br>
  <em class="cc1"> 480</em><em class="cc2"> 640</em><em class="cc3"> 780</em><br>
  <em class="cc4"> 960</em><em class="cc5">1024</em><em class="cc6">1200</em><br>
  <em class="cc7">1440</em><em class="cc8">1600</em><em class="cc9">1980</em><br>
 </div>
 <!-- }}} -->
 <!-- headsup_bz {{{ -->
 <div id="headsup_bz"      title="headsup_bz"         class="transcript hidden">
  <em id="headsup_bz_value"     class="cc10">BODY ZOOM</em><br>
  <em class="cc1">  70%</em><em class="cc2" >  80%</em><em class="cc3">  90%</em><br>
  <em class="cc1"> 100%</em><em class="cc2" > 110%</em><em class="cc3"> 120%</em><br>
  <em class="cc1"> 130%</em><em class="cc2" > 150%</em><em class="cc3"> 160%</em><br>
  <em class="cc1"> 180%</em><em class="cc2" > 200%</em><em class="cc3"> 220%</em><br>
 </div>
 <!-- }}} -->

 <!-- dom_traversal {{{ -->
 <div id="dom_traversal"   title="dom_traversal"      class="transcript hidden" >
 <!-- NodeIterator TreeWalker childNodes tagNodes {{{ -->
  <em class = "toolbag_button cc5">NodeIterator</em>
  <em class = "toolbag_button cc6">TreeWalker</em>
  <em class = "toolbag_button cc7">childNodes</em>
  <em class = "toolbag_button cc7">tagNodes</em>
  <!-- }}} -->
  <!-- tools_node {{{ -->
  <table>
   <tr>
    <th>node</th>
    <td>
     <input id="tools_node" title="tools_node"        type="text" />
     <span class="cc2">html</span>
     <span class="cc3">head</span>
     <span class="cc4">body</span>
    </td>
   </tr>
  </table>
  <!-- }}} -->
 </div>
 <!-- }}} -->
 <!-- test_panel: RELOAD CLEAR t_log_regex t_log_behavior - (onclick would not care for has_moved) {{{ -->
 <div id="test_panel"      title="test_panel"         class="transcript hidden">
  <em id="RELOAD"          title="RELOAD"             class="toolbag_button cc7"> RELOAD    </em>
  <em id="CLEAR"           title="CLEAR"              class="toolbag_button"    > CLEAR     </em>
  <em id="REGEX"           title="REGEX"              class="toolbag_button"    > REGEX     </em>
  <em id="BEHAVIOR"        title="BEHAVIOR"           class="toolbag_button"    > BEHAVIOR  </em>
  <em id="HIGHLIGHT"       title="HIGHLIGHT"          class="toolbag_button cc3"> HIGHLIGHT </em>
 </div>
 <!-- }}} -->

  <!-- dev_log_map {{{-->
  <div
   id      = "dev_log_map"
   title   = "dev_log_map"
   class   = "transcript hidden"
   >
   dev_log_map placeholder:<br>
   <i class="todo">..should have been populated by <em>dom_tools.sync_logging</em> with the value of logging</i>

  </div>
  <!-- }}} -->
 <!-- dom_load_tags (placeholder) {{{ -->
 <div
  id       = "dom_load_tags"
  title    = "dom_load_tags"
  class    = "transcript hidden"
  >
  dom_load_tags placeholder:<br />
  <i class="todo">...should have been populated by <em>dom_tools.show_tags</em> with the value of DOM_LOAD_TAG</i>

 </div>
 <!-- }}} -->

 <!-- transcript1 {{{ -->
 <div id="transcript1"     title="transcript1"  class="transcript hidden cleardiv"></div>
 <!-- }}} -->
 <!-- transcript2 {{{ -->
 <div id="transcript2"     title="transcript2"  class="transcript hidden cleardiv"></div>
 <!-- }}} -->

 <!-- pivspot {{{-->
 <div   id="pivspot"       title="pivspot"         class="hidden">
   <div id="pivspot_c">&#x00BB;</div>
 </div>
 <!--}}}-->
 <!-- seeker {{{-->
 <div  id = "seeker_PU"    title="seeker_PU"       class="seeker_P"     ><div id="seeker_CU" >seeker up    </div></div>
 <div  id = "seeker_PD"    title="seeker_PD"       class="seeker_P"     ><div id="seeker_CD" >seeker_thumbs</div></div>

 <div id = "seekspot_U"                                                 ></div>
 <div id = "seekzone"      title="seekzone"        class="hotspot_frame"></div>
 <div id = "seekspot_A"                                                 >&#x2191;</div>
 <div id = "seekspot_D"                                                 ></div>
 <!--}}}-->
<!--}}}-->
`
);
/*}}}*/
/**   12 PROP    JS dom_prop_js_data {{{*/
/*
../javascript/dom_prop.js
*/
dom_prop_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
"use strict";
/* dom_prop_js */
let DOM_PROP_JS_ID        = "dom_prop_js";
let DOM_PROP_JS_TAG       = DOM_PROP_JS_ID  +" (181230:00h)";


/* Prop public */
let prop_init    = function(id, value, onchange) { return _prop_set  (id, value, onchange)        ; }; /* returns prop (not calling onchange) */
let prop_set     = function(id, value, onchange) { return _prop_parse(id, value, onchange)        ; }; /* returns prop     */
let prop_get     = function(id                 ) { return _prop_get  (id                 ).value  ; }; /* returns value    */
let prop_toggle  = function(id                 ) { return _prop_parse(id,"toggle"        ).value  ; }; /* returns value    */
let prop_set_EL  = function(id, el             ) { return _prop_get  (id                 ).el = el; }; /* returns EL       */
let prop_get_EL  = function(id                 ) { return _prop_get  (id                 ).el     ; }; /* returns EL       */
let prop_get_MAP = function(                   ) { return                                 Prop_Map; }; /* returns Prop_Map */
let prop_set_CB  = function(cb                 ) {                                    Prop_CB = cb; }; /* UI state handler */
let prop_log_MAP = function(_caller            ) {
/* {{{*/

    Prop_Map.forEach(
                     function(prop,index,array) {
                         prop.log(index +" "+ _caller);
                     });

};
/*}}}*/

/* Prop private */
/* Prop_Map Prop_CB {{{*/
let Prop_Map = [];
let Prop_CB;

/*}}}*/
/*_Prop new {{{*/
let Prop = function(id, value, onchange)
{
    this.id        = id;
    this.value     = (value == "toggle") ? true      : value        ;
    this.onchange  = onchange;
    this.el        = null;
    /* this.toString {{{*/
    this.toString = function() {
        return ""
            +  "["+                  this.id
            +  " "+                  this.value         +"]"
            +  "["+ (this.onchange ? this.onchange.name : "")
            +  " "+    get_id_or_tag(this.el)           +"]"
        ;

    };
    /*}}}*/
    /* this.log {{{*/
    this.log = function(prefix="") {

        let lfv = (this.value ==  null) ? lf8
            :     (this.value == false) ? lb6
            :     (this.value ==  true) ? lb5
            :                             lb7;

        let lfe = (this.el            ) ? lf4
            :                             lf2;

        console.groupCollapsed( "%c"+ mPadEnd  (               prefix     , 42)
                       +       " %c"+ mPadStart(               this.id    , 24)
                       +       " %c"+ mPadStart(               this.value , 16)
                       +       " %c"+ mPadStart( get_id_or_tag(this.el   ), 24)
                       +       " %c"+ (this.el ? " "+this.el.className : "")
                       ,       lbH
                       ,       lbL+lfe
                       ,       lbC+lfv
                       ,       lbR+lfe
                       ,       lbH+lf3
                              );

        log_key_val(this.id, this, lf3);
        console.trace();
        console.groupEnd();
    };

    /*}}}*/
};
/*}}}*/
/*  _prop_set {{{*/
let _prop_set = function(id, value="toggle", onchange)
{
/*{{{*/
let   caller = "_prop_set("+id+", "+value+")"; if(typeof dom_prop_notify != "undefined") dom_prop_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf3);
/*}}}*/

    let    prop  =  _prop_get(id, value, onchange);
    if(onchange &&  (prop.onchange  != onchange )) { prop.onchange       = onchange;  }
    if(             (prop.value     != value    )) { prop.value = (value == "toggle") ? !prop.value : value ; }
    else if( log_this) log("...unchanged");

    t1_prop_id_state_CB(id, prop.value);

    return prop;
};
/*}}}*/
/*  _prop_get {{{*/
let _prop_get = function(id, value, onchange)
{
    let prop;
    for(let i=0; i < Prop_Map.length; ++i ) {
        if(  id == Prop_Map[i].id  ) {
            prop = Prop_Map[i];
            break;
        }
    }
    if(!prop ) {
        prop = new Prop(id, value, onchange);
        Prop_Map.push(prop);
    }
    return prop;
};
/*}}}*/
/*  _prop_parse {{{*/
let _prop_parse = function(id, value, onchange)
{
/*{{{*/
let   caller = "_prop_parse("+id+", "+value+")";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log(caller);
/*}}}*/
    let prop = _prop_get(id, value, onchange);
    if(      onchange && (onchange != prop.onchange ))
        prop .onchange  =  onchange;

    if(  prop.value != value) {
        _prop_set(id , value);

        if(Prop_CB) Prop_CB(id, prop.value);

        if( prop.onchange)
            prop.onchange(id, prop.value);
    }
else if( log_this) log("...unchanged");

if( log_this) prop.log(caller);
    return prop;
};
/*}}}*/

/*}}}*/
//# sourceURL=dom_prop.js
`
)
 .replace(/%u/g,"\\u")
;
/*}}}*/
/** 13 TOOLS   JS dom_tools_js_data {{{*/
/*
../javascript/dom_tools.js
*/
dom_tools_js_data ="data:application/javascript;charset=utf-8,"+ escape(`
/*{{{*/
/*"use strict";*/
/* dom_tools_js */
let DOM_TOOLS_JS_ID         = "dom_tools_js" ; let DOM_TOOLS_JS_TAG        = DOM_TOOLS_JS_ID   +" (190104:16h)";
let DOM_HOST_CSS_ID         = "dom_host_css" ;
let DOM_TOOLS_CSS_ID        = "dom_tools_css";
/* CONSOLE TEMPLATE TO BE IMPLEMENTED BY EMBEDDING LAYER {{{*/
      DOUBLE_QUOTE  = String.fromCharCode(34);
      LF            = String.fromCharCode(10);
      CR            = String.fromCharCode(13);
      BACKSLASH     = String.fromCharCode(92);
      FORESLASH     = String.fromCharCode(47);
      CS            = "font-size:150%; font-weight:900; border:1px solid 960; color:#960; background-color:navy; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #000 0%, #223 50%, #000 100%);";
      console_clear = function(  msg=null) { try { console.clear(); if(msg) console.warn("%c CLEARED BY: "+msg,CS);                 } catch(ex) {} };
      console_dir   = function(o,msg=null) { try {                  if(msg) console.log (       "%c"+msg      ,CS); console.dir(o); } catch(ex) {} };
      console_log   = function(  msg     ) { try {                          console.log (            msg         );                 } catch(ex) {} };
      console_warn  = function(  msg=null) { try {                          console.warn(            msg         );                 } catch(ex) {} };
/*}}}*/
/* CSS {{{*/
/* ECC .. Electronic color code {{{*/
const CSS_CC1                   = "cc1";
const CSS_CC2                   = "cc2";
const CSS_CC3                   = "cc3";
const CSS_CC4                   = "cc4";
const CSS_CC5                   = "cc5";
const CSS_CC6                   = "cc6";
const CSS_CC7                   = "cc7";
const CSS_CC8                   = "cc8";
const CSS_CC9                   = "cc9";

/*}}}*/
/* EVENTS {{{*/
const CSS_MOVING                = "moving";
const CSS_STACKING              = "stacking";
const CSS_PAUSE_ANIMATION       = "pause_animation";

const CSS_ON_COOLDOWN           = "on_cooldown";

const CSS_REGROUPING            = "regrouping";
const CSS_REMOVING              = "removing";
const CSS_SCROLLING             = "scrolling";
/*}}}*/
/* SEEK_ZONE {{{*/
const CSS_CAPTION_D             = "caption_D";
const CSS_CAPTION_U             = "caption_U";

const CSS_SEEKER_HANDLE         = "seeker_handle";

const CSS_SEEKER_PU2_LOOK_UP    = "seeker_PU2_look_up";
const CSS_SEEKER_PU3_LOOK_RIGHT = "seeker_PU3_look_right";
const CSS_SEEKER_PU4_LOOK_DOWN  = "seeker_PU4_look_down";
const CSS_SEEKER_PU5_LOOK_LEFT  = "seeker_PU5_look_left";

const CSS_ON_HIDEN_NODE         = "on_hiden_node";
const CSS_TARGET_TOOL           = "target_tool";
/*}}}*/
/* DISPLAY {{{*/
const CSS_DARK                  = "dark";

const CSS_HIDDEN                = "hidden";
const CSS_HIDING                = "hiding";
const CSS_VIEWABLE              = "viewable";

const CSS_HOVERING              = "hovering";
const CSS_LIFTED                = "lifted";
const CSS_PINNED                = "pinned";
const CSS_ON_CONTAINER          = "on_container";
const CSS_PRESSED               = "pressed";
const CSS_PULSING               = "pulsing";
const CSS_SEEK_TARGET           = "seek_target";

const CSS_TOP                   = "top";
const CSS_BOTTOM                = "bottom";
const CSS_TRAPPED               = "trapped";
/*}}}*/
/* PLAYGROUND {{{*/
const CSS_COLLAPSED             = "collapsed";

/*}}}*/
/* PANEL {{{*/
const CSS_TRANSCRIPT            = "transcript";
const CSS_FLOATLOG              = "floatlog";

/*}}}*/
/* PANEL STYLE {{{*/

const CSS_STANDBY               = "standby";
const CSS_DIMMED                = "dimmed";
const CSS_DISABLED              = "disabled";
const CSS_EMPTY                 = "empty";
const CSS_FADING                = "fading";
const CSS_FOCUSSED              = "focussed";
const CSS_GRAYED_OUT            = "grayed_out";
const CSS_FULLSCREEN            = "fullscreen";

const CSS_GUTTER                = "gutter";
const CSS_FREEZED               = "freezed";
const CSS_MAGNIFIED             = "magnified";
/*}}}*/
/* PANEL CHILD TOOL {{{*/
const CSS_TOOLBAG_BUTTON        = "toolbag_button";

const CSS_GRID_BAG              = "grid_bag";
const CSS_HAS_MOVING_CHILD      = "has_moving_child";
const CSS_MOV_SRC               = "mov_src";

const CSS_TXT_LOG               = "txt_log";
/*}}}*/
/* PANEL DECORATION {{{*/
const CSS_TALL_PANEL            = "tall_panel";
const CSS_WIDE_PANEL            = "wide_panel";
const CSS_TOO_LARGE             = "too_large";

const CSS_PIN_ON_PANEL          = "pin_on_panel";
const CSS_CLEARPIN              = "clearpin";
const CSS_CLOSEPIN              = "closepin";
const CSS_PUSH_PIN              = "push_pin";
const CSS_SCALEPIN              = "scalepin";

const CSS_LEFT                  = "left";
const CSS_RIGHT                 = "right";
/*}}}*/
/* PROPERTY {{{*/
const CSS_CHECKED               = "checked";
const CSS_ON                    = "on";

const CSS_USER_SET              = "user_set";
/*}}}*/
/* SELECTION {{{*/
const CSS_NUM_SELECTED          = "num_selected";
const CSS_OPEN_BAG              = "open_bag";
const CSS_PAT_CLICKED           = "pat_clicked";

const CSS_BACK                  = "back";
/*}}}*/
/* CONTAINERS {{{*/

const CSS_BUTTON_COPY           = "button_copy";
const CSS_BUTTON_MAGNIFY        = "button_magnify";
const CSS_BUTTON_MONO           = "button_mono";
const CSS_BUTTON_MONOSPACE      = "button_monospace";
const CSS_BUTTON_NEXT           = "button_next";
const CSS_BUTTON_PREV           = "button_prev";
const CSS_CONTAINER_SELECTED    = "container_selected";

/*}}}*/
/*}}}*/
/* SETTINGS OPTIONS {{{*/

const ANCHOR_FREEZE         = "anchor_freeze";
const CONTAINERS_HI         = "containers_hi";
const SCROLL_SMOOTH         = "scroll_smooth";

const FLY_DIV_MAGNIFIED     = "fly_div_magnified";
const PIVOT_MAGNIFIED       = "pivot_magnified";

const THEME_DARK            = "theme_dark"  ;

const TOOLS_SCROLL          = "tools_scroll"; /* (tools scrolling with the document .. (quite a mess! .. not really usefull) */
const TOOLS_EXTRAS          = "tools_extras"; /* (not really usefull for now) */

/*_TOOLS_PANEL_BEHAVIOR__________________*/
const TOOLS_TRAP            = "tools_trap";

/*_MONITORING_EVENTS_LOCATION_______________*/
const LOG_SEEKSPOT          = "log_seekspot" ;
const PIN_SEEKSPOT          = "pin_seekspot" ;
const SHOW_SEEKZONE         = "show_seekzone";

const OVERFLOW_VISI         = "overflow_visi";

/*_SELECTION_SEQUENCE_DIRECTION________*/
const SEL_BACK              = "sel_back";

/*_DOM_HIDE_EDITING_________________________*/
const DOM_EDITING           = "dom_editing"   ;
const SITE_OR_PAGE          = "site_or_page"  ;
const MASK_OR_HIDE          = "mask_or_hide"  ;
const EDIT_OR_STAGE         = "edit_or_stage" ;
const DOM_HIDE1_RESET       = "dom_hide1_reset";
const DENY_OR_ALLOW         = "deny_or_allow" ;

/*_WORKING_WITH_SELECTIONS___________________*/
const WORDING               = "wording"        ;
const WORDS_DROP_ING        = "words_drop_ing" ;
const WORDS_DROP_S          = "words_drop_s"   ;
const WORDS_EXACT           = "words_exact"    ;
const WORDS_HEAD_TAIL       = "words_head_tail";
const WORDS_OPCYCLE         = "words_opcycle"  ;
const WORDS_SEGMENT         = "words_segment"  ;

/*_DOC_EMBEDDED_TOOLS_*/
const SQUEEZE_CYCLE         = "squeeze_cycle";
const SQUEEZE_CYCLE_CLASSLIST = ["squeezed_1_0","squeezed_0_5","squeezed_0_1"];

/*}}}*/

/* PANELS ID's [A-Z] {{{

      1     dev_log_map
      2     dom_grid_html
      3     dom_load_tags
      4     dom_tools_html
      5     dom_traversal
      6     fly_div
      7     headsup
      8     headsup_bw
      9     headsup_bz
     10     headsup_ds
     11     headsup_w
     12     hotspot
     13     pat_bag
     14     pivspot
     15     seeker_PD
     16     seeker_PU
     17     seekspot_A
     18     seekspot_D
     19     seekspot_U
     20     seekzone
     21     sel_bag
     22     test_panel
     23     transcript1
     24     transcript2

}}}*/
/* PANEL ID's {{{

    dom_tools_html
    dom_grid_html

    pivspot
        pivspot_c

    hotspot
        hotwave
        hotring
        hotspot_c

    dev_log_map

    dom_load_tags

    dom_traversal
        tools_node

    headsup
        thumb_p
        theme_dark
        wording
        anchor_freeze
        containers_hi
        overflow_visi
        scroll_smooth
        tools_extras
        show_seekzone
        pin_seekspot
        log_seekspot

    headsup_bw
        headsup_bw_value

    headsup_bz
        headsup_bz_value

    headsup_ds
        tools_trap
        tools_scroll
        site_or_page
        mask_or_hide
        edit_or_stage
        dom_hide1_reset
        deny_or_allow

    headsup_w
        recycle
        tools_filter
        words_drop_s
        words_exact
        words_head_tail
        words_opcycle
        words_regex
        words_segment
    pat_bag
    sel_bag

    test_panel
        RELOAD
        CLEAR
        REGEX
        BEHAVIOR
        HIGHLIGHT

    transcript1
    transcript2

    fly_div

    seeker_PD
        seeker_CD
    seeker_PU
        seeker_CU

    seekzone
        seekspot_A
        seekspot_D
        seekspot_U

}}}*/
/* PANEL ZINDEX {{{*/
const TOOLS_MAX                = 30;
const ZINDEX_SHADOW_HOST       = 2147483647;

const ZINDEX_TARGET_TOOL_ZERO  =                                          10;
const ZINDEX_PINNED_PANEL_ZERO =                                          20;
const ZINDEX_TOOL_PANEL_ZERO   = ZINDEX_PINNED_PANEL_ZERO + TOOLS_MAX; /* 50 */
const ZINDEX_BELOW_TOOLS       = ZINDEX_TOOL_PANEL_ZERO              ; /* 50 */
const ZINDEX_ABOVE_TOOLS       = ZINDEX_BELOW_TOOLS + TOOLS_MAX      ; /* 80 */
const ZINDEX_ON_GRID           = ZINDEX_ABOVE_TOOLS                  ; /* 80 */
/*}}}*/
/*  TOOL_SET {{{*/
let TOOL_SET /*___________built_in_________________________________*/
    = [   { dom_load_id : ""           , panel_id : "hotspot"       }
        , { dom_load_id : ""           , panel_id : "fly_div"       }
        , { dom_load_id : ""           , panel_id : "seeker_CU"     }
        , { dom_load_id : ""           , panel_id : "seeker_CD"     }
        , { dom_load_id : ""           , panel_id : "seekzone"      }
        , { dom_load_id : ""           , panel_id : "seekspot_A"    }
        , { dom_load_id : ""           , panel_id : "seekspot_U"    }
        , { dom_load_id : ""           , panel_id : "seekspot_D"    }
        , { dom_load_id : ""           , panel_id :  TOOLS_TRAP     }

        /*_________________dom_find__________________________________________________________________*/
        , { dom_load_id : "dom_find"   , panel_id : "headsup_w"     } /* wording exact segment ...   */
/*{{{
        , { dom_load_id : "dom_find"   , panel_id : "headsup"       }
        , { dom_load_id : "dom_find"   , panel_id : "test_panel"    }
        , { dom_load_id : "dom_find"   , panel_id : "pat_bag"       }
}}}*/

        /*_________________dom_hide____________________________________________________________________________*/
        , { dom_load_id : "dom_hide"   , panel_id : "headsup"       } /* options                               */
        , { dom_load_id : "dom_hide"   , panel_id : "headsup_ds"    } /* tools trap & scroll                   */
        , { dom_load_id : "dom_hide"   , panel_id : "dev_log_map"   } /* LOG_MAP                               */
        , { dom_load_id : "dom_hide"   , panel_id : "dom_load_tags" } /* HTML CSS JS TAGS                      */
        , { dom_load_id : "dom_hide"   , panel_id : "test_panel"    } /* RELOAD CLEAR REGEX BEHAVIOR HIGHLIGHT */

        /*_________________playground________________________________________________________________________________*/

        , { dom_load_id : "playground" , panel_id : "headsup"       } /* options                                     */
        , { dom_load_id : "playground" , panel_id : "headsup_bw"    } /* body width                                  */
        , { dom_load_id : "playground" , panel_id : "headsup_bz"    } /* body zoom                                   */
        , { dom_load_id : "playground" , panel_id : "headsup_ds"    } /* tools trap & scroll                         */
        , { dom_load_id : "playground" , panel_id : "headsup_w"     } /* wording exact segment ...                   */

        , { dom_load_id : "playground" , panel_id : "pat_bag"       } /* patterns                                    */
        , { dom_load_id : "playground" , panel_id : "sel_bag"       } /* selected patterns                           */
        , { dom_load_id : "playground" , panel_id : "dom_traversal" } /* NodeIterator TreeWalker childNodes tagNodes */

        , { dom_load_id : "playground" , panel_id : "test_panel"    } /* RELOAD CLEAR REGEX BEHAVIOR HIGHLIGHT       */
        , { dom_load_id : "playground" , panel_id : "dev_log_map"   } /* LOG_MAP                                     */
        , { dom_load_id : "playground" , panel_id : "dom_load_tags" } /* HTML CSS JS TAGS                            */

        , { dom_load_id : "playground" , panel_id : "transcript1"   } /* TRANSCRIPT1                                 */
        , { dom_load_id : "playground" , panel_id : "transcript2"   } /* TRANSCRIPT2                                 */


    ];
/*}}}*/
/*_ is_a_DOM_LOAD_panel {{{*/
let is_a_DOM_LOAD_panel = function(panel_id)
{
/*{{{*/
let   caller = "is_a_DOM_LOAD_panel";
let log_this = LOG_MAP.T1_DOM_LOAD;

/*}}}*/
    let dom_load_id                 = (typeof DOM_LOAD_ID != "undefined") ? DOM_LOAD_ID : "default";
    let panel_to_load               =  true;    /* default implicit [panel_to_load] */
    let dom_load_is_defined         = false;    /* [TOOL_SET] may not have [DOM_LOAD_ID] explicit configuration */
    for(let i=0; i< TOOL_SET.length; ++i) {
        /* FOUND SOME EXPLICIT [DOM_LOAD_ID] [ENTRY] {{{*/
        let entry = TOOL_SET[i];
        if(!dom_load_is_defined && (entry.dom_load_id == dom_load_id))
        {
            dom_load_is_defined     =  true;
            panel_to_load           = false;    /* .. CLEAR [IMPLICIT ANSWER] */
        }

        /*}}}*/
        /* CHECK [DOM_LOAD_ID] [ENTRIES] {{{*/
        if(entry.dom_load_id == dom_load_id)
        {
            /* FOUND SPECIFIED ID */
            if(entry.panel_id  == panel_id)
            {
                panel_to_load       = true;     /* .. SET [EXPLICIT ANSWER] */
                break;
            }
        }
        /*}}}*/
    }
/*{{{*/
if(log_this) {
    let lfx = (panel_to_load ? lf4 : lf8);
    log("%c "+caller+": ...return "+panel_to_load+" %c "+dom_load_id+" %c "+(dom_load_is_defined ? "defined" : "")+" %c ["+panel_id+"]"
        ,lbH+lfx                                   ,lbL+lf8           ,lbC+lf8                                      ,lbR+lfx           );
}
/*}}}*/
    return panel_to_load;
};
/*}}}*/
/*_ is_a_DOM_LOAD_featured_function {{{*/
/* {{{*/
/* FEATURES .. f(LOADING PAGE ID) */
const FUNCTIONS_TO_IGNORE
    = [    { dom_load_id : "dom_hide" , id : "t_seekzone1_XYWH"           } /* no seekzone feedback */
         , { dom_load_id : "dom_hide" , id : "t_seekzone1_add_onDown_XY"  } /* no seekzone feedback */
         , { dom_load_id : "dom_hide" , id : "t_seekzone2_add_misclick"   } /* no click    feedback */
         , { dom_load_id : "dom_hide" , id : "t_seekzone2_add_dblclick"   } /* no click    feedback */
         , { dom_load_id : "dom_hide" , id : "onDown_6_DOC_SELECT_OR_SEEK"} /* no document wording  */
         , { dom_load_id : "dom_hide" , id : "onUp_6_DOC_CB_CLICK_WORD"   } /* no document wording  */
         , { dom_load_id : "dom_hide" , id : "onUp_2_SLOT_CONTAINER_CB"   } /* no document wording  */
         , { dom_load_id : "dom_hide" , id : "t_store_patterns_csv"       } /* no document wording  */

         , { dom_load_id : "dom_find" , id : "t_seekzone1_XYWH"           } /* no seekzone feedback */
         , { dom_load_id : "dom_find" , id : "t_seekzone1_add_onDown_XY"  } /* no seekzone feedback */
         , { dom_load_id : "dom_find" , id : "t_seekzone2_add_misclick"   } /* no click    feedback */
         , { dom_load_id : "dom_find" , id : "t_seekzone2_add_dblclick"   } /* no click    feedback */
         , { dom_load_id : "dom_find" , id : "t_target_tool_feed"         } /* no target_tool support */
    ];

let cached_entry_selected_item_id = {};
/*}}}*/
let is_a_DOM_LOAD_featured_function = function(item_id)
{
/*{{{*/
let   caller = "is_a_DOM_LOAD_featured_function";
let log_this = LOG_MAP.T1_DOM_LOAD;

/*}}}*/
    /* cached_entry_selected_item_id {{{*/
    let feature_to_ignore  = cached_entry_selected_item_id[item_id];
    if( feature_to_ignore != undefined) {
/*{{{*/
if( log_this) {
    let lfx = (feature_to_ignore ? lf2 : lf5);
    log("%c "+caller+" ...return %c"+(feature_to_ignore ? "FALSE":"TRUE ")+"%c CACHED ANSWER %c ["+item_id +"]"
        ,lbH+lf8                ,lbL+lfx                                   ,lbC+lf8         ,lbR+lfx           );
}
/*}}}*/
        return !feature_to_ignore;
    }
    /*}}}*/
    let dom_load_id                 = (typeof DOM_LOAD_ID != "undefined") ? DOM_LOAD_ID : "default";
    feature_to_ignore               = false;    /* default implicit [feature_to_ignore] */
    let dom_load_is_defined         = false;    /* [TOOL_SET] may not have [DOM_LOAD_ID] explicit configuration */
    for(let i=0; i< FUNCTIONS_TO_IGNORE   .length; ++i)
    {
        let entry = FUNCTIONS_TO_IGNORE[i];

        /* FOUND SOME EXPLICIT [DOM_LOAD_ID] [ENTRY] {{{*/
        if(!dom_load_is_defined && (entry.dom_load_id == dom_load_id))
        {
            dom_load_is_defined     =  true;
            feature_to_ignore       = false;    /* .. CLEAR [IMPLICIT ANSWER] */
        }

        /*}}}*/
        /* CHECK [DOM_LOAD_ID] [ENTRIES] {{{*/
        if(entry.dom_load_id == dom_load_id)
        {
            /* FOUND SPECIFIED ID */
            if(entry.id == item_id)
            {
                feature_to_ignore   = true;     /* .. SET [EXPLICIT ANSWER] */
                break;
            }
        }
        /*}}}*/
    }
/*{{{*/
if(log_this) {
    let lfx = (feature_to_ignore ? lf2 : lf5);
    log("%c "+caller+" ...return %c"+(feature_to_ignore ? "FALSE":"TRUE ")+" %c "+dom_load_id+" %c "+(dom_load_is_defined ? "defined" : "")+" %c ["+item_id +"]"
        ,lbH+lf3                ,lbL+lfx                                    ,lbC+lf8           ,lbC+lf8                                      ,lbR+lfx           );
}
/*}}}*/
    cached_entry_selected_item_id[item_id] = feature_to_ignore;
    return !feature_to_ignore;
};
/*}}}*/

/* TOOL LOAD {{{*/
/*  t_load */
/* {{{*/
const TOOLS1_OFF                 = "TOOLS OFF";
const TOOLS2_SANITY_CHECK_FAILED = "TOOLS SANITY CHECK FAILED";
const TOOLS3_NEED_RELAXED_CSP    = "TOOLS NEED RELAXED CSP";
const TOOLS4_DEPLOYED            = "TOOLS DEPLOYED";
const TOOLS5_UNLOADED            = "TOOLS UNLOADED";
const TOOLS6_NO_REPLY_YET        = "TOOLS NO REPLY YET";

/*}}}*/
/*  t_load {{{*/
/*{{{*/
let t_load_MS;

/*}}}*/
let t_load = function()
{
/*{{{*/
let caller     = "t_load";
logging_load_LOG_MAP();
let log_this = LOG_MAP.EV7_DISPATCH;

if(log_this) log(caller, "info");
/*}}}*/
    /* DOM_LOAD_ID+"] FROM TEMPLATE LITERAL {{{*/
    if( typeof DOM_LOAD_ID  == "undefined") {
        window.DOM_LOAD_ID="${DOM_LOAD_ID}";

if( log_this) logBIG("DOM_LOAD_ID ["+DOM_LOAD_ID+"] FROM TEMPLATE LITERAL");
    }
    /*}}}*/
    /* DOM_LOAD_ID FROM BOOKMARKLET SCRIPT TITLE {{{*/
    let dom_load_script = document.getElementById("dom_load");
    if( dom_load_script ) {
        window.DOM_LOAD_ID = dom_load_script.title;

if( log_this) logBIG("DOM_LOAD_ID..........=["+ DOM_LOAD_ID           +"]");
if( log_this) logBIG("dom_load_script.title=["+ dom_load_script.title +"]");
    }
    /*}}}*/

    t_load_MS = new Date().getTime();

    t1_load_SHADOW();

    t3_load_PLAYGROUND_PANELS();

    t2_load_TOOLS();
    if(!hotspot) {
        log("%c*** Tools hosting failed *** %c cannot continue", lbb+lbL+lf3, lbb+lbR+lf2);
        return;
    }

    t4_load_HEADSUP();

    t5_load_STORAGE();  /* prop_init prop_set pat_csv... pivotXY spread_ratio pivot_PANEL topTool transcripts dom_hide..observers IPC and STORE listeners */

    t6_load_DOM_TAGS();

    t7_load_GRID();

    t8_load_LOG_MAP();

    t9_load_BEHAVIOR();

    t10_load_IPC_and_LISTENERS();

    t11_load_POST();    /* IPC .. INIT TOOLS .. INIT DOC_TOOLS */
};
/*}}}*/
/*_ t_load_listener {{{*/
/*{{{*/
const PREVENT_RELOAD_DELAY = 5000;
/*}}}*/
let t_load_listener = function(event)
{
/*{{{*/
let   caller = "t_load_listener("+event.type+")";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) t_log_event_status(caller, lbb+lf1);
/*}}}*/
    /* [since_t_load] .. the delay since [t_load] was called */ /*{{{*/
        let this_MS = new Date().getTime();
        let since_t_load = this_MS - t_load_MS;
if( log_this) log("...since_t_load=["+since_t_load+"ms]");

    /*}}}*/
    /* === [beforeunload]  ==============================================================*
     * THE BROWSER MAY ASK THE USER                                                      *
     * ABOUT PREVENTING A SNEAKY UNLOAD                                                  *
     * WITH A CONFIRMATION DIALOGS                                                       *
       :!start explorer "https://developer.mozilla.org/en-US/docs/Web/Events/beforeunload"
     * ==================================================================================*/
    switch(event.type) {
    case "beforeunload": /* XXX {{{*/
    {
        let is_a_tool_request        = (onWork_EL_last_used && (onWork_EL_last_used.id == "RELOAD")); /* yields null or true */
        let user_is_wording          =  prop_get(       WORDING            ); /* USER PLAYING WITH WORDS      */
        let user_is_tooling          =  dimm_mask_displayed(               ); /* USER IS READING              */
        let user_has_anchor_freezed  =  prop_get(       ANCHOR_FREEZE      ); /* USER DISABLED LINKS          */
        let user_is_editing_dom_hide =  prop_get(       EDIT_OR_STAGE      ); /* EDIT MODE */
        let just_loaded              = (since_t_load < PREVENT_RELOAD_DELAY); /* AUTOMATED PAGE REQUEST .. TODO: FIND OUT [WHY] AND [HOW] */

        let confirmation_required
        =        !is_a_tool_request
        && (      user_is_wording
               || user_is_tooling
               || user_has_anchor_freezed
               || user_is_editing_dom_hide
               || just_loaded
           )
        ;
/*{{{*/
if(log_this || confirmation_required) {
        log_key_val_group( caller
                     , {          is_a_tool_request : is_a_tool_request
                         ,          user_is_wording : user_is_wording
                         ,          user_is_tooling : user_is_tooling
                         ,  user_has_anchor_freezed : user_has_anchor_freezed
                         , user_is_editing_dom_hide : user_is_editing_dom_hide
                         ,              just_loaded : just_loaded
                         ,    confirmation_required : confirmation_required
                     }
                     , lb0, false
                   );
}
/*}}}*/

        if(confirmation_required)
            event.returnValue = event.type +" USER CONFIRMATION"; /* Chrome requires returnValue to be set */
        else
            logBIG("UNLOAD CONFIRMATION NOT TRIGGERED", lf2);
        event.preventDefault(); /* Cancel the event as stated by the standard */
    }
    break;
    /*}}}*/
    case "unload": /*{{{*/
    {
log("%c"+caller+"%c"+event.type, lbb+lbL+lf2, lbb+lbR+lf3);

    }
    break;
    /*}}}*/
    default: /*{{{*/
    if(!log_this) {
log("%c"+caller+"%c"+event.type, lbb+lbL+lf2, lbb+lbR+lf3);

    }
    /*}}}*/
    }
};
/*}}}*/
/*_ t_unload {{{ */
let t_unload = function()
{
/*{{{*/
let caller = "t_unload";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

if( log_this) log("CLEAR SELECTED WORDS");
    s_clear_slot_all();

if( log_this) log("REMOVE EVENT LISTENERS");
    t_del_listeners();

if( log_this) log("MOVE TOOLS OFF GRID");
    if(!DOM_GRID_CSS_TAG)
        t_move_TOOLS_OFF_GRID(caller);

if( log_this) log("HIDE TOOLS");
    if(dom_tools_html)
        dom_tools_html.style.visibility = "hidden";

if( log_this) log("SET WORDING OFF");
    if(typeof dom_wording_cycle != "undefined")
        dom_wording_cycle("OFF", false);

if( log_this) log("SEND IPC UNLOAD MESSAGE");
    let ipc = {    t_load : TOOLS5_UNLOADED
        ,          caller : DOM_TOOLS_JS_TAG
    };
    t_send_IPC( ipc );

};
/*}}}*/
/*_ t_reload {{{ */
let t_reload = function()
{
/*{{{*/
let  caller = "t_reload";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly(caller);

    t_add_LISTENERS();

    t11_load_POST();
};
/* }}} */



/*  t1_load */
/*  t1_load */
/*  t1_load */
/*  t1_load_SHADOW {{{*/
let t1_load_SHADOW = function()
{
/*{{{*/
let   caller = "t1_load_SHADOW";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SD1+"%c "+caller, lbS+lf1, lbH+lf1);
/*}}}*/
    /* shadow_host shadow_root {{{*/
    let shadow_host = document.createElement("DIV");
    shadow_host.id  = "shadow_host";
    document.documentElement.appendChild( shadow_host );

    if( shadow_host.attachShadow ) {
        shadow_host.style.zIndex   = ZINDEX_SHADOW_HOST;

        shadow_root    = shadow_host.attachShadow({mode: "open"});
    }
    else {
        logBIG(caller+": shadow_host.attachShadow is missing");
        /* doc + tools event clash         */
        /* shadow_root = document.body;    */
        shadow_root    = shadow_host;
    }

    shadow_root.id     = "shadow_root";
    /*}}}*/
    /* t_host [CSS HTML JS] {{{*/

    t_host("dom_tools_css" );
    t_host("dom_tools_html");
    t_host("dom_tools_js"  );

    t_host("dom_grid_css"  );
    t_host("dom_grid_html" );
    t_host("dom_grid_js"   );

    t_host("dom_hide_js"   );
    t_host("dom_select_js" );
    t_host("dom_wording_js");

    t_host("dom_log_js"    );
    t_host("dom_prop_js"   );
    t_host("dom_store_js"  );
    t_host("dom_util_js"   );

    /*}}}*/
};
/*}}}*/
/*_ t_host {{{*/
let t_host = function(id)
{
/*{{{*/
let caller = "t_host";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"%c"+id, lbH+lf1);
/*}}}*/
    if( id.includes(" ") ) return;
    let el = document.querySelector("#"+id);
    if(!el               ) return;

    /* proxiedNode .. [https://www.wisdomjobs.com] .. [ special (/unique?) case] {{{*/
    if(el.proxiedNode)
    {
if(log_this) log("t_host: using proxiedNode ["+el.proxiedNode.type+"]:");
if(log_this) console_dir(el);
        el = el.proxiedNode;
    }
    /*}}}*/

    el.style.display = "inline";

    shadow_root.appendChild( el );

/*{{{
console.log("t_host("+id+") %c get_tool        "+ (get_tool(id)         ? " OK" : " FAILED"), lbF+lb7);
console.log("t_host("+id+") %c getComputedStyle"+ (getComputedStyle(el) ? " OK" : " FAILED"), lbF+lb7);
}}}*/
};
/*}}}*/
/*  t2_load */
/*  t2_load */
/*  t2_load */
/*  t2_load_TOOLS {{{*/
/*{{{*/
let dev_log_map;
let dom_load_tags;
let dom_tools_html;
let fly_div;
let TOOL_panels = [];

/*}}}*/
let t2_load_TOOLS = function()
{
/*{{{*/
let caller = "t2_load_TOOLS";
let log_this = LOG_MAP.T2_GRID || LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SD2+"%c "+caller, lbS+lf2, lbH+lf2);
/*}}}*/
    /* TOOLS CONTAINER [dom_tools_html] {{{*/
    let id;
    id = "dom_tools_html"   ; dom_tools_html                = get_tool(id);

    /*}}}*/

    /* ORDERED (OPTIONAL) PANELS INSERTION */

    /* PANEL [hotspot] .. BUILT-IN {{{*/
    id = "hotspot"          ; hotspot                       = get_tool(id);
    TOOL_panels.push( hotspot );

    id =  "hotring"         ; hotring                       = get_tool(id);
    id =  "hotspot_c"       ; hotspot_c                     = get_tool(id);
    id =  "hotwave"         ; hotwave                       = get_tool(id);
    /*}}}*/

    /* ROW #1: [pat_bag headsup_w headsup headsup_ds] */
    /* PANEL [pat_bag] {{{*/
    id = "pat_bag"          ; pat_bag                       = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( pat_bag );

     /*}}}*/
    /* PANEL [headsup_w] {{{*/
    id = "headsup_w"        ; headsup_w                     = get_tool(id); if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( headsup_w );
    id = "tools_filter"     ; tools_filter_input            = get_tool(id);
    id =  WORDS_EXACT       ; t_prop_set_EL(id              , get_tool(id));
    id =  WORDS_SEGMENT     ; t_prop_set_EL(id              , get_tool(id));
    id =  WORDS_HEAD_TAIL   ; t_prop_set_EL(id              , get_tool(id));
    id =  WORDS_OPCYCLE     ; t_prop_set_EL(id              , get_tool(id));
    id =  "recycle"         ; t_prop_set_EL(id              , get_tool(id));

    let id_array = t_get_words_drop_affix_array();
    for(let i=0; i < id_array.length; ++i) {
        id = id_array[i]    ; t_prop_set_EL(id              , get_tool(id));
    }
    /*}}}*/
    /* PANEL [headsup] {{{*/
    id = "headsup"          ; headsup                       = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( headsup );

    id = "thumb_p"          ; toolbar_thumb                 = get_tool(id);

    id =  ANCHOR_FREEZE     ; t_prop_set_EL(id              , get_tool(id));
    id =  THEME_DARK        ; t_prop_set_EL(id              , get_tool(id));
    id =  WORDING           ; t_prop_set_EL(id              , get_tool(id));

    id =  CONTAINERS_HI     ; t_prop_set_EL(id              , get_tool(id));

    id =  OVERFLOW_VISI     ; t_prop_set_EL(id              , get_tool(id));
    id =  SCROLL_SMOOTH     ; t_prop_set_EL(id              , get_tool(id));

    id =  TOOLS_EXTRAS      ; t_prop_set_EL(id              , get_tool(id));

    id =  SHOW_SEEKZONE     ; t_prop_set_EL(id              , get_tool(id));
    id =  PIN_SEEKSPOT      ; t_prop_set_EL(id              , get_tool(id));
    id =  LOG_SEEKSPOT      ; t_prop_set_EL(id              , get_tool(id));

    id =  DENY_OR_ALLOW     ; t_prop_set_EL(id              , get_tool(id));
    id =  EDIT_OR_STAGE     ; t_prop_set_EL(id              , get_tool(id));
    id =  DOM_HIDE1_RESET   ; t_prop_set_EL(id              , get_tool(id));
    id =  MASK_OR_HIDE      ; t_prop_set_EL(id              , get_tool(id));
    id =  SITE_OR_PAGE      ; t_prop_set_EL(id              , get_tool(id));

    /*}}}*/
    /* PANEL [headsup_ds] {{{*/
    id = "headsup_ds"       ; headsup_ds                    = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( headsup_ds );

    id =  TOOLS_TRAP        ; t_prop_set_EL(id              , get_tool(id));
    id =  TOOLS_SCROLL      ; t_prop_set_EL(id              , get_tool(id));
    /*}}}*/

    /* ROW #2: [sel_bag dom_traversal headsup_bw headsup_bz] */
    /* PANEL [sel_bag] {{{*/
    id = "sel_bag"          ; sel_bag                       = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( sel_bag );

    /*}}}*/
    /* PANEL [dom_traversal] {{{*/
    id = "dom_traversal"    ; dom_traversal                 = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( dom_traversal );

    /*}}}*/
    /* PANEL [headsup_bw] {{{*/
    id = "headsup_bw"       ; headsup_bw                    = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) )  TOOL_panels.push( headsup_bw );

    /*}}}*/
    /* PANEL [headsup_bz] {{{*/
    id = "headsup_bz"       ; headsup_bz                    = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( headsup_bz );

    /*}}}*/

    /* ROW #3: [test_panel dev_log_map dom_load_tags transcript1 transcript2] */
    /* PANEL [test_panel] {{{*/
    id = "test_panel"    ; test_panel                       = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( test_panel );

    /*}}}*/
    /* PANEL [dev_log_map] {{{*/
    id = "dev_log_map"      ; dev_log_map                   = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( dev_log_map );

    /*}}}*/
    /* PANEL [dom_load_tags] {{{*/
    id = "dom_load_tags"    ; dom_load_tags                 = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( dom_load_tags );

    /*}}}*/
    /* PANEL [transcript1] [transcript2] {{{*/
    id = "transcript1"      ; transcript1                   = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( transcript1 );

    id = "transcript2"      ; transcript2                   = get_tool(id);
    if( is_a_DOM_LOAD_panel(id) ) TOOL_panels.push( transcript2 );

    log_tr1 = transcript1;
    log_tr2 = transcript2;
    /*}}}*/

    /* FLOATING PANELS */
    /* pivspot seeker fly_div dom_grid_html {{{*/
    id = "pivspot"          ; pivspot                       = get_tool(id);
    id = "pivspot_c"        ; pivspot_c                     = get_tool(id);

    id = "seeker_PD"        ; seeker_PD                     = get_tool(id);
    id = "seeker_PU"        ; seeker_PU                     = get_tool(id);
    id = "seeker_CD"        ; seeker_CD                     = get_tool(id);
    id = "seeker_CU"        ; seeker_CU                     = get_tool(id);

    id = "seekzone"         ; seekzone                      = get_tool(id);
    id = "seekspot_A"       ; seekspot_A                    = get_tool(id);
    id = "seekspot_U"       ; seekspot_U                    = get_tool(id);
    id = "seekspot_D"       ; seekspot_D                    = get_tool(id);

    id = "fly_div"          ; fly_div                       = get_tool(id);

    id = "dom_grid_html"    ; dom_grid_html                 = get_tool(id);
    /*}}}*/

    /* hide all panels {{{*/
    if(dom_tools_html) dom_tools_html.style.visibility = "hidden";
    let el;
    for(let i=1; i < TOOL_panels.length; ++i)
        if( el   = TOOL_panels[i]) add_el_class(el, CSS_HIDDEN);

    /*}}}*/
if( log_this) prop_log_MAP(caller);
};
/*}}}*/
/*_ t_prop_set_EL {{{*/
let t_prop_set_EL = function(id,el)
{
/*{{{*/
let caller = "t_prop_set_EL";
let log_this = LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

/*}}}*/
    prop_set_EL(id, el);

    if( playground_clones_panel ) t2_clone_panel_id_bg_type_label(playground_clones_panel, id, "bg7", "input");
};
/*}}}*/

/*  t4_load */
/*  t4_load */
/*  t4_load */
/*  t4_load_HEADSUP {{{*/
let t4_load_HEADSUP = function()
{
/*{{{*/
let caller = "t4_load_HEADSUP";
let log_this = LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+SD4+"%c "+caller, lbS+lf4, lbH+lf4);
/*}}}*/
    /* headsup {{{*/
    let el;

    if( el = toolbar_thumb                 ) { el.style.position   = "absolute"; el.style.left = " 20px"; el.style.top = "  5px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( WORDING         )) { el.style.position   = "absolute"; el.style.left = "  5px"; el.style.top = " 72px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( ANCHOR_FREEZE   )) { el.style.position   = "absolute"; el.style.left = " 30px"; el.style.top = " 20px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( CONTAINERS_HI   )) { el.style.position   = "absolute"; el.style.left = " 85px"; el.style.top = " 33px"; el.style.transform = "" /*"initial"*/; }

    if( el = prop_get_EL( THEME_DARK      )) { el.style.position   = "absolute"; el.style.left = "135px"; el.style.top = "  5px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( TOOLS_EXTRAS    )) { el.style.position   = "absolute"; el.style.left = "155px"; el.style.top = " 58px"; el.style.transform = "" /*"initial"*/; }

    if( el = prop_get_EL( SCROLL_SMOOTH   )) { el.style.position   = "absolute"; el.style.left = "110px"; el.style.top = " 90px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( OVERFLOW_VISI   )) { el.style.position   = "absolute"; el.style.left = " 60px"; el.style.top = " 85px"; el.style.transform = "" /*"initial"*/; }

    if( el = prop_get_EL( SHOW_SEEKZONE   )) { el.style.position   = "absolute"; el.style.left = "190px"; el.style.top = "  5px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( PIN_SEEKSPOT    )) { el.style.position   = "absolute"; el.style.left = "220px"; el.style.top = " 45px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( LOG_SEEKSPOT    )) { el.style.position   = "absolute"; el.style.left = "200px"; el.style.top = " 90px"; el.style.transform = "" /*"initial"*/; }

    /*}}}*/
    /* headsup_w {{{*/
    if( el = prop_get_EL( WORDS_EXACT     )) { el.style.position   = "absolute"; el.style.left =  "10px"; el.style.top = " 47px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( WORDS_SEGMENT   )) { el.style.position   = "absolute"; el.style.left =  "55px"; el.style.top = " 33px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( WORDS_HEAD_TAIL )) { el.style.position   = "absolute"; el.style.left = "100px"; el.style.top = " 47px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( WORDS_OPCYCLE   )) { el.style.position   = "absolute"; el.style.left =  "55px"; el.style.top = " 80px"; el.style.transform = "" /*"initial"*/; }
    if( el = recycle_button                ) { el.style.position   = "absolute"; el.style.left = "130px"; el.style.top = " 80px"; el.style.transform = "" /*"initial"*/; }

    let    top =  48; /* MAGIC NUMBER */
    let   left = 155; /* MAGIC NUMBER */

    let id_array = t_get_words_drop_affix_array();
    for(let i=0; i < id_array.length; ++i)
    {
        let id = id_array[i];
        if( el = prop_get_EL(id)) {
            el.style.position  = "absolute";
            el.style.left      =  left+"px";
            el.style.top       =   top+"px";
            el.style.transform =         "";
            top += 30; /* MAGIC NUMBER */
        }
    }
    /*}}}*/
    /* headsup_ds {{{*/
    if( el = prop_get_EL( TOOLS_TRAP      )) { el.style.position   = "absolute"; el.style.left =  "10px"; el.style.top =   "5px"; }
    if( el = prop_get_EL( TOOLS_SCROLL    )) { el.style.position   = "absolute"; el.style.left =  "80px"; el.style.top =   "5px"; }

    if( el = prop_get_EL( SITE_OR_PAGE    )) { el.style.position   = "absolute"; el.style.left =   "5px"; el.style.top =  "50px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( MASK_OR_HIDE    )) { el.style.position   = "absolute"; el.style.left =  "45px"; el.style.top =  "50px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( EDIT_OR_STAGE   )) { el.style.position   = "absolute"; el.style.left =  "85px"; el.style.top =  "50px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( DOM_HIDE1_RESET )) { el.style.position   = "absolute"; el.style.left = "125px"; el.style.top =  "40px"; el.style.transform = "" /*"initial"*/; }
    if( el = prop_get_EL( DENY_OR_ALLOW   )) { el.style.position   = "absolute"; el.style.left = "120px"; el.style.top =  "75px"; el.style.transform = "scale(0.7)"    ; }

    /*}}}*/
};
/*}}}*/
/*  t5_load */
/*  t5_load */
/*  t5_load */
/*  t5_load_STORAGE {{{*/
/*{{{*/
let IN_WEBVIEW = "";
let USERAGENT  = "";

/*}}}*/
let t5_load_STORAGE = function()
{
/*{{{*/
let   caller = "t5_load_STORAGE";
let log_this = LOG_MAP.T0_STORE || LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+SD5+"%c "+caller, lbS+lf5, lbH+lf5);
/*}}}*/
    /* LOAD STORED USER-SETTINGS {{{*/

    t_store0_set_settings();

    let id, state;

    id = ANCHOR_FREEZE         ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  CONTAINERS_HI        ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  FLY_DIV_MAGNIFIED    ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  LOG_SEEKSPOT         ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  OVERFLOW_VISI        ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  PIN_SEEKSPOT         ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  PIVOT_MAGNIFIED      ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  SCROLL_SMOOTH        ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  SHOW_SEEKZONE        ; state = (store_getItem(id) == "true"); prop_set(id, state, t_SHOW_SEEKZONE_changed);
    id =  THEME_DARK           ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  TOOLS_EXTRAS         ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  TOOLS_SCROLL         ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  TOOLS_TRAP           ; state = (store_getItem(id) == "true"); prop_set(id, state);

    id =  WORDING              ; state = (store_getItem(id) == "true"); prop_set(id, state);
    id =  WORDS_EXACT          ; state = (store_getItem(id) == "true"); prop_set(id, state, t_words_option_select_key);
    id =  WORDS_SEGMENT        ; state = (store_getItem(id) == "true"); prop_set(id, state, t_words_option_select_key);
    id =  WORDS_HEAD_TAIL      ; state = (store_getItem(id) == "true"); prop_set(id, state, t_words_option_select_key);
    id =  WORDS_OPCYCLE        ; state = (store_getItem(id) == "true"); prop_set(id, state, t_words_option_select_key);

    let id_array = t_get_words_drop_affix_array();
    for(let i=0; i < id_array.length; ++i) {
        let id = id_array[i];
        id = id_array[i]; state = (store_getItem(id) == "true"); prop_set(id, state, t_words_option_select_key);
    }

    t_words_option_initialize();

     /*}}}*/
    /* SELECTION CSV {{{*/
    id = "sel_csv"             ; sel_csv = store_getItem(id) || "";
    id = "pat_csv"             ; pat_csv = store_getItem(id) || "";
    id = "off_csv"             ; off_csv = store_getItem(id) || "";
    id = "bak_csv"             ; bak_csv = store_getItem(id) || "";
    id = "alt_csv"             ; alt_csv = store_getItem(id) || "";

    if(off_csv && (csv_count(off_csv) == csv_count(pat_csv)))
    {
/*{{{
logXXX("%c RESELECTING [ALL-OFF SELECTION]", lbH+lf4);
}}}*/
        off_csv="";
    }
    all_csv        = csv_cat(pat_csv, off_csv);
    all_csv        = csv_cat(all_csv, bak_csv);
    all_csv        = csv_cat(all_csv, alt_csv);

/*{{{
logXXX(csv_count(pat_csv)+" in pat_csv");
logXXX(csv_count(off_csv)+" in off_csv");
logXXX(csv_count(bak_csv)+" in bak_csv");
logXXX(csv_count(alt_csv)+" in alt_csv");
logXXX(csv_count(all_csv)+" in all_csv");
}}}*/

     /*}}}*/
    /* INITIAL MODE .. (EDIT HIDE SITE) {{{*/
/*{{{
}}}*/
    prop_init(  SITE_OR_PAGE   , false, t_SITE_OR_PAGE_changed   );
    prop_init(  MASK_OR_HIDE   , false, t_MASK_OR_HIDE_changed   );
    prop_init(  EDIT_OR_STAGE  , false, t_EDIT_OR_STAGE_changed  );
    prop_init(  DOM_HIDE1_RESET, false, t_DOM_HIDE1_RESET_changed);
    prop_init(  DENY_OR_ALLOW  , false, t_store0_log_settings    );

    prop_init(  WORDS_DROP_ING ,  true                           );
    prop_init(  WORDS_DROP_S   ,  true                           );
    /*}}}*/
    /* USERAGENT {{{*/

    /* Mozilla/5.0
     * (Linux; Android 6.0.1; SGP512 Build/23.5.A.1.291; wv)
     * AppleWebKit/537.36 (KHTML, like Gecko)
     * Version/4.0
     * Chrome/57.0.2987.132
     * Safari/537.36
     */

    if(!USERAGENT)
    {
        USERAGENT  = window.navigator.userAgent;
        IN_WEBVIEW = (USERAGENT.toLowerCase().indexOf("android") > 0);

    }
    /*}}}*/

    t_cache_w_H_w_W_p_H();
    /* pivotXY .. (DEFAULT or STORED value) {{{*/
    pivotXY.x = window.innerWidth  / 2;
    pivotXY.y = window.innerHeight / 2;

    let     xy, x=0, y=0;
    if(     xy = store_parseXY("pivotXY")) {
        x = xy.x;
        y = xy.y;
    }

    x = Math.max( -w_W , x      );
    y = Math.max( -w_H , y      );
    x = Math.min(        x, w_W );
    y = Math.min(        y, w_H );

    pivotXY.x = x;
    pivotXY.y = y;
    /*}}}*/
    /* pivot_PANEL {{{*/
    id = store_getItem("pivot_PANEL");
    let panel = (id == null) ? null : get_tool(id);

    t_set_pivot_PANEL(panel);
    /*}}}*/
    /* transcript1 transcript2 {{{*/
    if(transcript1)
    {
        let panel = transcript1;
        let key   = panel.id +"_pinned";
        let prop  = prop_set(key, store_getBool(key));
        if(!prop.value)
            panel.style.position = prop_get( TOOLS_SCROLL ) ? "absolute" : "fixed";
        else {
            if( xy = store_parseXY(panel.id +"_XY")) {
                xy = t_get_tool_XY_in_viewport(panel, xy.x, xy.y);
                t_pin_tool_at_XY(panel, xy.x, xy.y, "fixed", ZINDEX_PINNED_PANEL_ZERO);
            }
        }
    }
    if(transcript2)
    {
        let panel = transcript2;
        let key   = panel.id +"_pinned";
        let prop  = prop_set(key, store_getBool(key));
        if(!prop.value)
            panel.style.position = prop_get( TOOLS_SCROLL ) ? "absolute" : "fixed";
        else {
            if( xy = store_parseXY(panel.id +"_XY")) {
                xy = t_get_tool_XY_in_viewport(panel, xy.x, xy.y);
                t_pin_tool_at_XY(panel, xy.x, xy.y, "fixed", ZINDEX_PINNED_PANEL_ZERO);
            }
        }
    }
    /*}}}*/
    /* TOOL_panels [pinned xy magnified] {{{*/
    for(let i=0; i < TOOL_panels.length; ++i)
    {
        /* stored json value {{{*/
        let panel = TOOL_panels[i];
        if(!panel      ) continue;

        let panel_json = store_getItem(panel.id+"_JSON");
        if(!panel_json ) continue;

        let value = JSON.parse( panel_json );
if( log_this) log_key_val(caller+" "+panel.id+" value", value, lf3);
        /*}}}*/
        /* [pinned] [xy] {{{*/
        if( value.pinned) {
            if( value.xy ) {
                let vp_xy = t_get_tool_XY_in_viewport(panel, value.xy.x, value.xy.y);
                t_pin_tool_at_XY(panel, vp_xy.x, vp_xy.y, "fixed", i+ZINDEX_PINNED_PANEL_ZERO);
            }
        }
        /*}}}*/
        /* [magnified] {{{*/
        t_layout_panel_magnified(panel, value.magnified);

        /*}}}*/
    }
    /*}}}*/
    /* target_tool [xy] .. (visible when PINNED) {{{*/
    for(let tt_num=1; tt_num <= TARGET_MAX; ++tt_num)
    {
        /* LOAD [tt_num] {{{*/
        let               tt = t_target_tool_get(tt_num);
        let tt_json = store_getItem(tt.id+"_JSON");
        if(!tt_json ) continue;
        /*}}}*/
        /* [xy] [date_MS] {{{*/
        let value = JSON.parse( tt_json );
        if( value.pinned )
            t_pin_tt_at_XY_position_date_MS_msg(  tt
                                                , value.xy.x
                                                , value.xy.y
                                                , "absolute"
                                                , value.date_MS
                                                , value.msg
                                               );

        /*}}}*/
        /* [dir_class] {{{*/
        if( value.dir_class ) {
            add_el_class(tt, value.dir_class);
        }
        /*}}}*/
if( log_this) console_dir(tt, caller);
    }
    /* ORDER PINNED [target_tool] INSTANCES */
    t_target_tool_reorder(caller);

    /*}}}*/
    /* topTool xy {{{*/
    if( xy            = store_parseXY("topTool_XY")) {
        xy.x          = Math.max( -w_W , xy.x      );
        xy.y          = Math.max( -w_H , xy.y      );
        xy.x          = Math.min(        xy.x, w_W );
        xy.y          = Math.min(        xy.y, w_H );

        topTool.x     = xy.x;
        topTool.y     = xy.y;
    }
/*{{{
logBIG("topTool=["+topTool.x+" "+topTool.y+"]")
log("...WINDOW %c "+ w_W+" x "+w_H +" %c PAGE %c "+p_H +" ", lb3,lbA, lb4);
}}}*/
    /*}}}*/
    /* spread_ratio {{{*/
    x =                      parseFloat(   store_getItem("spread_ratio_x") || 0.5);
    y =                      parseFloat(   store_getItem("spread_ratio_y") || 0.5);

    spread_ratio.x = x;
    spread_ratio.y = y;
/*{{{
logBIG(caller+": spread_ratio=["+spread_ratio.x+" "+spread_ratio.y+"]")
}}}*/
    /*}}}*/
    /* [dom_hide] {{{*/
    dom_hide6_add_container_observer      ( t_seek_set_container_selected );
    dom_hide6_add_store_set_value_observer( store_set_value               );
    dom_hide6_add_info_observer           ( t_fly                         );

    /*}}}*/
    /* IPC [dom_store] {{{*/
    dom_store_add_info_observer( t_pat_bag_status_set_innerText );

    store_add_listener();
    /*}}}*/
    /* scroll to tools_scrollY {{{ */
    let tools_scrollY = store_getItem("tools_scrollY"); tools_scrollY = (tools_scrollY == null) ? 0 : parseFloat(tools_scrollY);
    if( tools_scrollY) {
        setTimeout( function() { t_window_scrollTo(window.scrollX, tools_scrollY, "instant"); }, 0);
    }
    /*}}}*/
    /* add prop change listener {{{*/
    prop_set_CB( t1_prop_id_state_CB );

    /*}}}*/
    /* LOG SETTINGS */
if( log_this) t_store0_log_settings();

};
/*}}}*/
/*_ t_pin_tool_at_XY {{{*/
let t_pin_tool_at_XY = function(tool_el, x, y, position, zIndex)
{
/*{{{*/
let   caller = "t_pin_tool_at_XY";
let log_this = LOG_MAP.T0_STORE || LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;


if( log_this) log(caller+"("+get_n_lbl(tool_el)+", ["+x+" "+y+"], position=["+position+"], zIndex=["+zIndex+"])");
/*}}}*/

    if(position) tool_el.style.position = position;
    tool_el.style.left                  = x+"px"  ;
    tool_el.style.top                   = y+"px"  ;

    t_set_CSS_PINNED(tool_el, true);

    tool_el.style.display = "block";
    if(zIndex  ) tool_el.style.zIndex   = zIndex;
};
/*}}}*/
/*_ t_get_tool_XY_in_viewport {{{*/
let t_get_tool_XY_in_viewport = function(panel, x, y)
{
/*{{{*/
let   caller = "t_get_tool_XY_in_viewport";
let log_this = LOG_MAP.T0_STORE || LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

/*}}}*/
    let h = panel.offsetHeight;
    let w = panel.offsetWidth;

    let t = -h+2*BOX_MARGIN                   ; /* near top    */
    let l = -w+2*BOX_MARGIN                   ; /* near left   */
    let b =                 w_H - 2*BOX_MARGIN; /* near bottom */
    let r =                 w_W - 2*BOX_MARGIN; /* near right  */

    let xy    = { x:x , y:y };
    xy.x      = Math.max( l, x   );
    xy.x      = Math.min( xy.x, r);

    xy.y      = Math.max( t, y   );
    xy.y      = Math.min( xy.y, b);

    xy.capped = (x != xy.x) || (y != xy.y);

if( log_this)
    log_key_val( caller
                 , {       panel : panel.id
                     ,         x : x
                     ,         y : y
                     , WINDOW_WH : "["+  w_W +" "+  w_H +"]"
                     ,        tl : "["+    t +" "+    l +"]"
                     ,        br : "["+    b +" "+    r +"]"
                     ,        wh : "["+    w +" "+    h +"]"
                     ,        xy : "["+ xy.x +" "+ xy.y +"]"
                     ,    capped : xy.capped
                 }
               , lf4);
    return xy;
};
/*}}}*/
/*  t6_load */
/*  t6_load */
/*  t6_load */
/*  t6_load_DOM_TAGS {{{*/
let t6_load_DOM_TAGS = function()
{
/*{{{*/
    let caller = "t6_load_DOM_TAGS";
let log_this = LOG_MAP.T0_STORE || LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+SD6+"%c "+caller+" COLOR-STAMPING MODULE TAGS", lbS+lf6, lbH+lf6);
/*}}}*/
    /* dom_load_tags_el UI {{{*/
    let dom_load_tags_el = get_tool("dom_load_tags");
    if(!dom_load_tags) {
logBIG(caller+" *** get_tool('dom_load_tags') failed");

        return;
    }
    /*}}}*/
    let id, el;

    id = "dom_tools_html"; if(el = get_tool(id+"_tag")) DOM_TOOLS_HTML_TAG = el.innerHTML;
    id =  "dom_grid_html"; if(el = get_tool(id+"_tag")) DOM_GRID_HTML_TAG  = el.innerHTML;

    id =   "dom_host_css";                              DOM_HOST_CSS_TAG   = t6_load_css1_document_tag(id);
    id =  "dom_tools_css";                              DOM_TOOLS_CSS_TAG  = t6_load_css2_tool_tag    (id);
    id =   "dom_grid_css";                              DOM_GRID_CSS_TAG   = t6_load_css2_tool_tag    (id);

    if( typeof DOM_LOAD_TAG  == "undefined") {
        window.DOM_LOAD_TAG="${DOM_LOAD_TAG}";
if( log_this) logBIG("DOM_LOAD_TAG ["+DOM_LOAD_TAG+"] SET FROM TEMPLATE LITERAL");
    }

    let m_class = "em_missing";
    dom_load_tags_el.innerHTML = ""
        + ("LOAD :"+LF)
        + ((typeof DOM_LOAD_TAG       == "undefined") ? "<em class='"+m_class+"'>DOM_LOAD_TAG       *</em>" : "<em class='cc"+ get_tag_hour( DOM_LOAD_TAG       ) +"'>"+ DOM_LOAD_TAG        +"</em>")
        + ("HOST :"+LF)
        + ((typeof DOM_HOST_CSS_TAG   == "undefined") ? "<em class='"+m_class+"'>DOM_HOST_CSS_TAG   *</em>" : "<em class='cc"+ get_tag_hour( DOM_HOST_CSS_TAG   ) +"'>"+ DOM_HOST_CSS_TAG    +"</em>")
        + ((typeof DOM_WORDING_JS_TAG == "undefined") ? "<em class='"+m_class+"'>DOM_WORDING_JS_TAG *</em>" : "<em class='cc"+ get_tag_hour( DOM_WORDING_JS_TAG ) +"'>"+ DOM_WORDING_JS_TAG  +"</em>")
        + ("GRID :"+LF)
        + ((typeof DOM_GRID_CSS_TAG   == "undefined") ? "<em class='"+m_class+"'>DOM_GRID_CSS_TAG   *</em>" : "<em class='cc"+ get_tag_hour( DOM_GRID_CSS_TAG   ) +"'>"+ DOM_GRID_CSS_TAG    +"</em>")
        + ((typeof DOM_GRID_JS_TAG    == "undefined") ? "<em class='"+m_class+"'>DOM_GRID_JS_TAG    *</em>" : "<em class='cc"+ get_tag_hour( DOM_GRID_JS_TAG    ) +"'>"+ DOM_GRID_JS_TAG     +"</em>")
        + ((typeof DOM_GRID_HTML_TAG  == "undefined") ? "<em class='"+m_class+"'>DOM_GRID_HTML_TAG  *</em>" : "<em class='cc"+ get_tag_hour( DOM_GRID_HTML_TAG  ) +"'>"+ DOM_GRID_HTML_TAG   +"</em>")
        + ("TOOLS :"+LF)
        + ((typeof DOM_HIDE_JS_TAG    == "undefined") ? "<em class='"+m_class+"'>DOM_HIDE_JS_TAG    *</em>" : "<em class='cc"+ get_tag_hour( DOM_HIDE_JS_TAG    ) +"'>"+ DOM_HIDE_JS_TAG     +"</em>")
        + ((typeof DOM_LOG_JS_TAG     == "undefined") ? "<em class='"+m_class+"'>DOM_LOG_JS_TAG     *</em>" : "<em class='cc"+ get_tag_hour( DOM_LOG_JS_TAG     ) +"'>"+ DOM_LOG_JS_TAG      +"</em>")
        + ((typeof DOM_PROP_JS_TAG    == "undefined") ? "<em class='"+m_class+"'>DOM_PROP_JS_TAG    *</em>" : "<em class='cc"+ get_tag_hour( DOM_PROP_JS_TAG    ) +"'>"+ DOM_PROP_JS_TAG     +"</em>")
        + ((typeof DOM_SELECT_JS_TAG  == "undefined") ? "<em class='"+m_class+"'>DOM_SELECT_JS_TAG  *</em>" : "<em class='cc"+ get_tag_hour( DOM_SELECT_JS_TAG  ) +"'>"+ DOM_SELECT_JS_TAG   +"</em>")
        + ((typeof DOM_STORE_JS_TAG   == "undefined") ? "<em class='"+m_class+"'>DOM_STORE_JS_TAG   *</em>" : "<em class='cc"+ get_tag_hour( DOM_STORE_JS_TAG   ) +"'>"+ DOM_STORE_JS_TAG    +"</em>")
        + ((typeof DOM_TOOLS_CSS_TAG  == "undefined") ? "<em class='"+m_class+"'>DOM_TOOLS_CSS_TAG  *</em>" : "<em class='cc"+ get_tag_hour( DOM_TOOLS_CSS_TAG  ) +"'>"+ DOM_TOOLS_CSS_TAG   +"</em>")
        + ((typeof DOM_TOOLS_HTML_TAG == "undefined") ? "<em class='"+m_class+"'>DOM_TOOLS_HTML_TAG *</em>" : "<em class='cc"+ get_tag_hour( DOM_TOOLS_HTML_TAG ) +"'>"+ DOM_TOOLS_HTML_TAG  +"</em>")
        + ((typeof DOM_TOOLS_JS_TAG   == "undefined") ? "<em class='"+m_class+"'>DOM_TOOLS_JS_TAG   *</em>" : "<em class='cc"+ get_tag_hour( DOM_TOOLS_JS_TAG   ) +"'>"+ DOM_TOOLS_JS_TAG    +"</em>")
        + ((typeof DOM_UTIL_JS_TAG    == "undefined") ? "<em class='"+m_class+"'>DOM_UTIL_JS_TAG    *</em>" : "<em class='cc"+ get_tag_hour( DOM_UTIL_JS_TAG    ) +"'>"+ DOM_UTIL_JS_TAG     +"</em>")
    ;
if(LOG_MAP.T3_LAYOUT) log(strip_html(dom_load_tags_el.innerHTML));

};
/*}}}*/
/*_ t6_load_css1_document_tag {{{*/
let t6_load_css1_document_tag = function(id)
{
let caller = "t6_load_css1_document_tag("+id+")";

    let tag = "";

    /* check or provide a target DOCUMENT-HTMLElement for this id */
    let el = document.getElementById(id+"_tag");
    if(!el) {
        el               = document.createElement("SPAN");
        el.id            = id+"_tag";
        el.style.display = "none";
        document.body.appendChild( el );
    }

    /* return the content property value applied by the defined CSS ID selector */
    try {
        let style = getComputedStyle(el);
        let   txt = strip_pat(style.getPropertyValue("content"), DOUBLE_QUOTE);
        tag       = txt.includes(id) ? "DOCUMENT: "+txt : "";
    }
    catch(ex) {
/*{{{
console.trace(caller+": "+ ex);
}}}*/
    }

/*{{{
logXXX(caller+": ...return %c "+tag, lbH+lf1);
}}}*/
    return tag;
};
/*}}}*/
/*_ t6_load_css2_tool_tag {{{*/
let t6_load_css2_tool_tag = function(id)
{
let  caller = "t6_load_css2_tool_tag("+id+")";
    let tag = "";

    /* check the target HTMLElement for this id */
    let el       = get_tool(id)  ;
    if( el ) tag = t6_load_css3_first_rule_text(el);

    /* ...or provide a target SHADOW-HTMLElement for this id */
    if(!tag) {
        el               = document.createElement("SPAN");
        el.id            = id+"_tag";
        el.style.display = "none";
        shadow_root.appendChild( el );

        try {
            let style = getComputedStyle(el);
            let   txt = strip_pat(style.getPropertyValue("content"), DOUBLE_QUOTE);
            tag       = txt.includes(id) ? "SHADOW: "+txt : "";
        }
        catch(ex) {
/*{{{
console.trace(caller+": "+ ex);
}}}*/
        }
    }
/*{{{
logXXX(caller+": ...return %c "+tag, lbH+lf2);
}}}*/
    return tag;
};
/*}}}*/
/*_ t6_load_css3_first_rule_text {{{*/
let t6_load_css3_first_rule_text = function(el)
{
    let  caller = "t6_load_css3_first_rule_text("+el.id+")";

    let tag = "";

    let                                result = "";
    try {
        if(     !el.sheet            ) result = "!el.sheet";
        else if(!el.sheet.cssRules   ) result = "!el.sheet.cssRules";
        else if(!el.sheet.cssRules[0]) result = "!el.sheet.cssRules[0]";
        else {
            let txt = el.sheet.cssRules[0].cssText;
            let x_1 = txt.indexOf    ('"');
            let x_2 = txt.lastIndexOf('"');
            txt     = txt.substring(x_1+1, x_2);
            tag     = txt.includes(el.id) ? "SHEET: "+txt : "";
        }
    }
    catch(ex) {
        result = ex;
/*{{{
console.trace()
}}}*/
    }
/*{{{
logXXX(caller+": ...return: %c"+(tag || result), lbH+lf3);
}}}*/
    return tag;
};
/*}}}*/
/*  t7_load */
/*  t7_load */
/*  t7_load */
/*  t7_load_GRID {{{ */
let t7_load_GRID = function()
{
/*{{{*/
let   caller = "t7_load_GRID";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SD7+"%c "+caller, lbS+lf7, lbH+lf7);
/*}}}*/
    if(typeof t_grid_MEASURE != "undefined")
        t_grid_MEASURE();
};
/* }}} */
/*  t8_load */
/*  t8_load */
/*  t8_load */
/*_ t8_load_LOG_MAP {{{ */
/*{{{*/
let KEY_LOG_IPC             = "LOG IPC"      ;
let KEY_LOG_EVENTS          = "LOG EVENTS"   ;
let KEY_LOG_HIGHLIGHT       = "LOG HIGHLIGHT";
let KEY_LOG_TOOLBAR         = "LOG TOOLBAR"  ;

/*}}}*/
let t8_load_LOG_MAP = function()
{
/*{{{*/
let   caller = "t8_load_LOG_MAP";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SD8+"%c "+caller, lbS+lf8, lbH+lf8);
/*}}}*/
    if( !dev_log_map ) return;

    let button_className = CSS_TOOLBAG_BUTTON;
    dev_log_map.innerHTML = ""
        + "<em class='"+button_className+" "+ (LOG_IPC                ? "cc9" : "cc8") +"'>"+ KEY_LOG_IPC       +"</em>"
        + "<em class='"+button_className+" "+ (logging_EVENTS         ? "cc9" : "cc8") +"'>"+ KEY_LOG_EVENTS    +"</em>"
        + "<em class='"+button_className+" "+ (logging_HIGHLIGHT      ? "cc9" : "cc8") +"'>"+ KEY_LOG_HIGHLIGHT +"</em>"
        + "<em class='"+button_className+" "+ (logging_TOOLBAR        ? "cc9" : "cc8") +"'>"+ KEY_LOG_TOOLBAR   +"</em>"

        + "<em class='"+button_className+" "+ (LOG_MAP.EV0_LISTEN     ? "cc9" : "cc8") +"'>"+ "EV0_LISTEN"      +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV1_DOWN       ? "cc1" : "cc8") +"'>"+ "EV1_DOWN"        +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV2_MOVE       ? "cc2" : "cc8") +"'>"+ "EV2_MOVE"        +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV3_UP         ? "cc3" : "cc8") +"'>"+ "EV3_UP"          +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV4_LONG_PRESS ? "cc4" : "cc8") +"'>"+ "EV4_LONG_PRESS"  +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV5_TOOL_CB    ? "cc5" : "cc8") +"'>"+ "EV5_TOOL_CB"     +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV6_CHANGED    ? "cc6" : "cc8") +"'>"+ "EV6_CHANGED"     +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV7_DISPATCH   ? "cc7" : "cc8") +"'>"+ "EV7_DISPATCH"    +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.EV8_FLOATLOG   ? "cc9" : "cc8") +"'>"+ "EV8_FLOATLOG"    +"</em>"

        + "<em class='"+button_className+" "+ (LOG_MAP.S1_RANGE       ? "cc1" : "cc8") +"'>"+ "S1_RANGE"        +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.S2_SELECT      ? "cc2" : "cc8") +"'>"+ "S2_SELECT"       +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.S3_SLOT        ? "cc3" : "cc8") +"'>"+ "S3_SLOT"         +"</em>"

        + "<em class='"+button_className+" "+ (LOG_MAP.T0_STORE       ? "cc9" : "cc8") +"'>"+ "T0_STORE"        +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T1_DOM_LOAD    ? "cc1" : "cc8") +"'>"+ "T1_DOM_LOAD"     +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T2_GRID        ? "cc2" : "cc8") +"'>"+ "T2_GRID"         +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T3_LAYOUT      ? "cc3" : "cc8") +"'>"+ "T3_LAYOUT"       +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T4_PIVOT       ? "cc4" : "cc8") +"'>"+ "T4_PIVOT"        +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T5_SPREAD      ? "cc5" : "cc8") +"'>"+ "T5_SPREAD"       +"</em>"
        + "<em class='"+button_className+" "+ (LOG_MAP.T6_SLOT        ? "cc6" : "cc8") +"'>"+ "T6_SLOT"         +"</em>"

/* UNICODE {{{
        + "1 \u2610 \u2611 \u2620 \u2622 \u2638"+"<br>"
        + "2 \u2654 \u2655 \u2656 \u2657 \u2658"+"<br>"
        + "3 \u2659 \u2699 \u26A0 \u26A1 \u26AA"+"<br>"
        + "4 \u26AB \u26AC \u26D4 \u2705 \u2708"+"<br>"
        + "5 \u270B \u2710 \u2713 \u2714 \u2715"+"<br>"
        + "6 \u2716 \u2717 \u2718 \u271A \u271B"+"<br>"
        + "7 \u2724 \u2726 \u272D \u2731 \u2737"+"<br>"
        + "8 \u274C \u274D \u274E \u274F \u2753"+"<br>"
        + "9 \u2754 \u275D \u275E \u276E \u276F"+"<br>"
        + "A \u2770 \u2771 \u2774 \u2775 \u2794"+"<br>"
        + "B \u2795 \u2796 \u2797 \u2798 \u2799"+"<br>"
        + "C \u279A \u27A4 \u27EA \u27EB \u2AF6"+"<br>"
        + "D \u2AFB \u2AFC \u2AFD \u2B06 \u21E7"+"<br>"
}}}*/
    ;

    if(!t_has_push_pin_on_panel( dev_log_map ) ) t_add_toolpins_on_panel  ( dev_log_map );
    else                                         t_eval_wide_or_tall_panel( dev_log_map );
};
/* }}} */
/*  t9_load */
/*  t9_load */
/*  t9_load */
/*_ t9_load_BEHAVIOR {{{*/
let t9_load_BEHAVIOR = function()
{
/*{{{*/
let   caller = "t9_load_BEHAVIOR";
let log_this = LOG_MAP.T1_DOM_LOAD || LOG_MAP.EV7_DISPATCH;

if( log_this) log("%c"+SD9+"%c "+caller, lbS+lf9, lbH+lf9);
/*}}}*/
    /* TOUCH OR MOUSE {{{*/
    /* f(ontouchstart) {{{*/
/*
    behavior_TOUCH_ELSE_DESKTOP = ("ontouchstart" in document.documentElement);
*/
    /*}}}*/
    /* f(navigatore.platform) {{{*/
/*
    let platform = navigator.platform.toLowerCase();
    behavior_TOUCH_ELSE_DESKTOP
        =  !platform.startsWith("hp"   )
        && !platform.startsWith("mac"  )
        && !platform.startsWith("sunos")
        && !platform.startsWith("win"  )
    ;
*/
    /*}}}*/
    /* f(resolution dpi) {{{*/
/*{{{
    behavior_TOUCH_ELSE_DESKTOP = window.matchMedia("only screen and (min-resolution : 128dpi)").matches;
logXXX("behavior_TOUCH_ELSE_DESKTOP=["+behavior_TOUCH_ELSE_DESKTOP+"]");
}}}*/
    /*}}}*/
    /* f(navigator.appVersion) {{{*/
    let appVersion = navigator.appVersion.toLowerCase();
    behavior_TOUCH_ELSE_DESKTOP
        =  !appVersion.includes("windows")
        && !appVersion.includes("hp"     )
        && !appVersion.includes("mac"    )
        && !appVersion.includes("sunos"  )
    ;
/*{{{
logXXX("behavior_TOUCH_ELSE_DESKTOP=["+behavior_TOUCH_ELSE_DESKTOP+"]");
}}}*/
    /*}}}*/
    let behavior_em
        = behavior_TOUCH_ELSE_DESKTOP
        ? "<em class='cc7 big'> MOBILE  TOUCH BEHAVIOR </em>"
        : "<em class='cc8 big'> DESKTOP MOUSE BEHAVIOR </em>"
    ;
    /*}}}*/
    /* LOG EVENTS {{{*/
    let e_yes = "<em class='cc5'>IS DEFINED</em>";
    let e_no  = "<em class='cc8'>IS NOT DEFINED</em>";

    let event_info
        = "<em>EVENTS</em>"+LF
        +"<ul>"+LF
        + "<li>ontouchstart "+ ((typeof document.documentElement.ontouchstart != "undefined") ? e_yes : e_no)+"</li>"+LF
        + "<li>s_log        "+ ((typeof s_log                                 != "undefined") ? e_yes : e_no)+"</li>"+LF
        + "<li>  log        "+ ((typeof   log                                 != "undefined") ? e_yes : e_no)+"</li>"+LF
        + "</ul>"
    ;

    /*}}}*/
    /* LOG SCREEN {{{*/
    let s_yes = "<em class='cc5'>YES</em>";
    let s_no  = "<em class='cc8'>NO</em>";

    let screen_info
        = "<em>MEDIA</em>"+LF
        +"<ul>"+LF
    ;
    let  q;
    q = "(orientation: landscape)"                 ; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "(orientation:  portrait)"                 ; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution :  20dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution :  80dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution :  90dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (max-resolution :  96dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 100dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 120dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 150dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 200dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 240dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 300dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    q = "only screen and (min-resolution : 640dpi)"; screen_info += "<li>"+ q + (window.matchMedia(q).matches ? s_yes : s_no)+"</li>"+LF;
    screen_info
        += "</ul>"
    ;

    /*}}}*/
    /* LOG NAVIGATOR {{{*/
    let navigator_info
        = "<em>NAVIGATOR</em>"+LF
        + "<ul>"+LF
        +  "<li>Browser CodeName.....: <em>"+ navigator.appCodeName   +"</em></li>"+LF
        +  "<li>Browser Name.........: <em>"+ navigator.appName       +"</em></li>"+LF
        +  "<li>Browser Version......: <em>"+ navigator.appVersion    +"</em></li>"+LF
        +  "<li>Cookies Enabled......: <em>"+ navigator.cookieEnabled +"</em></li>"+LF
        +  "<li>Browser Language.....: <em>"+ navigator.language      +"</em></li>"+LF
        +  "<li>Browser Online.......: <em>"+ navigator.onLine        +"</em></li>"+LF
        +  "<li>Platform.............: <em>"+ navigator.platform      +"</em></li>"+LF
        +  "<li>User-agent header....: <em>"+ navigator.userAgent     +"</em></li>"+LF
        + "</ul>"
    ;
    /*}}}*/
    /* LOG BEHAVIOR .. f(activated doc playground or tool transcript) {{{*/
    if(    t_doc_div_clear("doc_log_div")
        || t_is_a_selected_panel(transcript2)
    )
        t_log_transcript_info(
            "<em class='cc8'>"+DOM_TOOLS_JS_TAG+"</em> "+ behavior_em
            +"<pre>"
            + event_info+LF
            + screen_info+LF
            + navigator_info
            +"</pre>"
        );

    /*}}}*/
};
/*}}}*/
/*  t10_load */
/*  t10_load */
/*  t10_load */
/*  t10_load_IPC_and_LISTENERS {{{*/
let t10_load_IPC_and_LISTENERS = function()
{
/*{{{*/
let   caller = "t10_load_IPC_and_LISTENERS";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SDA+"%c "+caller, lbS+lf9, lbH+lf9);
/*}}}*/
    /* [TOOLS NOT LOADED] .. f(CSP) .. [SEND IPC TOOLS NOT LOADED] {{{*/
    /* Content Security Poplicy (CSP) MAY HAVE "Refused to load the stylesheet" */
    let script_loaded;
    if((typeof DOM_TOOLS_CSS_TAG == "undefined") || !DOM_TOOLS_CSS_TAG)
    {
if(log_this) console.log("%c DOM_TOOLS_CSS_TAG=["+DOM_TOOLS_CSS_TAG+"] .. %c TOOLS INLINING REJECTED", lb7, lb2);

        /* hide all optional tools */
        let el;
        for(let i=1; i < TOOL_panels.length; ++i)
            if(el =      TOOL_panels[i]) el.style.display = "none";
        /* ipc seeker_PD seeker_PU {{{*/
        if(    el = pivspot            ) el.style.display = "none";
        if(    el = seeker_PD          ) el.style.display = "none";
        if(    el = seeker_PU          ) el.style.display = "none";

/*{{{
        if(    el = dom_grid_css_tag   ) el.style.display = "none";
        if(    el = dom_host_css_tag   ) el.style.display = "none";
        if(    el = dom_tools_css_tag  ) el.style.display = "none";
        if(    el = dom_tools_html_tag ) el.style.display = "none";
}}}*/
        /*}}}*/
        let ipc      = {  t_load : TOOLS3_NEED_RELAXED_CSP
            ,             caller : DOM_TOOLS_JS_TAG
            ,            details : caller
        };
        t_send_IPC( ipc );

        script_loaded = false;
    }
    /*}}}*/
    /* [TOOLS LOADED] ... ADD EVENT LISTENERS {{{*/
    else {
if(LOG_MAP.EV0_LISTEN || logging_EVENTS) log(caller+": ADDING EVENT LISTENERS");

        t_add_LISTENERS();

        script_loaded = true;
    }
    /*}}}*/
if( log_this) log("..."+caller+": return script_loaded=["+script_loaded+"]");
    return script_loaded;
};
/*}}}*/
/*  t11_load */
/*  t11_load */
/*  t11_load */
/*_ t11_load_POST {{{*/
let t11_load_POST = function()
{
/*{{{*/
let   caller = "t11_load_POST";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SDB+"%c "+caller, lbS+lf1, lbH+lf1);
/*}}}*/
    /* SCRIPT INJECTION WAS PREVENTED BY CSP .. TELL BROWSER EXTENSION {{{*/
    /* Content Security Policy .. (needs header.csp amending) */
    if((typeof DOM_TOOLS_CSS_TAG == "undefined") || !DOM_TOOLS_CSS_TAG)
    {
        log("%c *** "+caller+": %c TOOLS CSS NOT LOADED ", lb2, lbF);
        /*if(extension_signature) {*/
            let ipc = {  t_load : TOOLS3_NEED_RELAXED_CSP
                ,        caller : DOM_TOOLS_JS_TAG
                ,       details : caller
            };
            t_send_IPC( ipc );
        /*}*/
    }
    /*}}}*/
    /* SENDING TOOLS SIGNATURE .. (to browser extension) {{{*/
    else {
        let message = document.body.attributes[IPC_EXTENSION_ID]
            ?         document.body.attributes[IPC_EXTENSION_ID].textContent : "";
        if( message) {
            let ipc = t_get_IPC( message );
/*
            if(LOG_IPC) log(caller+": LOCKING ON LAST MESSAGE sequence_number: =["+ipc.sequence_number+"]");
            if(ipc.sequence_number) t_get_IPC_sequence_number = ipc.sequence_number;
*/
        }
        let ipc
            = { t_load : TOOLS4_DEPLOYED
            ,   caller : DOM_TOOLS_JS_TAG+"."+caller
        };
        t_send_IPC( ipc );

    }
    /*}}}*/
    /* IPC .. (MutationObserver) {{{*/
    if(!t_ipc_listener_id) {
        t_ipc_add_MutationObserver(DOM_TOOLS_JS_ID);

      /*t_ipc_add_message_listener(DOM_TOOLS_JS_ID);*/
    }
    /*}}}*/
    /* UI .. (init event parameters state) {{{*/
    t_clr_has_moved(caller+": CLEARING ONLOAD SCROLL");

    t_sync_styles(caller);
    t_SITE_OR_PAGE_changed();

    if(typeof sync_containers_hi != "undefined") sync_containers_hi();
    /*}}}*/
    /* TOOLS .. (display tools) {{{*/
    if(dom_tools_html) dom_tools_html.style.visibility = "visible";

    t_sync_layout(caller, 0); /* short call */
    /*}}}*/
    /* PROP AND DOC TOOLS {{{*/
    setTimeout(t_display_delayed_divs_shadow_root,   500); /* .. (dom_grid_playground) */
    setTimeout(t_display_delayed_divs_document   ,  1000);
    /*}}}*/
    t_sync_wording(caller);
};
/*}}}*/



/*_ t_TOOL_SET_select {{{*/
let t_TOOL_SET_select = function()
{
/*{{{*/
let   caller = "t_TOOL_SET_select";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);
/*}}}*/
    /* WORDING PANELS {{{*/
if( log_this) log("...pat_bag=["+get_n_lbl(pat_bag)+"]");
if( log_this) log("...TOOL_panels.includes(pat_bag)=["+TOOL_panels.includes(pat_bag)+"]");
    if(pat_bag && !off_bag) t_build_bag_tools();

    /*}}}*/
    /* FLOATLOG PRELOAD {{{*/
    t_log_set_state( LOG_MAP.EV8_FLOATLOG );

    set_el_class_on_off(fly_log, CSS_CHECKED, LOG_MAP.EV8_FLOATLOG  );
    /*}}}*/
    /* default to selecting first panel {{{*/
    let some_panel_selected = false;
    for(let i=0; i < TOOL_SET.length; ++i)
    {
        let panel = get_tool( TOOL_SET[i].panel_id );
        if( panel ) {
            let map = tools_map_get(panel);
            if( map && map.selected) {
                some_panel_selected = true;
                break;
            }
        }
    }
    /*}}}*/
/*{{{
if( log_this) logBIG("...some_panel_selected=["+some_panel_selected+"]");
}}}*/
    /* [pivot_PANEL] .. f(UNSELECTED or PINNED) {{{*/
    if(!some_panel_selected || has_el_class(pivot_PANEL, CSS_PINNED))
    {
        t_set_pivot_PANEL(null);
    }
    /* [pivot_PANEL] .. f(FIRST SELECTED DOM_LOAD_ID TOOL_SET) */
    if(!pivot_PANEL && some_panel_selected)
    {
        let dom_load_id = (typeof DOM_LOAD_ID != "undefined") ? DOM_LOAD_ID : "default";
        for(let i=0; i < TOOL_SET.length; ++i)
        {
            if(    (dom_load_id ==          TOOL_SET[i].dom_load_id)
                && (       panel = get_tool(TOOL_SET[i].panel_id)  )
                && (         map = tools_map_get(panel)            )
                && (         map.selected                          )
                && !has_el_class(panel, CSS_PINNED)
              ) {
                t_set_pivot_PANEL( panel );
                break;
            }
        }
    }

    t_get_selected_count( caller );
    /*}}}*/
    t_cache_init_by(caller);
};
/*}}}*/
/*_ t_TOOL_SET_set_class_state {{{*/
let t_TOOL_SET_set_class_state = function(className, state)
{
/*{{{*/
let   caller = "t_TOOL_SET_set_class_state("+className+", "+state+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    let i, el;
    for(i = 0; i < TOOL_SET.length; ++i)
    {
        if(el = get_tool( TOOL_SET[i].panel_id ))
            set_el_class_on_off(el, className, state);
    }
};
    /*}}}*/
/*_ t_TOOL_SET_eval_wide_or_tall_panel {{{*/
let t_TOOL_SET_eval_wide_or_tall_panel = function()
{
    for(let i=0; i < TOOL_SET.length; ++i)
    {
        let panel = get_tool( TOOL_SET[i].panel_id );
        if( panel ) {
            let map = tools_map_get(panel);
            if( map && map.selected) {
                t_eval_wide_or_tall_panel( panel );
            }
        }
    }
};
/*}}}*/

/*_ DELAYED TOOLS {{{*/
/*{{{*/
const CSS_DISPLAY_DELAYED = "display_delayed";

/*}}}*/
let t_display_delayed_divs_shadow_root = function() { t_display_delayed_divs_handler(shadow_root  ); };
let t_display_delayed_divs_document    = function() { t_display_delayed_divs_handler(document.body); };
let t_display_delayed_divs_handler     = function(container)
{
    let caller = "t_display_delayed_divs_handler";
let log_this = LOG_MAP.EV7_DISPATCH;

if(log_this) log("%c"+caller+"%c"+get_n_lbl(container),lbL+lf1,lbR+lf3);

    for(let i=0; i < container.childNodes.length; ++i)
    {
        let child = container.childNodes[i];

        if( child.classList && child.classList.contains( CSS_DISPLAY_DELAYED ) )
        {
if(log_this) log(".%c"+ get_n_lbl(child)+" ", lbH+lf3);
            child.classList.remove  ( CSS_DISPLAY_DELAYED );
        }

        for(let j=0; j < child.childNodes.length; ++j)
        {
            let el = child.childNodes[j];

            if(el.classList && el.classList.contains( CSS_DISPLAY_DELAYED ) )
            {
if(log_this) log("..%c"+ get_n_lbl(el)+" ", lbH+lf4);
                el.classList.remove  ( CSS_DISPLAY_DELAYED );
            }
        }
    }

};
/*}}}*/

/*}}}*/
/* _TOOL NODE {{{*/
/*{{{*/
let behavior_TOUCH_ELSE_DESKTOP;

let shadow_root;

let dom_grid_html; /* PLAYGROUND */

let hotspot;
let  hotring;
let  hotwave;
let pivspot;

let pat_bag;
let sel_bag;
let headsup;
let headsup_bw;
let headsup_bz;
let headsup_ds;
let headsup_f;
let headsup_w;

let dom_traversal;
let   pivspot_c;
let   hotspot_c;

let toolbar_thumb;
let tools_filter_input;
let recycle_button;
let tools_node_input;

let test_panel;

let transcript1;
let transcript2;
let  log_tr1;
let  log_tr2;

/*}}}*/
/*_ [TOOLS_MAP] CLASS {{{*/
let  TOOLS_MAP = function(panel, selected)
{
    /*this.init {{{*/
    this.init = function(panel, selected) {
        this.panel    =    panel;
        this.selected = selected;
        this.p        =       ""; /* position */
        this.x        =        0;
        this.y        =        0;
        this.w        =        0;
        this.h        =        0;
    };
    /*}}}*/
    /* this.log {{{*/
    this.log = function() {

        let   pinned =  this.panel.classList.contains(CSS_PINNED);

        let      lfx =  pinned                       ? lf2
            :           this.selected                ? lf4
            :                                          lf8;

        let      sym = !this.selected                ? SYMBOL_CLOSEPIN
            :           pinned                       ? SYMBOL_PUSH_PIN
            :                                          SYMBOL_CHECK_MARK;

        let      arr = " "+SYMBOL_RIGHT_LEFT_ARROW+" ";
        log( " %c "+sym+" " + this.panel.id
            +  " %c   POS=["+ this.p                + arr + this.panel.style.position                                +"]"
            +   " %c  X_Y=["+ this.x +" x "+ this.y + arr + this.panel.offsetLeft   +" x "+ this.panel.offsetTop     +"]"
            +    " %c W_H=["+ this.w +" x "+ this.h + arr + this.panel.offsetWidth  +" x "+ this.panel.offsetHeight  +"]"
            ,  lbH+lfx
            ,    lbH+lf5
            ,     lbH+lf6
            ,      lbH+lf7
           );
    };
    /*}}}*/
    this.init(panel, selected); /* construction-time-init */
};
/*_ [tools_map] ARRAY .. set get {{{*/

let tools_map = [];

let tools_map_set = function(map)
{
    tools_map.push( map );
};

let tools_map_get = function(panel)
{
    for(let i=0; i< tools_map.length; ++i) {
        if(panel == tools_map[i].panel) {
            return  tools_map[i];
        }
    }
    return null;
};
/*}}}*/
/*}}}*/
/*_ t_load_TOOLS_MAP {{{*/
/*{{{*/
let t_tools_loaded = false;
/*}}}*/
let t_load_TOOLS_MAP = function(_caller)
{
    /* TOOLS INLINING HAS BEEN REJECTED {{{*/
let   caller = "t_load_TOOLS_MAP("+_caller+")";
let log_this = LOG_MAP.T2_GRID || LOG_MAP.T1_DOM_LOAD;

if( log_this) logBIG(caller+": CALLED BY ["+ _caller+"]");

    if((typeof DOM_TOOLS_CSS_TAG == "undefined") || !DOM_TOOLS_CSS_TAG) {
log("%c *** "+caller+": TOOLS INLINING HAS BEEN REJECTED", lb2);

        return;
    }
    /*}}}*/
    /* ALREADY LOADED {{{*/
    if( t_tools_loaded ) {
/*{{{
        log("%c *** "+caller+": [tools_map] ALREADY LOADED ", lb2);
}}}*/
        return;
    }
     /*}}}*/
    /* [shadow_root] {{{*/
    if(!shadow_root) shadow_root = document.getElementById("shadow_root");

    if(shadow_root) {
if(log_this) log("shadow_root:");
if(log_this) console_dir( shadow_root );
    }
     /*}}}*/
    /* [t_tools_loaded] {{{*/
    t_tools_loaded = (typeof get_tool != "undefined");
if(log_this) log("...t_tools_loaded=["+t_tools_loaded+"]");

    /*}}}*/
    /*  dom_grid_is_loaded {{{*/
    let dom_grid_is_loaded = is_dom_grid_loaded();
    if(!dom_grid_is_loaded )
        log_dom_grid_js_not_loaded(caller+"("+ _caller+")");

    /*}}}*/
    /* SELECT [tools_map] .. (t1_load_SHADOW's PRELOADED HIDDEN TOOLS) {{{*/
let dom_load_id = (typeof DOM_LOAD_ID != "undefined") ? DOM_LOAD_ID : "default";
if(log_this) log("SELECTING TOOLS FOR DOM_LOAD_ID=["+dom_load_id+"] .. ("+TOOL_panels.length+" TOOL panels)");

    let selected_count = 0;
    let selected;
    if(t_tools_loaded) {
        for(let i=0; i < TOOL_panels.length; ++i)
        {
            let        panel = TOOL_panels[i];
            if(       !panel ) {
                log("%c *** "+caller+": panel #"+i+" IS MISSING ", lb2);
                continue;
            }

            if( is_a_DOM_LOAD_panel(panel.id) )
            {
/*{{{
                selected       = store_getBool(panel.id+".selected");
}}}*/
                let panel_json = store_getItem(panel.id+"_JSON");
                if( panel_json ) {
                    let value = JSON.parse( panel_json );
                    selected = value.selected;
                }
                else {
                    selected = false;
                }

                tools_map_set(new TOOLS_MAP(panel, selected));

                if(panel != hotspot)
                    t_add_toolpins_on_panel(panel);

                set_el_class_on_off(panel,CSS_HIDDEN, !selected);

                selected_count += selected ? 1 : 0;

if(log_this && selected) tools_map_get(panel).log(caller+":");
            }
        }
    }
    /*}}}*/
    /* SHOW [hotspot] {{{*/
    del_el_class(hotspot, CSS_HIDDEN);

    /*}}}*/
if(log_this) log("tools_map.length=["+tools_map.length+"] selected_count=["+selected_count+"]");
};
/*}}}*/
/*_ t_get_selected_count {{{*/
let t_get_selected_count = function(_caller)
{
/*{{{*/
let log_this = LOG_MAP.T2_GRID;

if( log_this) log("t_get_selected_count: CALLED BY ["+ _caller+"]");
/*}}}*/
    let selected_count = 0;
    for(let i=0; i< TOOL_panels.length; ++i) {
        let panel = TOOL_panels[i];
        if(!panel ) {
            log("%c *** t_get_selected_count: panel #"+i+" IS MISSING ", lb2);
            continue;
        }
        let         key = panel.id+".selected";
        let    selected = store_getBool(key) ? true : false;
/*
if(log_this) log("... t_get_selected_count: ...store_getItem(key=["+key+"]): ...selected=["+selected+"]");
*/
        selected_count += selected ? 1 : 0;
    }

if(log_this) log("t_get_selected_count: ...return "+selected_count);
    return selected_count;
};
/*}}}*/
/*_ t_tools_panel_select {{{*/
let t_tools_panel_select = function(panel, state=true)
{
/*{{{*/
let caller = "t_tools_panel_select("+get_n_lbl(panel)+", "+state+")";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);
/*}}}*/
    let map = tools_map_get( panel );
    if(!map) return;
    if( map.selected != state)
    {
if(log_this) log("..."+(state ? "SHOWING" : "HIDING")+" "+get_n_lbl(panel));

        t_grid_TOOLS_SELECT_panel(panel, state);

        set_el_class_on_off(panel,CSS_HIDDEN, !map.selected);

        t_sync_layout(caller);
    }
};
/*}}}*/
/*_ t_set_tool_id_value {{{*/
let t_set_tool_id_value = function(id, value)
{
    let el = get_tool(id);
    if( el ) el.value     = value;
    if( el ) el.value_set = value;
};
/*}}}*/
/*_ t_get_tool_id_value {{{*/
let t_get_tool_id_value = function(id)
{
    let el = get_tool(id);
    if( el ) return el.value;
    else     return       "";
};
/*}}}*/
/*_ get_bag_id {{{*/
let get_bag_id = function(el)
{
    for(let node  = el
        ;   node != null
        ;   node  = node.parentNode
       ) {
        switch(node.id)
        {
        case "pat_bag" :
        case "sel_bag" :

        case "seeker_PU" :
        case "seeker_PD" :
        case "seekzone"  :

        case "headsup"    :
        case "headsup_w"  :
        case "headsup_ds" :
        case "headsup_bw" :
        case "headsup_bz" :

        case "test_panel"    :
        case "dev_log_map"   :
        case "dom_load_tags" :
        case "dom_traversal" :

        case "transcript1" :
        case "transcript2" :

        case "fly_div" :

/*{{{
logXXX("...el=["+get_n_lbl(el)+"] .. bag_id=["+node.id+"]");
}}}*/
        return node.id;
        }
    }
    if( is_el_child_of_class(el, "prop_bag") ) {
/*{{{
logXXX("...el=["+get_n_lbl(el)+"] .. is_el_child_of_class(el, 'prop_bag')");
}}}*/
        return "prop_bag";
    }
    else {
        return "";
    }
};
/*}}}*/
/*_ get_tool {{{*/
let get_tool = function(id)
{
let caller = "get_tool("+id+")";

    if( id.includes(" ") ) return null;
    let selector
        = (id.charAt(0) != '.') && (id.charAt(0) != '#')
        ?  "#"+id
        :      id
    ;
    let el;

    if(shadow_root) el = shadow_root.querySelector(selector);
    else            el = document   .querySelector(selector);

/*{{{
logXXX(caller+": ...return ["+get_n_lbl(el)+"]");
}}}*/
    return el;
};
/*}}}*/

/*_ t_update_TOOLS_MAP_GEOMETRY {{{*/
/*{{{*/
const T_UPDATE_TOOLS_MAP_GEOMETRY_DELAY = 1000;
let   t_update_TOOLS_MAP_GEOMETRY_timer;

/*}}}*/
let   t_update_TOOLS_MAP_GEOMETRY = function(_caller, delay=T_UPDATE_TOOLS_MAP_GEOMETRY_DELAY)
{
/*{{{*/
let   caller ="t_update_TOOLS_MAP_GEOMETRY()";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller+"("+ _caller+", delay=["+delay+"])");
/*}}}*/
    if(       t_update_TOOLS_MAP_GEOMETRY_timer ) clearTimeout( t_update_TOOLS_MAP_GEOMETRY_timer );
              t_update_TOOLS_MAP_GEOMETRY_timer = null;

    if(delay) t_update_TOOLS_MAP_GEOMETRY_timer =   setTimeout( t_update_TOOLS_MAP_GEOMETRY_handler, delay);
    else                                                        t_update_TOOLS_MAP_GEOMETRY_handler(); /* sync call */
};
/*}}}*/
/*_ t_update_TOOLS_MAP_GEOMETRY_handler {{{*/
let t_update_TOOLS_MAP_GEOMETRY_handler = function()
{
/*{{{*/
let   caller ="t_update_TOOLS_MAP_GEOMETRY_handler";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);
/*{{{
if( log_this) console.trace();
if( log_this) console_clear(caller);
}}}*/
/*}}}*/
    t_update_TOOLS_MAP_GEOMETRY_timer = null;

/*{{{
    if( call_t_grid_IS_SIZED(caller) ) {
        t_cache_init_by(caller+": TOOLS WERE ON-GRID AT LAST CALL");
        return;
    }
}}}*/
    if(!t_tools_loaded) t_load_TOOLS_MAP(caller);

    let panelNum = 0;
    for(let i=0; i< tools_map.length; ++i)
    {
        let   map = tools_map[i];
        let panel =       map.panel;
/*{{{
logXXX(get_n_lbl(panel)+".position=["+ panel.style.position +"]");
}}}*/
        if(!map.selected                   ) continue;
        if( has_el_class(panel, CSS_HIDDEN)) continue;

/*{{{
let cs = getComputedStyle(panel)
console.dir(cs)
logXXX("cs.width=["+cs.width+"]");
logXXX("cs.height=["+cs.height+"]");
logXXX("position=["+panel.style.position+"]");
}}}*/
        if(!panel.style.position) {
            panel.style.position = prop_get( TOOLS_SCROLL ) ? "absolute" : "fixed";
/*{{{
logBIG("SETTING position=["+panel.style.position+"]")
}}}*/
        }

        map.p   = panel.style.position;
        map.x   = panel.offsetLeft;
        map.y   = panel.offsetTop;
        map.w   = panel.offsetWidth;
        map.h   = panel.offsetHeight;

/*{{{
logXXX("%c"+caller+"%c "+panel.id+" %c "+map.x+" "+map.y, lbH, lbC+lf3, lbH+lf8);
}}}*/
if(log_this) map.log("...");
/*{{{
if(panel == pat_bag) log(caller+": ...pat_bag map.h=["+map.h+"] .. offsetHeight=["+panel.offsetHeight+"]");
}}}*/
        if( panel.classList.contains(CSS_PINNED) )
        {
            let xy = t_get_tool_XY_in_viewport(panel, map.x, map.y);
            if( xy.capped )
            {
                let zIndex = ++panelNum + ZINDEX_PINNED_PANEL_ZERO;
                t_pin_tool_at_XY(panel, xy.x, xy.y, "fixed", zIndex);
                t_store_update_post(caller);
/*{{{
t_log_panel_style_zIndex(panel, caller+" [xy.capped]");
}}}*/
            }
/*{{{
else logBIG(get_n_lbl(panel)+" not capped")
}}}*/
        }
    }
};
/*}}}*/
/*}}}*/
/* _TOOL CHANGE {{{*/
/*  t_SITE_OR_PAGE_changed {{{*/
/*{{{*/
const SITE_LOCALSTORAGE    = "site_localstorage";

/*}}}*/
let t_SITE_OR_PAGE_changed = function(id, site_or_page_mode) /* id=unused .. (callback glue) .. (function-name redundant) */
{
/* {{{*/
let   caller = "t_SITE_OR_PAGE_changed";
let log_this = LOG_MAP.T3_LAYOUT;

    site_or_page_mode = (typeof site_or_page_mode != "undefined") ? site_or_page_mode  : prop_get( SITE_OR_PAGE ); /* set of fetch */

if( log_this)
    log(  "%c"    + caller
         +"%c to "+ site_or_page_mode
         +"%c on "+ (behavior_TOUCH_ELSE_DESKTOP ? "MOBILE" : "DESKTOP")
         , lbL+lf3
         , lbR+lf4
         , lbH+lbb+ (   behavior_TOUCH_ELSE_DESKTOP ?      lf7 : lf9   )
       );

if(log_this || LOG_MAP.EV8_FLOATLOG || fly_log_checked)
    t_fly("<em class='cc3'>"+caller+"</em> to <em class='cc4'>"+site_or_page_mode+"</em> on <em class='cc9'>"+(behavior_TOUCH_ELSE_DESKTOP ? "MOBILE" : "DESKTOP")+"</em>");

if(typeof dom_prop_notify != "undefined") dom_prop_notify(caller);

/*}}}*/
    /* TODO unexpand combinations (EDIT_OR_STAGE * SITE_OR_PAGE) */
    /* NOT EDITING {{{*/
    let          lfw;
    let      context;
    let   transition;
    let  which_nodes;

    let in_page_mode = !site_or_page_mode;
    let       action =  prop_get(  MASK_OR_HIDE ) ? "MASKING" : "HIDING";
    let          lfa = (action == "MASKING"     ) ?       lf6 : lf2     ;

    if(!prop_get( EDIT_OR_STAGE ) )
    {
        context = "WHILE NOT EDITING";
        if( in_page_mode ) {
            transition  = "ENTERING PAGE MODE";
            which_nodes = "SITE AND PAGE NODES";     lfw = lf4;
            dom_hide2_store_reload("both");
            del_el_class(hotspot, SITE_LOCALSTORAGE);
        }
        else {
            transition  = "LEAVING PAGE MODE";
            which_nodes = "SITE ONLY NODES";         lfw = lf6;
            dom_hide2_store_reload("site");
            add_el_class(hotspot, SITE_LOCALSTORAGE);
        }
    }
    /*}}}*/
    /* WHILE EDITING {{{*/
    else {
        context = "WHILE EDITING";
        if( in_page_mode ) {
            transition  = "ENTERING PAGE MODE";
            which_nodes = "PAGE ONLY NODES";         lfw = lf5;
            dom_hide2_store_reload("page");
            del_el_class(hotspot, SITE_LOCALSTORAGE);
        }
        else {
            transition  = "LEAVING PAGE MODE";
            which_nodes = "SITE ONLY NODES";         lfw = lf6;
            dom_hide2_store_reload("site");
            add_el_class(hotspot, SITE_LOCALSTORAGE);
        }
    }
    /*}}}*/
    dom_hide_set_MASK_OR_HIDE();

    if(!t_cache_empty)
        t_store4_save_site_layout(caller);
/*{{{*/
if( log_this)
    log("%c"+transition+"%c"+context+"%c"+action +"%c"+which_nodes
        ,lbb+lbL        ,lbb+lbR     ,lbb+lbL+lfa ,lbb+lbR+lfw    );

/*}}}*/
};
/*}}}*/
/*  t_DOM_HIDE1_RESET_changed {{{*/
let t_DOM_HIDE1_RESET_changed = function(id, value)
{
/*{{{*/
let   caller = "t_DOM_HIDE1_RESET_changed("+id+", "+value+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/
    dom_hide1_reset();

    /* transient state fallback .. not a checkbox */
    setTimeout(function() { del_el_class(prop_get_EL(id), CSS_CHECKED); }, 1000);

};
/*}}}*/
/*  t_EDIT_OR_STAGE_changed {{{*/
let t_EDIT_OR_STAGE_changed = function(id, value)
{
/*{{{*/
let   caller = "t_EDIT_OR_STAGE_changed("+id+", "+value+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/
    if( value ) t_dom_edit_or_stage_start(id, value);
    else        t_dom_edit_or_stage_end  (id, value);

};
/*}}}*/
/*_ t_dom_edit_or_stage_start {{{*/
let t_dom_edit_or_stage_start = function ()
{
/* {{{*/
let   caller = "t_dom_edit_or_stage_start"; if(typeof dom_prop_notify != "undefined") dom_prop_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/
    t_gutter_drag_hotspot_IN(t_hotspot_last_GUTTER_XY.x, t_hotspot_last_GUTTER_XY.y);
    t_gutter_drag_hotspot_to_LAST_GUTTER_XY();
    add_el_class(hotspot  , DOM_EDITING);

    del_el_class(hotspot_c, CSS_ROTATE_NE);
    del_el_class(hotspot_c, CSS_ROTATE_SE);
    del_el_class(hotspot_c, CSS_ROTATE_SW);
    del_el_class(hotspot_c, CSS_ROTATE_NW);

    /* START IN PAGE MODE .. (skipping onchange) */
    dom_hide2_store_reload("page");

    /* ENTER EDIT MODE .. (skipping onchange) */
    prop_set(MASK_OR_HIDE,  true);
    dom_hide_set_MASK_OR_HIDE();

    /* ANCHOR FREEZE WHILE EDITING */
    t_sync_wording( caller );
};
/*}}}*/
/*_ t_dom_edit_or_stage_end {{{*/
let t_dom_edit_or_stage_end = function ()
{
/* {{{*/
let   caller = "t_dom_edit_or_stage_end"; if(typeof dom_prop_notify != "undefined") dom_prop_notify(caller);
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/

    t_gutter_drag_hotspot_OUT(t_hotspot_last_WINDOW_XY.x, t_hotspot_last_WINDOW_XY.y, caller);
    t_gutter_drag_hotspot_to_LAST_WINDOW_XY();

    t_seekzone4_hide("instant");

    /* BACK TO HIDING PAGE HIDDEN NODES */
    prop_set(MASK_OR_HIDE, false);
    prop_set(SITE_OR_PAGE, false);

    /* RELOAD PAGE HIDDEN NODES */
    dom_hide2_store_reload   ("both");
    dom_hide_set_MASK_OR_HIDE( true);

    /* ANCHOR UNFREEZE AFTER EDITING */
    t_sync_wording( caller );
};
/*}}}*/
/*  t_MASK_OR_HIDE_changed {{{*/
let t_MASK_OR_HIDE_changed = function(id, value)
{
/*{{{*/
let   caller = "t_MASK_OR_HIDE_changed("+id+", "+value+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/

    /* [node_to_hide] toggle */
    dom_hide_set_MASK_OR_HIDE();

    /* tools toggle */
    if( prop_get( MASK_OR_HIDE ) )
    {
        del_el_class(hotspot , MARKED_TO_HIDE);
        del_el_class(seekzone, MARKED_TO_HIDE);
    }
    else {
        add_el_class(hotspot , MARKED_TO_HIDE);
        add_el_class(seekzone, MARKED_TO_HIDE);
    }
    t_SITE_OR_PAGE_changed();
};
/*}}}*/
/*  t_words_option_select_key {{{*/
let t_words_option_initialize = function() { t_words_option_select_key("INIT"); };
let t_words_option_select_key = function(key)
{
/*{{{*/
let   caller = "t_words_option_select_key("+key+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/
    switch(key)
    {
    case WORDS_EXACT    :
    prop_init(WORDS_SEGMENT  , false);
    prop_init(WORDS_HEAD_TAIL, false);
    break;

    case WORDS_SEGMENT  :
    prop_init(WORDS_EXACT    , false);
    prop_init(WORDS_HEAD_TAIL, false);
    break;

    default             :
    prop_init(WORDS_HEAD_TAIL,  true);
    /* ...then fall through: */
    case WORDS_HEAD_TAIL:
    prop_init(WORDS_EXACT    , false);
    prop_init(WORDS_SEGMENT  , false);
    break;
    }
};
/*}}}*/
/*_ t_SHOW_SEEKZONE_changed {{{*/
let t_SHOW_SEEKZONE_changed = function(id, value)
{
/*{{{*/
let   caller = "t_SHOW_SEEKZONE_changed("+id+", "+value+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf5);
/*}}}*/
      if(!prop_get(id) ) t_seekzone4_hide("instant");
};
/*}}}*/
/*}}}*/
/* _TOOL STORE {{{*/
/* TODO GENERALIZE THE HANDLING OF [UNDECIDED NUMBER OF MULTIPLE-ITEMS-PROPERTY (e.g. words suffix) ] */
/* WORDS SUFFIX OPTIONS {{{*/
const WORDS_SUFFIXES          = ["s"     , "ing"  ];
const WORDS_SUFFIXE_MIN_LEN   = { s:3    ,  ing:6 }; /* needs at least this number of chars to still make sense */
const WORDS_MUST_NOT_END_WITH = { s:"ss"          }; /* this word ending in is not likely a suffix */

/*_ t_get_words_drop_affix_array {{{*/
let       words_drop_affix_array;
let t_get_words_drop_affix_array = function()
{
    if(!words_drop_affix_array)
    {
        words_drop_affix_array = [];
        for(let i=0; i < WORDS_SUFFIXES.length; ++i)
            words_drop_affix_array.push("words_drop_"+WORDS_SUFFIXES[i]);
    }

    return words_drop_affix_array;
};
/*}}}*/
/*}}}*/
/* TOOL_KEY_PAGE_SITE_TRANSIENT {{{*/
const TOOL_KEY_PAGE_SITE_TRANSIENT = [
    /* LOG_MAP ENTRIES {{{*/
    {   key : "EV0_LISTEN"         , page : false , site : false , transient :  true }
    , { key : "EV1_DOWN"           , page : false , site : false , transient : false }
    , { key : "EV2_MOVE"           , page : false , site : false , transient : false }
    , { key : "EV3_UP"             , page : false , site : false , transient : false }
    , { key : "EV4_LONG_PRESS"     , page : false , site : false , transient : false }
    , { key : "EV5_TOOL_CB"        , page : false , site : false , transient : false }
    , { key : "EV6_CHANGED"        , page : false , site : false , transient : false }
    , { key : "EV7_DISPATCH"       , page : false , site : false , transient : false }
    , { key : "EV8_FLOATLOG"       , page : false , site : false , transient : false }
    , { key : "S1_RANGE"           , page : false , site : false , transient : false }
    , { key : "S2_SELECT"          , page : false , site : false , transient : false }
    , { key : "S3_SLOT"            , page : false , site : false , transient : false }
    , { key : "T0_STORE"           , page : false , site : false , transient : false }
    , { key : "T1_DOM_LOAD"        , page : false , site : false , transient : false }
    , { key : "T2_GRID"            , page : false , site : false , transient : false }
    , { key : "T3_LAYOUT"          , page : false , site : false , transient : false }
    , { key : "T4_PIVOT"           , page : false , site : false , transient : false }
    , { key : "T5_SPREAD"          , page : false , site : false , transient : false }
    , { key : "T6_SLOT"            , page : false , site : false , transient : false }

    , { key : "LOG_IPC"            , page : false , site : false , transient :  true }

    , { key : "logging_EVENTS"     , page : false , site : false , transient :  true }
    , { key : "logging_HIGHLIGHT"  , page : false , site : false , transient :  true }
    , { key : "logging_TOOLBAR"    , page : false , site : false , transient :  true }
    /*}}}*/
    /* TOOLS LAYOUT {{{*/
    , { key : "pivotXY"            , page : false , site : false , transient :  true }
    , { key : "pivot_PANEL"        , page : false , site : false , transient : false }
    , { key :  PIVOT_MAGNIFIED     , page : false , site : false , transient : false }

    , { key : "spread_ratio_x"     , page : false , site : false , transient :  true }
    , { key : "spread_ratio_y"     , page : false , site : false , transient :  true }
    , { key : "topTool_XY"         , page : false , site : false , transient :  true }
    , { key : "tools_scrollY"      , page :  true , site : false , transient : false }

    , { key : "transcript1_pinned" , page : false , site : false , transient : false }
    , { key : "transcript2_pinned" , page : false , site : false , transient : false }
    /*}}}*/
    /* USER PATTERNS CSV {{{*/
    , { key : "sel_csv"            , page :  true , site : false , transient : false }
    , { key : "pat_csv"            , page :  true , site : false , transient : false }
    , { key : "off_csv"            , page :  true , site : false , transient : false }
    , { key : "bak_csv"            , page :  true , site : false , transient : false }
    , { key : "alt_csv"            , page :  true , site : false , transient : false }

    , { key : "node_to_hide_csv"   , page :  true , site :  true , transient : false }
    /*}}}*/
];
/*}}}*/
/*  t_store0_set_settings {{{*/
let t_store0_set_settings = function()
{
/*{{{*/
let   caller = "t_store0_set_settings";
let log_this = LOG_MAP.T0_STORE;

if( log_this) log(caller);
/*}}}*/

    TOOL_KEY_PAGE_SITE_TRANSIENT.forEach(
        function(each) {
            if(  each.page     ) store_add_page_key           ( each.key );
            if(  each.site     ) store_add_site_key           ( each.key );
            if(  each.transient) store_do_not_log_transient_key( each.key );
        }
    );
};
/*}}}*/
/*  t_store0_log_settings {{{*/
let t_store0_log_settings = function()
{
log("%c STORAGE SETTINGS:", lbF+lb8);

    prop_log_MAP("t_store0_log_settings");

    dom_hide8_log();

    TOOL_KEY_PAGE_SITE_TRANSIENT.forEach(
        function(each) {
            let value = store_getItem(    each.key       );
            if( value ) store_key_log("", each.key, value);
        }
    );

    let id;

    id = "USERAGENT"         ; log("o %c "+id+": %c "+ USERAGENT +"] IN_WEBVIEW=["+ IN_WEBVIEW  +" ", lbF+lb1, lbA);
    id = "sel_csv"           ; log("o %c "+id+": %c "+ sel_csv                                  +" ", lbF+lb5, lbA);
    id = "pat_csv"           ; log("o %c "+id+": %c "+ pat_csv                                  +" ", lbF+lb5, lbA);
    id = "off_csv"           ; log("o %c "+id+": %c "+ off_csv                                  +" ", lbF+lb5, lbA);
    id = "bak_csv"           ; log("o %c "+id+": %c "+ bak_csv                                  +" ", lbF+lb5, lbA);
    id = "alt_csv"           ; log("o %c "+id+": %c "+ alt_csv                                  +" ", lbF+lb5, lbA);
    id = "pivot_PANEL"       ; log("o %c "+id+": %c "+ get_n_lbl(pivot_PANEL)                   +" ", lbF+lb8, lbA);
    id = "pivotXY"           ; log("o %c "+id+": %c "+ pivotXY.x+" "+pivotXY.y                  +" ", lbF+lb8, lbA);
    id = "topTool"           ; log("o %c "+id+": %c "+ topTool.x+" "+topTool.y                  +" ", lbF+lb8, lbA);
    id = "spread_ratio"      ; log("o %c "+id+": %c "+ spread_ratio.x +" "+ spread_ratio.y      +" ", lbF+lb8, lbA);

};
/*}}}*/
/*  t_store1_save_all_settings {{{*/
let t_store1_save_all_settings = function()
{
let   caller = "t_store1_save_all_settings";
let log_this = LOG_MAP.T0_STORE;

if( log_this) log(caller);

    /* NOTHING TO SAVE */
    if(!has_el_class(hotring, ALL_PAGE_ITEMS_REMOVED) )
    {
/*{{{
logBIG("NOTHING TO SAVE .. ALL_PAGE_ITEMS_REMOVED",lf9);
}}}*/
        return;
    }
    t_store2_save_site_theme   ();
    t_store3_save_site_logging ();
    t_store4_save_site_layout  ("SAVING ALL SETTINGS");
    t_store5_save_page_wording ();
};
/*}}}*/
/*_ t_store2_save_site_theme {{{*/
let t_store2_save_site_theme = function()
{
let   caller = "t_store2_save_site_theme";
let log_this = LOG_MAP.T0_STORE;
    /* TOOLS LAYOUT */
    let key, value;
if( log_this) log(caller);

    key = "tools_scrollY"      ; value = scroll_last_scrollY;       store_set_value(key, value);

    key = ANCHOR_FREEZE        ; value = prop_get( ANCHOR_FREEZE ); store_set_state(key, value);
    key =  CONTAINERS_HI       ; value = prop_get( CONTAINERS_HI ); store_set_state(key, value);
    key =  THEME_DARK          ; value = prop_get( THEME_DARK    ); store_set_state(key, value);
    key =  TOOLS_TRAP          ; value = prop_get( TOOLS_TRAP    ); store_set_state(key, value);
    key =  TOOLS_EXTRAS        ; value = prop_get( TOOLS_EXTRAS  ); store_set_state(key, value);

};
/*}}}*/
/*_ t_store3_save_site_logging {{{*/
let t_store3_save_site_logging = function()
{
let   caller = "store_per_site_logging";
let log_this = LOG_MAP.T0_STORE;
    /* LOGGING */
    let key, value;
if( log_this) log(caller);

    key = "tools_scrollY"      ; value = scroll_last_scrollY   ; store_set_value(key, value);
    key = "EV0_LISTEN"         ; value = LOG_MAP.EV0_LISTEN    ; store_set_state(key, value);
    key = "EV1_DOWN"           ; value = LOG_MAP.EV1_DOWN      ; store_set_state(key, value);
    key = "EV2_MOVE"           ; value = LOG_MAP.EV2_MOVE      ; store_set_state(key, value);
    key = "EV3_UP"             ; value = LOG_MAP.EV3_UP        ; store_set_state(key, value);
    key = "EV4_LONG_PRESS"     ; value = LOG_MAP.EV4_LONG_PRESS; store_set_state(key, value);
    key = "EV5_TOOL_CB"        ; value = LOG_MAP.EV5_TOOL_CB   ; store_set_state(key, value);
    key = "EV6_CHANGED"        ; value = LOG_MAP.EV6_CHANGED   ; store_set_state(key, value);
    key = "EV7_DISPATCH"       ; value = LOG_MAP.EV7_DISPATCH  ; store_set_state(key, value);
    key = "EV8_FLOATLOG"       ; value = LOG_MAP.EV8_FLOATLOG  ; store_set_state(key, value);
    key = "S1_RANGE"           ; value = LOG_MAP.S1_RANGE      ; store_set_state(key, value);
    key = "S2_SELECT"          ; value = LOG_MAP.S2_SELECT     ; store_set_state(key, value);
    key = "S3_SLOT"            ; value = LOG_MAP.S3_SLOT       ; store_set_state(key, value);
    key = "T0_STORE"           ; value = LOG_MAP.T0_STORE      ; store_set_state(key, value);
    key = "T1_DOM_LOAD"        ; value = LOG_MAP.T1_DOM_LOAD   ; store_set_state(key, value);
    key = "T2_GRID"            ; value = LOG_MAP.T2_GRID       ; store_set_state(key, value);
    key = "T3_LAYOUT"          ; value = LOG_MAP.T3_LAYOUT     ; store_set_state(key, value);
    key = "T4_PIVOT"           ; value = LOG_MAP.T4_PIVOT      ; store_set_state(key, value);
    key = "T5_SPREAD"          ; value = LOG_MAP.T5_SPREAD     ; store_set_state(key, value);
    key = "T6_SLOT"            ; value = LOG_MAP.T6_SLOT       ; store_set_state(key, value);

    key =  FLY_DIV_MAGNIFIED   ; value = prop_get( FLY_DIV_MAGNIFIED ); store_set_state(key, value);
    key = "LOG_IPC"            ; value = LOG_IPC               ; store_set_state(key, value);
    key = "logging_EVENTS"     ; value = logging_EVENTS        ; store_set_state(key, value);
    key = "logging_HIGHLIGHT"  ; value = logging_HIGHLIGHT     ; store_set_state(key, value);
    key = "logging_TOOLBAR"    ; value = logging_TOOLBAR       ; store_set_state(key, value);

};
/*}}}*/
/*_ t_store4_save_site_layout {{{*/
let t_store4_save_site_layout = function(reason)
{
/*{{{*/
let   caller = "t_store4_save_site_layout("+reason+")";
let log_this = LOG_MAP.T0_STORE;

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly(caller);
/*}}}*/
    /* UNLESS NO PAGE DATA WORTH REMEMBERING {{{*/
    if( t_store_patterns_consider_removing_all_page_items(caller) ) return;

    /*}}}*/
    /* TOOLS LAYOUT {{{*/
    let key, value, xy;
    if(hotring) {
if( log_this) log(caller);

        key = "tools_scrollY"       ; value = scroll_last_scrollY           ; store_set_value(key, value);

        t_gutter_save_last_hotspot_WINDOW_XY();

        if(pivot_PANEL) {
            key = "pivot_PANEL"     ; value = pivot_PANEL.id                ; store_set_value(key, value);
            key = "pivotXY"         ; value = JSON.stringify(pivotXY)       ; store_set_value(key, value);
            key =  PIVOT_MAGNIFIED  ; value = prop_get(key)                 ; store_set_state(key, value);
        }

        xy = { x:fly_div.offsetLeft , y:fly_div.offsetTop };
        key = "fly_div_XY"          ; value = JSON.stringify(xy)            ; store_set_value(key, value);

        key =  FLY_DIV_MAGNIFIED    ; value = prop_get(key); store_set_state(key, value);

        xy = { x:topTool.x , y:topTool.y };
        key = "topTool_XY"          ; value = JSON.stringify(xy)            ; store_set_value(key, value);

        key = "spread_ratio_x"      ; value = spread_ratio.x                ; store_set_value(key, value);
        key = "spread_ratio_y"      ; value = spread_ratio.y                ; store_set_value(key, value);

        key =  SHOW_SEEKZONE        ; value = prop_get(key); store_set_state(key, value);
        key =  PIN_SEEKSPOT         ; value = prop_get(key); store_set_state(key, value);
        key =  LOG_SEEKSPOT         ; value = prop_get(key); store_set_state(key, value);
    }
    /*}}}*/
    /* SCROLL OVERFLOW_VISI {{{*/
    key =  SCROLL_SMOOTH            ; value = prop_get(key); store_set_state(key, value);
    key =  OVERFLOW_VISI            ; value = prop_get(key); store_set_state(key, value);

    key =  TOOLS_SCROLL             ; value = prop_get(key); store_set_state(key, value);
    /*}}}*/
    /* PANELS SELECTED AND PINNED XY {{{*/
    t_store_panel_selected_pinned_XY(transcript1);
    t_store_panel_selected_pinned_XY(transcript2);
    t_store_panel_selected_pinned_XY(fly_div    );

    for(let i=0; i < TOOL_panels.length; ++i)
        t_store_panel_selected_pinned_XY( TOOL_panels[i] );

    /*}}}*/
    /* target_tool [XY PINNED] {{{*/
    for(let tt_num = 1; tt_num <= TARGET_MAX; ++tt_num)
    {
        t_store_target_tool( target_tools_map_get( tt_num ) );
    }
    /*}}}*/
};
/*}}}*/
/* TODO REMOVE KEY=VALUE VERSION */
/*_ t_store_panel_selected_pinned_XY {{{*/
let t_store_panel_selected_pinned_XY = function(panel)
{
/*{{{*/
let   caller = "t_store_panel_selected_pinned_XY";
let log_this = LOG_MAP.T0_STORE;

/*}}}*/
    if(!panel) return;

    let key , value;                let             map = tools_map_get( panel );
    key     = panel.id+".selected"; let selected = (map && map.selected);
    key     = panel.id+"_pinned"  ; let   pinned = selected && panel.classList.contains(CSS_PINNED);
    key     = panel.id+"_XY"      ; let       xy = get_el_xy(panel, caller);

    key     =   panel.id + "_JSON";
    value   = { selected : selected
        ,       pinned : pinned
        ,           xy : xy
        ,    magnified : has_el_class(panel,CSS_MAGNIFIED)
    };
if( log_this) log_key_val(key, value, lf3);

    store_set_value(key, JSON.stringify(value));
};
/*}}}*/
/*_ t_store_target_tool {{{*/
let t_store_target_tool = function(tt)
{
/*{{{*/
let   caller = "t_store_target_tool";
let log_this = LOG_MAP.T0_STORE;

if( log_this) log(caller+"("+get_n_lbl(tt)+")");
/*}}}*/
    if(!tt) return;

    /* REMOVE UNPINNED STORAGE {{{*/
    let    key = tt.id+"_JSON";
    let pinned = tt.classList.contains( CSS_PINNED );
    if(!pinned) {
        if(store_getItem( key ))
        {
if( log_this) log("REMOVE UNPINNED STORAGE FOR "+ get_n_lbl(tt));

            store_set_value(key, null);
        }
        return;
    }
    /*}}}*/
    /* UPDATE PINNED STORAGE {{{*/
    let dir_class
        = tt.classList.contains(CSS_POINT_EE) ? CSS_POINT_EE
        : tt.classList.contains(CSS_POINT_SE) ? CSS_POINT_SE
        : tt.classList.contains(CSS_POINT_SW) ? CSS_POINT_SW
        : tt.classList.contains(CSS_POINT_WW) ? CSS_POINT_WW
        : tt.classList.contains(CSS_POINT_NW) ? CSS_POINT_NW
        : tt.classList.contains(CSS_POINT_NE) ? CSS_POINT_NE
        :                                                 ""
    ;
    let     xy = get_el_xy(tt, caller);

    let value
        = {       xy : xy
        ,     pinned : pinned
        ,  dir_class : dir_class
        ,    date_MS : tt.date_MS
        ,        msg : tt.msg
/*{{{
        ,       text : strip_CR_LF( tt.innerText )
}}}*/
    };
    store_set_value(key, JSON.stringify(value));
    /*}}}*/
};
/*}}}*/
/*_ t_store5_save_page_wording {{{*/
let t_store5_save_page_wording = function()
{
let   caller = "t_store5_save_page_wording";
let log_this = LOG_MAP.T0_STORE;

    /* SCROLL WORDS FILTER NODE */
    let key, value;
if( log_this) log(caller);

    key = "sel_csv"            ; value = sel_csv               ; store_set_value(key, value);
    key = "pat_csv"            ; value = pat_csv               ; store_set_value(key, value);
    key = "off_csv"            ; value = off_csv               ; store_set_value(key, value);
    key = "bak_csv"            ; value = bak_csv               ; store_set_value(key, value);
    key = "alt_csv"            ; value = alt_csv               ; store_set_value(key, value);

    dom_hide2_store_save();

    key =  WORDING             ; value = prop_get(key)         ; store_set_state(key, value);
    key =  WORDS_EXACT         ; value = prop_get(key)         ; store_set_value(key, value);
    key =  WORDS_SEGMENT       ; value = prop_get(key)         ; store_set_value(key, value);
    key =  WORDS_HEAD_TAIL     ; value = prop_get(key)         ; store_set_value(key, value);
    key =  WORDS_OPCYCLE       ; value = prop_get(key)         ; store_set_state(key, value);
    let id_array = t_get_words_drop_affix_array();
    for(let i=0; i < id_array.length; ++i)
    {
        key   = id_array[i];
        value = prop_get(key);
        store_set_state(key, value);
    }

};
/*}}}*/
/*  t_store_update_post {{{*/
/*{{{*/
let PENDING_LOCALSTORAGE_DELAY = 1000;

let t_update_store3_site_layout_timer;
let t_update_store3_site_layout_callers = "";
let t_update_store3_site_layout_count   =  0;
/*}}}*/
let t_store_update_post = function(_caller, delay=PENDING_LOCALSTORAGE_DELAY)
{
    /*{{{*/
    let caller = "t_store_update_post";
let log_this = LOG_MAP.T0_STORE;

if( log_this) log(caller+"("+_caller+")");
    /*}}}*/
    /* clearTimeout {{{*/
    if(               t_update_store3_site_layout_timer ) {
        clearTimeout( t_update_store3_site_layout_timer );
        /*.........*/ t_update_store3_site_layout_timer = null;
    }
    /*}}}*/
    /* log first caller {{{*/
    if(!t_update_store3_site_layout_callers) {
        t_update_store3_site_layout_count   = 1;
        t_update_store3_site_layout_callers = "1 "+ _caller;
if(log_this) log("%c FIRST PENDING LOCAL STORAGE .. %c BY "+t_update_store3_site_layout_callers+" ", lb3,lb0);
    }
    /*}}}*/
    /* log more callers {{{*/
    else {
        t_update_store3_site_layout_count += 1;
if(log_this && !t_update_store3_site_layout_callers.includes(_caller)) t_update_store3_site_layout_callers += LF + t_update_store3_site_layout_count +" "+ _caller;
    }
    /*}}}*/
    /* post or commit handler {{{*/
    if(delay) t_update_store3_site_layout_timer = setTimeout(t_store_update_handler, PENDING_LOCALSTORAGE_DELAY);
    else                                                     t_store_update_handler();

    /*}}}*/
};
/*}}}*/
/*_ t_store_update_is_pending {{{*/
let t_store_update_is_pending = function()
{
    return (t_update_store3_site_layout_timer != null);
};
/*}}}*/
/*_ t_store_update_handler {{{*/
let t_store_update_handler = function()
{
    /* [onWork_EL] is not released .. (postpone update) {{{*/
    t_update_store3_site_layout_timer = null;
let log_this = LOG_MAP.T0_STORE;

    if(onWork_EL) {
if(log_this) log("%c PENDING LOCAL STORAGE POSTPONED BY %c "+get_n_lbl(onWork_EL)+" ", lb3,lb0);
        t_update_store3_site_layout_timer = setTimeout(t_store_update_handler, PENDING_LOCALSTORAGE_DELAY);
        return;
    }
    /*}}}*/

if(log_this) log("%c PENDING LOCAL STORAGE (x"+t_update_store3_site_layout_count+") BY: %c"+LF+t_update_store3_site_layout_callers, lb3,lb0);

    /*....*/ t_store4_save_site_layout(t_update_store3_site_layout_callers);
    t_update_store3_site_layout_count   = 0;
    t_update_store3_site_layout_callers = "";
};
/*}}}*/
/*}}}*/

/* EVENT LISTENER ONDOWN PIVOT PINNED */
/*{{{*/
/*{{{*/

/*_______________XY___________________________*/
let onDown_HSPOT_XY        = { x:0, y:0 }; /* TODO ? could better be [onDown_HSPOT_MID] ? */
let onDown_TOOL_XY         = { x:0, y:0 };
let onDown_PANEL_XY        = { x:0, y:0 };
let onDown_XY_sign         = { x:0, y:0 };
let onMove_pivotXY         = { x:0, y:0 };

/*_________SCROLL_____________________________*/
let onDown_SCROLL_XY        = { x:0, y:0 };

/*_________PANEL______________________________*/
let onWork_PANEL           = null;
let pivot_PANEL            = null;
let onStandby_PANEL        = null;
let onWork_PANEL_magnified = null;
let onWork_MOVABLE_PANEL   = null;

/*_________TOOL_______________________________*/
let onDown_EL              = null;
let onWork_EL              = null;
let onWork_SEEK_TOOL       = null;
let onWork_MOVABLE_CHILD   = null;
let onWork_EL_last_used    = null;

/*_________MODIFIER___________________________*/
let onDown_SHIFT           = false;
let onDown_ALT             = false;
let onDown_CTRL            = false;

/*_________MILLISECOND_TIMING_________________*/
let onDownPMS              = 0;
let onDown_MS              = 0;
let onUp_MS                = 0;

/*__what_was_selected_at_event_start__________*/

/*__DURATION__________________________________*/
const CLICK_DURATION       =                500;
const MISCLICK_TOUCH_MS    = CLICK_DURATION / 4;
const MISCLICK_MOUSE_MS    = CLICK_DURATION / 4;
const LONG_PRESS_DURATION  = CLICK_DURATION * 2;

const DBLCLICK_DELAY       = CLICK_DURATION;
const DBLTOUCH_DELAY       = CLICK_DURATION / 2;

const DRAG_MAX_MS          = CLICK_DURATION * 2;
const DRAG_MIN_MS          = CLICK_DURATION / 4;

/*}}}*/
/* LISTENER {{{*/
/* NOTE {{{

 :!start explorer "https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver"

 Do not use the "on" prefix. For example, use "click" instead of "onclick".
 :!start explorer "https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener"
 :!start explorer "https://www.w3schools.com/jsref/met_element_addeventlistener.asp"
 :!start explorer "https://www.w3schools.com/jsref/dom_obj_event.asp"
 :!start explorer "https://www.w3schools.com/charsets/ref_utf_math.asp"

 [preventDefault]
 :!start explorer "https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md"

 [default-passive-events]
 :!start explorer "https://github.com/zzarcon/default-passive-events"
 :!start explorer "https://dom.spec.whatwg.org/#dictdef-eventlisteneroptions"

 [sourceURL]
 :!start explorer "https://www.html5rocks.com/en/tutorials/developertools/sourcemaps"

 option=[capture || true] .. e.eventPhase == (CAPTURING_PHASE || AT_TARGET) .. ( !BUBLINB_PHASE)
 option=[passive        ] .. will not call preventDefault

}}}*/
/* ADD */
/*_ t_add_LISTENERS {{{*/
let t_add_LISTENERS = function()
{
/*{{{*/
let   caller = "t_add_LISTENERS";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+caller, lbb+lbH+lf2);
/*}}}*/
    /* UNLOAD */
    add_listener_capture_active(       window, "beforeunload"     , t_load_listener);
    add_listener_capture_active(       window,       "unload"     , t_load_listener);

    /* LAYOUT */
    add_listener_capture_active(       window, "scroll"           , t_scroll_listener);
    add_listener_capture_active(       window, "resize"           , t_resize_listener);
    add_listener_capture_active(       window, "orientationchange", t_layout_listener);

    /* TOUCH */
    if( ("ontouchstart" in document.documentElement) ) {
        add_listener_capture_active(   window, "touchstart"       , t_pointerdown_listener);
        add_listener_capture_active(   window, "touchend"         , t_pointerup_listener);
    }
    /* MOUSE */
    else {
        add_listener_capture_active(   window, "mousedown"        , t_pointerdown_listener);
        add_listener_capture_active(   window, "mouseup"          , t_pointerup_listener);
    }
/*{{{*/
if( log_this) {
    log("%c"+t_load_listener        .name+"%c beforeunload unload %c window",lbL,lbF+lf1,lbR);
    log("%c"+t_scroll_listener      .name+"%c scroll              %c window",lbL,lbF+lf3,lbR);
    log("%c"+t_resize_listener      .name+"%c resize              %c window",lbL,lbF+lf3,lbR);
    log("%c"+t_layout_listener      .name+"%c orientationchange   %c window",lbL,lbF+lf3,lbR);

    log("%c"+t_pointerdown_listener .name+"%c mousedown           %c window",lbL,lbF+lf4,lbR);
    log("%c"+t_pointerup_listener   .name+"%c mousedown           %c window",lbL,lbF+lf4,lbR);
    log("%c"+t_pointerdown_listener .name+"%c touchstart          %c window",lbL,lbF+lf5,lbR);
    log("%c"+t_pointerup_listener   .name+"%c touchend            %c window",lbL,lbF+lf5,lbR);

}
/*}}}*/

    /* INPUT */
    let inputs = dom_tools_html.getElementsByTagName("INPUT");
    for(let i=0; i < inputs.length ; ++i) {
        if( inputs[i].id ) {
if( log_this) log("%c"+t2_input_CB.name+"%c onkeyup onchange %c"+(inputs[i].id || ("INPUT #"+i)),lbL,lbF+lf2,lbR);
            add_listener_capture_active(inputs[i], "keyup"        , t2_input_CB);
            add_listener_capture_active(inputs[i], "change"       , t2_input_CB);
        }
    }

    /* WINDOW KEYBOARD */
    add_listener_capture_active(        window   , "keyup"        , t2_window_keyup_CB);

};
/*}}}*/
/*_ add_page_pointermove_listener {{{*/
let add_page_pointermove_listener = function(_caller)
{
/*{{{*/
let   caller = "add_page_pointermove_listener";
let log_this = LOG_MAP.EV0_LISTEN;

if( log_this) t_log_event_status(caller+" .. CALLED BY "+ _caller, lf2);
/*}}}*/
/*{{{
    if(typeof MWebJS != "undefined") MWebJS.eval("SCROLL OFF");
}}}*/
    if(("ontouchmove" in document.documentElement))
        add_listener_capture_active(   window, "touchmove"        , t_page_pointermove_drag);
    else
        add_listener_capture_active(   window, "mousemove"        , t_page_pointermove_drag);
};
/*}}}*/
/*_ add_tool_pointermove_listener {{{*/
let add_tool_pointermove_listener = function(_caller)
{
/*{{{*/
let  caller = "add_tool_pointermove_listener";
    let log_this = LOG_MAP.EV0_LISTEN;

if( log_this) t_log_event_status(caller+" .. CALLED BY "+ _caller, lf2);
/*}}}*/
    if(("ontouchmove" in document.documentElement))
        add_listener_capture_active(   window, "touchmove"        , t_tool_pointermove_drag);
    else
        add_listener_capture_active(   window, "mousemove"        , t_tool_pointermove_drag);
};
/*}}}*/
/* REMOVE */
/*_ t_del_listeners {{{*/
let t_del_listeners = function()
{
let   caller = "t_del_listeners";
let log_this = LOG_MAP.EV0_LISTEN;

if( log_this) log(caller, "info");

    /* LAYOUT */
    remove_listener_capture_active    (window, "orientationchange", t_layout_listener);
    remove_listener_capture_active    (window, "resize"           , t_resize_listener);
    remove_listener_capture_active    (window, "scroll"           , t_scroll_listener);

    /* TOUCH (DOWN UP) (HOST TOOL) */
    if( ("ontouchstart" in document.documentElement) ) {
        remove_listener_capture_active(window, "touchstart"       , t_pointerdown_listener);
        remove_listener_capture_active(window, "touchend"         , t_pointerup_listener);
    }
    /* MOUSE (DOWN UP) (HOST TOOL) */
    else {
        remove_listener_capture_active(window, "mousedown"        , t_pointerdown_listener);
        remove_listener_capture_active(window, "mouseup"          , t_pointerup_listener);
    }

    /* MOVE (dynamically added) */
    del_page_and_tool_pointermove_listeners(caller);
};
/*}}}*/
/*_ del_page_and_tool_pointermove_listeners {{{*/
let del_page_and_tool_pointermove_listeners = function(_caller)
{
let   caller = "del_page_and_tool_pointermove_listeners";
let log_this = LOG_MAP.EV0_LISTEN;

if( log_this) t_log_event_status(caller+" .. CALLED BY "+ _caller, lf2);

/*
    if(typeof MWebJS != "undefined") MWebJS.eval("SCROLL ON");
*/
    remove_listener_capture_active(    window, "mousemove"        , t_page_pointermove_drag);
    remove_listener_capture_active(    window, "touchmove"        , t_page_pointermove_drag);

    remove_listener_capture_active(    window, "mousemove"        , t_tool_pointermove_drag);
    remove_listener_capture_active(    window, "touchmove"        , t_tool_pointermove_drag);
};
/*}}}*/
/* PROPAGATION */
/*_ add_listener_capture_active {{{*/
let CAPTURE_TRUE_PASSIVE_FALSE  = {capture:true, passive:false};

let add_listener_capture_active = function(el, ev, fn)
{
    if(!el) return;
if(LOG_MAP.EV0_LISTEN) log("%c add_listener_capture_active("+get_n_lbl(el)+", "+ev+")", lbF+lb8);

    el.   addEventListener(ev, fn, CAPTURE_TRUE_PASSIVE_FALSE);
};
/*}}}*/
/*_ remove_listener_capture_active {{{*/
let remove_listener_capture_active = function(el, ev, fn, uc)
{
    if(!el) return;
if(LOG_MAP.EV0_LISTEN) log("%c remove_listener_capture_active("+get_n_lbl(el)+", "+ev+"]", lbF+lb8);

    el.removeEventListener(ev, fn, CAPTURE_TRUE_PASSIVE_FALSE);
};
/*}}}*/

/*_ t_acceptBubble {{{*/
let t_acceptBubble = function(e, msg)
{
    if( logging_something() )
        t_log_transcript_event_top("<span style='color:yellow;'>"+ SYMBOL_BLACK_CIRCLE +"</span>"
            +                      " ACCEPT BUBBLE <em>"+          e.type              +"</em>"
            +                      " <em>"+                        msg                 +"</em>"
        );
};
/*}}}*/
/*_ t_preventDefault {{{*/
/*{{{*/
let t_preventDefault_caller;

/*}}}*/
let t_preventDefault = function(e, preventDefault_caller)
{
/*{{{*/
    if(t_preventDefault_caller) return;
    t_preventDefault_caller = preventDefault_caller;

let log_this = !onDown_SHIFT && LOG_MAP.EV7_DISPATCH;

if( log_this)
{
    logBIG("PREVENT DEFAULT "+ preventDefault_caller, lbH+lf9);

    t_log_event_status("t_preventDefault("+e.type+")", lbF+lf3);

    log_key_val( "t_preventDefault"
                 , {   bubbles                  : e.bubbles
                     , cancelable               : e.cancelable
                     , defaultPrevented         : e.defaultPrevented
                     , preventDefault           : e.preventDefault
                     , stopImmediatePropagation : e.stopImmediatePropagation
                     , stopPropagation          : e.stopPropagation
                     , cancelBubble             : e.cancelBubble
                     , returnValue              : e.returnValue
                 }
                 , lbH+lf8
               );
}
/*}}}*/
/* NOTE: {{{
 *  [e.stopPropagation         ()] .. stop bubbling phase #3 handlers
 *  [e.stopImmediatePropagation()] .. stop   target phase #2 handlers
 *  [e.preventDefault          ()] .. i.e. return false from within on<event> attribute handler
 *
 *  [e.cancelBubble]               .. depreciated .. (may not reach [outer body])
 *  [e.returnValue]                .. depreciated
 }}}*/
    if( e.stopPropagation          ) e.stopPropagation         ();
    if( e.stopImmediatePropagation ) e.stopImmediatePropagation();
    if( e.preventDefault           ) e.preventDefault          ();
};
/*}}}*/
/*_ t_preventDefault_has_been_called {{{*/

let t_preventDefault_has_been_called = function(_caller)
{
    return (t_preventDefault_caller != "");
};
/*}}}*/
/*_ t_restoreDefault {{{*/
let t_restoreDefault = function(restoreDefault_caller)
{
let log_this = logging_something();

if(log_this && t_preventDefault_caller) {

    if( logging_something() )
        t_log_transcript_event_bot( "<span style='color:green;'>"+ SYMBOL_BLACK_CIRCLE +"</span>"
            +                      " <span style='text-decoration:line-through;'>preventDefault</span>"
            +                      " <em>"+ restoreDefault_caller +"</em> was set by "+ t_preventDefault_caller
        );

}
    t_preventDefault_caller = "";
};
/*}}}*/

/*}}}*/
/** DOWN {{{*/
/* javascript/dom_ondown.js */
/* ONDOWN {{{*/
/*{{{*/
const CSS_SEEK0_ONDOC           = "seek0_onDOC";
const CSS_SEEK0_ONTOOL          = "seek0_onTOOL";
const CSS_SEEK1_ONSLOTEL        = "seek1_onSlotEL";
const CSS_SEEK2_ONRESUME        = "seek2_onResume";
const CSS_SEEK3_ONJUMPEL        = "seek3_onJumpEL";
const CSS_SEEK4_ONSEEKER        = "seek4_onSeeker";
const CSS_SEEK5_ONTARGET        = "seek5_onTarget";

/*}}}*/
/*  get_onDown_SEEK {{{*/
let get_onDown_SEEK = function(e)
{
/*{{{*/
let caller = "get_onDown_SEEK";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

/*{{{
if( log_this) console_clear(caller);
}}}*/
if( log_this) t_log_event_status(caller+SYMBOL_RIGHT_ARROW+"BEFORE", lbb+lf9);
if( log_this) console.dir(e);
/*}}}*/
    /* seek1_onSlotEL seek3_onJumpEL seek5_onTarget seek4_onSeeker seek2_onResume */
    /*{{{*/

    let seeker_PU_showing = t_seeker_PU_is_active() /*&& !t_node_is_off_screen(seeker_PU)*/;

    let  is_on_scrollbar  = get_onDown_is_on_scrollbar(e);

    let     seek5_onTarget                               /* target_tool  is a tool */
        =               (target_tool != undefined      ) /* some ative target_tool */
        &&              (target_tool == onWork_EL      ) /* just touched           */
        &&  has_el_class(target_tool  , CSS_SEEK_TARGET) /* pad in seeking state   */
        && !has_el_class(target_tool  , CSS_LIFTED     ) /* not in LIFTED  state   */
    ;
    let slot         = t_get_EL_slot(onWork_EL);
    let slot_has_ccs = get_ccs_slot(slot);

    let     seek4_onSeeker
        =  !seek5_onTarget
        && ((seeker_CU == onWork_EL) || (seeker_PU == onWork_EL))
    ;

    let     seek3_onJumpEL
        =  !seek4_onSeeker                      /* seeker not touched */
        && !seek5_onTarget
        &&  seeker_PU_showing                   /* seeker showing */
        &&  t_is_onSeekEL(onWork_EL)            /* onWork_EL has a slot */
    ;

    let     seek1_onSlotEL
        =  !seek3_onJumpEL
        && !seek4_onSeeker
        && !seek5_onTarget
        && slot
        && slot_has_ccs
    ;

    let     seek0_onTOOL
        =  !seek5_onTarget
        && !seek4_onSeeker
        && !seek3_onJumpEL
        && !seek1_onSlotEL
        &&  t_is_a_tool_el(onWork_EL, caller)
    ;

    let     seek2_onResume
        =  !seek0_onTOOL
        && !seek1_onSlotEL
        && !seek3_onJumpEL                      /* not switching slot */
        && !seek4_onSeeker                      /* not touching the seeker itself */
        && !seek5_onTarget
        &&  seeker_PU_showing                   /* seeker showing */
    ;

    let     seek0_onDOC                         /* .. NONE OF THE ABOVE */
        =  !seek5_onTarget
        && !seek4_onSeeker
        && !seek3_onJumpEL
        && !seek2_onResume
        && !seek1_onSlotEL
    ;

    /*}}}*/
/* log {{{*/
    let lfx
        =   seek0_onTOOL   ? lf9
        :   seek0_onDOC    ? lf8
        :   seek5_onTarget ? lf5
        :   seek4_onSeeker ? lf4
        :   seek3_onJumpEL ? lf3
        :   seek2_onResume ? lf2
        :   seek1_onSlotEL ? lf1
        :                    lf8;
if( log_this) {
    let the_highest
        = seek5_onTarget   ? CSS_SEEK5_ONTARGET
        : seek4_onSeeker   ? CSS_SEEK4_ONSEEKER
        : seek3_onJumpEL   ? CSS_SEEK3_ONJUMPEL
        : seek2_onResume   ? CSS_SEEK2_ONRESUME
        : seek1_onSlotEL   ? CSS_SEEK1_ONSLOTEL
        : seek0_onTOOL     ? CSS_SEEK0_ONTOOL
        : seek0_onDOC      ? CSS_SEEK0_ONDOC
        :                    "<seek_state_unexpected>"
    ;

    log_key_val_group(       the_highest
                       , {   seek0_onDOC       : seek0_onDOC
                           , seek0_onTOOL      : seek0_onTOOL
                           , seek5_onTarget    : seek5_onTarget
                           , seek4_onSeeker    : seek4_onSeeker
                           , seek3_onJumpEL    : seek3_onJumpEL
                           , seek2_onResume    : seek2_onResume
                           , seek1_onSlotEL    : seek1_onSlotEL
                           , seeker_PU_showing : seeker_PU_showing
                           , target_tool       : get_n_lbl(target_tool)
                           , onWork_EL         : get_n_lbl(onWork_EL)
                           , onWork_PANEL      : get_n_lbl(onWork_PANEL)
                           , is_on_scrollbar   : is_on_scrollbar
                       }
                       , lfx, true /* collapse */
                     );
}
/*}}}*/
    /* TRANSITION SEEKER {{{*/
    del_el_class(seeker_PU, CSS_SEEK1_ONSLOTEL); /* seek1_onSlotEL */
    del_el_class(seeker_PU, CSS_SEEK2_ONRESUME); /* seek2_onResume */
    del_el_class(seeker_PU, CSS_SEEK3_ONJUMPEL); /* seek3_onJumpEL */
    del_el_class(seeker_PU, CSS_SEEK4_ONSEEKER); /* seek4_onSeeker */
    del_el_class(seeker_PU, CSS_SEEK5_ONTARGET); /* seek5_onTarget */

    if     ( seek0_onTOOL     ) set_onDown_seek0_onTOOL  (lfx, log_this);
    else if( seek1_onSlotEL   ) set_onDown_seek1_onSlotEL(lfx, log_this);
    else if( seek3_onJumpEL   ) set_onDown_seek3_onJumpEL(lfx, log_this);
    else if( seek5_onTarget   ) set_onDown_seek5_onTarget(lfx, log_this);
    else if( seek4_onSeeker   ) set_onDown_seek4_onSeeker(lfx, log_this);
    else if( seek2_onResume   ) set_onDown_seek2_onResume(lfx, log_this);
    else if( seek0_onDOC      ) set_onDown_seek0_onDOC   (lfx, log_this);

    if     ( seek0_onTOOL     ) t_set_onDown_SEEK_label(CSS_SEEK0_ONTOOL  );
    else if( seek1_onSlotEL   ) t_set_onDown_SEEK_label(CSS_SEEK1_ONSLOTEL);
    else if( seek2_onResume   ) t_set_onDown_SEEK_label(CSS_SEEK2_ONRESUME);
    else if( seek3_onJumpEL   ) t_set_onDown_SEEK_label(CSS_SEEK3_ONJUMPEL);
    else if( seek4_onSeeker   ) t_set_onDown_SEEK_label(CSS_SEEK4_ONSEEKER);
    else if( seek5_onTarget   ) t_set_onDown_SEEK_label(CSS_SEEK5_ONTARGET);
    else if( seek0_onDOC      ) t_set_onDown_SEEK_label(CSS_SEEK0_ONDOC   );
    else                        t_set_onDown_SEEK_label(                  );

    /*}}}*/
    /* SYNC prop {{{*/
     prop_set(CSS_SEEK0_ONDOC   , seek0_onDOC   );
     prop_set(CSS_SEEK0_ONTOOL  , seek0_onTOOL  );
     prop_set(CSS_SEEK1_ONSLOTEL, seek1_onSlotEL);
     prop_set(CSS_SEEK2_ONRESUME, seek2_onResume);
     prop_set(CSS_SEEK3_ONJUMPEL, seek3_onJumpEL);
     prop_set(CSS_SEEK4_ONSEEKER, seek4_onSeeker);
     prop_set(CSS_SEEK5_ONTARGET, seek5_onTarget);

    /*}}}*/
if( log_this) t_log_event_status(caller+SYMBOL_RIGHT_ARROW+"AFTER", lbb+lfx);
if( log_this && target_tool) t_target_tool_log(target_tool);
};
/*}}}*/
/* seek1_onSlotEL seek3_onJumpEL seek5_onTarget seek4_onSeeker seek2_onResume {{{*/
/*_ set_onDown_seek0_onDOC {{{*/
let set_onDown_seek0_onDOC = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek0_onDOC";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/
    let slot = t_get_EL_slot(onWork_EL);
    if( slot )
    {
if( log_this) logBIG(caller+": IGNORING onWork_EL slot #"+slot);
        if( onDown_EL   == onWork_EL)
            onDown_EL    = onWork_EL.parentElement;
        onWork_EL        = onWork_EL.parentElement;
        onWork_SEEK_TOOL = null;
    }

/*{{{
    if(!target_tool && !has_el_class(onWork_EL, CSS_TARGET_TOOL))
}}}*/
};
/*}}}*/
/*_ set_onDown_seek0_onTOOL {{{*/
let set_onDown_seek0_onTOOL = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek0_onTOOL";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/

};
/*}}}*/
/*_ set_onDown_seek1_onSlotEL {{{*/
let set_onDown_seek1_onSlotEL = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek1_onSlotEL";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/

    add_el_class(seeker_PU, CSS_SEEK1_ONSLOTEL);

/*{{{
    if(!target_tool && !has_el_class(onWork_EL, CSS_TARGET_TOOL))
}}}*/
};
/*}}}*/
/*_ set_onDown_seek2_onResume {{{*/
let set_onDown_seek2_onResume = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek2_onResume";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/
    add_el_class(seeker_PU, CSS_SEEK2_ONRESUME);
    if(target_tool && (target_tool == onWork_EL_last_used))
        add_el_class(seeker_PU, CSS_SEEK5_ONTARGET);
    set_seek_grab_done( true );

    t_change_onWork_SEEK_TOOL(seeker_PU);

};
/*}}}*/
/*_ set_onDown_seek3_onJumpEL {{{*/
let set_onDown_seek3_onJumpEL = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek3_onJumpEL";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/
    /* [seeker_PU] .. CSS_SEEK3_ONJUMPEL {{{*/
    add_el_class(seeker_PU, CSS_SEEK3_ONJUMPEL);

    /*}}}*/
    t_seek_slot_num_SELECT_EL(onWork_EL);
};
/*}}}*/
/*_ set_onDown_seek4_onSeeker {{{*/
let set_onDown_seek4_onSeeker = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek4_onSeeker";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/
    add_el_class(seeker_PU, CSS_SEEK4_ONSEEKER);
    set_seek_grab_done( true );

    t_change_onWork_SEEK_TOOL(seeker_PU);
};
/*}}}*/
/*_ set_onDown_seek5_onTarget {{{*/
let set_onDown_seek5_onTarget = function(lfx,log_this)
{
/*{{{*/
let caller = "set_onDown_seek5_onTarget";

if( log_this) log("%c"+caller, lbH+lfx);
/*}}}*/
    add_el_class(seeker_PU, CSS_SEEK5_ONTARGET);

    t_change_onWork_SEEK_TOOL(target_tool);
};
/*}}}*/
/*}}}*/
/*}}}*/
/* onSeekXYL {{{*/
/*  t_set_onDown_SEEK_label {{{*/
/*{{{*/
let onSeekXYL = { x:0, y:0, label:"" }; /* where to move seeker_PU at next ccs highlighting */

/*}}}*/
/*_ t_set_onSeekXYL {{{*/
let t_set_onSeekXYL = function(xy, seek_label)
{
    onSeekXYL.label = seek_label;
    onSeekXYL.x     = xy.x - window.scrollX;
    onSeekXYL.y     = xy.y - window.scrollY;
/*{{{
log( log_json(onSeekXYL, true) );
}}}*/
};
/*}}}*/
let t_set_onDown_SEEK_label = function(seek_label="")
{
    t_seek_clr_container_selected();

    let xy
        = {   x : onDown_XY.x + window.scrollX
            , y : onDown_XY.y + window.scrollY
        };
    t_set_onSeekXYL(xy, seek_label);
};
/*}}}*/
/*  t_set_onSeekXYL_from_container {{{*/
let t_set_onSeekXYL_from_container = function(container, seek_label)
{
    if(!container ) return;

    let xy = get_el_xy( container, "t_set_onSeekXYL_from_container");
    if( xy ) t_set_onSeekXYL(xy, seek_label);

    t_seekzone1_show(SYMBOL_BLACK_CIRCLE+" FOLLOW CONTAINER "+container_selected.tagName);
};
/*}}}*/
/*  is_onSeekXYL_onTarget {{{*/
let is_onSeekXYL_onTarget = function()
{
    let result = (onSeekXYL.label.startsWith(CSS_SEEK5_ONTARGET));
/*{{{
logBIG("is_onSeekXYL_onTarget: ...return "+result+" .. "+ log_json(onSeekXYL, true));
}}}*/
    return result;
};
/*}}}*/
/*}}}*/
/* onWork_EL {{{*/
/*  t_clr_onWork_EL .. [onWork_EL  onWork_SEEK_TOOL  onWork_PANEL] {{{*/
let t_clr_onWork_EL = function(_caller, log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV1_DOWN || LOG_MAP.EV5_TOOL_CB)
{
/*{{{*/
let   caller = "t_clr_onWork_EL";

if( log_this ) log("%c"+caller+" .. CALLED BY "+ _caller, lf8);
/*}}}*/

    onWork_MOVABLE_CHILD    = null;
    onWork_MOVABLE_PANEL    = null;
    onWork_SEEK_TOOL        = null;
    onWork_PANEL_magnified  = null;

    t_set_onWork_EL_last_used( onWork_EL );

    if(onWork_EL) t_clr_onWork_EL_pressed();
    onWork_EL               = null;

    onWork_PANEL            = null;
};
/*}}}*/
/*  t_set_onWork_EL .. [onWork_EL  onWork_SEEK_TOOL  onWork_PANEL] {{{*/
let t_set_onWork_EL = function(el,_caller)
{
/*{{{*/
let   caller = "t_set_onWork_EL";
let log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV1_DOWN || LOG_MAP.EV5_TOOL_CB;

if( log_this ) log("%c"+caller+" .. CALLED BY "+ _caller, lf9);
/*}}}*/
    /* t_clr_onWork_EL {{{*/
    t_clr_onWork_EL(caller);

    if(!el) return; /* all done */

    /*}}}*/
    /* [target_tool] [onDown_EL] [onWork_EL] [onDown_TOOL_XY] {{{*/
    let new_target_tool
        = (el != target_tool)
        && t_set_target_tool_from_el(el)
    ;

    onDown_EL = new_target_tool ? target_tool : el;
    onWork_EL = onDown_EL;

    onDown_TOOL_XY.x = onWork_EL.offsetLeft;
    onDown_TOOL_XY.y = onWork_EL.offsetTop ;

    /*}}}*/
    /* [onWork_MOVABLE_CHILD] {{{*/
    t_set_movable_TOOL_CHILD(onWork_EL, _caller);

    /*}}}*/
    /* [onWork_SEEK_TOOL] .. (any that conveys some SEEK info) {{{*/
    if(        !prop_get(    EDIT_OR_STAGE )
        && (   (    seeker_PU == onWork_EL )
            || (    seeker_CU == onWork_EL )
         /* || (    seeker_PD == onWork_EL ) */
         /* || (    seeker_CD == onWork_EL ) */
            || (  target_tool == onWork_EL )
            || (                 onWork_EL.id.startsWith("thumb_p_"))
            || (                 onWork_EL.id.startsWith("seekzone"))
            || is_node_selected( onWork_EL )
           )
      ) {
        onWork_SEEK_TOOL = onWork_EL;
    }
    else {
        onWork_SEEK_TOOL = null;
    }
    /*}}}*/
    /* [onWork_PANEL] [onDown_PANEL_XY] [onWork_MOVABLE_PANEL] {{{*/
    t_set_onWork_PANEL(onWork_EL, _caller);

    /*}}}*/
    /* [onDown_HSPOT_XY] [onDown_XY_sign] [onMove_pivotXY] {{{*/
    onDown_HSPOT_XY.x        = h_x;
    onDown_HSPOT_XY.y        = h_y;

    onDown_XY_sign.x         = (onDown_HSPOT_XY.x < pivotXY.x) ? 1 : -1;
    onDown_XY_sign.y         = (onDown_HSPOT_XY.y < pivotXY.y) ? 1 : -1;

    onMove_pivotXY.x         = pivotXY.x;
    onMove_pivotXY.y         = pivotXY.y;

/*{{{
log("....hotspot.Left.Top=["+hotspot.offsetLeft    +" "+ hotspot.offsetTop     +"]");
log(".....onDown_HSPOT_XY=["+onDown_HSPOT_XY.x     +" "+ onDown_HSPOT_XY.y     +"]");
log(".onMove_pivotXY=["+onMove_pivotXY.x +" "+ onMove_pivotXY.y +"]");
log("......onDown_XY_sign=["+onDown_XY_sign.x      +" "+ onDown_XY_sign.y      +"]");
}}}*/
    /*}}}*/
    t_set_onWork_EL_pressed();
    /* ...grid log {{{*/
if(typeof t_grid_onWork_EL_changed != "undefined") t_grid_onWork_EL_changed(_caller);

    /*}}}*/
};
/*}}}*/
/*_ t_change_onWork_SEEK_TOOL {{{*/
let t_change_onWork_SEEK_TOOL = function(seek_tool)
{
/*{{{
log("%c t_change_onWork_SEEK_TOOL %c "+get_n_lbl(seek_tool)+"%c"+((seek_tool == onWork_SEEK_TOOL) ? "UNCHANGED" : "FROM "+get_n_lbl(onWork_SEEK_TOOL)+"")
   ,lbL                          ,lbC+lf6                   ,lbR+lf7                                                                                     );
}}}*/

    onWork_SEEK_TOOL = seek_tool;

    if(onWork_EL) t_clr_onWork_EL_pressed();
    onWork_EL        = seeker_PU;

    onWork_PANEL     = hotspot;
};
/*}}}*/
/*_ t_set_movable_TOOL_CHILD(el, {{{*/
let t_set_movable_TOOL_CHILD = function(el, _caller)
{
    onDown_TOOL_XY.x     = el.offsetLeft;
    onDown_TOOL_XY.y     = el.offsetTop;

    if(el == target_tool) onDown_TOOL_XY.y += target_tool.offsetHeight/2;

    onWork_MOVABLE_CHILD = is_a_movable_TOOL_CHILD(el)
        ?                                          el
        :                                          null;
};
/*}}}*/
/*_ t_set_onWork_PANEL {{{*/
let t_set_onWork_PANEL = function(el, _caller)
{
    onWork_PANEL = t_get_tool_panel(el);

    onWork_PANEL_magnified
        = has_el_class(onWork_PANEL, CSS_MAGNIFIED)
        ?              onWork_PANEL
        :              null;

    onWork_MOVABLE_PANEL
        = is_a_movable_panel(onWork_PANEL)
        ?                    onWork_PANEL
        :                    null;

    let  xy
        = onWork_PANEL
        ? get_el_xy(onWork_PANEL, _caller)
        : { x:0 , y:0 };
    onDown_PANEL_XY.x   = xy.x;
    onDown_PANEL_XY.y   = xy.y;

    /* cache map */
    if( onWork_PANEL )
    {
        if(!t_tools_loaded  ) t_load_TOOLS_MAP(caller);

        let map             = tools_map_get(onWork_PANEL);
        if( map ) {
            map.x           = xy.x;
            map.y           = xy.y;
        }

    }
};
/*}}}*/
/*  t_get_tool_panel {{{*/
let t_get_tool_panel = function(el)
{
    let tool_panel = null;
    if(      is_el_or_child_of_parent_el(el, hotspot  ) ) tool_panel =   hotspot;
    else if( is_el_or_child_of_parent_el(el, fly_div  ) ) tool_panel =   fly_div;
    else if( is_el_or_child_of_parent_el(el, dimm_mask) ) tool_panel = dimm_mask;
/*
    else if( is_el_or_child_of_parent_el(el, seeker_PU) ) tool_panel = hotspot;
    else if( is_el_or_child_of_parent_el(el, seeker_PD) ) tool_panel = hotspot;
*/
    else {
        for(let i=1; i < TOOL_panels.length; ++i)
        {
            if( is_el_or_child_of_parent_el(el, TOOL_panels[i]) )
            {
                tool_panel = TOOL_panels[i];
                break;
            }
        }
    }
    return tool_panel;
};
/*}}}*/
/*_ t_set_onWork_EL_pressed {{{*/
let t_set_onWork_EL_pressed = function()
{
    let caller = "t_set_onWork_EL_pressed";
/*{{{
t_log_event_status("t_set_onWork_EL_pressed: onWork_EL=["+get_id_or_tag(onWork_EL)+"]", lbb+lf9);
}}}*/

    if(!onWork_EL                            ) return;
    if( onWork_EL    == onWork_PANEL         ) return;
    if( onWork_EL.id == "div_slot_containers") return;

    add_el_class(onWork_EL, CSS_PRESSED);

    if(has_el_class(onWork_EL, CSS_TARGET_TOOL)) t_target_tool_set_parked(false, "PRESSED");

/* SET PRESSED BUTTON BUNDLES {{{
    if     (onWork_EL == button_NEXT     ) add_el_class(button_NEXT_LEFT, CSS_PRESSED);
    else if(onWork_EL == button_NEXT_LEFT) add_el_class(button_NEXT     , CSS_PRESSED);

    if     (onWork_EL == button_PREV     ) add_el_class(button_PREV_LEFT, CSS_PRESSED);
    else if(onWork_EL == button_PREV_LEFT) add_el_class(button_PREV     , CSS_PRESSED);
}}}*/
};
/*}}}*/
/*_ t_clr_onWork_EL_pressed {{{*/
let t_clr_onWork_EL_pressed = function()
{
/*{{{*/
    let caller = "t_clr_onWork_EL_pressed";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV3_UP;

if(log_this) t_log_event_status("t_clr_onWork_EL_pressed: onWork_EL=["+get_id_or_tag(onWork_EL)+"]", lbb+lf9);
/*}}}*/

    /* DON't CLEAR WHEN... */
    if(!onWork_EL                            ) return;
    if( onWork_EL    == onWork_PANEL         ) return;
    if( onWork_EL.id == "div_slot_containers") return;
    del_el_class(onWork_EL, CSS_PRESSED);

/* CLEAR PRESSED BUTTON BUNDLES {{{
    if     (onWork_EL == button_NEXT         ) del_el_class(button_NEXT_LEFT, CSS_PRESSED);
    else if(onWork_EL == button_NEXT_LEFT    ) del_el_class(button_NEXT     , CSS_PRESSED);

    if     (onWork_EL == button_PREV         ) del_el_class(button_PREV_LEFT, CSS_PRESSED);
    else if(onWork_EL == button_PREV_LEFT    ) del_el_class(button_PREV     , CSS_PRESSED);
}}}*/

    /* LASTLY */
    /*......................................*/ del_el_class(onWork_EL       , CSS_PRESSED);
    if(seekzone)                               del_el_class(seekzone        , CSS_PRESSED);
};
/*}}}*/
/*_ t_set_onWork_EL_last_used {{{*/
let t_set_onWork_EL_last_used = function(el)
{
/*{{{
logXXX("t_set_onWork_EL_last_used("+get_id_or_tag(el)+")");
}}}*/

    if(el) onWork_EL_last_used = el; /* never forget last use */

    if( has_el_class(el, CSS_TARGET_TOOL) )
    {
        let thumb_p     = 100 * el.offsetTop / get_page_height();
        let thumb_p_str = get_thumb_p_str(thumb_p)+"%";
        el.title        = el.id +LF+ thumb_p_str;
    }

};
/*}}}*/
/*_ t_get_onWork_EL_last_used {{{*/
let t_get_onWork_EL_last_used = function()
{
    return onWork_EL_last_used;
};
/*}}}*/
/*_ t_get_onWork_tool_label {{{*/
let t_get_onWork_tool_label = function()
{
    return (onWork_PANEL ?       get_n_lbl(onWork_PANEL)      : "")
        +  (onWork_EL    ? " ("+ get_n_lbl(onWork_EL   ) +")" : "")
    ;
};
/*}}}*/
/*}}}*/
/* SELECTION {{{*/
/*  get_onDown_SELECTION {{{*/
/*{{{*/
let onDown_SELECTION       = null;
let onDown_SEL_TEXT        =   "";

/*}}}*/
let get_onDown_SELECTION = function()
{
    onDown_SELECTION = window.getSelection();
    onDown_SEL_TEXT  = t_get_current_sel_text() || onDown_SEL_TEXT; /* update or keep previous */
};
/*}}}*/
/*_ t_get_current_sel_text {{{*/
let t_get_current_sel_text = function()
{
    let selection = window.getSelection();
    return (selection && (selection.rangeCount > 0))
        ?   selection.getRangeAt(0).toString().trim()
        :   ""
    ;
};
/*}}}*/
/*_ t_window_getSelection_removeAllRanges {{{*/
let t_window_getSelection_removeAllRanges = function(_caller)
{
let  caller = "t_window_getSelection_removeAllRanges";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) t_log_event_status(caller+": .. CALLED BY "+ _caller, lf2);

    window.getSelection().removeAllRanges();

    t_target_tool_sync_pastable();
};
/*}}}*/
/*}}}*/
/* onDown_XY {{{*/
/*  get_onDown_XY {{{*/
let     onDown_XY = { x:0, y:0 };
let get_onDown_XY = function(e, _caller)
{
    let      xy = get_event_XY(e);
    onDown_XY.x = xy.x;
    onDown_XY.y = xy.y;
/*{{{
logXXX("%c get_event_XY: onWork_SEEK_TOOL=["+get_id_or_tag(onWork_SEEK_TOOL)+"] .. CALLED BY "+_caller, lbH+lf7);
}}}*/
};
/*}}}*/
/*  get_onMoveDXY {{{*/
let     onMoveDXY = { x:0, y:0 };
let get_onMoveDXY = function(e, _caller)
{
    let      xy = get_event_XY(e);
    onMoveDXY.x = xy.x - onDown_XY.x;
    onMoveDXY.y = xy.y - onDown_XY.y;
/*{{{
    if(onDown_ALT) {
        onMoveDXY.x = onDown_XY.x - xy.x;
        onMoveDXY.y = onDown_XY.y - xy.y;
    }
}}}*/
/*{{{
logXXX("%c get_event_XY: onWork_SEEK_TOOL=["+get_id_or_tag(onWork_SEEK_TOOL)+"] .. CALLED BY "+_caller, lbH+lf7);
}}}*/
};
/*}}}*/
/*  get_event_XY {{{*/
let get_event_XY = function(e)
{
    let x, y;
    if(e.changedTouches) {
        x = parseInt(e.changedTouches[0].clientX);
        y = parseInt(e.changedTouches[0].clientY);
    }
    else {
        x = parseInt(                  e.clientX);
        y = parseInt(                  e.clientY);
    }
    return { x:x , y:y };
};
/*}}}*/
/*}}}*/
/*}}}*/
/* PIVOT {{{*/
/*{{{*/
const T_RAISE_PIVOT_PANEL_DELAY_LONG  = 2000;
const T_RAISE_PIVOT_PANEL_DELAY_SHORT =  500;

let   t_raise_pivot_PANEL_timer;
let   pivot_PANEL_changed_since_onDown;
/*}}}*/
/* t_set_pivot_PANEL {{{*/
/*{{{*/
let pivotXY = { x:512 , y:512 };

/*}}}*/
let t_set_pivot_PANEL = function(panel)
{
/*{{{*/
let   caller = "t_set_pivot_PANEL("+get_n_lbl(panel)+")";
let log_this   = LOG_MAP.T4_PIVOT;

if(log_this) t_log_event_status(caller, lf1);
/*}}}*/
    /* [pat_bag] .. (t_pat_bag_open_or_close on focus) {{{*/
    if((panel == pat_bag) && off_bag && (pivot_PANEL != pat_bag))
        t_pat_bag_open_or_close("SET PIVOT PANEL [pat_bag]");

    /*}}}*/
    /* SAME PANEL {{{*/
    if(pivot_PANEL && (pivot_PANEL == panel))
    {
if(log_this) log("%c"+caller+": UNCHANGED", lbF+lb2);

        return;
    }
    /*}}}*/
    /* RELEASE CURRENT PANEL {{{*/
    if(pivot_PANEL) {
        if( t_is_panel_magnified( pivot_PANEL ) )
        {
            let pinned =  pivot_PANEL.classList.contains(CSS_PINNED);
            if(!pinned) t_toggle_panel_magnified(pivot_PANEL, false);
        }
    }
    /*}}}*/
    /* SELECT AND STORE NEW PIVOT PANEL {{{*/
    pivot_PANEL_changed_since_onDown = "from ["+get_n_lbl(pivot_PANEL)+"] to ["+get_n_lbl(panel)+"]";

    if(pivot_PANEL) t_set_CSS_PIVOT_PANEL(pivot_PANEL, false);

    pivot_PANEL = panel;
    if( !pivot_PANEL ) {
        t_set_pivotXY(topTool.x, topTool.y);
        return;
    }

    t_layout_panel_magnified(panel , prop_get( PIVOT_MAGNIFIED ));
    /*}}}*/
    /* MOVE PIVOT POINT {{{*/
    let map = tools_map_get(pivot_PANEL);
    if(!map) {
if( log_this) log("MOVE PIVOT POINT: pivot_PANEL NOT TRACKED YET");
        return;
    }
    map.x   = panel.offsetLeft;
    map.y   = panel.offsetTop;
    map.w   = panel.offsetWidth;
    map.h   = panel.offsetHeight;

/*{{{
logXXX("%c"+caller+"%c "+panel.id+" %c "+map.x+" "+map.y, lbH, lbC+lf3, lbH+lf8);
}}}*/

    let   x = map.x;
    let   y = map.y;
    let   w = map.w;
    let   h = map.h;
/*{{{
seekspot_A.style.marginLeft = (map.x) +"px";
seekspot_A.style.top        = (map.y) +"px";
seekspot_A.style.display    =       "block";
}}}*/

    let x_sign = (x > topTool.x) ? 1 : -1;
    let y_sign = (y > topTool.y) ? 1 : -1;
    if( x_sign < 0) x += w;
    if( y_sign < 0) y += h;
/*{{{
log("topTool_xy=["+topTool.x+" "+topTool.y+"] xy_sign=["+x_sign+" "+y_sign+"]");
}}}*/
    /* CHANGE [pivotXY] and [onMove_pivotXY] */
    let piv_x  =  x + x_sign * w * spread_ratio.x;
    let piv_y  =  y + y_sign * h * spread_ratio.y;
    t_set_pivotXY(piv_x, piv_y);

    t_store_update_post(caller);

    onMove_pivotXY.x = piv_x;
    onMove_pivotXY.y = piv_y;

    t_set_has_moved( caller );

    /*}}}*/
};
/*}}}*/
/*  t_set_pivotXY {{{*/
let t_set_pivotXY = function(x,y)
{
    if(pivotXY.x != x) pivotXY.x = parseInt(x);
    if(pivotXY.y != y) pivotXY.y = parseInt(y);

    if(pivspot) t_tool_set_panel_xy(pivspot, pivotXY.x, pivotXY.y);
};
/*}}}*/
/*  t_flash_unpinned_panels {{{*/
let t_flash_unpinned_panels = function(_caller)
{
/*{{{*/
let   caller = "t_flash_unpinned_panels";
let log_this = LOG_MAP.T4_PIVOT;

if( log_this) log(caller+".. CALLED BY "+ _caller);
/*}}}*/
    /* PANEL STYLE .. f(pivot_PANEL DIMMED_PANEL fully_spread) {{{*/
    for(let i=0; i < TOOL_panels.length; ++i)
    {
        let tool_panel  = TOOL_panels[i];
        if( tool_panel == hotspot    ) continue;
        if( tool_panel == fly_div    ) continue;
        /*..........................*/ t_show_unpinned_panel( tool_panel );
    }
    /*}}}*/
    /* SCHEDULE t_raise_pivot_PANEL_delayed {{{*/
    t_raise_pivot_PANEL_delayed(T_RAISE_PIVOT_PANEL_DELAY_LONG, caller);

    /*}}}*/
};
/*}}}*/
/*  t_raise_pivot_PANEL {{{*/
let t_raise_pivot_PANEL         = function(_caller) { t_raise_pivot_PANEL_delayed(0, _caller); };
let t_raise_pivot_PANEL_delayed = function(delay=0, _caller)
{
/*{{{*/
let   caller = "t_raise_pivot_PANEL_delayed("+delay+") .. CALLED BY "+_caller;
let log_this = LOG_MAP.T4_PIVOT;

if(log_this) logBIG(caller);
/*}}}*/

    /* to be handled once only [since onDown] ...cleared by [onUp] */
    if( t_raise_pivot_PANEL_timer == null)
        t_raise_pivot_PANEL_timer  = setTimeout(t_raise_pivot_PANEL_handler, delay);
};
/*}}}*/
/*_ t_raise_pivot_PANEL_handler {{{*/
let t_raise_pivot_PANEL_handler = function()
{
/* handler may be called early {{{*/
let log_this   = LOG_MAP.T4_PIVOT;
    let caller = "t_raise_pivot_PANEL_handler";

if(log_this) logBIG(caller);
if(log_this) t_log_event_status(caller);
/*}}}*/
    /* canceled {{{*/
    if(t_raise_pivot_PANEL_timer == null) {
if(log_this) logBIG(caller+": has been canceled");
        return
    }
    t_raise_pivot_PANEL_timer = null;

    if( call_t_grid_IS_ON_GRID(caller) ) return;
    /*}}}*/
    t_raise_pivot_PANEL_layout(caller);
};
/*}}}*/
/*_ t_raise_pivot_PANEL_layout {{{*/
let t_raise_pivot_PANEL_layout = function(_caller)
{
/* handler may be called early {{{*/
let log_this   = LOG_MAP.T4_PIVOT;
    let caller = "t_raise_pivot_PANEL_layout";

if(log_this) logBIG(caller+" CALLED BY "+_caller);
/*}}}*/
    /* [selected_tools] {{{*/
    let selected_tools = [];
    for(let i=1; i < TOOL_panels.length; ++i)
    {
        let tool_panel = TOOL_panels[i];
        if(!tool_panel) continue; /* i.e. fly_div may not be there yet ... TODO */
        if( tool_panel.classList.contains(CSS_PINNED)) continue;

        let map = tools_map_get(tool_panel);
        if(!map ) continue;
        if( map.selected) selected_tools.push(tool_panel);
    }

if(log_this) log(".....selected_tools.length=["+ selected_tools.length +"]");
    /*}}}*/
    /* [panel_rank] {{{*/
    let pivot_idx  = selected_tools.indexOf( pivot_PANEL );
    let panel_rank = selected_tools.length;
if(log_this) log(".....pivot_idx...........................=["+ pivot_idx  +"]");
if(log_this) log(".....panel_rank..........................=["+ panel_rank +"]");
    /*}}}*/
    for(let i=0; i < selected_tools.length; ++i) {
        /* [zIndex] .. f(tool_rank) {{{*/
        let tool_panel = selected_tools[i];
        let tool_idx   = selected_tools.indexOf( tool_panel );
        tool_panel.tool_rank = panel_rank - Math.abs(pivot_idx - tool_idx);

        let s = "....................".substring(0, tool_panel.tool_rank);
if(log_this) log("...["+s+"] ["+get_n_lbl(tool_panel)+"] .. tool_panel.tool_rank=["+tool_panel.tool_rank+"]");

        /*}}}*/
        /* PIVOT  PANEL  .. [unhide] [zIndex] {{{*/
        if(tool_panel == pivot_PANEL)
        {
            t_show_unpinned_panel (tool_panel);
            t_set_CSS_PIVOT_PANEL (tool_panel,  true);

            tool_panel.style.zIndex = ZINDEX_ABOVE_TOOLS-1; /* as the last tool */
/*{{{
t_log_panel_style_zIndex(tool_panel, caller);
}}}*/

/*
            tool_panel.style.boxShadow = "0px 0px "+(2*panel_rank)+"px blue";
            tool_panel.style.opacity   = "1";
*/
        }
        /*}}}*/
        /* PINNED PANELS .. [unhide] {{{*/
        else if( tool_panel.classList.contains(CSS_PINNED) )
        {
            t_show_pinned_panel(tool_panel, panel_rank);
        }
        /*}}}*/
        /* OTHER  PANELS .. [hide] [zIndex] {{{*/
        else {
            t_set_CSS_PIVOT_PANEL(tool_panel, false);
            if(!tool_panel.classList.contains(CSS_PINNED))
            {
                if(t_show_or_dimm_unpinned_panels(caller)) t_show_unpinned_panel( tool_panel );
                else                                       t_dimm_unpinned_panel( tool_panel );
            }
            tool_panel.style.zIndex    = ZINDEX_TOOL_PANEL_ZERO + tool_panel.tool_rank;
/*{{{
t_log_panel_style_zIndex(tool_panel, caller);
}}}*/
/*{{{
            tool_panel.style.boxShadow = "0px 0px "+(2*tool_panel.tool_rank)+"px black";
            tool_panel.style.opacity   = tool_panel.tool_rank/2 / panel_rank;
}}}*/
        }
        /*}}}*/
    }
    /* STORE TOOLS LAYOUT {{{*/
    /* pat_bag geometry takes time to reflect dynamic content layout .. TODO */
    if(!onWork_PANEL) {
        t_update_TOOLS_MAP_GEOMETRY(caller);
        t_tool_set_top_xy(caller, topTool.x, topTool.y);
    }
    else {
/*
if(onWork_PANEL) log("NOT UPDATING GEOMETRY WHILE WORKING ON ["+onWork_PANEL.id+"]");
*/
    }
    /*}}}*/
};
/*}}}*/

/*  t_raise_pivot_PANEL_called_since_onDown {{{*/
let t_raise_pivot_PANEL_called_since_onDown = function(_caller)
{
/*{{{*/
let log_this   = LOG_MAP.T4_PIVOT;
    let caller = "t_raise_pivot_PANEL_called_since_onDown";

if(log_this) log(caller+"("+_caller+"): ...return "+(t_raise_pivot_PANEL_timer != null));
/*}}}*/
    return (t_raise_pivot_PANEL_timer != null);
};
/*}}}*/
/*  t_raise_pivot_PANEL_reset {{{*/
let t_raise_pivot_PANEL_reset = function(_caller)
{
/*{{{*/
let log_this   = LOG_MAP.T4_PIVOT;
    let caller = "t_raise_pivot_PANEL_reset";

if(log_this) logBIG(caller+"("+_caller+")", lf8);
/*}}}*/
    if(t_raise_pivot_PANEL_timer)
    {
        clearTimeout(t_raise_pivot_PANEL_timer);

        t_raise_pivot_PANEL_timer = null;
    }
};
/*}}}*/

/*}}}*/
/* PINNED {{{*/
/*{{{*/
const CSS_FULLY_SPREAD   = "fully_spread";
const DIMMED_PANEL   = "dimmed_panel";
const CSS_PIVOT_PANEL    = "pivot_panel";

/*}}}*/
/* XXX MOVE FUNCTION BELOW WHERE IT FITS BEST */
/*_ t_show_or_dimm_unpinned_panels {{{*/
let t_show_or_dimm_unpinned_panels = function(_caller)
{
/*{{{*/
let   caller = "t_show_or_dimm_unpinned_panels";
let log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV1_DOWN || LOG_MAP.T4_PIVOT || LOG_MAP.EV5_TOOL_CB;

/*}}}*/
    let fully_spread          = ((spread_ratio.x >= 0.9) || (spread_ratio.y >= 0.9));
    let moving_unpinned_panel = (onWork_PANEL && (onWork_PANEL != pivot_PANEL) && !has_el_class(onWork_PANEL, CSS_PINNED));
    let moving_hotspot        = (             onWork_PANEL        == hotspot    );
    let moving_hotring        = (             onWork_EL_last_used == hotring    );
if(log_this) { /*{{{*/
    log_key_val( caller
                 , {   moving_hotspot        : moving_hotspot
                     , moving_hotring        : moving_hotring
                     , moving_unpinned_panel : moving_unpinned_panel
                     , onWork_PANEL          : get_id_or_tag(onWork_PANEL)
                     , pivot_PANEL           : get_id_or_tag(pivot_PANEL)
                     , fully_spread          : fully_spread
                 }
                 , lb0
               );
}
/*}}}*/

    let show_or_dimm_unpinned_panels
        = moving_hotspot        ?               "hotspot"
        : moving_hotring        ?               "hotring"
        : fully_spread          ?          "fully_spread"
        : moving_unpinned_panel ? "moving_unpinned_panel"
        :                                              "" /* no reason to show */
    ;

if(log_this) log("%c"+caller+" .. CALLED BY "+ _caller+"%c"+(show_or_dimm_unpinned_panels ? "SHOW "+show_or_dimm_unpinned_panels : "DIMM"), lbH, lbb+lbH+lf5);
    return show_or_dimm_unpinned_panels;
};
    /*}}}*/
/*_ t_show_unpinned_panel {{{*/
let t_show_unpinned_panel = function(tool_panel)
{
    /* UNDIMM {{{*/
    let tool_panel_is_dimmed    = has_el_class(tool_panel, DIMMED_PANEL);
    if( tool_panel_is_dimmed )    del_el_class(tool_panel, DIMMED_PANEL);

    /*}}}*/
    /* CSS_PIVOT_PANEL {{{*/
    if(!has_el_class(tool_panel, CSS_PIVOT_PANEL))
    {
        let tool_panel_pinned       = has_el_class(tool_panel  , CSS_PINNED);
        let moving_a_pinned_panel   = has_el_class(onWork_PANEL, CSS_PINNED);
        let panels_are_fully_spread = ((spread_ratio.x >= 0.9) || (spread_ratio.y >= 0.9));
        let fully_spread
            =  !tool_panel_pinned
            && !moving_a_pinned_panel
            &&  panels_are_fully_spread
        ;

        t_set_CSS_FULLY_SPREAD(tool_panel, fully_spread);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_dimm_unpinned_panel {{{*/
let t_dimm_unpinned_panel = function(tool_panel)
{
    add_el_class(tool_panel, DIMMED_PANEL);
};
/*}}}*/
/*_ t_show_pinned_panel {{{*/
let t_show_pinned_panel = function(tool_panel, panel_rank)
{
    del_el_class          (tool_panel, DIMMED_PANEL);
    t_set_CSS_FULLY_SPREAD(tool_panel, false);
    t_set_CSS_PIVOT_PANEL (tool_panel, false);

    tool_panel.style.zIndex = ZINDEX_PINNED_PANEL_ZERO + panel_rank;
/*{{{
t_log_panel_style_zIndex(tool_panel, "t_show_pinned_panel");
}}}*/
};
/*}}}*/

/*}}}*/
/* [target focus has_moved clicked consumed] {{{*/
/*_ t_get_event_target {{{*/
let t_get_event_target = function(e, caller)
{
    /* e_target .. f(event) {{{*/
    let e_target;
    /* [event.target] {{{

     * A reference to the object that dispatched the event.
     * It is different from [event.currentTarget]
     * . when the event handler is called
     * . during the bubbling
     * . or capturing phase of the event.
     }}} */
    if     (e.path && (e.path[0].tagName != "IMG")) { e_target = e.path[0];                /*log("e.path..................=["+ e.path                   +"]");*/ }
    else if(e.path &&  e.path[1]                  ) { e_target = e.path[1];                /*log("e.path..................=["+ e.path                   +"]");*/ }
    else if(e.target                              ) { e_target = e.target ;                /*log("e.target................=["+ e.target                 +"]");*/ }
    else if(e.originalTarget                      ) { e_target = e.originalTarget;         /*log("e.originalTarget........=["+ e.originalTarget         +"]");*/ }
    else if(e.explicitOriginalTarget              ) { e_target = e.explicitOriginalTarget; /*log("e.explicitOriginalTarget=["+ e.explicitOriginalTarget +"]");*/ }

    /*}}}*/

    /* skip proxy el {{{*/
    let el;
    e_target
        = ((el = e_target.firstElementChild) && (el.tagName == "INPUT")) ? e_target.firstElementChild
        : ((el = e_target                  ) && (el.htmlFor           )) ? document.getElementById(el.htmlFor)
        : ((el = e_target.parentElement    ) && (el.htmlFor           )) ? document.getElementById(el.htmlFor)
        : /*..........................................................*/   e_target
    ;

    /*}}}*/
    /* handled_target .. f(handler) {{{*/
    if( t_get_EL_slot(e_target) )
    {
        let handled_target;
        switch(e.type)
        {
            /* MOUSE */
            case "mousedown" :
            case "mouseup"   :
            case "touchstart":
            case "touchend"  :
            case "click"     :
            case "dblclick"  :
            if( !get_el_mouse_event_handler(e_target) ) handled_target = get_el_parent_with_any_event_handler(e_target);
            break;
            /* KEY */
            case "keydown"   :
            case "keypress"  :
            case "keyup"     :
            if( !get_el_onkey_event_handler(e_target) ) handled_target = get_el_parent_with_any_event_handler(e_target);
            break;
            /* INPUT .. (form frame) */
            case "change"    :
            case "focus"     :
            case "select"    :
            case "input"     :
            case "submit"    :
            case "blur"      :
            if( !get_el_input_event_handler(e_target) ) handled_target = get_el_parent_with_any_event_handler(e_target);
            break;
            /* NOT HANDLED */
            default:
            log("%c*** t_get_event_target: EVENT TYPE ["+e.type+"] NOT HANDLED", lbF+lb2);
            break;
        }
        if(handled_target) {
            e_target = handled_target;
        }
    }
    /*}}}*/
/* log {{{
onmousedown onmouseup onclick ondblclick
onkeydown onkeypress onkeyup
onchange
onfocus onselect oninput onsubmit onblur TODO

console.dir(e);
console.dir(e_target);

try { log("e_target.id......=["+e_target.id      +"]"); } catch(ex) { console.warn(ex); console.dir(e_target); }
try { log("e_target.nodeName=["+e_target.nodeName+"]"); } catch(ex) { console.warn(ex); console.dir(e_target); }
try { log("e_target.tagName.=["+e_target.tagName +"]"); } catch(ex) { console.warn(ex); console.dir(e_target); }
}}}*/
/*{{{
let target_label = get_n_lbl((e.path ? e.path[0] : e.e_target));
logXXX("t_get_event_target("+e.type+" on "+target_label+" .. CALLED BY "+caller+") ...return %c"+get_n_lbl(e_target), lb5);
}}}*/
    return e_target;
};
/*}}}*/
/*_ t_set_has_moved {{{*/
/*{{{*/
const MOVED_ENOUGH = 16;
let has_moved      = "";

/*}}}*/
/*_ t_clr_has_moved {{{*/
let t_clr_has_moved = function(_caller)
{
/*{{{
logBIG("t_clr_has_moved: "+_caller, lbH+lf4)
}}}*/
    has_moved     = "";
    has_been_scrolled_by_script  = "";
};
/*}}}*/
/*_ t_set_has_moved {{{*/
let t_set_has_moved = function(_caller)
{
/*{{{*/
let log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV1_DOWN || LOG_MAP.EV2_MOVE || LOG_MAP.EV3_UP || LOG_MAP.EV4_LONG_PRESS ;

if( log_this && !has_moved) t_log_event_status("t_set_has_moved "+ _caller, lf3);
/*}}}*/
    has_moved = _caller;
/*{{{
    if(onWork_EL) t_clr_onWork_EL_pressed();
}}}*/

    if( is_long_press_pending() )
        del_long_press_listener(has_moved);
};
/*}}}*/
let t_check_has_moved       = function(dx, dy, _caller) {                 return t_check_has_moved_dx_dy(dx, dy, _caller,   MOVED_ENOUGH) };
let t_check_big_moved       = function(dx, dy, _caller) { has_moved = ""; return t_check_has_moved_dx_dy(dx, dy, _caller, 2*MOVED_ENOUGH) };
let t_check_has_moved_dx_dy = function(dx, dy, _caller, d_min)
{
    if( has_moved                   ) return  true;
    if(!onWork_EL                   ) return false;
    if( onDown_7_STALL_is_pending() ) return false; /* WAKE UP DELAY */

    /* SEEKER MAGNET */
    if( onWork_SEEK_TOOL ) t_check_on_seeker_move(dx, dy, d_min);

    /* NOT MOVED ENOUGH */
    let dx_dy = Math.max(Math.abs(dx), Math.abs(dy));
    if( dx_dy < d_min) return false;

    /* HAS MOVED ENOUGH */
    t_set_has_moved("[has_moved "+dx_dy+"px] ["+_caller+"] ["+get_n_lbl(onWork_EL)+"]");

let log_this = LOG_MAP.EV0_LISTEN || logging_EVENTS;
    if(log_this)
    {
        console_warn(has_moved +": "+_caller+"("+dx_dy+")"
         /* + LF + "........onDown_XY: ["+              onDown_XY.x +" "+             onDown_XY.y +"]" */
         /* + LF + "...page offset XY: ["+ window       .scrollX    +" "+          window.scrollY +"]" */
         /* + LF + "...body_scroll XY: ["+ document.body.scrollLeft +" "+ document.body.scrollTop +"]" */
        );
        console_dir(onWork_EL, _caller);
        t_log_event_status(_caller+"("+dx_dy+") .. CALLED BY "+ _caller, lf2);

    }
    return true;
};
/*}}}*/
/*_ t_is_bouncing_e_type {{{*/
/*{{{*/
const T_EVENT_DEBOUNCE_DELAY = 100;
let   t_last_handled_event_of_type_MS = {};

/*}}}*/
let t_is_bouncing_e_type = function(e_type, _caller)
{
let log_this = logging_something();

    let last_MS = t_last_handled_event_of_type_MS[e_type] || 0;

    let this_MS = new Date().getTime() % 86400000;
    let delay   = this_MS - last_MS;

    let bouncing = (delay < T_EVENT_DEBOUNCE_DELAY);

    t_last_handled_event_of_type_MS[e_type] = this_MS;

if(log_this && bouncing) log("t_is_bouncing_e_type(%c "+e_type+" %c) %c .. CALLED BY ["+_caller+"] %c .. DEBOUNCED: ["+Math.floor(delay)+"ms < "+T_EVENT_DEBOUNCE_DELAY+"] .. onWork_EL=["+get_n_lbl(onWork_EL)+"] onWork_PANEL=["+get_n_lbl(onWork_PANEL)+"]",lb5,lbA, lb6,lbA);
    return bouncing;
};
/*}}}*/
/*_ t_event_set_e_consumed_by {{{*/
/*{{{*/
let t_event_consumed_cause = "";

/*}}}*/
let t_event_set_e_consumed_by = function(e, consume_cause)
{
let log_this = !onDown_SHIFT && logging_something();
if( log_this) log("t_event_set_e_consumed_by: %c "+consume_cause, lb0);

    t_event_consumed_cause = consume_cause;
};
/*}}}*/
/*_ t_event_has_been_consumed {{{*/
let t_event_has_been_consumed = function(_caller)
{
/*
if(t_event_consumed_cause) log("t_event_has_been_consumed("+_caller+"): [%c "+t_event_consumed_cause+" %c]", lbF+lb8,lbA);
*/
    return t_event_consumed_cause;
};
/*}}}*/
/*_ t_post_focus_to {{{*/
/*{{{*/
let T_POST_FOCUS_TO_DELAY = 250;
let t_post_focus_to_el;

/*}}}*/
/*_ t_post_focus_to {{{*/
let t_post_focus_to = function(el)
{
    if(t_post_focus_to_el) del_el_class(t_post_focus_to_el,CSS_FOCUSSED);
    t_post_focus_to_el = el;

    setTimeout(t_post_focus_to_handler, T_POST_FOCUS_TO_DELAY);
};
/*}}}*/
/*_ t_post_focus_to_handler {{{*/
let t_post_focus_to_handler = function(el)
{
/*{{{*/
let   caller = "t_post_focus_to_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    if(!t_post_focus_to_el) return;
/*{{{
logXXX(caller+": ...moving focus to "+ get_n_lbl(t_post_focus_to_el)+")");
}}}*/
    add_el_class( t_post_focus_to_el,CSS_FOCUSSED);
    t_focus     ( t_post_focus_to_el );

    let panel = t_get_tool_panel(t_post_focus_to_el);
    if( panel && (pivot_PANEL != panel) )
    {
        t_set_pivot_PANEL( panel );
        t_raise_pivot_PANEL(caller+"("+get_n_lbl(el)+")");
        t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) );
    }

    t_post_focus_to_el = null;
};
/*}}}*/
/*_ t_focus {{{*/
let t_focus = function(el)
{
/*{{{
logXXX("t_focus("+get_id_or_tag(el)+")");
logXXX("...behavior_TOUCH_ELSE_DESKTOP=["+behavior_TOUCH_ELSE_DESKTOP+"]");
}}}*/
    /*if( !behavior_TOUCH_ELSE_DESKTOP )*/ el.focus ();
};
/*}}}*/
/*}}}*/

/*}}} */
/* [magnified] {{{*/
/*_ t_layout_panel_magnified {{{*/
let t_layout_panel_magnified = function(panel, magnified)
{
/*{{{*/
let   caller = "t_layout_panel_magnified";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"("+panel.id+", "+magnified+")");
/*}}}*/
    if( magnified ) {
        /*...........................*/ add_el_class(panel,CSS_MAGNIFIED);
        if(!t_can_be_magnified(panel) ) add_el_class(panel,CSS_TOO_LARGE);
        else                            del_el_class(panel,CSS_TOO_LARGE);
    } else {
        /*...........................*/ del_el_class(panel,CSS_MAGNIFIED);
        /*...........................*/ del_el_class(panel,CSS_TOO_LARGE);
    }
};
/*}}}*/
/*_ t_toggle_panel_magnified {{{*/
let t_toggle_panel_magnified = function(panel, new_state)
{
/*{{{*/
let   caller = "t_toggle_panel_magnified("+get_id_or_tag(panel)+", "+new_state+")";
let log_this = (LOG_MAP.T4_PIVOT || LOG_MAP.EV4_LONG_PRESS || LOG_MAP.T3_LAYOUT);

/*}}}*/
    /* TOGGLE STATE {{{*/
    let old_state = panel.classList.contains("magnified");
    switch( new_state ) {
        case  true: new_state =  new_state; break; /* SET    */
        case false: new_state =  new_state; break; /* UNSET  */
        default:    new_state = !old_state; break; /* TOGGLE */
    }
    /*}}}*/
    /* STORE CHANGE {{{*/
    if(new_state != old_state)
    {
        t_store_update_post(get_n_lbl(panel)+" magnified "+new_state);

if( log_this) log(caller+": ...TOGGLED TO "+ new_state);
    }
    else {
if( log_this) log(caller+": ...NO CHANGE");
    }
    /*}}}*/
    t_layout_panel_magnified(panel, new_state);

    return new_state;
};
/*}}}*/
/*_ t_toggle_pivot_PANEL_magnified {{{*/
let t_toggle_pivot_PANEL_magnified = function(new_state)
{
/*{{{*/
let   caller = "t_toggle_pivot_PANEL_magnified("+new_state+")";
let log_this = (LOG_MAP.T4_PIVOT || LOG_MAP.EV4_LONG_PRESS || LOG_MAP.T3_LAYOUT);

/*}}}*/
    /* TOGGLE STATE {{{*/
    if( !pivot_PANEL ) return;

    let old_state = prop_get                ( PIVOT_MAGNIFIED );
    new_state     = t_toggle_panel_magnified( pivot_PANEL, new_state);

    /*}}}*/
    /* STORE CHANGE {{{*/
    if(new_state != old_state) {
        prop_set(PIVOT_MAGNIFIED , new_state);

        t_store_update_post("pivot_magnified "+new_state);

if(log_this) log(caller+": pivot_magnified: %c "+new_state+" ", (new_state ? lb2 : lb8));
    }
    /*}}}*/
    return new_state;
};
/*}}}*/
/*_ t_is_panel_magnified {{{*/
let t_is_panel_magnified = function(panel)
{
let log_this  = LOG_MAP.T4_PIVOT;

    let state
        = panel.classList.contains("magnified")
    ;
if(log_this) log("%c t_is_panel_magnified(panel=["+get_n_lbl(panel)+"]) %c: ...return "+state, lbF+lb1, lb2);

    return state;
};
/*}}}*/
/*_ t_can_be_magnified {{{*/
let t_can_be_magnified = function(panel)
{
/*{{{*/
let   caller = "t_can_be_magnified";
let log_this = (LOG_MAP.T4_PIVOT || LOG_MAP.EV4_LONG_PRESS || LOG_MAP.T3_LAYOUT);

/*}}}*/
    if(panel == seeker_PD          )           return true; /* not a TOOL_panels .. but can be magnified */
    let  map  = tools_map_get(panel); if(!map) return true; /* NO SUCH PANEL (YET) .. as when loading */

    /*...............................................*/ let reject_reason = "";
    if     ( map.w > (w_W / 2)                            ) reject_reason = "["+map.w+" > "+w_W+"/2] .. "+ "["+get_n_lbl(panel)+ "] IS TOO WIDE";
    else if( map.h > (w_H / 2)                            ) reject_reason = "["+map.h+" > "+w_H+"/2) .. "+ "["+get_n_lbl(panel)+ "] IS TOO HIGH";
/*
    else if( onWork_EL && !t_tools_layout_on_mouseup_timer) reject_reason = "["+map.h+" > "+w_H+"/2) .. onWork_EL layout pending";
    else if( onWork_EL                                    ) reject_reason = "["+map.h+" > "+w_H+"/2) .. onWork_EL layout pending";
*/
    let result = (reject_reason == "");

if(log_this) log("t_can_be_magnified("+get_n_lbl(panel)+"): ...return "+result+" %c "+reject_reason, lbF+lb2);
    return result;
};
/*}}}*/
/*_ t_update_panel_magnified {{{*/
let t_update_panel_magnified = function()
{
    for(let i=0; i < TOOL_panels.length; ++i)
    {
        let                        panel = TOOL_panels[i];
        if(t_is_panel_magnified(   panel ))
           t_layout_panel_magnified(panel , true);
    }
};
/*}}}*/
/*}}}*/
/*}}}*/

/* EVENT HANDLERS DOWN MOVE LONG_PRESS UP CLICK LONG_CLICK */
/*{{{*/
/* DOWN */
/*{{{*/
/*  t_pointerdown_listener {{{*/
let t_pointerdown_listener = function(e)
{
/*{{{*/
let   caller = "t_pointerdown_listener";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log(caller+"("+ get_n_lbl(t_get_event_target(e))+")");
/*}}}*/
    /* DOWN .. times (PMS .. MS] .. modifiers (SHIFT CTRL ALT) {{{*/
    log_sep_clr();

    onDownPMS    = onDown_MS;            /* previous  */
    onDown_MS    = new Date().getTime(); /* current   */

    onDown_SHIFT = e.shiftKey;           /* modifiers */
    onDown_CTRL  = e.ctrlKey ;
    onDown_ALT   = e.altKey  ;
    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* return .. [onDown_CTRL] [onDown_SHIFT] {{{*/
    if(onDown_CTRL ) { log(); return; } /* right-button-menu override */
    if(onDown_ALT  ) { log(); console.clear();                                    t_preventDefault(e, caller); return; }
    if(onDown_SHIFT) { log(); caller="SHIFT "+caller; console_clear_post(caller); t_preventDefault(e, caller); t_event_set_e_consumed_by(e, caller); return; }
    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    let                consumed_by = "";                               let  consumed_by_css =  "";
    if(!consumed_by) { consumed_by = onDown_0_MULTITOUCH               (e); consumed_by_css = lf9; }
    if(!consumed_by) { consumed_by = onDown_1_INIT_CTRL_DEBOUNCE_INPUT (e); consumed_by_css = lf1; }
    if(!consumed_by) { consumed_by = onDown_2_target_tool_MOVE         (e); consumed_by_css = lf4; }
    if(!consumed_by) { consumed_by = onDown_2_slot_fullscreen_DRAG     (e); consumed_by_css = lf2; }
    if(!consumed_by) { consumed_by = onDown_2_TOOL_PICK                (e); consumed_by_css = lf2; }
    if(!consumed_by) { consumed_by = onDown_3_TOOL_PRESS               (e); consumed_by_css = lf3; }
    if(!consumed_by) { consumed_by = onDown_4_TOOL_MOVE                (e); consumed_by_css = lf4; }
/*{{{
    if(!consumed_by) { consumed_by = onDown_5_TOOL_SEEKER_TO_HIDE      (e); consumed_by_css = lf5; }
}}}*/
    if(!consumed_by) { consumed_by = onDown_6_DOC_SELECT_OR_SEEK       (e); consumed_by_css = lf6; }
    if(!consumed_by) { consumed_by = e.type+" BUBBLING"; onDown_7_STALL( ); consumed_by_css = lf7; }
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */

    /* consumed_by {{{*/
if( log_this) t_log_event_status(caller+":"+LF+SYMBOL_RIGHT_ARROW+" "+consumed_by, lbb+consumed_by_css);

    if( logging_something() )
        t_log_transcript_event_top("<span class='big'>"+ SYMBOL_DOWN_ARROW +"</span>"
            +                      "<em>"+               consumed_by       +"</em>");

    /*}}}*/
};
/*}}}*/

/*_ onDown_0_MULTITOUCH {{{*/
/*{{{*/
let onDown_TOUCHES;

/*}}}*/
let onDown_0_MULTITOUCH = function(e)
{
    onDown_TOUCHES     = e.touches ? e.touches.length : 1;
    let    consumed_by = ((onDown_TOUCHES > 1) ? "MULTI-TOUCH x"+onDown_TOUCHES : "");
    return consumed_by;
};
/*}}}*/
/*_ onDown_1_INIT_CTRL_DEBOUNCE_INPUT {{{*/
let onDown_1_INIT_CTRL_DEBOUNCE_INPUT = function(e)
{
/*{{{*/
let   caller = "onDown_1_INIT_CTRL_DEBOUNCE_INPUT";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log("%c"+caller, lbF+lb1);
/*}}}*/
    /* INIT EVENT CHAIN {{{*/
    t_log_clr_status();
    t_clr_has_moved(caller);
    t_raise_pivot_PANEL_reset(caller);

    t_seekzone8_clear_feedback();

    set_seek_grab_done( false );

    t_scrollIntoViewCanceled(caller);

    if(               t_tools_layout_on_mouseup_timer ) {
        clearTimeout( t_tools_layout_on_mouseup_timer );
        /*.........*/ t_tools_layout_on_mouseup_timer = null;
    }

    if(t_preventDefault_caller) t_restoreDefault("ON DOWN INIT");

    mousemove_consumed_by    = "";
    onMove_selection_removed = false;

    move_cooldown_handler();

    /*}}}*/
    /* EVENT START-TO-END TRANSITION {{{*/
    fully_spread_since_onDown                      = false;
    pivot_PANEL_changed_since_onDown               = false;

    /*}}}*/

    /* XY */
    get_onDown_XY(e, caller);
    onMoveDXY.x = 0;
    onMoveDXY.y = 0;

    /* SCROLL */
    if(!dimm_mask_displayed() )
        onDown_SCROLL_XY
            = {   x : window.scrollX
                , y : window.scrollY
            };

    /* EL */
    let e_target = t_get_event_target(e, caller);
    t_set_onWork_EL(e_target, caller);

    /* SEEKER: seek1_onSlotEL seek3_onJumpEL seek5_onTarget seek4_onSeeker seek2_onResume */
    get_onDown_SEEK(e);

    if( prop_get(SHOW_SEEKZONE) ) {
        t_seekzone1_show_onDown();
        t_seekzone1_add_onDown_XY();
    }

    /* SELECTION */
    get_onDown_SELECTION();

    /* IGNORE CLICK BURST */
    let consumed_by = "";
    if(t_is_bouncing_e_type(e.type, "t_pointerdown_listener"))
        consumed_by = "BOUNCING [EVENT <= "+T_EVENT_DEBOUNCE_DELAY+" ms]";

if(consumed_by) t_clear( consumed_by );
    return consumed_by;
};
/*}}}*/
/*_ onDown_2_target_tool_MOVE {{{*/
let onDown_2_target_tool_MOVE = function(e)
{
/*{{{*/
let   caller = "onDown_2_target_tool_MOVE";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) t_log_event_status(caller, lf2);
    if(onDown_EL != target_tool) return;
if( log_this) t_target_tool_log(target_tool);
    let consumed_by;
/*}}}*/
    /* ADD MOVE LISTENERS FOR [target_tool] {{{*/
    if(target_tool.clicked == "handle")
    {
        consumed_by = "MOVING TARGET TOOL";
        t_preventDefault(e, "PREVENT PAGE SCROLL WHILE "+consumed_by);

        add_tool_pointermove_listener(caller);
    }
    /*}}}*/
    /* ADD MOVE LISTENERS FOR [target_tool] DIRECTION {{{*/
    if((target_tool.clicked == "pad") && has_el_class( target_tool, CSS_LIFTED))
    {
        consumed_by = "POINTING TARGET TOOL";
        t_preventDefault(e, "PREVENT PAGE SCROLL WHILE "+consumed_by);

        add_tool_pointermove_listener(caller);
    }
    /*}}}*/
if( log_this && consumed_by) logBIG(consumed_by, lf2);
    return consumed_by;
};
/*}}}*/
/*_ onDown_2_slot_fullscreen_DRAG {{{*/
let onDown_2_slot_fullscreen_DRAG = function(e)
{
/* {{{*/
let   caller = "onDown_2_slot_fullscreen_DRAG";
let log_this = LOG_MAP.EV1_DOWN ||LOG_MAP.T3_LAYOUT;

if( log_this) t_log_event_status(caller, lf2);
/*}}}*/
    if(!div_slot_containers_displayed()         ) return "";
    if(!has_el_class(onWork_EL, CSS_FULLSCREEN )) return "";

    let    consumed_by = "START button_magnify DRAG ["+get_n_lbl(onWork_EL)+"]";
    /* ADD MOVE LISTENERS {{{*/
    add_tool_pointermove_listener(caller);
    /*}}}*/

    return consumed_by;
};
/*}}}*/
/*_ onDown_2_TOOL_PICK {{{*/
let onDown_2_TOOL_PICK = function(e)
{
    /* [e_target] {{{*/
let   caller = "onDown_2_TOOL_PICK";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log("%c"+caller, lbF+lb2);

    let e_target = t_get_event_target(e, caller);
    /*}}}*/
    /* PLAYGROUND [doc_evt_div] {{{*/
    if(doc_evt_div)
    {
        if(    !is_el_or_child_of_parent_el(e_target, doc_evt_div)
            && !is_el_or_child_of_parent_el(e_target, doc_log_div)
        )
            t_doc_div_clear("doc_evt_div")

    }
    /*}}}*/
    /* FOCUS ON SOME INPUT {{{*/
/*{{{
try{
logXXX("...e_target............=["+ get_id_or_tag(e_target) +"]");
logXXX("...e_target.tagName....=["+ e_target.tagName        +"]");
} catch(ex) {}
}}}*/
    if(e_target)
    {
        /* [e_target] IS AN INPUT .. (t_post_focus_to) {{{*/
        if(e_target.tagName == "INPUT")
        {
if( log_this) log("...%c INPUT FOCUS TO TARGET:", lb2);

            t_focus( e_target );
        }
        /*}}}*/
        /* TODO FOCUSSING NEXT PANEL INPUT {{{*/
/* TODO {{{
        else {
            let inputs = e_target.getElementsByTagName("INPUT");
            if(inputs.length)
            {
                logXXX(caller+": ...TARGET CONTAINS "+inputs.length+" INPUT NODES");
                for(let i=0; i < inputs.length; ++i)
                {
                    let el = inputs[i];
                    if( el.tagName == "INPUT")
                    {
logXXX("...document.activeElement=["+ get_n_lbl(document.activeElement) +"]");
logXXX(".........posting focus to ["+ get_n_lbl(el                    ) +"]");
logXXX(".....INPUT FOCUS TO CHILD ["+ get_n_txt(el                    ) +"]");

                        t_post_focus_to(el);
                        break;
                    }
                }
            }
        }
}}}*/
        /*}}}*/
    }
    /*}}}*/
    /* PIVOT PANEL SWITCH .. (move tool drag) {{{*/
    let     consumed_by = "";

    if(    !consumed_by
        && (onWork_PANEL                                )
        && (onWork_PANEL                  != dimm_mask  )
        && (onWork_PANEL                  != hotspot    )
        && (onWork_PANEL                  != fly_div    )
        && !onWork_PANEL.classList.contains( CSS_PINNED )
    ) {
        if(onWork_EL == onWork_PANEL) t_seeker_PU_hide("instant");

/*{{{
try {
logXXX("......................................onWork_PANEL=["+ get_id_or_tag(onWork_PANEL                      ) +"]");
logXXX(".......................................pivot_PANEL=["+ get_id_or_tag(pivot_PANEL                       ) +"]");
logXXX("..........................................e_target=["+ get_id_or_tag(e_target                          ) +"]");
logXXX("..................................e_target.tagName=["+ e_target.tagName                                  +"]");
logXXX("is_el_or_child_of_parent_el(e_target, pivot_PANEL)=["+is_el_or_child_of_parent_el(e_target, pivot_PANEL) +"]");
} catch(ex) {}
}}}*/
        /* SWITCH [pivot_PANEL] {{{*/
        if(      (onWork_PANEL != pivot_PANEL)
/*FIXME
              && (   !e_target || (e_target.tagName != "INPUT")
                  || !is_el_or_child_of_parent_el(e_target, pivot_PANEL))
*/
          ) {
if( log_this) log("PIVOT PANEL SWITCH:");
            let msg
                = caller+": EVENT CANCELED:"
                + LF+"SWITCHING PIVOT PANEL"
                +    " FROM ["+ get_n_lbl(pivot_PANEL ) +"]"
                +      " TO ["+ get_n_lbl(onWork_PANEL) +"]"
                + LF+"...onWork_EL=["+ get_n_lbl(onWork_EL) +"]"
            ;
            t_event_set_e_consumed_by(e, msg);

            onWork_MOVABLE_CHILD      = null;

            fully_spread_since_onDown = true; /* FIXME so it may not be cycled without another onDown */

            t_set_pivot_PANEL( onWork_PANEL );

            let show_or_dimm_unpinned_panels = true;
            t_raise_pivot_PANEL_layout(show_or_dimm_unpinned_panels, caller);

            t_sync_layout(caller);
        }
        /*}}}*/
        /* CURRENT PANEL .. RAISE & MAGNIFY {{{*/
        else {
if( log_this) log("PIVOT PANEL CURRENT");
            if( t_show_or_dimm_unpinned_panels(caller) )
                t_raise_pivot_PANEL(caller);

            /* INPUT CLICKED */
            if(e_target && (e_target.tagName == "INPUT"))
                consumed_by = "INPUT CLICKED";

        }
        /*}}}*/
    }
    /*}}}*/
    /* FLASH UNPINNED PANELS .. f(hotspot) {{{*/
    if(onWork_PANEL == hotspot)
    {
        t_flash_unpinned_panels();
    }
    /*}}}*/
    /* WHETHER TO CALL [t_preventDefault] .. f(onWork_EL or onWork_PANEL handler) {{{*/
    if(!consumed_by)
    {
/*{{{
if( log_this) log("%c...ACCEPT BUBBLE or PREVENT DEFAULT...", lf2);
}}}*/

        let has_handler      = (get_el_event_handler(onWork_EL, caller) != null);
        let is_a_tool        = t_is_a_tool_el(onWork_EL, caller);
        let is_a_tool_dimmed = is_el_or_child_of_parent_el(onWork_EL, dimm_mask);
/*{{{
log(caller);
log("...(onWork_PANEL == pivot_PANEL)...: "+ (onWork_PANEL != pivot_PANEL));
log("...has_handler.....................: "+ has_handler                        );
log("...is_a_tool.......................: "+ is_a_tool                          );
log("...is_a_tool_dimmed................: "+ is_a_tool_dimmed                   );
log("...onWork_PANEL....................: "+ get_n_lbl    (onWork_PANEL        ));
log("...onWork_EL.......................: "+ get_n_lbl(    onWork_EL           ));
log("...onWork_SEEK_TOOL................: "+ get_id_or_tag(onWork_SEEK_TOOL    ));
log("...onWork_MOVABLE_CHILD............: "+ get_id_or_tag(onWork_MOVABLE_CHILD));
}}}*/

/*{{{
        let is_a_push_pin    = has_el_class(onWork_EL, CSS_PUSH_PIN);
log("...is_a_push_pin...................: "+ is_a_push_pin                );
        if     (is_a_push_pin && (onWork_PANEL != pivot_PANEL))
                                                  t_preventDefault(e, "ON DOWN .. TOOL PIN ["+ get_n_lbl(onWork_EL)+"]");
}}}*/

        if     (    onWork_SEEK_TOOL            ) t_preventDefault(e, "ON DOWN .. SEEK_TOOL             ["+ get_n_lbl( onWork_EL    )+"]");
        else if(    onWork_MOVABLE_CHILD        ) t_preventDefault(e, "ON DOWN .. MOVE_CHILD            ["+ get_n_lbl( onWork_EL    )+"]");
        else if(t_touching_a_scrollable_panel() ) {
/*{{{
        if( behavior_TOUCH_ELSE_DESKTOP         ) t_preventDefault(e, "ON DOWN .. TOOL TOUCHED          ["+ get_n_lbl( onWork_EL    )+"]");
                                                  t_preventDefault(e, "ON DOWN .. PANNEL SCROLL         ["+ get_n_lbl( onWork_PANEL )+"]");
}}}*/
            t_set_body_style_overflow_hidden(true);
        }
        else if( is_a_tool && !is_a_tool_dimmed ) {
/*{{{
            if(     behavior_TOUCH_ELSE_DESKTOP ) t_preventDefault(e, "ON DOWN .. TOOL TOUCHED          ["+ get_n_lbl( onWork_EL    )+"]");
}}}*/
            if     (has_handler                 ) t_preventDefault(e, "ON DOWN .. TOOL WITH    HANDLER  ["+ get_n_lbl( onWork_EL    )+"]");
            else                                  t_preventDefault(e, "ON DOWN .. TOOL WITH NO HANDLER  ["+ get_n_lbl( onWork_EL    )+"]");
        }
        else if(    onWork_PANEL                ) {
            if(     has_handler                 ) t_preventDefault(e, "ON DOWN .. PANEL WITH    HANDLER ["+ get_n_lbl( onWork_PANEL )+"]");
            else if(!behavior_TOUCH_ELSE_DESKTOP) t_preventDefault(e, "ON DOWN .. PANEL WITH NO HANDLER ["+ get_n_lbl( onWork_PANEL )+"]");
        }
/* TODO NO SCROLL ON MOBILE{{{
        else if(prop_get( ANCHOR_FREEZE )       ) t_preventDefault(e, "ON DOWN .. [anchor_freeze] SET   ["+ get_n_lbl( onWork_EL    )+"]");
}}}*/
        else if(log_this)                         t_acceptBubble  (e, "ON DOWN .. NOT A PANEL OR TOOL   ["+ get_n_lbl( onWork_EL    )+"]");

    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*_ onDown_3_TOOL_PRESS {{{*/
let onDown_3_TOOL_PRESS = function(e)
{
/* TODO child of [dimm_mask] .. [div_slot_containers fullscreen selected container] */
/* {{{*/
let   caller = "onDown_3_TOOL_PRESS";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log("%c"+caller, lbF+lb3);
/*}}}*/
    /* ADD LONG PRESS TIMER .. (do not consume) {{{*/
    let consumed_by = "";
    if( onDown_3_TOOL_has_long_press_handler() )
    {
if( log_this) log("%cADDING LONG PRESS TIMER:", lbF+lf3);

        add_long_press_listener("ON DOWN TOOL PRESS "+ get_n_lbl(onWork_PANEL));
    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*_ onDown_3_TOOL_has_long_press_handler {{{*/
let onDown_3_TOOL_has_long_press_handler = function()
{
/*{{{*/
let caller = "onDown_3_TOOL_has_long_press_handler";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV4_LONG_PRESS || logging_EVENTS;

if(log_this) t_log_event_status(caller, lf3);
/*}}}*/
    /* context {{{*/
    if(!onWork_EL) return false;

    /* onWork_PANEL */
    let panel1_is_a_dimm_mask        = dimm_mask_is(                onWork_EL                    );
    let panel2_is_hotspot            = (                            onWork_PANEL   ==  hotspot   );
    let panel3_is_a_sel_bag_CHILD    = (            sel_bag ==      onWork_PANEL) && ( onWork_EL != sel_bag);
    let panel4_is_onWork_EL          = (onWork_PANEL &&       (     onWork_PANEL   ==  onWork_EL ));
    let panel5_has_a_SCALEPIN        = get_el_child_with_class(     onWork_PANEL    , CSS_SCALEPIN);
    /* onWork_EL */
    let el0_onSlotEL                 = (t_get_EL_slot             ( onWork_EL) > 0);
    let el1_is_a_tool                = t_is_a_tool_el             ( onWork_EL       , caller         );
    let el2_is_a_dimm_mask_child     = is_el_or_child_of_parent_el( onWork_EL       , dimm_mask      );
    let el3_is_a_fly_div_child       = is_el_or_child_of_parent_el( onWork_EL       , fly_div        );

    let el4_has_t_target_tool_feed   = is_a_DOM_LOAD_featured_function("t_target_tool_feed");
    let el5_is_a_seek_target_tool    = el4_has_t_target_tool_feed && has_el_class(onWork_SEEK_TOOL, CSS_TARGET_TOOL);
    let el6_pinned_target_tool_count = el4_has_t_target_tool_feed && t_get_pinned_target_tool_count();

/*{{{*/
if(log_this) {
    log_key_val( caller
                 , {   onWork_PANEL                  : get_n_lbl(onWork_PANEL)
                     ,  panel1_is_a_dimm_mask         : panel1_is_a_dimm_mask
                     ,  panel2_is_hotspot             : panel2_is_hotspot
                     ,  panel3_is_a_sel_bag_CHILD     : panel3_is_a_sel_bag_CHILD
                     ,  panel4_is_onWork_EL           : panel4_is_onWork_EL
                     ,  panel5_has_a_SCALEPIN         : panel5_has_a_SCALEPIN
                     , onWork_EL                     : get_n_lbl(onWork_EL)
                     ,  el0_onSlotEL                  : el0_onSlotEL
                     ,  el1_is_a_tool                 : el1_is_a_tool
                     ,  el2_is_a_dimm_mask_child      : el2_is_a_dimm_mask_child
                     ,  el3_is_a_fly_div_child        : el3_is_a_fly_div_child
                     ,  el4_has_t_target_tool_feed    : el4_has_t_target_tool_feed
                     ,  el5_is_a_seek_target_tool     : el5_is_a_seek_target_tool
                     ,  el6_pinned_target_tool_count  : el6_pinned_target_tool_count
                     , onDown_SEL_TEXT               : ellipsis_short(onDown_SEL_TEXT)
                 }
                 , lf8);
}
/*}}}*/
    /*}}}*/
    /* handled_by {{{*/
    let                                                          handled_by = "";
    if( el1_is_a_tool ) {
    /* onWork_PANEL */
        if     ( panel1_is_a_dimm_mask          ) handled_by =     onWork_EL.id          ;
/*{{{
        else if( panel2_is_hotspot              ) handled_by = "HOTSPOT PANELS UNHIDE"  ;
}}}*/
        else if( panel3_is_a_sel_bag_CHILD      ) handled_by = "A [sel_bag] CHILD"      ;
        else if( panel4_is_onWork_EL            ) handled_by = "A TOOL PANEL TO MAGNIFY";
        else if( panel5_has_a_SCALEPIN          ) handled_by = "";
    /* onWork_EL */
        else if( el2_is_a_dimm_mask_child       ) handled_by = "A [dimm_mask] CHILD"    ;
        else if( el3_is_a_fly_div_child         ) handled_by = "A [fly_div] CHILD"      ;
        else if( el5_is_a_seek_target_tool      ) handled_by = "A [target_tool] TO FEED FROM SEL_TEXT";
        else if((onWork_EL    == alt_bag       )) handled_by = "A [pat_bag] DIV"        ;
        else if((onWork_EL    == bag_rot       )) handled_by = "A [pat_bag] TOOL"       ;
        else if((onWork_EL    == bak_bag       )) handled_by = "A [pat_bag] DIV"        ;
        else if((onWork_EL    == bot_div       )) handled_by = "A [pat_bag] DIV"        ;
        else if((onWork_EL    == off_bag       )) handled_by = "A [pat_bag] DIV"        ;
        else if((onWork_EL    == transcript1   )) handled_by =    onWork_EL.id          ;
        else if((onWork_EL    == transcript2   )) handled_by =    onWork_EL.id          ;

    }
    else {
        if     (     el0_onSlotEL                    ) handled_by = "";
        else if(     onDown_SEL_TEXT                 ) handled_by = "LONG PRESS [NEW target_tool]";
        else if(     el4_has_t_target_tool_feed      ) {
            if     ( el6_pinned_target_tool_count < 1) handled_by = "A [target_tool] TO ADD FIRST TARGET";
            else if( el6_pinned_target_tool_count > 0) handled_by = el6_pinned_target_tool_count+" [target_tool] TO CHOOSE FROM";
        }
    }
    /*}}}*/
    let result = (handled_by != "");
if(log_this) log("%c onDown_3_TOOL_has_long_press_handler %c return "+result    +"%c"+handled_by
                 ,lbL+lf3                                ,lbC+(result ? lf4:lf8) ,lbR+lf3       );
    return result;
};
/*}}}*/
/*_ onDown_4_TOOL_MOVE {{{*/
let onDown_4_TOOL_MOVE = function(e)
{
/*{{{*/
let   caller = "onDown_4_TOOL_MOVE";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log("%c"+caller, lbF+lb4);
/*}}}*/
    /* MOVABLE [onWork_EL] [onWork_PANEL] {{{*/
    if(    onWork_SEEK_TOOL           ) return ""; /* SEEKING DOCUMENT */
    if(   !onWork_MOVABLE_CHILD
       && !onWork_MOVABLE_PANEL       ) return ""; /* NO MOVING TOOL */

    if( call_t_grid_IS_SIZED(caller)  ) return "";

    let consumed_by;
    /*}}}*/
    /* [PIN / UNPIN] .. [UNGROUP / REGROUP] {{{*/
    let mouse_down_on_a_push_pin = onWork_EL.classList.contains( CSS_PUSH_PIN );
if(log_this) log("...%c[mouse_down_on_a_push_pin: "+mouse_down_on_a_push_pin+"]%c .. %c[onWork_EL "   +get_n_lbl(onWork_EL   )+"]%c ...classList=["+onWork_EL.classList   +"]",lb4,lbA, lbF,lbA);

    if( mouse_down_on_a_push_pin )
    {
        consumed_by = "START TOOL_DRAG PUSH_PIN ["+get_n_lbl(onWork_PANEL)+"]";

        onDown_4_TOOL_DRAG_PUSH_PIN(e);
    }
    else {
        consumed_by = "START TOOL_DRAG PANEL ["+get_n_lbl(onWork_PANEL)+"]";
    }
    /*}}}*/
    /* (THEN) START DRAGGING PANEL {{{*/
/* SCROLL FREEZE .. (EMULATOR=OK .. TABLET=KO) {{{
    if(behavior_TOUCH_ELSE_DESKTOP) document.body.style.overflow = "hidden";
}}}*/
    /* DRAG [hotspot] INTO GUTTER .. f(seekzone in gutter) {{{*/
    if(t_gutter_is_XY_IN(h_x, h_y))
    {
        if( !has_el_class(seekzone, CSS_GUTTER) )
            t_gutter_drag_hotspot_IN(h_x, h_y);
    }
    /*}}}*/
    /* ADD MOVE LISTENERS {{{*/
    add_tool_pointermove_listener(caller);
    /*}}}*/
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*_ onDown_4_TOOL_DRAG_PUSH_PIN {{{*/
let onDown_4_TOOL_DRAG_PUSH_PIN = function(e)
{
/*{{{*/
    let caller = "onDown_4_TOOL_DRAG_PUSH_PIN";
let log_this   = LOG_MAP.T4_PIVOT || LOG_MAP.EV1_DOWN;

if( log_this) log("%c"+caller, lbH+lf4);
/*}}}*/
    /* PIN [pivot_PANEL] or UNPIN A PINNED PANEL {{{*/
    let pinned = onWork_PANEL.classList.contains(CSS_PINNED);

/*{{{
logBIG("...pivot_PANEL_changed_since_onDown=["+ pivot_PANEL_changed_since_onDown +"]")
logXXX("........................pivot_PANEL=["+ get_n_lbl(pivot_PANEL )          +"]");
logXXX(".......................onWork_PANEL=["+ get_n_lbl(onWork_PANEL)          +"]");
logXXX(".............................pinned=["+pinned                            +"]");
logXXX("..........................classList=["+ onWork_PANEL.classList           +"]");
}}}*/

    if(!pinned && pivot_PANEL_changed_since_onDown) return;
    /*}}}*/
    /* [pinned] TOGGLE {{{*/
if(log_this) console.dir(onWork_PANEL);

    /* PINNED / NOT PINNED */
    pinned = !pinned;
    t_set_CSS_PINNED(onWork_PANEL, pinned);

    /* STORE PANEL PINNED STATE */ /* (ONLY FOR TRANSCRIPT 1 AND 2) TODO... what about other panels */
    if(onWork_PANEL == transcript1) prop_set("transcript1_pinned", pinned);
    if(onWork_PANEL == transcript2) prop_set("transcript2_pinned", pinned);
    t_store_update_post(caller);

    /* FLASH UNPINNED PANELS .. f(PUSH_PIN) */
    t_flash_unpinned_panels(caller);

    /* PINNING PIVOT PANEL .. set last as the new pivot_PANEL */
    if(pinned && (onWork_PANEL == pivot_PANEL))
    {
        let last_panel_idx = t_get_TOOL_panels_last_selected_not_pinned_idx();
        t_set_pivot_PANEL(               (last_panel_idx > 0)
                            ? TOOL_panels[last_panel_idx]
                            : null
                         );
    }

    /* ADJUST POSITION */
    onWork_PANEL.style.transformOrigin = "98% 52% 0"; /* near push_pin */
    onWork_PANEL.style.position = pinned ? "fixed" : prop_get( TOOLS_SCROLL ) ? "absolute": "fixed";

    /*}}}*/
    /* 1/2 UNGROUP JUST-PINNED TOOL {{{*/
    if(pinned) {
if(log_this) log("UNGROUP JUST-PINNED TOOL", lb4);
        if( prop_get( TOOLS_SCROLL ) ) {

            let x = onWork_PANEL.offsetLeft - window.scrollX;
            let y = onWork_PANEL.offsetTop  - window.scrollY;

            onWork_PANEL.style.left = x+"px";
            onWork_PANEL.style.top  = y+"px";
        }
        onWork_PANEL.style.zIndex = ZINDEX_PINNED_PANEL_ZERO + onWork_PANEL.tool_rank;
/*{{{
t_log_panel_style_zIndex(onWork_PANEL, caller+" [UNGROUP JUST-PINNED TOOL]");
}}}*/
        t_set_onWork_EL(onWork_PANEL);
/* TODO (180313) removed while tuning t_touching_a_scrollable_panel
*/
    }
    /*}}}*/
    /* 2/2 REGROUP JUST-UNPINNED TOOL {{{*/
    else {
if( log_this) log("REGROUP UNPINNED TOOL", lb4);
if( log_this) t_log_event_status(caller, lf5);

        if( onWork_PANEL )
        {
            t_set_has_moved("REGROUP JUST-UNPINNED TOOL");
            add_el_class(dom_tools_html, CSS_REGROUPING);
/*{{{
for(let i=1; i < TOOL_panels.length; ++i) logBIG(i+" "+get_id_or_tag(TOOL_panels[i]), lf5)
}}}*/

            let work_panel_idx = TOOL_panels.indexOf( onWork_PANEL );
/*{{{
logBIG("...work_panel_idx=["+ work_panel_idx +"] ["+ get_id_or_tag(TOOL_panels[ work_panel_idx ]) +"]", lf2)
}}}*/

            let last_panel_idx = t_get_TOOL_panels_last_selected_not_pinned_idx();
/*{{{
logBIG("...last_panel_idx=["+ last_panel_idx +"] ["+ get_id_or_tag(TOOL_panels[ last_panel_idx ]) +"]", lf8)
}}}*/

            /* RE-ORDER PANELS .. (onWork_PANEL shifted to the end) */
            if(       work_panel_idx < last_panel_idx) {
/*{{{
logXXX("shifting onWork_PANEL to the end");
}}}*/
                while(work_panel_idx < last_panel_idx) TOOL_panels[ work_panel_idx ] = TOOL_panels[ ++work_panel_idx ];
                /*..................................*/ TOOL_panels[ last_panel_idx ] = onWork_PANEL;
/*{{{
for(let i=1; i < TOOL_panels.length; ++i) logBIG(i+" "+get_id_or_tag(TOOL_panels[i]), lf6)
}}}*/
            }

            t_set_spread_ratio_up_to_panel(onWork_PANEL);

            t_set_pivot_PANEL(onWork_PANEL);

            /* UPDATE REGROUPED PANELS LAYOUT */
            t_tool_set_top_xy(caller, topTool.x, topTool.y);
        }
    }
    /*}}}*/
};
/*}}}*/
/*_ onDown_5_TOOL_SEEKER_TO_HIDE {{{*/
let onDown_5_TOOL_SEEKER_TO_HIDE = function(e)
{
/* {{{*/
let caller = "onDown_5_TOOL_SEEKER_TO_HIDE";
let log_this   = LOG_MAP.EV1_DOWN;

if( log_this) t_log_event_status(caller, lf5);
    if( !t_is_a_tool_el(onWork_EL) ) return "";
/*}}}*/

    let consumed_by = "ON TOOL ["+get_id_or_tag(onWork_EL)+"] .. SEEK TOOL ["+get_n_lbl(onWork_SEEK_TOOL)+"]";

    t_seeker_PU_hide("instant");

/*{{{
logXXX("consumed_by=["+consumed_by+"]");
}}}*/
    return consumed_by;
};
/*}}}*/
/* add_page_pointermove_listener */
/*_ onDown_6_DOC_SELECT_OR_SEEK {{{*/
let onDown_6_DOC_SELECT_OR_SEEK = function(e)
{
/* {{{*/
let   caller = "onDown_6_DOC_SELECT_OR_SEEK";
if(!is_a_DOM_LOAD_featured_function(caller)) return "";
let log_this = LOG_MAP.T4_PIVOT || LOG_MAP.EV1_DOWN;

if( log_this) t_log_event_status(caller, lf6);
    let consumed_by = "";
/*}}}*/
/*{{{
logBIG("SELECT WORD: t_seeker_PU_is_active()...................=["+ t_seeker_PU_is_active()                 +"]")
logBIG("...onWork_EL=["+get_id_or_tag(onWork_EL)+"]")
}}}*/
    /* SELECT WORD {{{*/
/*{{{
logXXX("SELECT WORD: anchor_freeze..............................=["+ prop_get( ANCHOR_FREEZE )                  +"]");
logXXX("SELECT WORD: t_preventDefault_has_been_called(caller)...=["+ t_preventDefault_has_been_called(caller) +"]");
logXXX("SELECT WORD: onWork_EL.tagName..........................=["+ onWork_EL.tagName                        +"]");
}}}*/
    if(!consumed_by && prop_get( ANCHOR_FREEZE ) && !t_preventDefault_has_been_called(caller))
    {
        consumed_by = "SELECT WORD";

        if(onWork_EL.tagName == "A")
        {
            consumed_by += " .. (ANCHOR FREEZED)";
            t_preventDefault(e, consumed_by);
        }
        else if(get_el_event_handler(onWork_EL, caller) != null)
        {
            consumed_by += ".. (EVENT HANDLER FREEZED)";
            t_preventDefault(e, consumed_by);
        }
        else {
            let msg     = caller+": SELECT WORD .. ("+get_n_lbl(onWork_EL)+" HAS NO EVENT HANDLER)";
            t_acceptBubble(e, msg);
        }
    }
    /*}}}*/
    /* SEEK TOOL {{{*/
    if(!consumed_by && onWork_SEEK_TOOL)
    {
        consumed_by += "SEEK TOOL ["+get_n_lbl(onWork_SEEK_TOOL)+"]";
        add_page_pointermove_listener( caller );

        add_long_press_listener("ON DOWN DOC TOOL");
    }
    /*}}}*/
if( log_this && consumed_by) logBIG(consumed_by, lf6);
    return consumed_by;
};
/*}}}*/
/*_ onDown_7_STALL .. handler .. is_pending {{{*/
/*{{{*/
const MOVE_ON_STALL_DURATION = 500;
let   move_on_stall_timer    = null;

/*}}}*/
let onDown_7_STALL = function()
{
/* {{{*/
let   caller = "onDown_7_STALL";
let log_this = LOG_MAP.T4_PIVOT || LOG_MAP.EV1_DOWN;

if( log_this) log("%c"+caller, lb7);
/*}}}*/
    if(move_on_stall_timer) clearTimeout(move_on_stall_timer);
    move_on_stall_timer   =   setTimeout(onDown_7_STALL_handler, MOVE_ON_STALL_DURATION);
};
let onDown_7_STALL_handler = function()
{
/*{{{
logXXX("...onDown_7_STALL_handler");
t_log_event_status("onDown_7_STALL: TODO .. why has_moved should be freezed when this is called-for ?");
}}}*/
    /* restart from there, after a stall interval */
    move_on_stall_timer = null;
/*{{{
    onDown_XY.x         = 0;
    onDown_XY.y         = 0;
}}}*/
    t_check_on_seeker_clear("onDown_7_STALL_handler");
};
let onDown_7_STALL_is_pending = function()
{
/*{{{
if(move_on_stall_timer != null) logXXX("onDown_7_STALL_is_pending");
}}}*/
    return (move_on_stall_timer != null);
};
let onDown_7_STALL_cancel  = function()
{
    move_on_stall_timer = null;
};
/*}}}*/

/*_ t_touching_a_scrollable_panel {{{*/
let t_touching_a_scrollable_panel = function(panel)
{
    let result
        = behavior_TOUCH_ELSE_DESKTOP
        && (onWork_PANEL == transcript2)
        && (onWork_EL    == transcript2)
/*      && (onWork_PANEL.scrollHeight > onWork_PANEL.clientHeight)*/
    ;

/*{{{
logXXX("t_touching_a_scrollable_panel("+get_n_lbl(onWork_PANEL)+" .. "+get_n_lbl(onWork_EL)+"): ...return "+result);
logXXX("...scrollHeight=["+onWork_PANEL.scrollHeight+"]");
logXXX("...offsetHeight=["+onWork_PANEL.offsetHeight+"]");
logXXX("...clientHeight=["+onWork_PANEL.clientHeight+"]");
}}}*/
    return result;
};
/*}}}*/
/*_ t_set_body_style_overflow_hidden {{{*/
let t_set_body_style_overflow_hidden = function(hidden)
{
    document.body.style.overflow = (hidden ? "hidden" : "");
/*
     if(onWork_PANEL) onWork_PANEL.style.overflow = (hidden ? "auto" : "hidden");
*/
};
/*}}}*/
/*}}}*/
/* MOVE */
/*{{{*/
/* t_page_pointermove_drag {{{*/
/*{{{*/
const SELECT_NEXT_DURATION = 200;

const MOVE_GRAB           = "MOVE_GRAB";
const MOVE_NUM_NEXT       = "MOVE_NUM_NEXT";
const MOVE_NUM_PREV       = "MOVE_NUM_PREV";
const MOVE_SLOT_NEXT      = "MOVE_SLOT_NEXT";
const MOVE_SLOT_PREV      = "MOVE_SLOT_PREV";

let mousemove_consumed_by = "";
let onMove_selection_removed;
/*}}}*/
/*_ t_page_pointermove_drag {{{*/
let t_page_pointermove_drag = function(e)
{
/* log {{{ */
let   caller =    "t_page_pointermove_drag";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

    if(!onWork_EL                                      ) return false; /* moving element .. none */
    if(!onWork_EL.id                                   ) return false; /* moving element .. unknown */
    if(!onWork_SEEK_TOOL && !(onWork_EL == target_tool)) return false; /* moving element .. not at document-level */
/*}}}*/
if(!log_this) log_this = onDown_CTRL;
    /* update onMoveDXY {{{*/
        get_onMoveDXY(e, caller);

    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    let                consumed_by = "";                       let  log_css = lbF;
    if(!consumed_by) { consumed_by = onMove_0_MULTITOUCH       (e); log_css = lb9; }
    if(!consumed_by) { consumed_by = onMove_1_ON_COOLDOWN      (e); log_css = lb1; }
    if(!consumed_by) { consumed_by = onMove_4_MUST_MOVE_MORE   (e); log_css = lb2; }
    if(!consumed_by) { consumed_by = onMove_5_GRAB_SELECTION   (e); log_css = lb5; }
    if(!consumed_by) { consumed_by = onMove_6_GRAB_TARGET      (e); log_css = lb5; }
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* consumed_by {{{*/
if( log_this && (mousemove_consumed_by != consumed_by)) log("%c "+caller+": %c "+consumed_by, lb7, log_css);

    mousemove_consumed_by = consumed_by;
    /*}}}*/
};
/*}}}*/
/*_ set_seek_grab_done {{{*/
let     seek_grab_done = false;
let set_seek_grab_done= function(state)
{
    seek_grab_done = state;
};
/*}}}*/
/*}}}*/
/*  t_tool_pointermove_drag {{{*/
let t_tool_pointermove_drag = function(e)
{
if(e.ctrlKey) {logXXX("MOVE IGNORED .. f(e.ctrlKey)"); return; }
/*{{{*/
let   caller = "t_tool_pointermove_drag";
let log_this = LOG_MAP.EV2_MOVE;

/*{{{
if( log_this) t_log_event_status(caller, lf2);
}}}*/
/*}}}*/
    /* onMove_selection_removed {{{*/
    if( !onMove_selection_removed )
    {
        t_window_getSelection_removeAllRanges(caller);
        onMove_selection_removed = true;
    }
    /*}}}*/
    /* [onWork_EL] not selected {{{*/
    if(!onWork_EL) return;

    /* onWork_PANEL new CENTER */
    get_onMoveDXY(e, caller);

    let x = onDown_XY.x + onMoveDXY.x;
    let y = onDown_XY.y + onMoveDXY.y;

    /* indirect hotspot dragging */
    if(onWork_PANEL == hotspot)
    {
/*{{{
        if( t_seeker_PU_is_active() ) t_seeker_PU_hide("instant");
}}}*/

        x -= onDown_XY.x - onDown_PANEL_XY.x;
        y -= onDown_XY.y - onDown_PANEL_XY.y;
        if( hotspot.style.transform != "") {
            x -= onDown_XY.x - onDown_PANEL_XY.x;
            y -= onDown_XY.y - onDown_PANEL_XY.y;
        }
    }

    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    let                consumed_by = "";                                       let log_css =  "";
    if(!consumed_by) { consumed_by = onMove_0_MULTITOUCH       (e           );     log_css = lb9; }
    if(!consumed_by) { consumed_by = onMove_1_TARGET_TOOL_SEEK (e           );     log_css = lb1; }
    if(!consumed_by) { consumed_by = onMove_2_TARGET_TOOL_MOVE (e,          );     log_css = lb2; }
    if(!consumed_by) { consumed_by = onMove_3_DIV_MAGNIFY      (e           );     log_css = lb3; }
    if(!consumed_by) { consumed_by = onMove_4_MUST_MOVE_MORE   (e           );     log_css = lb4; }
    if(!consumed_by) { consumed_by = onMove_5_GRAB_TOOL_PANEL  (e, x, y     );     log_css = lb5; }
    if(!consumed_by) { consumed_by = onMove_6_GRAB_TOOL_CHILD  (e, x, y     );     log_css = lb6; }
    if(!consumed_by) { consumed_by = "DRAGGING ["+get_n_lbl    (onWork_PANEL)+"]"; log_css = lb7;
        /*{{{*/
        if(onWork_PANEL) {
            /* FLASH UNPINNED PANELS */
            if(   !t_raise_pivot_PANEL_called_since_onDown(caller)
                && is_a_spread_drag()
            ) {
                t_flash_unpinned_panels(caller);
            }

            if(onWork_PANEL == hotspot)
            {
                t_tool_pointermove_drag_hotspot(x,y);
            }
            else {
                t_set_pivotXY( onMove_pivotXY.x + onMoveDXY.x
                    ,          onMove_pivotXY.y + onMoveDXY.y);
                t_tool_set_top_xy(caller, topTool.x, topTool.y);
            }
        }
        /*}}}*/
    }
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* consumed_by {{{*/
if( log_this && (mousemove_consumed_by != consumed_by)) log("%c "+caller+": %c "+consumed_by, lb9, log_css);

    mousemove_consumed_by = consumed_by;
    /*}}}*/
};
/*}}}*/

/* HOTSPOT */
/*  t_tool_pointermove_drag_hotspot {{{*/
let t_tool_pointermove_drag_hotspot = function(x,y)
{
/*{{{*/
let   caller = "t_tool_pointermove_drag_hotspot";
let log_this = LOG_MAP.EV2_MOVE;

if( log_this) log(caller);
/*}}}*/
    t_tool_set_panel_xy(hotspot, x, y);
    /* DRAG [hotspot] INTO GUTTER .. SHOW [seekzone] .. [add_long_press_listener] {{{*/
/*{{{
logXXX("...is_long_press_pending()=["+ is_long_press_pending()                  +"]");
logXXX("....t_gutter_is_XY_IN(x,y)=["+ t_gutter_is_XY_IN(x,y)                 +"]");
}}}*/
    if(t_gutter_is_XY_IN(x, y))
    {
        if(!has_el_class(seekzone, CSS_GUTTER) )
            t_gutter_drag_hotspot_IN(x,y);

        add_long_press_listener("ON MOVE [hotspot] IN GUTTER");
    }
    /*}}}*/
    /* [hotspot] IS IN GUTTER {{{*/
    else if( has_el_class(seekzone, CSS_GUTTER) )
    {
        /* [hotspot] STILL IN GUTTER .. UPDATE IN-GUTTER-POSITION {{{*/
        if( t_gutter_is_XY_IN(x, y) ) {
            t_gutter_save_last_hotspot_GUTTER_XY(x,y);
        }
        /*}}}*/
        /* DRAG [hotspot] OFF GUTTER .. HIDE [seekzone] {{{*/
        else {
            if( log_this) log("%c OFF  GUTTER %c HIDE [seekzone]"
                              ,lbb+lbH+lf7 ,lbH                );

            del_el_class(seekzone, CSS_GUTTER);
            t_seekzone4_hide_handler();

            if(   has_moved && (onWork_PANEL == hotspot)
               && prop_get( EDIT_OR_STAGE )
              )
                prop_set(   EDIT_OR_STAGE, false); /* EDITING DONE */
        }
        /*}}}*/
    }
    /*}}}*/
    /* DRAG [pivspot] .. f( TOOLS_TRAP ) {{{*/
    let dragging_pivspot = prop_get( TOOLS_TRAP );
    if( dragging_pivspot )
    {
        let move_x = false;
        let move_y = false;

        let margin = h_W / 2;
        if     ((onDown_XY_sign.x >  0) && ((x+margin) >  pivotXY.x)) { onMove_pivotXY.x = x+margin; onMoveDXY.x = 0; move_x = true; }
        else if((onDown_XY_sign.x <= 0) && ((x-margin) <= pivotXY.x)) { onMove_pivotXY.x = x-margin; onMoveDXY.x = 0; move_x = true; }

        if     ((onDown_XY_sign.y >  0) && ((y+margin) >  pivotXY.y)) { onMove_pivotXY.y = y+margin; onMoveDXY.y = 0; move_y = true; }
        else if((onDown_XY_sign.y <= 0) && ((y-margin) <= pivotXY.y)) { onMove_pivotXY.y = y-margin; onMoveDXY.y = 0; move_y = true; }

        if(move_x || move_y)
            t_set_pivotXY( move_x ? onMove_pivotXY.x : pivotXY.x
                ,          move_y ? onMove_pivotXY.y : pivotXY.y);
    }
    /*}}}*/
    t_tool_set_top_xy(caller, x, y);
};
/*}}}*/
/* DOC & TOOL */
/*_ onMove_0_MULTITOUCH {{{*/
let onMove_0_MULTITOUCH = function(e)
{

    let    consumed_by = ((onDown_TOUCHES > 1) ? "MULTI-TOUCH x"+onDown_TOUCHES : "");
    return consumed_by;
};
/*}}}*/
/*_ onMove_1_ON_COOLDOWN {{{*/
let onMove_1_ON_COOLDOWN = function(e)
{
    let caller = "onMove_1_ON_COOLDOWN";

    let                                   consumed_by = "";
    if     ( scroll_not_done_yet()      ) consumed_by = "SCROLLING";
    else if( move_cooldown_is_pending() ) consumed_by = "MOVE COOLDOWN";

    if(consumed_by)
    {
        consumed_by += ".. (get_onDown_XY tracking)";

        get_onDown_XY(e, caller);
        onMoveDXY.x = 0;
        onMoveDXY.y = 0;
    }

/*{{{
logXXX(consumed_by);
}}}*/
    return consumed_by;
};
/*}}}*/
/* TOOL */
/*_ onMove_1_TARGET_TOOL_SEEK {{{*/
let onMove_1_TARGET_TOOL_SEEK = function(e)
{
/*{{{*/
let   caller = "onMove_1_TARGET_TOOL_SEEK";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

/*{{{
if( log_this) log("%c"+caller, lf1);
}}}*/
if(!mousemove_consumed_by && log_this) t_target_tool_log(target_tool, lf1);
/*{{{
if(               target_tool  != onWork_EL    ) return;
if(!has_el_class( target_tool, CSS_SEEK_TARGET)) return;
}}}*/
    let dismissed_by
        = (target_tool  != onDown_EL                     ) ?              "(target_tool != onDown_EL)"
        : (!has_el_class( target_tool, CSS_SEEK_TARGET)  ) ? "!has_el_class(target_tool  , CSS_SEEK_TARGET)"
        : ( has_el_class( target_tool, CSS_LIFTED     )  ) ? "!has_el_class(target_tool  , CSS_SEEK_TARGET)"
        : (               target_tool.clicked == "handle") ? "target_tool.clicked=["+target_tool.clicked+"]"
        :                                                  ""
    ;

    if(dismissed_by) {
if( log_this && !mousemove_consumed_by) log("%c"+caller+"%c dismissed_by %c"+dismissed_by, lf4, lbA, lf9);

        return "";
    }

if( log_this && !mousemove_consumed_by) t_log_event_status(caller, lf1);
if( log_this && !mousemove_consumed_by) t_target_tool_log(target_tool);

    let consumed_by = caller+" "+target_tool.id;
/*}}}*/
    /* CLEAR PAGE SELECTION {{{*/
    t_window_getSelection_removeAllRanges(caller);

    /*}}}*/
    /* MOVE [seeker_PU] on [target_tool] {{{*/
    consumed_by = caller+" "+target_tool.id;

    t_move_seeker_PU_on_target_tool(target_tool);
    /*}}}*/
if(!mousemove_consumed_by && log_this) log(caller+": consumed_by=["+consumed_by+"]");
    return consumed_by;
};
/*}}}*/
/*_ onMove_2_TARGET_TOOL_MOVE {{{*/
/*{{{*/
let target_tool_H;
let target_tool_W;

/*}}}*/
let onMove_2_TARGET_TOOL_MOVE = function(e)
{
/*{{{*/
let   caller = "onMove_2_TARGET_TOOL_MOVE";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

    if(onWork_EL   != target_tool) return false;

    log_this &= !mousemove_consumed_by; /* FIRST MOVE ONLY */

if( log_this) t_log_event_status(caller, lf2);
if( log_this) t_target_tool_log(target_tool, "MOVING", lf7);
/*}}}*/
    /* HIDE seeker_PU {{{*/
/*{{{
log_key_val_group( caller
                   , { seeker_PU_classList_contains_hiding : seeker_PU.classList.contains("hiding")
                     , seeker_PU_style_display             : seeker_PU.style.display
                   }, lf2, false);
}}}*/
    if( t_seeker_PU_is_active() )
    {
if(log_this) log("HIDE seeker_PU");

        t_seeker_PU_hide("instant");
    }
    /*}}}*/
    /* LIFTED PAD .. CYCLE POINTING DIR {{{*/
    let consumed_by;
    if((target_tool.clicked == "pad") && has_el_class(target_tool, CSS_LIFTED) )
    {
        /* ON COOLDOWN .. IGNORE MOUSE {{{*/
        consumed_by = target_tool.id +"."+CSS_LIFTED;

        if( move_cooldown_is_pending() )
        {
            get_onDown_XY(e, caller);
        }
        /*}}}*/
        /* COOLDOWN DONE .. TRACK MOUSE {{{*/
        else {
            t_check_has_moved(onMoveDXY.x, onMoveDXY.y, caller);
            if(has_moved)
            {
                let  dir = (Math.abs(onMoveDXY.x) > Math.abs(onMoveDXY.y)) ? ((onMoveDXY.x > 0) ? "RIGHT" : "LEFT")
                    :                                                        ((onMoveDXY.y > 0) ?  "DOWN" : "UP"  );
/*{{{
logBIG(dir, lf7);
}}}*/
                t_target_tool_cycle_dir_class(target_tool, dir);

                move_cooldown_start();
                onMoveDXY.x = 0;
                onMoveDXY.y = 0;
            }
        }
        /*}}}*/
    }
    /*}}}*/
    /* OR .. MOVE [target_tool] {{{*/
    if(!consumed_by) {
        /* LIFT TARGETS ON FIRST MOVE {{{*/
/*{{{
        if(!has_el_class(target_tool, CSS_LIFTED) )
            t_target_tool_set_lifted(true);
}}}*/

        /*}}}*/
        /* TARGET PAGE COORDINATES {{{*/
        let x = onDown_TOOL_XY.x + onMoveDXY.x;
        let y = onDown_TOOL_XY.y + onMoveDXY.y + target_tool_H/2;

        x = Math.max(x,                   onDown_SCROLL_XY.x      );
        x = Math.min(x,                   onDown_SCROLL_XY.x + w_W);
        y = Math.max(y - target_tool_H/2, onDown_SCROLL_XY.y      );
        y = Math.min(y - target_tool_H/2, onDown_SCROLL_XY.y + w_H);

        target_tool.style.left = x+"px";
        target_tool.style.top  = y+"px";

        /*}}}*/
        /* CLIP TO VIEWPORT {{{*/
        if(target_tool.style.position != "fixed")
        {
            x -= onDown_SCROLL_XY.x;
            y -= onDown_SCROLL_XY.y;
        }

        if(!target_tool_H) {
            target_tool_H = target_tool.offsetHeight;
            target_tool_W = target_tool.offsetWidth;
        }
        let x_min = target_tool_W; let x_max = w_W -   target_tool_W;
        let y_min = target_tool_H; let y_max = w_H - 2*target_tool_H;

        let nearing_T = (y <= y_min);
        let nearing_L = (x <= x_min);
        let nearing_B = (y >= y_max);
        let nearing_R = (x >= x_max);

        /*}}}*/
        /* FLIP POINTING DIRECTION NEAR BORDERS {{{*/
        if(nearing_T || nearing_L || nearing_B || nearing_R)
        {
            /* check current pointing direction {{{*/
            let pointing_X = target_tool.className.includes("point_");
            let pointing_N
                =   pointing_X
                && !has_el_class(target_tool, CSS_POINT_SE)
                && !has_el_class(target_tool, CSS_POINT_SW)
            ;
            let pointing_E
                =   pointing_X
                && !has_el_class(target_tool, CSS_POINT_SW)
                && !has_el_class(target_tool, CSS_POINT_WW)
                && !has_el_class(target_tool, CSS_POINT_NW)
            ;

            /*}}}*/
            /* [new direction] {{{*/
            let switching_N = !pointing_N && nearing_B;
            let switching_E = !pointing_E && nearing_L;
            let switching_S =  pointing_N && nearing_T;
            let switching_W =  pointing_E && nearing_R || !pointing_X; /* start from there */

            if(   switching_N
               || switching_E
               || switching_S
               || switching_W
              )
                t_set_target_tool_pointing(target_tool, pointing_E, pointing_N, switching_N, switching_S, switching_E, switching_W);

            /*}}}*/
        }
        /*}}}*/
        onMove_2_TARGET_TOOL_MOVE_ONGRID();
    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*_ onMove_2_TARGET_TOOL_MOVE_ONGRID {{{*/
/*{{{*/
let TARGET_PIN_RESOLUTION =  32;
let TARGET_PIN_DELAY      = 150;

let onMove_2_TARGET_TOOL_MOVE_ONGRID_timer;
/*}}}*/
/*_ onMove_2_TARGET_TOOL_MOVE_ONGRID {{{*/
let onMove_2_TARGET_TOOL_MOVE_ONGRID = function()
{
    if(onMove_2_TARGET_TOOL_MOVE_ONGRID_timer) clearTimeout(onMove_2_TARGET_TOOL_MOVE_ONGRID_timer);
    onMove_2_TARGET_TOOL_MOVE_ONGRID_timer =     setTimeout(onMove_2_TARGET_TOOL_MOVE_ONGRID_handler, TARGET_PIN_DELAY);
};
/*}}}*/
/*_ onMove_2_TARGET_TOOL_MOVE_ONGRID_handler {{{*/
let onMove_2_TARGET_TOOL_MOVE_ONGRID_handler = function()
{
    let x = target_tool.offsetLeft;
    let y = target_tool.offsetTop;

    x = TARGET_PIN_RESOLUTION * Math.floor((x + TARGET_PIN_RESOLUTION / 2) / TARGET_PIN_RESOLUTION);
    y = TARGET_PIN_RESOLUTION * Math.floor((y + TARGET_PIN_RESOLUTION / 2) / TARGET_PIN_RESOLUTION);

    target_tool.style.left = x+"px";
    target_tool.style.top  = y+"px";
};
/*}}}*/
/*}}}*/
/*_ onMove_3_DIV_MAGNIFY {{{*/
let onMove_3_DIV_MAGNIFY = function(e)
{
/* [!div_slot_containers] {{{*/
let   caller = "onMove_3_DIV_MAGNIFY";
    if( !div_slot_containers_displayed() ) return "";

    if(!div_slot_containers) return "";

    let consumed_by = get_id_or_tag(onWork_EL);
    t_preventDefault(e, caller+" "+consumed_by);
/*}}}*/
    /* ON COOLDOWN .. IGNORE MOUSE {{{*/
    if(move_cooldown_is_pending() )
    {
        get_onDown_XY(e, caller);
    }
    /*}}}*/
    /* COOLDOWN DONE .. TRACK MOUSE {{{*/
    else {
        t_check_has_moved(onMoveDXY.x, onMoveDXY.y, caller);
        if(has_moved) {
            /* HORIZONTAL .. button_PREV button_NEXT {{{*/
            let  dir = (Math.abs(onMoveDXY.x) > Math.abs(onMoveDXY.y)) ? ((onMoveDXY.x > 0) ?    "PREV" : "NEXT"    )
                :                                                        ((onMoveDXY.y > 0) ? "ZOOM_IN" : "ZOOM_OUT");
/*{{{
logBIG(dir, lf7);
}}}*/

            if((dir == "PREV") || (dir == "NEXT"))
            {
                t_slot_container_set_fullscreen((dir == "PREV") ? button_PREV : button_NEXT);
            }
            /*}}}*/
            /* VERTICAL .. slot_container_magnified_0_to_9 {{{*/
            else {
                let value = (dir == "ZOOM_IN") ? 1 : -1;
                if( value ) {
                    value += slot_container_magnified_0_to_9;
                    value  = Math.max(value, 0);
                    value  = Math.min(value, 9);
                    if( slot_container_magnified_0_to_9 != value) {
                        slot_container_magnified_0_to_9  = value;
                        t_slot_containers_magnify();
                    }
                }
            }
            /*}}}*/
            /* MOVE COOLDOWN {{{*/
            move_cooldown_start();
            onMoveDXY.x = 0;
            onMoveDXY.y = 0;
            /*}}}*/
        }
    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/* DOC & TOOL */
/*_ onMove_4_MUST_MOVE_MORE {{{*/
let onMove_4_MUST_MOVE_MORE = function(e)
{
/* [has_moved] {{{*/
let caller = "onMove_4_MUST_MOVE_MORE";

    if(has_moved && is_long_press_pending())
        del_long_press_listener(caller);

    if(has_moved) return "";
/*}}}*/
/*{{{*/
let log_this = (LOG_MAP.EV0_LISTEN || logging_EVENTS || LOG_MAP.EV2_MOVE);
if(!log_this) log_this = onDown_CTRL;

if( log_this && !mousemove_consumed_by) t_log_event_status(caller, lf4);
/*}}}*/
    /* NOT FOR [hotspot] .. NO LAG {{{*/
    if(   (onWork_PANEL == hotspot)
       && (onWork_EL    == hotring)
    ) {
        if( !t_gutter_is_XY_IN(onDown_HSPOT_XY.x, onDown_HSPOT_XY.y) )
        {
            t_set_has_moved(caller+": no lag for [hotring] when not IN GUTTER");

            del_el_class(pivspot, CSS_HIDDEN);

            return ""; /* HAS MOVED ENOUGH */
        }
    }
    /*}}}*/
    /* YES WHILE SEEKING [target_tool] {{{*/
    if(onWork_EL == target_tool)
    {
        let dxy = Math.abs(onMoveDXY.x + onMoveDXY.y);
        if(dxy >= 3*MOVED_ENOUGH) {
/*{{{
t_log_event_status(caller+" .. [target_tool] .. dxy=["+dxy+"]");
}}}*/
            return "";
        }
        else {
            return  "NOT ENOUGH WHILE SEEKING [target_tool]";
        }
    }
    /*}}}*/
    /* NOT FOR [fly_div] .. NO LAG {{{*/
    if(onWork_PANEL == fly_div)
    {
/*
        t_set_has_moved(caller+": no lag for fly_div");
*/

        return ""; /* HAS MOVED ENOUGH */
    }
    /*}}}*/
    /* DOWN STALL: DISCARD SMALL MOVES {{{*/
    if( onDown_7_STALL_is_pending() )
    {
        let has_not_moved  = "MOVE ON STALL WAKEUP DELAY";

        has_not_moved     += ".. (get_onDown_XY tracking)";
        get_onDown_XY(e, caller);
        onMoveDXY.x       = 0;
        onMoveDXY.y       = 0;

        return has_not_moved;
    }
    /*}}}*/
    /* [t_check_has_moved] {{{*/
    if(!has_moved)
    {
        t_check_has_moved(onMoveDXY.x, onMoveDXY.y, "MOVE CHECK");
    }
    /*}}}*/
    /* HAS MOVED .. CLEAR LONG_PRESS .. [onWork_MOVABLE_CHILD] {{{*/
    if( has_moved )
    {
        if( is_long_press_pending() )
            del_long_press_listener("HAS MOVED "+has_moved);

        if(onWork_MOVABLE_CHILD) onMove_4_GRAB_PANEL_CHILD();

        return ""; /* HAS MOVED ENOUGH */
    }
    /*}}}*/
    return "HAS NOT MOVED ENOUGH";
};
/*}}}*/
/*_ onMove_4_GRAB_PANEL_CHILD {{{*/
/*{{{*/
let mov_src_div;
let mov_dst_div;
/*}}}*/
let onMove_4_GRAB_PANEL_CHILD = function()
{
/*{{{*/
let   caller = "onMove_4_GRAB_PANEL_CHILD";
let log_this = (LOG_MAP.S2_SELECT || LOG_MAP.EV2_MOVE);

/*}}}*/
    /* onWork_PANEL_magnified {{{*/
    if(onWork_EL.parentElement)
    {
        onDown_XY.x      -= onWork_EL.offsetLeft;
        onDown_XY.y      -= onWork_EL.offsetTop ;
        onDown_TOOL_XY.x -= onWork_EL.offsetLeft;
        onDown_TOOL_XY.y -= onWork_EL.offsetTop ;

        if(onWork_PANEL_magnified) {
            onDown_XY.x  -= onWork_EL.offsetLeft;
            onDown_XY.y  -= onWork_EL.offsetTop ;
        }
    }
    /*}}}*/
    /* parent_div offset {{{*/
    let parent_div  = get_el_parent_with_tag(onWork_EL,"DIV");
/*
    if( parent_div  == bak_bag) {
        onDown_XY.x -= bak_bag.offsetLeft * (onWork_PANEL_magnified ? 2 : 1);
        onDown_XY.y -= bak_bag.offsetTop  * (onWork_PANEL_magnified ? 2 : 1);
    }
*/
    /*}}}*/
    /* parent_div_has_movable_child {{{*/
    let parent_div_has_movable_child
        =  (parent_div == pat_bag)
        || (parent_div == off_bag)
        || (parent_div == bak_bag)
        || (parent_div == alt_bag)
    ;

    if(!parent_div_has_movable_child) return;
    /*}}}*/
    /* MOVE A BAG CHILD COPY */
    if(onWork_EL) t_clr_onWork_EL_pressed();
    onWork_EL = t_pat_bag9_grab_child( parent_div );

    t_set_onWork_EL_pressed();
};
/*}}}*/
/* PAGE SELECTION */
/*_ onMove_5_GRAB_SELECTION {{{*/
const WRAPSCAN = true;
let onMove_5_GRAB_SELECTION = function(e)
{
/*{{{*/
let   caller = "onMove_5_GRAB_SELECTION";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if( log_this) t_log_event_status(caller, lbH+lf5);
/*}}}*/
    /* REQUIRES CURRENT SLOT OR [last_highlight_slot] {{{*/
    let slot =  t_get_EL_slot(onWork_EL);
    if( slot <= 0) {
if( log_this) logBIG(caller+": slot=["+slot+"]", lbH+lf8);

/*{{{
        if( t_seeker_PU_is_active() ) t_seeker_PU_hide("instant");
}}}*/

        return;
    }
    if(!ccs[slot]) {
if( log_this) log(caller+": SLOT #"+slot+" NOT CURRENLTY INITIALIZED");
    if(t_preventDefault_caller) t_restoreDefault("NOT CURRENLTY INITIALIZED");
        return;
    }
    let consumed_by = "SCROLL TO [SLOT] [NUM]";
    /*}}}*/
    /* LONG PRESS dismiss {{{*/
    if( is_long_press_pending() )
        del_long_press_listener("PAGE DRAGGED");

    /*}}}*/
    /* GRAB SELECTION {{{*/
    if(!seek_grab_done)
    {
        if     (onWork_EL    == seeker_CU) { seek_grab_done  = true; }
        else if(onWork_PANEL == sel_bag  ) { seek_grab_done  = true; }
    }
/*{{{
log("%c _onWork_EL...........=["+ get_n_lbl(onWork_EL       ) +"]", lbb+lf5);
log("%c _onWork_PANEL........=["+ get_n_lbl(onWork_PANEL    ) +"]", lbb+lf5);
log("%c _onWork_SEEK_TOOL....=["+ get_n_lbl(onWork_SEEK_TOOL) +"]", lbb+lf5);
log("%c seek_grab_done.......=["+ seek_grab_done              +"]", lbb+lf5);
}}}*/
    /*}}}*/

    /* [dir] .. (horizontal..vertical) {{{*/
    let  dir = (!seek_grab_done                              ) ? (                    MOVE_GRAB                      )
        :      (Math.abs(onMoveDXY.x) > Math.abs(onMoveDXY.y)) ? ((onMoveDXY.x > 0) ? MOVE_NUM_NEXT  : MOVE_NUM_PREV )
        :                                                        ((onMoveDXY.y > 0) ? MOVE_SLOT_NEXT : MOVE_SLOT_PREV)
    ;

    /*}}}*/
    /* [slot] [num] .. (onWork_EL) .. (dir) {{{*/
    let  num =  t_get_onWork_EL_num ();
    switch(dir) {
        /* (slot.num) .. GRAB onWork_EL {{{*/
        default:
        case MOVE_GRAB:        { seek_grab_done = true; } break;
        /*}}}*/
        /* ( num - 1) .. UP {{{*/
        case  MOVE_NUM_NEXT:   { num +=  1;             } break;

        /*}}}*/
        /* ( num + 1) .. DOWN {{{*/
        case    MOVE_NUM_PREV: { num += -1;             } break;
        /*}}}*/
        /* (slot - 1) .. LEFT {{{*/
        case  MOVE_SLOT_PREV:  {
            let to_slot  = t_get_used_slot_dir(slot, -1);

            if( to_slot != slot) {
                let to_num  = ccs[to_slot].num_selected;
                t_seek_slot_num_JUMP_FROM_TO(slot, num, to_slot, to_num);
                slot       =                            to_slot;
                num        =                                     to_num;
            }
        }
        break;
        /*}}}*/
        /* (slot + 1) .. RIGHT {{{*/
        case MOVE_SLOT_NEXT: {
            let to_slot  = t_get_used_slot_dir(slot, +1);

            if( to_slot != slot) {
                let to_num  = ccs[to_slot].num_selected;
                t_seek_slot_num_JUMP_FROM_TO(slot, num, to_slot, to_num);
                slot        =                           to_slot;
                num         =                                    to_num;
            }
        }
        break;
        /*}}}*/
    }
    /*}}}*/
    /* [num] .. (wrapscan) {{{*/
    if( WRAPSCAN ) {
        num = 1 + (ccs[slot].nodes.length + (num-1)) % ccs[slot].nodes.length;
    }
    else {
        num = Math.min(ccs[slot].nodes.length, num);
        num = Math.max(1                     , num);
    }

    let to_slot_num_EL = ccs[slot].nodes[num-1];
    /*}}}*/

    /* SCROLL TO [slot] [num] {{{*/
    let quick_move;
    if((slot >= 0) && (num > 0))
    {
        if(!t_seeker_PU_is_active())
            t_seeker_PU_show();

        let visible = scroll_to_slot_num(slot, num, onSeekXYL);
        t_seeker_move_on_slot_num(slot, num, visible);

        /* COOLDOWN BETWEEN JUMPS .. (SHIFT == sqeeze move cooldown) */
        quick_move = has_el_class(seeker_PU, CSS_SEEK4_ONSEEKER);
        if( quick_move ) move_cooldown_short();
        else             move_cooldown_start();
    }
    /*}}}*/
    /*  NEXT [to_slot_num_EL] {{{*/
    if( onWork_EL    != to_slot_num_EL) {

        t_set_onWork_EL(to_slot_num_EL, caller);
    }
    /*}}}*/
/*{{{*/
if( log_this)
{
    consumed_by = "SCROLL TO [slot "+slot+"] [num "+num+"]";

    let lfx
        = (dir == MOVE_GRAB     ) ? lf8
        : (dir == MOVE_NUM_PREV ) ? lf3
        : (dir == MOVE_SLOT_NEXT) ? lf4
        : (dir == MOVE_NUM_NEXT ) ? lf5
        : (dir == MOVE_SLOT_PREV) ? lf6
        :                           lf8;

    log_key_val(  caller
                , {              dir : dir
                    ,           slot : slot
                    ,            num : num
                    ,      onMoveDXY : onMoveDXY.x+" "+onMoveDXY.y
                    ,     quick_move : quick_move
                    , from_onWork_EL : get_n_lbl( onWork_EL      )
                    , to_slot_num_EL : get_n_lbl( to_slot_num_EL )
                    , onWork_PANEL   : get_n_lbl( onWork_PANEL   )
                }
                , lbb+lfx
               );

}
/*}}}*/
if( log_this) logBIG(caller+" "+consumed_by, lbH+lf5);
    return consumed_by;
};
/*}}}*/
/* PAGE TARGET */
/*_ onMove_6_GRAB_TARGET {{{*/
let onMove_6_GRAB_TARGET = function(e)
{
/*{{{*/
let   caller = "onMove_6_GRAB_TARGET";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if(log_this) {
    t_log_event_status(caller, lf6);
    log_key_val( caller
                 , {   target_tool        : get_n_lbl(target_tool)
                     , onSeekXYL          : onSeekXYL
                     , CSS_SEEK2_ONRESUME : has_el_class(seeker_PU, CSS_SEEK2_ONRESUME)
                     , CSS_SEEK5_ONTARGET : has_el_class(seeker_PU, CSS_SEEK5_ONTARGET)
                 }, lf6
               );
}
/*}}}*/
    /* REQUIRES [target_tool] and [seek5_onTarget or seek2_onResume] {{{*/
    if(        !target_tool
        || (   !(onSeekXYL.label = CSS_SEEK5_ONTARGET)
            && !(onSeekXYL.label = CSS_SEEK2_ONRESUME))
      ) {

        return;
    }
    let consumed_by = onSeekXYL.label;
    /*}}}*/
/*{{{
logXXX(caller+": .. onMoveDXY=["+onMoveDXY.x+" "+onMoveDXY.y+"]");
}}}*/
    /* [dir] .. (horizontal..vertical) {{{*/
    let  dir = (!seek_grab_done                              ) ? (                    MOVE_GRAB                      )
        :      (Math.abs(onMoveDXY.x) > Math.abs(onMoveDXY.y)) ? ((onMoveDXY.x > 0) ? MOVE_NUM_NEXT  : MOVE_NUM_PREV )
        :                                                        ((onMoveDXY.y > 0) ? MOVE_SLOT_NEXT : MOVE_SLOT_PREV)
    ;
    ;

    /*}}}*/
    /* SCROLL TO NEXT TARGET .. (dir) {{{*/
    switch(dir)
    {
    default:
    case MOVE_GRAB     : { t_seek_next_target_tool(target_tool, 0); seek_grab_done = true; } break;
    case MOVE_NUM_NEXT : { t_seek_next_target_tool(target_tool,+1);                        } break;
    case MOVE_NUM_PREV : { t_seek_next_target_tool(target_tool,-1);                        } break;
    case MOVE_SLOT_PREV: { t_seek_next_target_tool(target_tool,-1);                        } break;
    case MOVE_SLOT_NEXT: { t_seek_next_target_tool(target_tool,+1);                        } break;
    }

    /* COOLDOWN BETWEEN JUMPS .. (SHIFT == sqeeze move cooldown) */
    let quick_move
        =  has_el_class(seeker_PU, CSS_SEEK4_ONSEEKER)
        || prop_get(TOOLS_EXTRAS);

    if( quick_move ) move_cooldown_short();
    else             move_cooldown_start();
/*}}}*/
/*{{{*/
if( log_this)
{
    let lfx
        = (dir == MOVE_GRAB     ) ? lf2
        : (dir == MOVE_NUM_PREV ) ? lf3
        : (dir == MOVE_SLOT_NEXT) ? lf4
        : (dir == MOVE_NUM_NEXT ) ? lf5
        : (dir == MOVE_SLOT_PREV) ? lf6
        :                           lf8;

    log_key_val(  caller
                , {              dir : dir
                    ,      onMoveDXY : onMoveDXY.x+" "+onMoveDXY.y
                    ,     quick_move : quick_move
                    ,    target_tool : get_n_lbl( target_tool )
                }
                , lbb+lfx
               );

    consumed_by += " ["+get_n_lbl(target_tool)+"]";
}
/*}}}*/
if(log_this) log("%c"+consumed_by, lbb+lbH+lf6);
    return consumed_by;
};
/*}}}*/
/* TOOL PANEL */
/*_ onMove_5_GRAB_TOOL_PANEL {{{*/
let onMove_5_GRAB_TOOL_PANEL = function(e,x,y)
{
/*{{{*/
let   caller = "onMove_5_GRAB_TOOL_PANEL";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if( onWork_MOVABLE_CHILD) return "";
if(!onWork_PANEL        ) return "";

/*{{{
if( log_this) log("%c"+caller, lbH+lf5);
}}}*/
let consumed_by = "";
/*}}}*/
    /* PANELS WITH SCROLLABLE CONTENT {{{*/
    if(!consumed_by && t_touching_a_scrollable_panel())
    {
        if( !has_el_class(onWork_PANEL, CSS_EMPTY) )
            consumed_by = "SCROLLABLE PANEL ["+get_n_lbl(onWork_PANEL)+"]";

    }
    /*}}}*/
    /* MOVE A PINNED PANEL {{{*/
    if(!consumed_by && onWork_PANEL.classList.contains(CSS_PINNED))
    {
        onMove_5_TOOL_PANEL_PINNED(x, y);
        consumed_by = "TOOL PINNED ["+get_n_lbl(onWork_PANEL)+"]";
    }
    /*}}}*/
    /* UNHIDE PANELS [pivspot] .. f(!pinned) {{{*/
    if(!consumed_by && !onWork_PANEL.classList.contains(CSS_PINNED))
    {
        let moving_a_panel
            =                               onWork_PANEL
            &&                             !onWork_MOVABLE_CHILD
            && !is_el_or_child_of_parent_el(onWork_EL, fly_div)
        ;

        if( moving_a_panel ) del_el_class(pivspot, CSS_HIDDEN);
    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*_ onMove_5_TOOL_PANEL_PINNED {{{*/
let onMove_5_TOOL_PANEL_PINNED = function(x,y)
{
    /* {{{*/
    let caller = "onMove_5_TOOL_PANEL_PINNED";

    /*}}}*/
    /* dismiss long press timer on big move {{{*/
    if( is_long_press_pending() )
    {
        if( t_check_big_moved(onMoveDXY.x, onMoveDXY.y, caller) )
            del_long_press_listener("MOVE PINNED");

    }
    /*}}}*/
    /* KEEPING MOVED [fly_div] PANEL ON SCREEN {{{*/
    if( is_el_or_child_of_parent_el(onWork_EL, fly_div) )
    {
        if(t_log_clr_innerHTML_is_pending())
            t_fly_clr_cancel();

        t_add_closepin_on_panel( fly_div );
    }
    /*}}}*/
    /* move pinned {{{*/

    x -= onDown_XY.x - onDown_PANEL_XY.x;
    y -= onDown_XY.y - onDown_PANEL_XY.y;

    let x_min =       (  BOX_MARGIN) - onWork_PANEL.offsetWidth;
    let x_max = w_W - (2*BOX_MARGIN);
    let y_min =       (  BOX_MARGIN) - onWork_PANEL.offsetHeight;
    let y_max = w_H - (2*BOX_MARGIN);

    x = (x < x_min) ? x_min : (x > x_max) ? x_max : x;
    y = (y < y_min) ? y_min : (y > y_max) ? y_max : y;

    onWork_PANEL.style.left = x +"px";
    onWork_PANEL.style.top  = y +"px";

    /*}}}*/
/*{{{
t_spread_log(onWork_PANEL);
}}}*/
};
/*}}}*/
/* TOOL CHILD */
/*_ onMove_6_GRAB_TOOL_CHILD {{{*/
let onMove_6_GRAB_TOOL_CHILD = function(e,x,y)
{
/* [onWork_MOVABLE_CHILD] {{{*/
if(!onWork_MOVABLE_CHILD) return "";

let   caller = "onMove_6_GRAB_TOOL_CHILD";
let log_this = (LOG_MAP.EV0_LISTEN || logging_EVENTS|| LOG_MAP.EV2_MOVE);

if(log_this) t_log_event_status(caller, lf6);
/*}}}*/
    let consumed_by = "MOVING ["+get_n_lbl(onWork_EL)+"]";
    /* D_XY [onDown_XY .. XY] {{{*/
    x -= onDown_XY.x;
    y -= onDown_XY.y;
    y -= onWork_EL.offsetHeight * (behavior_TOUCH_ELSE_DESKTOP ? 1.5 : 0.5); /* TODO CONFIRM */

    /*}}}*/
    /* CLIP [within parent area] {{{*/
    let   v_W = onWork_EL.parentElement.offsetWidth ;
    let   v_H = onWork_EL.parentElement.offsetHeight;
    let   e_W = onWork_EL              .offsetWidth ;
    let   e_H = onWork_EL              .offsetHeight;

    let x_min = 0 - onDown_TOOL_XY.x;
    let x_max = v_W - e_W;
    let y_min = 0 - onDown_TOOL_XY.y;
    let y_max = v_H - e_H;

    if(onWork_PANEL_magnified) {
        x /= 2;
        y /= 2;
    }

    x = (x < x_min) ? x_min : (x > x_max) ? x_max : x;
    y = (y < y_min) ? y_min : (y > y_max) ? y_max : y;
    /*}}}*/
    /* MOVE [mov_div] {{{*/
    if( t_pat_bag9_grab_item_is_mov_div() )
    {
        t_pat_bag9_grab_item_mov_div_xy(e, x, y);

    }
    /*}}}*/
    /* OR.. [onWork_MOVABLE_CHILD] {{{*/
    else {
        onWork_EL.style.left = x +"px";
        onWork_EL.style.top  = y +"px";

    }
    /*}}}*/
    return consumed_by;
};
/*}}}*/
/*}}}*/
/* LONG_PRESS */
/*{{{*/
/*{{{*/
const LONG_PRESS_ARM     = "long_press_arm";
let LONG_PRESS_ARM_DELAY = CLICK_DURATION;
let LONG_PRESS_DELAY     = CLICK_DURATION * 2;

let long_press_caller;
let long_press_timer;
let long_press_arm_timer;
/*}}}*/
/*  add_long_press_listener .. (call birst debouncer) {{{*/
let add_long_press_listener = function(_caller="setTimeout")
{
/*{{{*/
let   caller = "add_long_press_listener";
let log_this = LOG_MAP.EV4_LONG_PRESS;

if( log_this) log("%c"+caller+" %c "+_caller, lbL+lf4, lbR+lf0);
/*}}}*/

    /* Remember [LAST LONG PRESS CALLER] */
    long_press_caller = _caller;

    /* Clear pending [LONG PRESS TIMER] */
    if(long_press_timer) clearTimeout(long_press_timer);
    /*.............................*/ long_press_timer = null;

    /* Replace [LONG PRESS ARM TIMER] */
    if(long_press_arm_timer) clearTimeout(long_press_arm_timer);
    long_press_arm_timer =     setTimeout(long_press_arm_handler, LONG_PRESS_ARM_DELAY);
};
/*}}}*/
/* rearm_long_press_listener {{{*/
/*{{{*/
const REARM_LONG_PRESS_DELAY = 500;
let   rearm_long_press_timer;

/*}}}*/
let rearm_long_press_listener = function()
{
/*{{{*/
let   caller = "rearm_long_press_listener";
let log_this = logging_EVENTS;

if( log_this) log(caller);
/*}}}*/

    if( rearm_long_press_timer ) clearTimeout( rearm_long_press_timer );
    rearm_long_press_timer = null;

    if(   has_el_class(seeker_PU, CSS_SEEKER_PU2_LOOK_UP   )
       || has_el_class(seeker_PU, CSS_SEEKER_PU3_LOOK_RIGHT)
       || has_el_class(seeker_PU, CSS_SEEKER_PU4_LOOK_DOWN )
       || has_el_class(seeker_PU, CSS_SEEKER_PU5_LOOK_LEFT )
      )
        rearm_long_press_timer =  setTimeout(add_long_press_listener, REARM_LONG_PRESS_DELAY);
};
 /*}}}*/
/*_ long_press_arm_handler {{{*/
let long_press_arm_handler = function()
{
/*{{{*/
let   caller = "long_press_arm_handler";
let log_this = LOG_MAP.EV4_LONG_PRESS;

/*}}}*/

    /* [LONG PRESS ARM DONE] */
    long_press_arm_timer = null;

    /* SHOW PENDING [LONG PRESS ARM SCHEDULED] */
    if( t_seeker_PU_is_active() )
    {
        t_seeker_PU_show();
        add_el_class(seeker_CU, LONG_PRESS_ARM);
    }
    /* Replace [LONG PRESS TIMER] */
    if(long_press_timer) clearTimeout(long_press_timer);
    long_press_timer     = setTimeout(long_press_handler, LONG_PRESS_DELAY);

    /* TRANSCRIPT LOG {{{*/
if( log_this) log("%c"+caller+": ADDING LONG PRESS LISTENER ON %c"+t_get_onWork_tool_label(), lbH+lf4, lbH+lf3);

if( log_this)
    t_log_transcript_event_top("<span style='color:yellow;'>"+ SYMBOL_BLACK_CIRCLE +"</span>"
        +                      "long_press_arm_handler .. CALLED BY <em>"+ long_press_caller +"</em>");
    /*}}}*/
};
/*}}}*/
/*_ long_press_handler {{{*/
let long_press_handler  = function()
{
/* {{{*/
let   caller = "long_press_handler";
let log_this = LOG_MAP.EV4_LONG_PRESS;

/*}}}*/
    /* [LONG PRESS DONE] */
    long_press_timer = null;

    /* HIDE PENDING [LONG PRESS ARM SCHEDULED] */
    del_el_class(seeker_CU, LONG_PRESS_ARM);

    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    let                consumed_by = "";                               let consumed_by_css =  "";
    if(!consumed_by) { consumed_by = onLong_press1_HOTSPOT_IN_GUTTER   (); consumed_by_css = lf1; }
    if(!consumed_by) { consumed_by = onLong_press2_TOOLS_ON_GRID       (); consumed_by_css = lf2; }
    if(!consumed_by) { consumed_by = onLong_press3_TOOL_EL_CB          (); consumed_by_css = lf3; }
    if(!consumed_by) { consumed_by = onLong_press4_TOOL_PANEL_MAGNIFY  (); consumed_by_css = lf4; }
    if(!consumed_by) { consumed_by = onLong_press5_HOTSPOT_PANEL_UNHIDE(); consumed_by_css = lf5; }
    if(!consumed_by) { consumed_by = onLong_press6_SLOT_CONTAINERS     (); consumed_by_css = lf6; }
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* NO LONG PRESS ACTION FOR [onWork_EL]  {{{*/
    if(!consumed_by)
    {
        consumed_by = "NO LONG PRESS ACTION FOR ["+get_n_lbl(onWork_EL)+"] target_tool=["+get_n_lbl(target_tool)+"]";

/*{{{
log("%c "+caller+" %c *** "+consumed_by+" ***", lbb+lbL+lf9, lbb+lbR+lf2);
t_log_event_status(caller+": "+consumed_by);
}}}*/
    }
    /*}}}*/
    /* ALL DONE {{{*/
    if( logging_something() )
        t_log_transcript_event_bot( "<span style='color:white;'>"+SYMBOL_CHECK_MARK+"</span>"
            +                      " long press <em>"+ consumed_by +"</em>"
        );

    arm_long_presss_timer = null; /* done */

    long_press_timer      = null; /* nearly done */

    /*}}}*/
if( log_this) t_log_event_status(caller+":"+LF+SYMBOL_RIGHT_ARROW+" "+consumed_by, lbb+consumed_by_css);
};
/*}}}*/

/*_ onLong_press1_HOTSPOT_IN_GUTTER {{{*/
let onLong_press1_HOTSPOT_IN_GUTTER = function()
{
/* {{{*/
let   caller = "onLong_press1_HOTSPOT_IN_GUTTER";

/*}}}*/

    if(  onWork_PANEL != hotspot ) return "";
    if(  onWork_EL    != hotring ) return "";
    if(!t_gutter_is_hotspot_IN() ) return "";

    prop_toggle( EDIT_OR_STAGE ); /* START EDITING */

    return "NODE HIDING: HOTSPOT DRAGGED IN GUTTER";
};
/*}}}*/
/*_ onLong_press2_TOOLS_ON_GRID {{{*/
let onLong_press2_TOOLS_ON_GRID = function()
{
/* {{{*/
let   caller = "onLong_press2_TOOLS_ON_GRID";

/*}}}*/
    if( !dimm_mask_displayed() ) return "";

    if( call_t_grid_IS_ON_GRID(caller) )
    {
        t_move_TOOLS_OFF_GRID(caller);

        return "MOVING TOOLS OFF GRID";
    }

    if( has_el_class(pat_bag, CSS_OPEN_BAG) )
    {
        t_pat_bag_close(caller,caller);

        dimm_stop(caller);

        return "CLOSING [pat_bag]";
    }

    return "";
};
/*}}}*/
/* XXX target_tool */
/*_ onLong_press3_TOOL_EL_CB {{{*/
let onLong_press3_TOOL_EL_CB = function()
{
/*{{{*/
let   caller = "onLong_press3_TOOL_EL_CB";
let log_this = LOG_MAP.EV4_LONG_PRESS;

if( log_this) t_log_event_status(caller, lf3);

    let el_slot                  = (t_get_EL_slot(onWork_EL) > 0);
    let current_sel_text         = t_get_current_sel_text();

    let target_tool_seeking      = (target_tool && !has_el_class( target_tool, CSS_SEEK_TARGET));
    let pinned_target_tool_count = t_get_pinned_target_tool_count();

if( log_this) {
    log_key_val( caller
                 , {   el_slot                  : el_slot
                     , current_sel_text         : ellipsis_short(current_sel_text)
                     , onDown_SEL_TEXT          : ellipsis_short(onDown_SEL_TEXT )
                     , target_tool_seeking      : target_tool_seeking
                     , pinned_target_tool_count : pinned_target_tool_count
                 }, lf3);
}
    if(el_slot) return;
/*}}}*/
    /* LONG PRESS ON [pat_bag.bag_rot] {{{*/
    let consumed_by = "";
    if(onWork_EL == bag_rot)
    {
        consumed_by = "TODO: HANDLE LONG PRESS ON "+get_id_or_tag(onWork_EL);
/*{{{ FIXME .. FLYING SEEKER_CD DOES NOT LOOK GREAT .. (.. AND IT IS DOC-POSITIONNED-TOOL NOT A VIEWPORT-FIXED ONE)
        seeker_CD.innerHTML = "<div><pre>"+ bag_rot.title +"</pre></div>";
        t_seeker_PD_show();
        let xy = get_el_xy(pat_bag, caller);
        let  x = onDown_SCROLL_XY.x + xy.x + pat_bag.offsetWidth  / 2;
        let  y = onDown_SCROLL_XY.y + xy.y + pat_bag.offsetHeight + BOX_MARGIN;
logXXX("...bag_rot=["+xy.x+"  "+xy.y+"] .. xy=["+x+" "+y+"]");
        t_seeker_move_below_XY(seeker_PD, x, y);
        del_el_class(seeker_PD, CSS_ON_HIDEN_NODE);
}}}*/

/* FIXME .. should be visible without this hack with fly_log_checked ... */
let was_fly_log_checked = fly_log_checked;
        fly_log_checked = true;
        t_fly("<pre class='cc7'>"+ bag_rot.title +"</pre>");
        fly_log_checked = was_fly_log_checked;
    }
    /*}}}*/
    /* LONG PRESS ON [dimm_mask] .. t_slot_container_set_fullscreen {{{*/
    else if( is_el_or_child_of_parent_el(onWork_EL,  dimm_mask) )
    {
        consumed_by = "LONG PRESS ON SLOT CONTAINER .. [t_slot_container_set_fullscreen]";

        t_slot_container_set_fullscreen( onWork_EL );
    }
    /*}}}*/

else if( is_a_DOM_LOAD_featured_function("t_target_tool_feed") )
{
    /* LONG PRESS ON [target_tool] .. PASTE OR RESTORE {{{*/
    if(onWork_SEEK_TOOL && (onWork_SEEK_TOOL == target_tool))
    {
        consumed_by = "LONG PRESS ON  [target_tool] .. TO PASTE SEL_TEXT";
if(log_this) log("%c"+consumed_by, lbb+lbH+lf3);

        t_target_tool_feed(target_tool);
    }
     /*}}}*/
    /* LONG PRESS ON [DOC PAGE] .. PASTE TO TARGET {{{*/
    else if(current_sel_text || onDown_SEL_TEXT)
    {
        if(pinned_target_tool_count < TARGET_MAX)
        {
            consumed_by = onLong_press3_TARGET_TOOL_CB();

        }
    }
    /*}}}*/
    /* LONG PRESS ON [DOC PAGE] .. TARGET NOT SEEKING .. CHOOSE PINNED TARGET {{{*/
    else if(!pinned_target_tool_count && (pinned_target_tool_count > 0))
    {
        consumed_by = "LONG PRESS [OFF target_tool] .. x"+pinned_target_tool_count+" PINNED TO CHOOSE FROM";
if(log_this) log("%c"+consumed_by, lbb+lbH+lf3);

        t_target_tool_feed();
    }
    /*}}}*/
    /* LONG PRESS ON [DOC PAGE] .. [NO onWork_PANEL] .. ADD FIRST TARGET {{{*/
    else if(!onWork_PANEL)
    {
        consumed_by = "LONG PRESS [OFF target_tool] .. ADD FIRST EMPTY TARGET";
if(log_this) log("%c"+consumed_by, lbb+lbH+lf3);

        t_target_tool_new_XY_SEL_TEXT(onDown_XY.x, onDown_XY.y, SYMBOL_DIRECT_HIT);
    }
    /*}}}*/
}
if(log_this && !consumed_by) logBIG(caller+": NOT CONSUMED", lf8);
    return consumed_by;
};
/*}}}*/
/*_ onLong_press3_TARGET_TOOL_CB {{{*/
let onLong_press3_TARGET_TOOL_CB = function()
{
/*{{{*/
let   caller = "onLong_press3_TARGET_TOOL_CB";
let log_this = LOG_MAP.EV4_LONG_PRESS;

/*}}}*/
    /* SELECTION IS CHANGING .. WAIT FOR ANOTHER LONG_PRESS_DELAY {{{*/
    let consumed_by = "";
    let current_sel_text = t_get_current_sel_text();
    if( current_sel_text && onDown_SEL_TEXT && (current_sel_text != onDown_SEL_TEXT))
    {
        consumed_by      = "LONG PRESS CANCLED BY CHANGING SELECTION:"+LF+" FROM ["+onDown_SEL_TEXT+"]"+LF+"...TO ["+current_sel_text+"]";
if(log_this) log("%c"+consumed_by,     lbH+lf8);

/*{{{
            onDown_SEL_TEXT  = current_sel_text;
            long_press_timer = setTimeout(long_press_handler, LONG_PRESS_DELAY);
            pulse_id( hotspot );
            t_seekzone2_add_dblclick();
 t_seekzone1_show(SYMBOL_BLACK_CIRCLE);
            t_seekzone3_add_longpress();
}}}*/
    }
    /*}}}*/
    /* SELECTION READY .. CONSUME SEL_TEXT TO ADD NEW TARGET {{{*/
    else
    {
        if(onUp_MS > onDown_MS)
        {
if(log_this) logBIG("MOUSE BUTTON RELEASED");

        }
        else if(!onDown_SEL_TEXT)
        {
if(log_this) logBIG("(!onDown_SEL_TEXT)");
        }
        else {
            consumed_by      = "LONG PRESS [OFF target_tool] .. ADD NEW WITH onDown_SEL_TEXT=["+onDown_SEL_TEXT+"]";
if(log_this) log("%c"+consumed_by, lbb+lbH+lf3);

            t_target_tool_new_XY_SEL_TEXT(onDown_XY.x, onDown_XY.y, onDown_SEL_TEXT);

            /* consume selection */
            t_window_getSelection_removeAllRanges(caller);
            onDown_SEL_TEXT = "";
        }
    }
    /*}}}*/
if(log_this && !consumed_by) logBIG(caller+": NOT CONSUMED", lf8);
    return consumed_by;
};
/*}}}*/
/*_ onLong_press4_TOOL_PANEL_MAGNIFY {{{*/
let onLong_press4_TOOL_PANEL_MAGNIFY = function()
{
/* {{{*/
let   caller = "onLong_press4_TOOL_PANEL_MAGNIFY";

/*}}}*/
    /* MAGNIFY [fly_div] {{{*/
    if( is_el_or_child_of_parent_el(onWork_EL, fly_div) )
    {
        t_fly_div_magnified_toggle();

        return "FLOAT LOG MAGNIFICATION";
    }
    /*}}}*/
    /* NO [onWork_PANEL] SELETED {{{*/
    if( !onWork_PANEL ) return "";

    /*}}}*/
    /* DRAG [pivot_PANEL] AND SYNC PANELS MAGNIFICATION {{{*/
    if( is_a_spread_drag() )
    {
        if(onWork_PANEL == pivot_PANEL) {
            t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) );
            return "SETTING DRAGGED PIVOT PANEL RE-MAGNIFICATION";
        }
    }
    /*}}}*/
    /* MAGNIFY ANOTHER PANEL {{{*/
    else if(onWork_PANEL != hotspot)
    {
        if(onWork_PANEL == pivot_PANEL) {
            t_toggle_pivot_PANEL_magnified();
            return "TOGGLED PIVOT PANEL MAGNIFICATION";
        }
        else
        {
            t_toggle_panel_magnified(  onWork_PANEL , "toggle");
            return "TOGGLED "+get_n_lbl(onWork_PANEL)+" MAGNIFICATION";
        }
    }
    /*}}}*/
};
/*}}}*/
/*_ onLong_press5_HOTSPOT_PANEL_UNHIDE {{{*/
let onLong_press5_HOTSPOT_PANEL_UNHIDE = function()
{
/* {{{*/
let   caller = "onLong_press5_HOTSPOT_PANEL_UNHIDE";

/*}}}*/

    /* [has_moved] normal check .. (standard check was too sensitive due to no-lag-constraint) */
    t_clr_has_moved();
    t_check_has_moved(onMoveDXY.x, onMoveDXY.y, caller);

    if(  onWork_PANEL != hotspot ) return "";
    if(  onWork_EL    != hotring ) return "";
    if(  has_moved               ) return "";

    if(!t_raise_pivot_PANEL_called_since_onDown(caller))
        t_flash_unpinned_panels(caller);

    return "UNHIDING PANELS";
};
/*}}}*/
/*_ onLong_press6_SLOT_CONTAINERS {{{*/
let onLong_press6_SLOT_CONTAINERS = function()
{
/* {{{*/
let   caller = "onLong_press6_SLOT_CONTAINERS";

/*}}}*/

    let      slot = t_get_EL_slot(onWork_EL);
    if(     !slot  ) return;
    if(!ccs[ slot] ) return;

    /* SET PARAGRAPH TO OUTLINE */
    ccs[slot].num_selected = t_get_onWork_EL_num();

    /* FILL [dimm_mask] WITH [div_slot_containers] */
    if( ccs[slot] )
        t_slot_containers_display(slot);

    return "SHOWING SLOT ["+slot+"] CONTAINERS";
};
/*}}}*/
/*  is_long_press_pending {{{*/
let is_long_press_pending = function()
{
    let result
            =  (long_press_arm_timer != null)
            || (long_press_timer     != null)
    ;

/*{{{
log_key_val(   "is_long_press_pending"
            , {              onWork_EL : get_n_lbl(onWork_EL)
                ,     long_press_timer : long_press_timer
                , long_press_arm_timer : long_press_arm_timer
                ,               result : result
            }
            , lbb+lf4)

}}}*/
    return result;
};
/*}}}*/
/*  del_long_press_listener {{{*/
let del_long_press_listener = function(_caller)
{
/*{{{*/
let   caller = "del_long_press_listener";
let log_this = !onDown_SHIFT && (LOG_MAP.EV4_LONG_PRESS || LOG_MAP.EV2_MOVE);

if( log_this) t_log_event_status(caller+LF+".. CALLED BY "+_caller, lf4);
/*}}}*/
    /* [hotspot] IN GUTTER .. PRESERVE long_press_listener {{{*/
    if(  (onWork_PANEL == hotspot)
       && t_gutter_is_XY_IN(h_x, h_y))
    {
        if(_caller != MOUSEUP) {
if( log_this) log("%c IN GUTTER "+_caller+" (onWork_EL != null) .. PRESERVE long_press_listener", lbb+lbH+lf7);
            return;
        }
        else {
if( log_this) log("%c IN GUTTER "+_caller+" (onWork_EL == null) .. DELETING long_press_listener", lbb+lbH+lf7);
        }

    }
    /*}}}*/
    /* WAS PRELOADING .. [long_press_arm_timer] {{{*/
    if(long_press_arm_timer)
    {
        clearTimeout( long_press_arm_timer );
        /*.........*/ long_press_arm_timer = null;

        /* HIDE PENDING [LONG PRESS ARM SCHEDULED] */
        del_el_class(seeker_CU, LONG_PRESS_ARM);

        if(long_press_timer == null) {
            if( logging_something() )
                t_log_transcript_event_bot( "<span style='color:white;'>x</span>"
                    +                      " <span style='text-decoration:line-through;'>long press</span> disarmed"
                    +                      " <em>"+ _caller +"</em>"
                );
if( log_this) log("LONG PRESS DISARMED BY: "+ _caller);

            return;
        }
    }
    /*}}}*/
    /* WAS PENDING .. [long_press_timer] {{{*/
    if(long_press_timer)
    {
        clearTimeout( long_press_timer );
        /*.........*/ long_press_timer = null; /* done */

        if( logging_something() )
            t_log_transcript_event_bot( "<span style='color:white;'>"+SYMBOL_HEAVY_BALLOT+"</span>"
                +                      " <span style='text-decoration:line-through;'>LONG PRESS</span> CANCELED: "
                +                      " <em>"+ _caller +"</em>"
            );
if( log_this) t_fly("LONG PRESS CANCELED: "+_caller);

        if(onWork_PANEL == null) return;
    }
    /*}}}*/
};
/*}}}*/
/*}}}*/
/* UP */
/*{{{*/
/* t_pointerup_listener {{{*/
/*{{{*/
const MOUSEUP_DBL_CLICK  = "DBL_CLICK";
const MOUSEUP_CLICK      = "CLICK";
const MOUSEUP_LONG_CLICK = "LONG_CLICK";
const MOUSEUP            = "MOUSE UP";

/*}}}*/
let t_pointerup_listener  = function(e)
{
if(e.ctrlKey) {logXXX("UP   IGNORED .. f(e.ctrlKey)"); return; }
/* {{{*/
let   caller = "t_pointerup_listener";
let log_this = !onDown_SHIFT && !onDown_ALT && (LOG_MAP.EV0_LISTEN || logging_EVENTS || LOG_MAP.EV3_UP);

if( log_this) log("%c"+caller, lbb+lbH+lf8);
/*}}}*/
    /* DEL MOVE and LONG_PRESS LISTENERS {{{*/
    del_page_and_tool_pointermove_listeners( caller );

    if( is_long_press_pending() )
        del_long_press_listener( MOUSEUP );

    /*}}}*/
    /* log event chain {{{*/
    /*
if( log_this ) console_dir(e);
if( log_this ) log("...onWork_EL=["+(onWork_EL ? onWork_EL.tagName : "")+"]");
if( log_this ) log("..........id=["+(onWork_EL ? onWork_EL.id      : "")+"]");
if( log_this ) log("..........XY=["+e.clientX+" "+e.clientY+"]");
     */
    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* return .. [onDown_CTRL] [onDown_SHIFT] {{{*/
    /* DEBOUNCE CTRL INPUT {{{*/
    if( t_is_bouncing_e_type(e.type, caller) ) return;
/*
    if( onWork_EL && (onWork_EL.tagName == "INPUT")) return;
*/
    /*}}}*/
    if(onDown_CTRL ) { log(); return; } /* right-button-menu override */
    if(onDown_ALT  ) { log(); return; }
    if(onDown_SHIFT) { log(); return; }
    /*}}}*/
    /* @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    /* [has_moved] [clicked] [dblclicked] [LONG-PRESS] {{{*/
    get_onMoveDXY(e, caller);

/* TODO rename to make it clear this is required to check [has_move] */
onDown_7_STALL_cancel();
    if(!has_moved) t_check_has_moved(onMoveDXY.x, onMoveDXY.y, MOUSEUP);

/*{{{
logXXX(" %c...has_moved..................=["+ has_moved                   +"%c]",lf8,lbA);
logXXX(" %c...has_been_scrolled_by_script=["+ has_been_scrolled_by_script +"%c]",lf8,lbA);
logXXX(" %c............onDown_SCROLL_XY.y=["+ onDown_SCROLL_XY.y          +"%c]",lf8,lbA);
logXXX(" %c................window.scrollY=["+ window.scrollY              +"%c]",lf8,lbA);
logXXX(" %c...........scroll_last_scrollY=["+ scroll_last_scrollY         +"%c]",lf8,lbA);
    if(!has_moved && (Math.abs(scroll_last_scrollY - onDown_SCROLL_XY.y) > SCROLLED_ENOUGH))
    if(!has_moved && (Math.abs(window.scrollY - onDown_SCROLL_XY.y) > SCROLLED_ENOUGH))
}}}*/
    if(!has_moved && behavior_TOUCH_ELSE_DESKTOP && has_been_scrolled_by_script)
        t_set_has_moved( has_been_scrolled_by_script );

    let clicked    = is_a_click() && !move_cooldown_is_pending();

    let dblclicked =  clicked && is_a_dblclick(e, caller);

/*{{{
    if( clicked ) t_scrollIntoViewCanceled(caller);
}}}*/

    let detail
        = has_moved  ? has_moved
        : dblclicked ? MOUSEUP_DBL_CLICK
        :    clicked ? MOUSEUP_CLICK
        :              MOUSEUP_LONG_CLICK
    ;
if( log_this) t_log_event_status(caller, lf8);
if(log_this) {
    log_key_val( caller+": details"
                 , {   behavior_TOUCH_ELSE_DESKTOP : behavior_TOUCH_ELSE_DESKTOP
                     , t_preventDefault_caller     : t_preventDefault_caller
                     , t_event_consumed_cause      : t_event_consumed_cause
                     , clicked                     : clicked
                     , dblclicked                  : dblclicked
                     , fullscreen_slot_container   : get_id_or_tag(fullscreen_slot_container)
                     , EDIT_OR_STAGE               :  prop_get( EDIT_OR_STAGE )
                 }
                 , lb0
               );
}

/*{{{
    caller += " "+detail;
}}}*/
    /*}}}*/
    /* EVENT CONSUME OR BUBBLE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */
    let                consumed_by = "";                                            let consumed_by_css =  "";
    if(!consumed_by) { consumed_by = onUp_0_MULTITOUCH         (e                    ); consumed_by_css = lf9; }
    if(!consumed_by) { consumed_by = onUp_1_TOOL_GRID_CB       (e, clicked           ); consumed_by_css = lf1; }
    if(!consumed_by) { consumed_by = onUp_2_SLOT_CONTAINER_CB  (e, clicked           ); consumed_by_css = lf2; }
    if(!consumed_by) { consumed_by = onUp_3_TARGET_TOOL_CB     (e, clicked,dblclicked); consumed_by_css = lf3; }
    if(!consumed_by) { consumed_by = onUp_3_DOC_TOOL_CB        (e, clicked,dblclicked); consumed_by_css = lf3; }
    if(!consumed_by) { consumed_by = onUp_4_DOC_TOUCH_CB       (e, clicked,dblclicked); consumed_by_css = lf4; }
    if(!consumed_by) { consumed_by = onUp_5_TOOL_ONCLICK       (e, clicked,dblclicked); consumed_by_css = lf5; }
    if(!consumed_by) { consumed_by = onUp_6_DOC_CB             (e, clicked,dblclicked); consumed_by_css = lf6; }
    if(!consumed_by) { consumed_by = onUp_7_ON_EVENT_CONSUMED  (e                    ); consumed_by_css = lf7; }
    if(!consumed_by) { consumed_by = e.type+" BUBBLING";                                consumed_by_css = lf8; }
    /*............................*/ onUp_8_ON_MOUSEUP_DONE    (e);
    /* DONE @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ */

    /* consumed_by {{{*/
/*{{{
log("%c"+caller+":", lbF);
log("_ e..........path[0]=["+get_n_lbl(e.path[0])+"]");
log("_ e..........handler=["+get_n_lbl(get_el_parent_with_any_event_handler(e.path[0]), caller)+"]");
log("_ e..........bubbles=["+e.bubbles+"]");
log("_ e.......cancelable=["+e.cancelable+"]");
log("_ e.....cancelBubble=["+e.cancelBubble+"]");
log("_ e.defaultPrevented=["+e.defaultPrevented+"]");
log(consumed_by);
if( log_this) log("%c"+caller+" %c "+consumed_by, lbL+lf8, lbR+lf9);
}}}*/

if( log_this) t_log_event_status(caller+" "+SYMBOL_RIGHT_ARROW+" "+consumed_by, lbb+consumed_by_css);
    if(consumed_by && logging_something())
        t_log_transcript_event_bot("<span class='big'>"+ SYMBOL_UP_ARROW +"</span>"
            +                      "<em>"+               consumed_by     +"</em>");

    /*}}}*/
    /* rewind nested collapsed logging {{{*/
    log_sep_clr();

    /*}}}*/
};
/*}}}*/
/* CLICK {{{*/
/*_  is_a_spread_drag {{{*/
let  is_a_spread_drag = function(e)
{
/*{{{*/
let   caller = "is_a_spread_drag";
let log_this = logging_EVENTS;

/*}}}*/

    let this_MS      = new Date().getTime();
    let delayMS      = onDown_MS ? (this_MS - onDown_MS) : 0;
    let in_hand      = (delayMS > DRAG_MIN_MS);
    let fully_spread = ((spread_ratio.x >= 0.9) || (spread_ratio.y >= 0.9));

    let cause        = "";

    if(in_hand && has_moved && fully_spread)
        cause = "MOVED FULLY SPREAD AFTER "+ (this_MS-onDown_MS)+" ms .. "+has_moved;

/*{{{
    else if( (onWork_EL_last_used != hotring    )
        &&   (onWork_EL_last_used != pivot_PANEL)
        &&   t_is_a_selected_panel(onWork_EL_last_used)
    )
        cause = "(pivot_PANEL != onWork_EL_last_used)";
logXXX("pivot_PANEL=["+get_n_lbl(pivot_PANEL)+"] onWork_EL_last_used=["+get_n_lbl(onWork_EL_last_used)+"]");
*/
/* works well .. results are not that great ?... */

/*
    else if(delayMS > DRAG_MAX_MS)
        cause = "DRAGGED MORE THAN "+ DRAG_MAX_MS +" ms";
*/
/*}}}*/

    let result  = (cause != "");

if(log_this && result) log("is_a_spread_drag: ...return "+result+" .. %c"+cause, lb7);

    return result;
};
/*}}}*/
/*_  is_a_click {{{*/
let  is_a_click = function(e)
{
/*{{{*/
let   caller = "is_a_click";
let log_this = logging_EVENTS;

/*}}}*/
    let cause   = "";
    let this_MS = new Date().getTime();
    let delayMS = onDown_MS ? (this_MS - onDown_MS) : 0;

    if(delayMS <=  CLICK_DURATION) cause = "pressed during "+delayMS+" ms";

    let clicked  = (cause != "");

if(!clicked && (delayMS > LONG_PRESS_DURATION)) t_seekzone3_add_longpress();
/*{{{
}}}*/
    is_a_click_last_result = clicked;

if(log_this && clicked) log(caller+": ...return "+clicked+" .. %c"+cause, lb7);
    return clicked;
};
/*}}}*/
/*_  is_a_dblclick {{{*/
let  is_a_dblclick = function(e, _caller)
{
/*{{{*/
let   caller = "is_a_dblclick";
let log_this = !onDown_SHIFT && logging_something();

/*{{{
t_log_event_status(caller, lf8);
}}}*/
/*}}}*/
    let this_MS      = new Date().getTime();
    let clicks_MS    =             onDown_MS - onDownPMS;
    let pressMS      = (this_MS -  onDown_MS);
    let downs_MS     =             onDown_MS ? pressMS : 0;
    let quick_enough = (downs_MS < DBLCLICK_DELAY);
    let multi_click  = e.detail ? (e.detail > 1) : (clicks_MS < DBLCLICK_DELAY);
    let misclick     = is_a_misclick(e, multi_click, pressMS);
    let dblclick     = !misclick  && multi_click && quick_enough;
/*{{{*/
if(log_this) {
    let                                                  cause  = "";
    if     ( misclick                                  ) cause += "misclick";
    if     ( e.type == "mouseup"                       ) cause += "click count "+ e.detail;
    else if(!dblclick && !multi_click ) cause += "not multi_click";
    else if(!dblclick && !quick_enough) cause += "not quick_enough";

    let lfx = (dblclick ? lf4 : lf8);

    log("%c"+caller+": ...%c return "+dblclick +" %c"+cause +"%c e.type ["+e.type+"] %c downs_MS ["+ downs_MS +"] %c clicks_MS ["+clicks_MS+"] %c onWork_PANEL ["+get_id_or_tag(onWork_PANEL)+"]"
        ,lbL+lf3         ,lbR+lfx                ,lbH+lfx    ,lb0                   ,lf6                         ,lf7                         ,lf3);
}
/*}}}*/

    if( dblclick ) t_seekzone2_add_dblclick(pressMS);

    is_a_dblclick_last_result = dblclick;

    return dblclick;
};
/*}}}*/
/*_  is_a_misclick {{{*/
let  is_a_misclick = function(e, multi_click, pressMS)
{
/*{{{*/
let   caller = "is_a_misclick";
let log_this = !onDown_SHIFT && logging_something();

/*}}}*/

    let window_selection = String(window.getSelection());
    let misclick_MS      = behavior_TOUCH_ELSE_DESKTOP ? MISCLICK_TOUCH_MS : MISCLICK_MOUSE_MS;
    let misclick         =  !multi_click
        &&                 (pressMS < misclick_MS)
        &&                 !onWork_PANEL
        &&                 !window_selection
    ;

    if( misclick ) t_seekzone2_add_misclick(pressMS, misclick_MS);

    is_a_misclick_last_result = misclick;

if(log_this) log("%c "+caller+":  %c window_selection ["+window_selection+"]",lb0,lf8);

    return misclick;
};
/*}}}*/
/*_ was_a_click {{{*/
let  is_a_click_last_result;
let was_a_click = function()
{
    return is_a_click_last_result;
};
/*}}}*/
/*_ was_a_dblclick {{{*/
let  is_a_dblclick_last_result;
let was_a_dblclick = function()
{
    return is_a_dblclick_last_result;
};
/*}}}*/
/*_ was_a_misclick {{{*/
let  is_a_misclick_last_result;
let was_a_misclick = function()
{
    return is_a_misclick_last_result;
};
/*}}}*/
/*_ clr_click_last_result {{{*/
let clr_click_last_result = function()
{
    is_a_click_last_result    = false;
    is_a_dblclick_last_result = false;
    is_a_misclick_last_result = false;
};
/*}}}*/
/*}}}*/

/*_ onUp_0_MULTITOUCH {{{*/
let onUp_0_MULTITOUCH = function(e)
{

    onUp_MS = new Date().getTime();
    let    consumed_by = ((onDown_TOUCHES > 1) ? "MULTI-TOUCH x"+onDown_TOUCHES : "");
    return consumed_by;
};
/*}}}*/
/*_ onUp_1_TOOL_GRID_CB {{{*/
let onUp_1_TOOL_GRID_CB = function(e, clicked)
{
/*{{{*/
let   caller = "onUp_1_TOOL_GRID_CB(clicked "+clicked+")";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) t_log_event_status(caller, lf1);

    if(!clicked                   ) return "";

    if( prop_get( EDIT_OR_STAGE ) ) return "";

    if(has_moved)
    {
        if(t_check_big_moved(onMoveDXY.x, onMoveDXY.y, caller) ) {
if( log_this) logBIG("BIG MOVE", lf2);
            return;
        }
        else {
if( log_this) logBIG("SMALL MOVE", lf7);
        }
    }

    let consumed_by = "";
/*}}}*/
    /*  MOVING TOOLS ON GRID .. f(hotring) {{{*/
    if(!call_t_grid_IS_ON_GRID(caller))
    {
        if(onWork_EL == hotring) {
            consumed_by     = "MOVING TOOLS ON GRID";

            t_move_TOOLS_ON_GRID(caller);
        }
    }
    /*}}}*/
    /*  TOOLS ON GRID {{{*/
    else {
        /* MOVING TOOLS OFF GRID .. f(hotring || dimm_mask) {{{*/
        if((onWork_EL == hotring) || dimm_mask_is(onWork_EL))
        {
            consumed_by = " MOVING TOOLS OFF GRID";

            t_move_TOOLS_OFF_GRID(caller);

            t_sync_layout(caller);
        }
        /*}}}*/
        /* ELSE: SELECT TOOLS ON GRID {{{*/
        else {
            consumed_by = " SELECT TOOLS ON GRID ";

            t_grid_TOOLS_SELECT(e);
        }
        /*}}}*/
    }
    /*}}}*/
if(log_this) log(consumed_by);
    return consumed_by;
};
/*}}}*/
/*_ onUp_2_SLOT_CONTAINER_CB {{{*/
let onUp_2_SLOT_CONTAINER_CB = function(e, clicked)
{
/* log {{{*/
let   caller = "onUp_2_SLOT_CONTAINER_CB";
if(!is_a_DOM_LOAD_featured_function(caller)) return "";
let log_this = !onDown_SHIFT && (LOG_MAP.EV3_UP || LOG_MAP.T1_DOM_LOAD);

if( log_this) caller += "(clicked "+clicked+")";
if( log_this) t_log_event_status(caller, lf2);
/*}}}*/
    /* ASSERT FEATURE {{{*/
    if(!div_slot_containers_displayed()         ) return "";
    if(!clicked                                 ) return "";
    if( has_moved                               ) return "";

    /*}}}*/
    /* PARSE TARGET ELEMENT AND ITS CONTAINER {{{*/
    let consumed_by               =  "ON "+ get_id_or_tag(onWork_EL);

    let clicked_COPY_TO_CLIPBOARD = has_el_class(                 onWork_EL, CSS_BUTTON_COPY   ) ? "COPY TO CLIPBOARD" : "";
    let clicked_MAGNIFY_START     = has_el_class(                 onWork_EL, CSS_BUTTON_MAGNIFY) ?           "MAGNIFY" : "";
    let clicked_PREV              = has_el_class(                 onWork_EL, CSS_BUTTON_PREV   ) ?      "MAGNIFY PREV" : "";
    let clicked_NEXT              = has_el_class(                 onWork_EL, CSS_BUTTON_NEXT   ) ?      "MAGNIFY NEXT" : "";
    let clicked_MONO              = has_el_class(                 onWork_EL, CSS_BUTTON_MONO   ) ?         "MONOSPACE" : "";
    let clicked_MAGNIFY_STOP      = (fullscreen_slot_container == onWork_EL                    ) ?        "FULLSCREEN" : "";


    let clicked_target
        = clicked_COPY_TO_CLIPBOARD ? onWork_EL.parentElement
        : clicked_MAGNIFY_START     ? onWork_EL
        : clicked_PREV              ? onWork_EL
        : clicked_NEXT              ? onWork_EL
        : clicked_MONO              ? onWork_EL
        : clicked_MAGNIFY_STOP      ? null
        :                             onWork_EL
    ;

if(log_this) {
    let s = log_key_val(       caller
                         , {   consumed_by               : consumed_by
                             , clicked_COPY_TO_CLIPBOARD : clicked_COPY_TO_CLIPBOARD
                             , clicked_MAGNIFY_START     : clicked_MAGNIFY_START
                             , clicked_PREV              : clicked_PREV
                             , clicked_NEXT              : clicked_NEXT
                             , clicked_MONO              : clicked_MONO
                             , clicked_MAGNIFY_STOP      : clicked_MAGNIFY_STOP
                             , clicked_target            : get_n_lbl(clicked_target)
                          }
                         , lf2
                       );
}
    /*}}}*/
    /* MAGNIFY_START {{{*/
    if     (clicked_MAGNIFY_START) { consumed_by += " .. "+ clicked_MAGNIFY_START; t_slot_container_set_fullscreen( clicked_target ); }

    /*}}}*/
    /* MAGNIFY_PREV  {{{*/
    else if(clicked_PREV         ) { consumed_by += " .. "+ clicked_PREV         ; t_slot_container_set_fullscreen( clicked_target ); }

    /*}}}*/
    /* MAGNIFY_NEXT  {{{*/
    else if(clicked_NEXT         ) { consumed_by += " .. "+ clicked_NEXT         ; t_slot_container_set_fullscreen( clicked_target ); }

    /*}}}*/
    /* MONO {{{*/
    else if(clicked_MONO         ) { consumed_by += " .. "+ clicked_MONO         ; t_slot_container_set_fullscreen( clicked_target ); }

    /*}}}*/
    /* MAGNIFY_STOP {{{*/
    else if(clicked_MAGNIFY_STOP ) { consumed_by += " .. "+ clicked_MAGNIFY_STOP ; t_slot_container_set_fullscreen( clicked_target ); }

    /*}}}*/
    /* COPY TO CLIPBOARD {{{*/
    else if(clicked_COPY_TO_CLIPBOARD && clicked_target) {
        consumed_by += " .. "+ clicked_COPY_TO_CLIPBOARD;

        let container_to_copy_from
            = (clicked_target.id == 'button_COPY_ALL_parent_div')
            ?  clicked_target.parentElement
            :  clicked_target
        ;
/*{{{
console.dir(container_to_copy_from)
logBIG("textContent")
log(container_to_copy_from.textContent)
logBIG("innerHTML")
log(container_to_copy_from.innerHTML)
}}}*/
        t_slot_containers_copy_to_clipboard_outerHTML( container_to_copy_from );

        /* highlight copied container */
        let              div_slot_containers = clicked_target.parentElement;
        for(let i=0; i < div_slot_containers.childNodes.length; ++i)
            del_el_class(div_slot_containers.childNodes[i], CSS_FOCUSSED);

        add_el_class(        clicked_target               , CSS_FOCUSSED);
    }
    /*}}}*/
    /* SCROLL TO [clicked_target] .. [dimm_stop] {{{*/
    else if( clicked_target )
    {
        consumed_by += " .. SCROLL TO "+t_onclick_target_handle_scroll_to_slot_num(clicked_target, caller);

        dimm_stop( caller );
    }
    /*}}}*/
    /* SCROLL BACK TO DIM SCROLL POINT .. [dimm_stop] {{{*/
    else {
        consumed_by += " .. SCROLL BACK TO DIM START POINT";

        t_window_scrollTo(0, onDown_SCROLL_XY.y);

        dimm_stop( caller );
    }
    /*}}}*/
if(log_this)  log("%c"+consumed_by, lbb+lbH+lf2);
    return caller+":"+LF+consumed_by;
};
/*}}}*/
/*_ onUp_3_TARGET_TOOL_CB {{{*/
let onUp_3_TARGET_TOOL_CB = function(e,clicked,dblclicked)
{
/*{{{*/
let   caller = "onUp_3_TARGET_TOOL_CB";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) t_log_event_status(caller, lf3);

    let onDown_target_tool  = (onDown_EL == target_tool) ;
    let seeker_PU_is_active = t_seeker_PU_is_active() ;

if( log_this) {
    log_key_val(caller
                , {   seeker_PU_is_active   :      seeker_PU_is_active
                    , onDown_target_tool    :      onDown_target_tool
                    , onSeekXYL             :      onSeekXYL
                    , target_tool           : "["+ get_n_lbl(target_tool     ) +"]"
                    , onDown_EL             : "["+ get_n_lbl(onDown_EL       ) +"]"
                    , onWork_EL             : "["+ get_n_lbl(onWork_EL       ) +"]"
                    , onWork_PANEL          : "["+ get_n_lbl(onWork_PANEL    ) +"]"
                    , onWork_SEEK_TOOL      : "["+ get_n_lbl(onWork_SEEK_TOOL) +"]"
                    , clicked               :      clicked
                    , dblclicked            :      dblclicked
                    , has_moved             :      has_moved
                    , onDown_SEL_TEXT       : "["+ onDown_SEL_TEXT             +"]"
                }
                , lf3
               );
}
/*}}}*/
    /* PAGE CLICK .. UNLIFT TARGETS .. HIDE TARGET SEEKER {{{*/
    let rejected_by = "";
    if(!onDown_target_tool )
    {
        if( t_target_tool_set_lifted(false) ) {
            rejected_by += " UNLIFTING TARGETS";
        }
        if(clicked && seeker_PU_is_active && is_onSeekXYL_onTarget())
        {
            t_seeker_PU_hide("instant");
            rejected_by += " HIDING TARGET SEEKER";
        }
        if(onWork_EL == dimm_mask)
        {
            rejected_by += " "+dimm_mask.id;
        }
    }
    /*}}}*/
    /* TARGET CLICK .. TRANSITION {{{*/
    let consumed_by = "";
    if(onDown_target_tool && !rejected_by)
    {
        rejected_by
            = !clicked                    ?     "NO CLICK"
            :  dblclicked                 ? "DOUBLE CLICK"
            :  has_moved                  ? "HAS MOVED ["+has_moved+"]"
            :  prop_get(EDIT_OR_STAGE)    ? "HIDE EDIT MODE"
            :                               "NO [target_tool] TRANSITION";

        if(        clicked
                   &&     !dblclicked
                   &&     !has_moved
                   &&     !prop_get(EDIT_OR_STAGE)
          )
            consumed_by = t_target_tool_CB(target_tool);

    }
    /*}}}*/
/*{{{*/
if(log_this) {
    if(consumed_by) log("%c"+caller+":%c consumed_by %c TARGET "+consumed_by, lbb+lbH+lf3, lbL, lbb+lbH+lf4);
    else            log("%c"+caller+":%c rejected_by %c PAGE "  +rejected_by, lbb+lbH+lf3, lbL, lbb+lbH+lf8);
}
    return consumed_by;
/*}}}*/
};
/*}}}*/
/*_ onUp_3_DOC_TOOL_CB {{{*/
let onUp_3_DOC_TOOL_CB = function(e,clicked,dblclicked)
{
    /* clicked dblclicked consumed TOOL {{{*/
let   caller = "onUp_3_DOC_TOOL_CB";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller, lf3);

    if( !onWork_EL                         ) return "";
    if( dblclicked                         ) return "";
    if( t_event_has_been_consumed(caller)  ) return "";

    let consumed_by;
    /*}}}*/
    /* [clicked doc_div] .. (PLAYGROUND EMBEDDED TOOL) {{{*/
    if( clicked )
    {
        let doc_div = onWork_EL.id.startsWith("doc_evt_div") ? doc_evt_div
            :         onWork_EL.id.startsWith("doc_log_div") ? doc_log_div
            :         null;
        if(doc_div) {
            if(has_el_class(onWork_EL, CSS_CLOSEPIN)) {
                consumed_by     = "EMBEDDED TOOL: CLOSING "+doc_div.id;
                t_doc_div_clear(doc_div.id);
            }
            else {
                consumed_by     = "EMBEDDED TOOL: CLICK IGNORED";
            }
        }
        else {
if(log_this) log("NO DOC EMBEDDED TOOL");
        }
    }
    /*}}}*/
    /* [hotspot] [NOT clicked] + [NOT has_moved] {{{*/
/*{{{
    if(      !clicked
          && !has_moved
          && (onWork_PANEL == hotspot)
      ) {
        consumed_by = "hotspot LONG CLICK: ... DO SOMETHING";

    }
}}}*/
    /*}}}*/
if(log_this) log(consumed_by);
    return consumed_by;
};
/*}}}*/
/*_ onUp_4_DOC_TOUCH_CB {{{*/
let onUp_4_DOC_TOUCH_CB = function(e,clicked,dblclicked)
{
/*{{{*/
let   caller = "onUp_4_DOC_TOUCH_CB";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller, lf4);
/*}}}*/
    /* dismissed_by .. f(!clicked OR dblclicked OR t_event_has_been_consumed) {{{*/
    let is_a_tool = t_is_a_tool_el(onWork_EL, caller);

    let dismissed_by
        = (!clicked                          ) ? "!clicked"
        : ( is_a_tool                        ) ? "is_a_tool"
        /*( prop_get( ANCHOR_FREEZE )        ) ? ANCHOR_FREEZE*/
        : ( dblclicked                       ) ? "dblclicked"
        : ( t_event_has_been_consumed(caller)) ? t_event_consumed_cause
        :                                        ""
    ;

    if(dismissed_by) {
if( log_this) log("%c"+caller+"%c dismissed_by %c"+dismissed_by, lf4, lbA, lf9);
        return "";
    }
    /*}}}*/
    /* dismissed_by .. f((NO el_event_handler) {{{*/
    let el_event_handler  = get_el_event_handler(onWork_EL, caller);
    dismissed_by
        = (el_event_handler == null)
        ? "NO EVENT HANDLER"
        : "";
    if(dismissed_by) {
if( log_this) log("%c"+caller+"%c dismissed_by %c"+dismissed_by, lf4, lbA, lf9);
        return "";
    }
    /*}}}*/
    /* MOBILE el_event_handler .. CALLING {{{*/
if( log_this) log("...handler=["+el_event_handler.label+"]");
    let consumed_by = onUp_el_event_handler(e, el_event_handler);

    /*}}}*/
if(log_this) log(consumed_by);
    return consumed_by;
};
/*}}}*/
/*_ onUp_5_TOOL_ONCLICK {{{*/
let onUp_5_TOOL_ONCLICK = function(e,clicked,dblclicked)
{
    /* TOOL {{{*/
let   caller = "onUp_5_TOOL_ONCLICK";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

    let dismissed_by
    = ( t_event_has_been_consumed(caller)  ) ? t_event_consumed_cause
    : (!t_is_a_tool_el(onWork_EL, caller)  ) ? "NOT A TOOL ["+get_n_lbl(onWork_EL)+"]"
    :                                          "";
if( log_this && dismissed_by) log("%c"+caller+"%c dismissed_by %c"+dismissed_by, lf5, lbA, lf9);
    if(dismissed_by) return "";
if( log_this) log("%c"+caller, lf5);

    let consumed_by = "ON TOOL "+get_n_lbl(onWork_EL);
    /*}}}*/
    /* PANEL or [target_tool] MOVED .. TOOLS LAYOUT STORAGE UPDATE {{{*/
    if(has_moved && (onWork_PANEL || (onWork_EL == target_tool)))
    {
        t_store_update_post(caller);
    }
    /*}}}*/
    /* MOVE OR (slightly moved) CLICK {{{*/
    if(onWork_PANEL && clicked && has_moved)
    {
        if(t_check_big_moved(onMoveDXY.x, onMoveDXY.y, caller) )
        {
if(log_this) log("%c [CLICKED + BIG   MOVE] .. CANCEL CLICK ON ["+get_n_lbl(onWork_PANEL)+"]", lf5);
            clicked = false;
        }
        else {
if(log_this) log("%c [CLICKED + SMALL MOVE] .. CANCEL MOVE  ON ["+get_n_lbl(onWork_PANEL)+"]", lf6);
            t_clr_has_moved(caller);
        }
    }
    /*}}}*/
    /* {{{*/
/*
TODO: already called at this point by move handler
    if(clicked && !has_moved && onWork_PANEL)
    {
        t_tool_set_panel_xy(onWork_PANEL, onDown_PANEL_XY.x, onDown_PANEL_XY.y);
        t_tool_set_top_xy  (caller      , onDown_PANEL_XY.x, onDown_PANEL_XY.y);
    }
*/
    /*}}}*/
    /* PANEL DRAGGED .. t_sync_layout {{{*/
/* NO .. onUp_8_TOOLS_LAYOUT_HANDLER should do the job with a delay
    let pinned = onWork_PANEL && onWork_PANEL.classList.contains(CSS_PINNED);
    if(!pinned)
        t_sync_layout(caller, 0);
*/
    /*}}}*/
    /* TODO - delayed hide pivspot - shown by onDown_4_TOOL_DRAG_PUSH_PIN */
    /* DBLCLICKED .. STANDBY .. FASTCLICK .. CLEAR {{{*/
/*{{{
logXXX(caller+": ......clicked=["+   clicked+"]");
logXXX(caller+": ...dblclicked=["+dblclicked+"]");
}}}*/

    if(dblclicked) {
/*{{{
        if(      t_clear_ON_DBLCLICK_for( onWork_EL    ) ) { consumed_by += " DBLCLICK CLEAR"  ;    t_clear(caller);                                  }
}}}*/
        if     ( t_filter_STANDBY_for   ( onWork_PANEL ) ) { consumed_by += " DBLCLICK STANDBY";    t1_onclick( onWork_EL   , 0, true        ); }
        else if( t_shake_ON_DBLCLICK_for( onWork_PANEL ) ) { consumed_by += " DBLCLICK TOOLPIN";
            if(! t_has_push_pin_on_panel( onWork_PANEL ) )                                          t_add_toolpins_on_panel ( onWork_PANEL );
            else                                                                                    t_del_toolpins_on_panel ( onWork_PANEL );
            clicked = false;
        }
    }
    /*}}}*/
    /* CLICKED .. [hotspot] .. [EDIT_OR_STAGE] .. [dom_hide] {{{*/
    if(   (hotspot == onWork_PANEL)
       &&  prop_get( EDIT_OR_STAGE )
/*     &&  t_gutter_is_XY_IN(h_x, h_y) */
      ) {
        if( clicked ) {
            prop_toggle( MASK_OR_HIDE );
            consumed_by += " CLICK .. NODE TO HIDE "+ (prop_get( MASK_OR_HIDE ) ? "MASKED" : "HIDDEN");
        }
        /* TODO: to make [dblclicked] work .. [clicked] should be prevented somehow */
/*{{{
        if(dblclicked) {
            consumed_by += " DBLCLICK .. NODE TO CLEAR HIDDEN NODES";
            dom_hide1_reset();
        }
}}}*/

    }
    /*}}}*/
/*{{{
logBIG(caller+": "+consumed_by, lbb+lf7);
}}}*/
    /* CLICKED onWork_SEEK_TOOL ..  HIDING {{{*/
    if(       clicked
          && (onWork_SEEK_TOOL && !t_is_a_tool_el(onWork_SEEK_TOOL))
      ) {
if( log_this) log("%c clicked ON %c onWork_SEEK_TOOL %c"+get_id_or_tag(onWork_SEEK_TOOL)+"%c WHICH IS NOT A TOOL"
                  ,lbH+lf5      ,lbL+lf6            ,lbR+lf6                             ,lbH+lf5                );

        t_seeker_PU_hide("instant");

        consumed_by = "";
    }
    /*}}}*/
    /* CLICKED .. PIVOT-MAGNIFY .. CLICK-HANDLER .. [t1_onclick] {{{*/
    else if( clicked && !has_moved) {
/*{{{
        if     ( target_tool && (onWork_SEEK_TOOL == target_tool) ) { consumed_by += " target_tool   HANDLER"; t1_onclick( onWork_EL                    ); }
}}}*/
        if     ( target_tool        ==  onWork_EL                 ) { consumed_by += " target_tool   HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( dimm_mask          ==  onWork_EL                 ) { consumed_by += " dimm_mask     HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( t_filter_SEL_CLICK_for(onWork_EL               ) ) { consumed_by += " DOC SEL CLICK HANDLER"; t1_onclick( onWork_EL   , 0, false       ); }
        else if( has_el_class          (onWork_EL, CSS_PUSH_PIN ) ) { consumed_by += " .. [push_pin] HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( has_el_class          (onWork_EL, CSS_CLOSEPIN ) ) { consumed_by += " .. [closepin] HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( has_el_class          (onWork_EL, CSS_SCALEPIN ) ) { consumed_by += " .. [scalepin] HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( has_el_class          (onWork_EL, CSS_CLEARPIN ) ) { consumed_by += " .. [clearpin] HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( t_tool_has_onclick_for(onWork_EL               ) ) { consumed_by += " onWork_EL     HANDLER"; t1_onclick( onWork_EL                    ); }
        else if( t_tool_has_onclick_for(onWork_PANEL            ) ) { consumed_by += " onWork_PANEL  HANDLER"; t1_onclick( onWork_EL   , T_ONCLICK_DELAY); }
        else {
            let el_event_handler
                =  get_el_event_handler(onWork_EL, caller);
            if(el_event_handler                                   )   consumed_by += onUp_el_event_handler(e, el_event_handler);
        }
    }
    /*}}}*/
    /* [has_moved] .. (t_pat_bag9_move_item_to_div) {{{*/
    else if(has_moved) {
        /* SUBTOOL MOVED {{{*/
        if(    mov_dst_div && mov_src_div
           && (mov_dst_div != mov_src_div)
          ) {
            consumed_by += t_pat_bag9_move_item_to_div( mov_dst_div );
        }
        /*}}}*/
        /* TOOL PANEL MOVED {{{*/
        else {
            consumed_by += " TOOL MOVED";

            /* TRANSCRIPT MOVED {{{*/
            let is_a_pinned_transcript
                =  (      (onWork_PANEL                 == transcript1)
                       || (onWork_PANEL                 == transcript2))
                && (       onWork_PANEL.classList.contains(CSS_PINNED ));

            if( is_a_pinned_transcript )
            {
                let  xy = get_el_xy(onWork_PANEL, caller);
                let key =           onWork_PANEL.id+"_XY";
                store_set_value(key, JSON.stringify(xy));
                consumed_by += " (a pinned transcript)";
            }
            /*}}}*/
        }
        /*}}}*/
    }
    /*}}}*/
    /* TODO - make clear what is prevented by this call... */
    if(consumed_by) t_event_set_e_consumed_by(e, consumed_by);

if( log_this) log("...return %c["+consumed_by+"]", lf5);
    return consumed_by;
};
/*}}}*/
/*_ onUp_6_DOC_CB {{{*/
let onUp_6_DOC_CB = function(e, clicked, dblclicked)
{
    /* !t_is_a_tool_el .. !has_moved .. !t_seeker_PU_is_active {{{*/
let   caller = "onUp_6_DOC_CB";
if(!is_a_DOM_LOAD_featured_function(caller)) return "";
let log_this = !onDown_SHIFT && (LOG_MAP.EV3_UP || LOG_MAP.T1_DOM_LOAD);

    let dismissed_by
        = ( t_is_a_tool_el(onWork_EL, caller)  ) ? "[onWork_EL] IS A TOOL"
        : ( has_moved                          ) ?   has_moved
        : ( t_seeker_PU_is_active()            ) ? "[seeker_PU] IS ACTIVE"
        :                                          "";
if( log_this && dismissed_by) log("%c"+caller+"%c dismissed_by %c"+dismissed_by, lf6, lbA, lf9);
    if(dismissed_by) return "";

if( log_this) log("%c"+caller, lf6);

    let consumed_by;
    /*}}}*/
    /* DOC CLICK {{{*/
    if(clicked && !dblclicked)
    {
        if( was_a_misclick() )
        {
if(log_this) logBIG("WAS A MISSCLICK", lf3);
            consumed_by = "DOC MISSCLICK";

/*{{{ //FIXME_PARKED
            let parked = !t_target_tool_all_parked();
            t_target_tool_set_parked_handler(parked, consumed_by)
}}}*/
        }
        else {
            consumed_by = "DOC CLICKED";
            /* 1/3 - ON DOC SELECTION .. CLEAR SELECTION {{{*/
            if( onWork_SEEK_TOOL )
            {
                let slot     = t_get_EL_slot(onWork_EL);
                consumed_by += " clear_slot("+slot+")";

                t_clear_slot( slot );
            }
            /*}}}*/
            /* 2/3 -!EDIT_OR_STAGE ON HOTSPOT IN GUTTER .. HIDE CONTAINER {{{ */
            else if( prop_get( EDIT_OR_STAGE ) )
            {
                let range = get_range_from_XY(onDown_XY.x, onDown_XY.y);
                if( range.startContainer )
                {
                    let    container  = get_text_container( range.startContainer );
                    if(    container
                           && (container != document.body)
                           && (container != document.documentElement)
                      ) {
                        consumed_by += " .. dom_hide1_container_clicked("+get_n_lbl(container)+")";

                        t_window_getSelection_removeAllRanges(caller);
                        dom_hide1_container_clicked( container );
                    }
                }
            }
            /*}}}*/
            /* 3/3 - ON A DOC WORD .. ADD A SELECTION {{{*/
            else {
                /* [SELECT WORD] .. (NO EVENT HANDLER] {{{*/
                if( !get_el_event_handler(onWork_EL,caller) )
                {
                    consumed_by += " SELECT WORD .. (NO EVENT HANDLER) for ["+get_n_lbl(onWork_EL)+"]";

                    onUp_6_DOC_CB_CLICK_WORD(consumed_by);
                }
                /*}}}*/
                /* [EVENT HANDLER NOT FREEZED] .. OR .. [CLICK WORD] {{{*/
                else {
                    if(prop_get( ANCHOR_FREEZE )) {
                        consumed_by += " SELECT WORD .. (EVENT HANDLER FREEZED)";
                        t_preventDefault(e, caller+" "+consumed_by);

                        onUp_6_DOC_CB_CLICK_WORD(consumed_by);
                    }
                    else {
                        /* NOTE: [anchor_freeze should have been processed by onUp_4_DOC_TOUCH_CB] */
                        consumed_by += " CLICK WORD .. (EVENT HANDLER NOT FREEZED";
                        t_acceptBubble(e, caller+" "+consumed_by);

                    }
                }
                /*}}}*/
            }
            /*}}}*/
        }
    }
    /*}}}*/
if(log_this && consumed_by) log("%c"+consumed_by, lbb+lbH+lf6);
    return consumed_by;
};
/*}}}*/
/*_ onUp_6_DOC_CB_CLICK_WORD {{{*/
let onUp_6_DOC_CB_CLICK_WORD = function(_consumed_by)
{
/*{{{*/
let   caller = "onUp_6_DOC_CB_CLICK_WORD";
if(!is_a_DOM_LOAD_featured_function(caller)) return "";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) caller += "("+_consumed_by+")";
/*}}}*/
    /* SEARCH DOC {{{*/
    call_s_touchedWord(onDown_XY.x, onDown_XY.y);

    /*}}}*/
    /* GOT NO SELECTION RANGE {{{*/
    if( !s_touchedWord_range_parent )
    {
if( log_this) log("%c "+caller+" %c NO SELECTION RANGE",lbL+lf6  ,lbR+lf2);

        return;
    }
    /*}}}*/
    /* GOT NO SELECTED SLOT {{{*/
    if( !s_touchedWord_slot )
    {
if( log_this) log("%c "+caller+" %c NO TOUCHED WORD SLOT",lbL+lf6  ,lbR+lf2);

        return;
    }
    /*}}}*/
    /* GOT NO SLOT PATTERN .. RESELECTING ALL PATTERNS {{{*/
    if( !ccs[s_touchedWord_slot].pattern )
    {
if( log_this) log("%c "+caller+" %c NO TOUCHED WORD PATTERN: RESELECTING",lbL+lf6  ,lbR+lf2);

        t_pat_bag3_reselect_all();
/*{{{
logXXX("%c "+caller+" %c NO TOUCHED WORD PATTERN: NOT RESELECTING", lbL+lf6, lbR+lf2);
}}}*/
        return;
    }
    /*}}}*/
if( log_this) log("%c"+caller+" %c s_touchedWord_slot %c "+s_touchedWord_slot, lbL+lf6, lbC, lbR+lfX[s_touchedWord_slot]);
    /* SYNC CONTAINER AND BAGS {{{*/
    t_set_touchedWord_startContainer();

    t_onPatternUpdate("DOCUMENT <em>"+ _consumed_by +"</em>", caller);
    /*}}}*/
};
/*}}}*/
/*_ onUp_7_ON_EVENT_CONSUMED {{{*/
let onUp_7_ON_EVENT_CONSUMED = function(e)
{
let   caller = "onUp_7_ON_EVENT_CONSUMED";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller +" "+t_event_consumed_cause, lf7);

    return t_event_has_been_consumed(caller);
};
/*}}}*/
/*_ onUp_8_ON_MOUSEUP_DONE {{{*/
/*{{{*/
const   TOOLS_LAYOUT_ON_MOUSEUP_HANDLER_DELAY = 500;

let   t_tools_layout_on_mouseup_timer;
/*}}}*/
let onUp_8_ON_MOUSEUP_DONE = function(e)
{
/*{{{*/
let   caller = "onUp_8_ON_MOUSEUP_DONE";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) t_log_event_status(caller, lf8);
/*}}}*/
    /* HIDE TRANSIENT TOOLS .. [hotspot] [pivspot] BAGS [seeker_PU] [seeker_CU] [misclick] {{{*/
    add_el_class(pivspot, CSS_HIDDEN);

    /* SYNC SEEKER .. [CLEAR LONG-PRESS-ARM STATE] */
    if( has_el_class(seeker_CU, LONG_PRESS_ARM) )
    {
        del_el_class(seeker_CU, LONG_PRESS_ARM);
if( log_this) logBIG("REVIVE SEEKER .. f(LONG_PRESS_ARM)");

        t_seeker_PU_show();
    }

    del_el_class(seeker_CU, LONG_PRESS_ARM);

    move_cooldown_clear_pending();

    /* EDITING DONE */
    if(    has_moved && (onWork_PANEL == hotspot)
       &&  prop_get( EDIT_OR_STAGE )
       && !t_gutter_is_XY_IN(h_x, h_y)
      )
        t_gutter_drag_hotspot_OUT(h_x, h_y, caller);

    /* [target_tool] MOVING DONE */
    if(has_moved && (onWork_EL == target_tool))
        onMove_2_TARGET_TOOL_MOVE_ONGRID_handler();

    if( t_pat_bag9_grab_item_mov_div_is_showing() )
        t_pat_bag9_grab_item_mov_div_drop();

    t_check_on_seeker_clear();

    t_set_body_style_overflow_hidden(false);

    if( t_raise_pivot_PANEL_called_since_onDown(caller) )
        t_raise_pivot_PANEL_reset( caller );

    /*}}}*/
    t_target_tool_sync_pastable();
/* [bag] .. (drift) {{{*/
/*
    pat_bag.style.marginLeft = 0;
    pat_bag.style.marginTop  = 0;
    bak_bag.style.marginLeft = 0;
    bak_bag.style.marginTop  = 0;
    off_bag.style.marginLeft = 0;
    off_bag.style.marginTop  = 0;
*/
/*}}}*/
    /* [seeker_PU] {{{*/
    if(seeker_PU)
    {
        for(let i = 1; i <= SELECT_SLOT_MAX; ++i) {
            set_id_class_on_off(seeker_PU.id, "slot_color"+i, false);
        }
        set_el_class_on_off(seeker_PU,  SHOW_SEEKZONE , false);
    }
    /*}}}*/
    /* [seekzone] {{{*/
    if( prop_get( SHOW_SEEKZONE ) )
    {
        if( was_a_misclick() )
            t_seekzone1_show("onUP .. was_a_misclick");
/*{{{
        else t_seekzone4_hide();
}}}*/
    }
    /*}}}*/
    /* [target_tool] {{{*/
    if( target_tool )
    {
if(log_this) {
    let s = log_key_val(    caller
                       , {  was_a_misclick : was_a_misclick()
                          , was_a_click    : was_a_click   ()
                          , was_a_dblclick : was_a_dblclick()
                          ,      has_moved : has_moved
                          ,       CONSUMED : t_event_consumed_cause
                         } , lf8
                       );
}

        if(has_el_class(target_tool, CSS_PRESSED)) {
if(log_this) log("%c RELEASING CSS_PRESSED ["+target_tool.id+"]", lbb+lbH+lf8);
            del_el_class(target_tool, CSS_PRESSED);
        }

/*{{{
        if(was_a_click() && !has_moved && has_el_class(target_tool, CSS_LIFTED)) {
if(log_this) log("%c was_a_click .. UNLIFTING ["+target_tool.id+"]", lbb+lbH+lf7);
            t_target_tool_set_lifted(false);
        }
}}}*/

    }
    /*}}}*/

    clr_click_last_result();

    /* POST EVENT DONE HANDLER {{{*/
    if(has_moved || call_t_grid_IS_ON_GRID(caller) || cached_user_options_map.length) {
        t_tools_layout_on_mouseup_timer = setTimeout(onUp_8_TOOLS_LAYOUT_HANDLER, TOOLS_LAYOUT_ON_MOUSEUP_HANDLER_DELAY);
    }
    else {
        let _log_this = false;
        t_clr_onWork_EL(caller, _log_this);

if( log_this) t_log_event_status(caller, lbb+lf8);
    }
    if( t_preventDefault_caller )
        t_restoreDefault("ON UP DONE");

    onWork_MOVABLE_CHILD = null;
    /*}}}*/
};
/*}}}*/
/*_ onUp_8_TOOLS_LAYOUT_HANDLER {{{*/
let onUp_8_TOOLS_LAYOUT_HANDLER = function()
{
let caller   = "onUp_8_TOOLS_LAYOUT_HANDLER";
let log_this = !onDown_SHIFT && (LOG_MAP.EV0_LISTEN || logging_EVENTS || LOG_MAP.EV3_UP);

    if(call_t_grid_IS_ON_GRID(caller)) return;

    /* TOOL PANELS LAYOUT {{{*/
    if( t_cache_changed(  caller) ) {
        t_cache_layout("Tools layout adjusted");
        t_tool_set_top_xy(caller, topTool.x, topTool.y);
    }
    t_set_onWork_EL(null, caller);
if( log_this) t_log_event_status(caller, lbb+lf8);

    let h_xy = get_el_xy(hotspot, caller);
    t_raise_pivot_PANEL(caller);
    t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) );

    del_el_class(dom_tools_html, CSS_REGROUPING);

    /*}}}*/
    /* TOOL ACCESSORIES RESET {{{*/
    t_hide_hov();

    /*}}}*/

    t_reinstate_USER_OPTIONS( caller );
};
/*}}}*/

/*_ onUp_el_event_handler {{{*/
let onUp_el_event_handler = function(e, el_event_handler)
{
/*{{{*/
let   caller = "onUp_el_event_handler";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller, lbb+lf7);
/*}}}*/
    let consumed_by;
    /* MOBILE el_event_handler .. CALLING {{{*/

if( log_this) log("behavior_TOUCH_ELSE_DESKTOP=["+behavior_TOUCH_ELSE_DESKTOP+"]");
if( log_this) log("t_preventDefault_caller=["+t_preventDefault_caller+"]");

    if(behavior_TOUCH_ELSE_DESKTOP && t_preventDefault_caller)
    {
        consumed_by = "MOBILE  CALLING EVENT HANDLER ["+ get_n_lbl(onWork_EL) +"] ["+el_event_handler.label+"] HANDLER";

        if(t_preventDefault_caller) t_restoreDefault("ON TOUCH UP");

        el_event_handler.handler(e);
        t_cache_init_by( consumed_by );
    }
    /*}}}*/
    /* DESKTOP DOC EVENT HANDLER .. BUBBLING {{{*/
    else {
        consumed_by = "DESKTOP BUBBLING TO DOC EVENT HANDLER <em>"+ get_n_lbl(onWork_EL) +"</em> HANDLER";
    }
    /*}}}*/
if(log_this) log(consumed_by);
    return consumed_by;
};
    /*}}}*/

/*_ t_tool_has_onclick_for {{{*/
let t_tool_has_onclick_for = function(el)
{
/*{{{*/
let   caller = "t_tool_has_onclick_for";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

    if(!el   ) return false;
    if(!el.id) return false;

if( log_this) log(caller+": prop_get_EL("+el.id+")=["+get_n_lbl(prop_get_EL(el.id))+"]");
/*}}}*/

    let bag_id = get_bag_id(el);

    let result
        = (                         (bag_id != "") /* DELEGATED TO CONTAINER PANEL   */
           || t_is_a_toggle_option  ( el.id      ) /* DYNAMICALLY ADDED TOOL TARGETS */
           || get_n_lbl( prop_get_EL( el.id     )) /* DYNAMICALLY ADDED PROP TOOL    */
          );

/*{{{*/
if( log_this)
    log("%c "+caller+"("+get_n_lbl(el)+"): %c ...return "+result   +"%c el=["+get_n_lbl(el)+"]%c bag=["+bag_id+"]%c parent=["+get_n_lbl(get_el_parent_with_id(el))+"]"
        ,lbL                              ,lbR+(result ? lf5 : lf8) ,lbL                     ,lbC+lf3           ,lbR+lf7                                              );
/*}}}*/
    return result;
};
/*}}}*/
/*_ t_is_a_toggle_option {{{*/
let t_is_a_toggle_option = function(id)
{
/*{{{*/
let   caller = "t_is_a_toggle_option";
let log_this = !onDown_SHIFT && LOG_MAP.EV3_UP;

/*{{{
if( log_this) prop_log_MAP(caller);
}}}*/
/*}}}*/
    if(!id) return false;
    let result
        =  (id == ANCHOR_FREEZE)
        || (id ==  CONTAINERS_HI   )
        || (id ==  SCROLL_SMOOTH   )
        || (id ==  OVERFLOW_VISI   )

        || (id ==  SHOW_SEEKZONE   )
        || (id ==  PIN_SEEKSPOT    )
        || (id ==  LOG_SEEKSPOT    )

        || (id ==  SITE_OR_PAGE    )
        || (id ==  MASK_OR_HIDE    )
        || (id ==  EDIT_OR_STAGE   )
        || (id ==  DOM_HIDE1_RESET )
        || (id ==  DENY_OR_ALLOW   )

        || (id ==  THEME_DARK      )
        || (id ==  TOOLS_TRAP      )
        || (id ==  TOOLS_EXTRAS    )
        || (id ==  TOOLS_SCROLL    )

        || (id ==  WORDING         )
        || (id ==  WORDS_EXACT     )
        || (id ==  WORDS_SEGMENT   )
        || (id ==  WORDS_HEAD_TAIL )
        || (id ==  WORDS_OPCYCLE   )

        || id.startsWith( SQUEEZE_CYCLE )

        || t_get_words_drop_affix_array().includes(id)
    ;

/*{{{*/
if( log_this)
    log("%c "+caller+"("+id+"): %c ...return "+result
        ,lbL                   ,lbR+(result ? lf5 : lf8));
/*}}}*/
    return result;
};
/*}}}*/
/*_ t_filter_STANDBY_for {{{*/
let t_filter_STANDBY_for = function(panel)
{
    if(    !panel   ) return false;
    if(    !panel.id) return false;
    return (onStandby_PANEL != null )
        && (onStandby_PANEL == panel)
    ;
};
/*}}}*/
/*_ t_filter_SEL_CLICK_for {{{*/
let t_filter_SEL_CLICK_for = function(el)
{
    if(    !el   ) return false;
    if(    !el.id) return false;
    return  el.id.startsWith("thumb_p_")
        ||  el.id.startsWith("thumb_s_")
    ;
};
/*}}}*/
/*_ t_clear_ON_DBLCLICK_for {{{*/
let t_clear_ON_DBLCLICK_for = function(el)
{
    if(     !el   ) return false;
    if(     !el.id) return false;

    return  (el.id.startsWith( "transcript"));
};
/*}}}*/
/*_ t_shake_ON_DBLCLICK_for {{{*/
let t_shake_ON_DBLCLICK_for = function(el)
{
    if(     !el   ) return false;
    if(     !el.id) return false;

    return  has_el_class(el, CSS_TRANSCRIPT);

};
/*}}}*/
/*}}}*/
/* CHANGE */
/*{{{*/
/* TOOL onchange {{{*/
/*_ onchange {{{*/
let onchange = function(e)
{
let log_this   = (LOG_MAP.EV0_LISTEN || logging_EVENTS || LOG_MAP.EV6_CHANGED);

    let caller = "onchange";
/*
if( log_this) log(caller+": TARGET=["+get_n_lbl(t_get_event_target(e, caller))+"]");
*/

    if(log_this) {
        console_clear(caller);
        log(caller+":");
        log("...e.srcElement=["+ e.srcElement.id +"]");
        log("...e.....target=["+ e.    target.id +"]");
        console_dir( e );
    }
    t_sync_layout(caller);
};
/*}}}*/

/*}}}*/
/* TOOL CB {{{*/
/*_ t_dom_traversal_CB {{{*/
let t_dom_traversal_CB = function(e_target, e_type)
{
/*{{{
if( t_preventDefault_has_been_called("t_dom_traversal_CB") ) return;
}}}*/
    /* log {{{*/
    let caller   = "t_dom_traversal_CB("+get_n_lbl(e_target)+", e_type=["+e_type+"])";
let log_this = logging_EVENTS || LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf5);
    /*}}}*/
    /* [has_moved] [INPUT] {{{*/
    if( has_moved                         ) return;
    if(e_target.tagName == "INPUT"        ) return;
    if( t_event_has_been_consumed(caller) ) return;

    /*}}}*/
    /* [focussed] [t_clear] {{{*/
if(e_target) del_el_class(e_target, CSS_FOCUSSED);
/*
t_clear( caller );
*/
    /*}}}*/
    /*  keyword {{{*/
    let keyword;
    if(!keyword) try { keyword =                e_target.id;                   } catch(ex) {}
    if(!keyword) try { keyword = get_first_word(e_target.textContent, caller); } catch(ex) {}
    if(!keyword)       keyword =                e_type;
/*{{{
logXXX("keyword=["+keyword+"]");
}}}*/
    /*}}}*/
    switch(keyword) {
        /* Traversal {{{*/
        case "NodeIterator":
        case "TreeWalker"  :
        case "childNodes"  :
        case "tagNodes"    :
        {
            current_traversal = keyword;

if(log_this) log("%c SETTING current_traversal to %c"+current_traversal, lbL, lbR);
        }
        break;
        /*}}}*/
        /* CLEAR: tools_node {{{*/
        case "node":
        {
if(log_this) log_set_TR_SELECT("<em class='big'>CLEAR: tools_node</em>");

            /* VALUE CLEAR BY CB */
            tools_node = "";

            /* INPUT CLEAR BY CB */
            if(tools_node_input) tools_node_input.value = "";
        }
        break;
        /*}}}*/
        /* CHANGE: tools_node {{{*/
        case "tools_node"  :
        {
            if(e_target.id != "tools_node") t_set_tool_id_value("tools_node", keyword);

if(e_target && log_this) log_set_TR_SELECT("<em class='big'>CHANGE: tools_node ["+ keyword +"]</em>");
        }
        break;
        /*}}}*/
        /* SET: tools_node {{{*/
        case "html":
        case "head":
        case "body":
        {
            /* VALUE FROM CB */
            t_set_tool_id_value("tools_node", keyword);

if(log_this) log_set_TR_SELECT("<em class='big'>SET</em> : <em>tools_node "+ keyword +"</em>");
        }
        break;
        /*}}}*/
        /* default: {{{*/
        default: {
            if(log_this) log("...default: keyword=["+keyword+"]");
            return;
        }
        /*}}}*/
    }
    /* APPLY [tools_node + tools_filter] */
    t_call_dom_traversal();

t_cache_init_by(caller+": keyword=["+keyword+"]");
};
/*}}}*/
/*_ t_call_dom_traversal {{{*/
let current_traversal = "TreeWalker";

let t_call_dom_traversal = function()
{
/*{{{*/
let   caller = "t_call_dom_traversal";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

    let tools_filter = t_get_tool_id_value("tools_filter");
    let tools_node   = t_get_tool_id_value("tools_node"  );
if( log_this) log("...current_traversal...=["+  current_traversal +"]");
if( log_this) log("...tools_filter........=["+  tools_filter      +"]");
if( log_this) log("...tools_node..........=["+  tools_node        +"]");

    switch( current_traversal )
    {
        case "NodeIterator": call_check_NodeIterator(tools_node, tools_filter); break;
        case "TreeWalker"  : call_check_TreeWalker  (tools_node, tools_filter); break;
        case "childNodes"  : call_check_childNodes  (tools_node, tools_filter); break;
        case "tagNodes"    : call_check_tagNodes    (tools_node, tools_filter); break;
    }
    t_onPatternUpdate("CALLING DOM TRAVERSAL <em class='cc9'>"+ ellipsis_short(tools_filter) +"</em>", caller);

    t_sync_layout(caller);
    if( tools_filter_input ) t_focus( tools_filter_input );
};
/*}}}*/
/*_ t_log_option_changes {{{*/
let t_log_option_changes = function(changes)
{

    let options
        = prop_get( WORDS_EXACT   ) ? WORDS_EXACT
        : prop_get( WORDS_SEGMENT ) ? WORDS_SEGMENT
        :                             WORDS_HEAD_TAIL
    ;
    let s = "<em>"+changes+"</em>" +"<br>"+LF
        +"<table>"+LF
        +"<tr><th>OPTIONS:</th></tr>"+LF
        +"<tr>"
        +" <td>"+ get_log_option_state( TOOLS_SCROLL       , prop_get( TOOLS_SCROLL       )     ) +"</td>"
        +" <td>"+ get_log_option_state( ANCHOR_FREEZE      , prop_get( ANCHOR_FREEZE      )     ) +"</td>"
        +" <td>"+ get_log_option_state( CONTAINERS_HI      , prop_get( CONTAINERS_HI      )     ) +"</td>"
        +" <td>"+ get_log_option_state( SCROLL_SMOOTH      , prop_get( SCROLL_SMOOTH      )     ) +"</td>"
        +" <td>"+ get_log_option_state( OVERFLOW_VISI      , prop_get( OVERFLOW_VISI      )     ) +"</td>"
        +" <td>"+ get_log_option_state( TOOLS_EXTRAS       , prop_get( TOOLS_EXTRAS       )     ) +"</td>"
        +"</tr>"+LF
        +"<tr>"
        +" <td>"+ get_log_option_value("WORDS OPTIONS"     , t_get_words_options_symbol( options )     )
        +" <td>"+ get_log_option_state( WORDS_EXACT        , prop_get( WORDS_EXACT        )     ) +"</td>"
        +" <td>"+ get_log_option_state( WORDS_SEGMENT      , prop_get( WORDS_SEGMENT      )     ) +"</td>"
        +" <td>"+ get_log_option_state( WORDS_HEAD_TAIL    , prop_get( WORDS_HEAD_TAIL    )     ) +"</td>"
        +" <td>"+ get_log_option_state( WORDS_OPCYCLE      , prop_get( WORDS_OPCYCLE      )     ) +"</td>"
        +" <td>"+ get_log_option_state( WORDING            , prop_get( WORDING            )     ) +"</td>"
        +" <td>"+ get_log_option_state( THEME_DARK         , prop_get( THEME_DARK         )     ) +"</td>"
        +"</tr>"+LF
        +"<tr>"
      /*+" <td>"+ get_log_option_value("tools_node"        , "<em class='cc9'>"+tools_node  +"</em>" )         */
      /*+" <td>"+ get_log_option_value("tools_filter"      , "<em class='cc9'>"+tools_filter+"</em>" )         */
      /*+" <td>"+ get_log_option_state("filter_auto"       , filter_auto                             ) +"</td>"*/
      /*+" <td>"+ get_log_option_state("transcripts"       , transcripts                             ) +"</td>"*/
        +"</tr>"+LF
        +"<tr>"
        +" <td>"+ get_log_option_state("logging_EVENTS"    , logging_EVENTS                          ) +"</td>"
        +" <td>"+ get_log_option_state("logging_HIGHLIGHT" , logging_HIGHLIGHT                       ) +"</td>"
        +" <td>"+ get_log_option_state("logging_TOOLBAR"   , logging_TOOLBAR                         ) +"</td>"
        +"</tr>"+LF
        +"<tr><th>CSS:</th></tr>"+LF
        +"<tr>"
        + "<td><em class='em_match'  >em_match  </em></td>"
        + "<td><em class='em_missing'>em_missing</em></td>"
        +"</tr>"+LF
        +"</table>"+LF
    ;

    log_set_TR_LAYOUT("<div id='log_tags_div'>"+ s +"</div>");
};

let get_log_option_state = function(option, state)
{
    let     mark = state ? SYMBOL_CHECK_MARK : SYMBOL_NOT_CHECKED;
    let em_class = state ?             "cc2" : "cc8";
    return option +" <em class='"+em_class+"'>"+ mark     +"</em>    ";
};

let get_log_option_value = function(option, value_em)
{
    return option +" "+ value_em;
};

/*}}}*/
/*_ t_override_USER_OPTION .. (called while adjusting .. by s_touchedWord_adjust) {{{*/
/*{{{*/
let t_override_USER_OPTION = function(key, val)
{
/*{{{*/
let   caller = "t_override_USER_OPTION("+key+", "+val+")";
let log_this = logging_something();

if( log_this) log(caller);
/*}}}*/
    if(!cached_user_options_map_get(key) ) {
        cached_user_options_map_set(key, prop_get(key));
if(log_this) log(caller+": ...caching USER OPTION %c"+key+"%c"+val, lbL+lf3, lbR+lf3);
    }
if(log_this) log(caller+": ...overriding "+key+" option from %c "+cached_user_options_map_get(key)+" %c to %c "+val, lb1,lbA ,lb2);
    prop_set(key, val);
};
/*}}}*/
/*_ t_reinstate_USER_OPTIONS .. (called when done .. by onDown_1_INIT_CTRL_DEBOUNCE_INPUT) {{{*/
let t_reinstate_USER_OPTIONS = function(key)
{
/*{{{*/
let   caller = "t_reinstate_USER_OPTIONS("+key+")";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV0_LISTEN;

if( log_this) log(caller);
/*}}}*/
    for(let i=0; i< cached_user_options_map.length; ++i)
    {
        let    key =   cached_user_options_map[i].key;
        let cached =   cached_user_options_map[i].val;
        let option =                prop_get(key);
        if( option != cached) {
if(log_this)
        log(caller+": ...restoring %c"+key+"%c option from %c"+option+"%c to %c"+cached+"]"
            ,                      lb1     ,lbA           ,lb4       ,lbA   ,lb3           );
            prop_set(key, cached);
        }
        else {
if(log_this)
        log(caller+": ............ %c"+key+"%c option ==== %c"+cached+"%c (as cached)"
            ,                      lb1     ,lbA           ,lb3       ,lbA             );
        }
    }
    cached_user_options_map = [];
};
/*}}}*/

/*_ t_onclick_target_handle_scroll_to_slot_num {{{*/
let t_onclick_target_handle_scroll_to_slot_num = function(e_target, _caller)
{

let log_this = LOG_MAP.EV5_TOOL_CB || LOG_MAP.T2_GRID || LOG_MAP.T6_SLOT;

if(log_this) log("t_onclick_target_handle_scroll_to_slot_num(e_target=["+get_n_lbl(e_target)+"]) ..%c CALLED BY "+ _caller, lb0);

    /* slot */
    let     slot  = get_slot_from_id_or_className(e_target);
    if(     slot <= 0) return "NO SLOT FOR "+get_n_lbl(e_target);

    if(!ccs[slot].thumbs) ccs[slot].thumbs = [];

    /* num */
    let num = get_num_from_id_or_className_slot(e_target, slot);
if(log_this) log_add_TR_SELECT(".slot=<em>"+slot+"</em> num=<em>"+num+"</em>");
if(log_this) log(              ".slot="    +slot     +" num="    +num        );

    /* next num .. f(last_highlight_thumb_p) */
    if(!num) {
        num = get_slot_num_for_thumb_p(slot, last_highlight_thumb_p, prop_get( SEL_BACK ));
if(log_this) log(".slot_num_for_thumb_p=["+ num +"]");

        /* next num .. (may wrap at boundaries) */
        let first = 1;
        let  last = ccs[slot].nodes.length;

        if(prop_get( SEL_BACK )) num = (num > first) ? num-1 : last;
        else                          num = (num < last ) ? num+1 : first;
if(log_this) log_add_TR_SELECT(".NEXT num=<em>"+num+"</em>");

    }
    let visible = scroll_to_slot_num(slot, num, 0);
    t_seeker_move_on_slot_num(slot, num, visible);

    let result = "TO THUMB slot=["+slot+"] num=["+num+"]";
if(log_this) log_add_TR_SELECT("<em class='cc4'>"+result+"</em>");

    return result;
};
/*}}}*/
/*}}}*/
/*_ [cached_user_options_map] ARRAY .. set get {{{*/

let cached_user_options_map = [];

let cached_user_options_map_set = function(key,val)
{
    cached_user_options_map.push({ key:key , val:val });
};

let cached_user_options_map_get = function(key)
{
    for(let i=0; i< cached_user_options_map.length; ++i) {
        if(key   == cached_user_options_map[i].key) {
            return  cached_user_options_map[i].val;
        }
    }
    return null;
};
/*}}}*/
/*}}}*/
/* TOOL standby {{{*/
/*_ t_standby_bag_id {{{*/
/*{{{*/
let T_STANDBY1_DELAY = 1.5 * CLICK_DURATION;
let t_standby1_timer = null;

/*}}}*/
let t_standby_bag_id = function(bag_id)
{
/*{{{
logBIG("t_standby_bag_id("+bag_id+")",lf1)
}}}*/
/*{{{*/
    let caller = "t_standby_bag_id("+bag_id+")";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbF+lb0);
if( log_this) log_add_TR_EVENT("<em class='cc1'>STANDBY</em> <em class='cc9'>"+bag_id+"</em>");
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, " <em class='cc9'>standby ["+bag_id+"]</em>");
/*}}}*/

    /* clear old */
    if(onStandby_PANEL) t_standby3_release("t_standby_bag_id");

    /* select new */
    if(bag_id) onStandby_PANEL = get_tool(bag_id);
    else       onStandby_PANEL = null;

    if(onStandby_PANEL) add_el_class(onStandby_PANEL, CSS_STANDBY);

if(onStandby_PANEL) if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_3_RESULT, " Setting "+bag_id+" on STANDBY");

    /* new timer */
    if(t_standby1_timer) clearTimeout(t_standby1_timer);
    t_standby1_timer =     setTimeout(t_standby1_handle, T_STANDBY1_DELAY);
};
/*}}}*/
/*_ t_standby1_handle {{{*/
let t_standby1_handle = function()
{
/*{{{
logBIG("t_standby1_handle",lf1)
}}}*/
    if(!onStandby_PANEL) return;

    let caller = "t_standby1_handle";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller+": ["+onStandby_PANEL.id+"]", lbF+lb1);

    switch( onStandby_PANEL.id )
    {
        case "pat_bag":
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_1_INPUT, " STANDBY HANDLE <em class='cc9'>"+onStandby_PANEL.id+"</em>");
        t_pat_bag_stage_target( pat_bag );
        break;

        case "sel_bag":
        prop_toggle( SEL_BACK );
if(log_this) log_add_TR_EVENT("_<em class='cc3'>SELBAG SELECT <em class='cc9'>"+(prop_get( SEL_BACK ) ? "BACKWARD" : "FORWARD")+"</em></em>");
        t_sync_seek_back(caller);
        break;
    }

    if( t_standby2_is_done(onStandby_PANEL.id, caller) )
        t_standby3_release(caller);
};
/*}}}*/
/*_ t_standby2_is_done {{{*/
let t_standby2_is_done = function(id,_caller)
{
/*{{{
logBIG("t_standby2_is_done",lf2)
}}}*/
let log_this = LOG_MAP.S2_SELECT;

/*
    let target_handled
        =               (id     != "pat_bag")
        || !has_el_class(pat_bag, CSS_OPEN_BAG)
    ;
*/
    let target_handled = true; /*TODO*/

if( log_this) log("%c t_standby2_is_done("+id+"): ...return ["+target_handled+"] %c .. CALLED BY "+ _caller, lbF+lb2, lb0);
    return target_handled;
};
/*}}}*/
/*_ t_standby3_release {{{*/
let t_standby3_release = function(_caller="timer")
{
/*{{{
logBIG("t_standby3_release",lf3)
}}}*/
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;
if( log_this) log("%c t_standby3_release: ["+get_n_lbl(onStandby_PANEL)+"] .. CALLED BY "+ _caller, lbF+lb3);

    if( !check_wall_of_text_done)
    {
logXXX("CALLING check_wall_of_text");
/*{{{
}}}*/
        check_wall_of_text();
    }

    if(!onStandby_PANEL) return;

    if(t_standby1_timer) clearTimeout( t_standby1_timer );
    /*..............................*/ t_standby1_timer = null; /* done */

    del_el_class(onStandby_PANEL, CSS_STANDBY);

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_3_RESULT, " STANDBY CLEAR <em class='cc9'>"+onStandby_PANEL.id+"</em>");

    onStandby_PANEL  = null;
};
/*}}}*/
/*}}}*/
/* TOOL CLEAR {{{*/
/*_ t_clear {{{*/
/*{{{*/
let T_CLEAR_INTERVAL_MIN = 500;
let t_clear_timeStamp    = 0;
/*}}}*/
let t_clear = function(_caller)
{
/*{{{*/
    let caller = "t_clear .. CALLED BY ["+_caller+"]";
let log_this = logging_something();
if( log_this) log(caller);
if( log_this) log("...t_preventDefault_caller=["+t_preventDefault_caller+"]");
/*
if( t_preventDefault_has_been_called("t_clear") ) return;
*/
/*}}}*/
    /* ...debounce {{{*/
    let          this_MS = new Date().getTime();
    let t_clear_interval = this_MS - t_clear_timeStamp;
    if( t_clear_interval < T_CLEAR_INTERVAL_MIN)
    {
if(log_this) log(caller+": BOUNCING: "+t_clear_interval+" < (T_CLEAR_INTERVAL_MIN "+T_CLEAR_INTERVAL_MIN+")");
        return;
    }
    t_clear_timeStamp = this_MS;

    /* clear log buffers */
    log();

    /* clear browser selection */
    t_window_getSelection_removeAllRanges(caller);

    /*}}}*/
    /* TARGET ACTION .. (pat_bag input cycle dblclick) {{{*/
    let target
        = caller.includes("pat_bag" ) ? "pat_bag"
        : caller.includes("EM"      ) ?      "em"
        : caller.includes("INPUT"   ) ?   "input"
        : caller.includes("cycle"   ) ?   "cycle"
        :                               "default"
        ;

    let action
        = caller.includes("dblclick") ? "dblclick"
        : was_a_dblclick()            ? "dblclick"
        : caller.includes("onclick" ) ? "onclick"
        :                               "default"
    ;

    let target_action = target+"."+action;

if(log_this) log(".target_action=["+target_action+"]");
    /*}}}*/
    switch(target_action) {
        /* IGNORE: TARGET=[EM INPUT] ACTION=[onclick .. dblclick] {{{*/
        case    "em.onclick": case    "em.dblclick":
        case "input.onclick": case "input.dblclick":
        case "cycle.default":

        break;
        /*}}}*/
        /* CLEAR : TARGET=[default ] ACTION=[           dblclick] {{{*/
        case "default.dblclick":

if(log_this) log(".fall through case default...");
        /*}}}*/
        /* CLEAR : default .. (transcript1 transcript2 doc_evt_div doc_log_div) {{{*/
        default:
/*{{{
if(!LOG_MAP.EV3_UP) console_clear_post(caller + (onWork_PANEL ? " on "+get_n_lbl(onWork_PANEL) : ""));
}}}*/

        /* LOG BUFFER */
        log();
if( LOG_MAP.EV3_UP) log("%c t_clear("+caller+") console logs preserved for %c LOG_MAP.EV3_UP", lb4, lbF+lb3);

        /* LOG TOOLS */
        log_clr_TR1(caller);
        log_clr_TR2(caller);

        /* bring back empty pinned panels within window viewport */
        if( transcript1.classList.contains(CSS_PINNED) ) t_clear_move_panel_within_window(transcript1);
        if( transcript2.classList.contains(CSS_PINNED) ) t_clear_move_panel_within_window(transcript2);

        /* DOCUMENT DIV */
        t_doc_div_clear("doc_evt_div");
        t_doc_div_clear("doc_log_div");

        /*}}}*/
    }
    t_outline_clear();
    /* CACHE */
    t_cache_init_by(caller);
};
/*}}}*/
/*_ t_clear_move_panel_within_window {{{*/
let t_clear_move_panel_within_window = function(panel)
{
    let caller = "t_clear_move_panel_within_window("+get_n_lbl(panel)+")";
let log_this = logging_something();

    let xy = get_el_xy(panel, caller);

    let margin      = hotring.clientWidth;

    let x_max = w_W - margin;
    let y_max = w_H - margin;
    let x_min =       0;
    let y_min =       0;

    let                                               panel_moved = false;
    if(xy.x > x_max) { panel.style.left = x_max+"px"; panel_moved =  true; }
    if(xy.x < x_min) { panel.style.left = x_min+"px"; panel_moved =  true; }
    if(xy.y > y_max) { panel.style.top  = y_max+"px"; panel_moved =  true; }
    if(xy.y < y_min) { panel.style.top  = y_min+"px"; panel_moved =  true; }

if(log_this && panel_moved) log(caller+": .. moved from XY=["+xy.x+" "+xy.y+"] .. within ["+ x_max+" "+ y_max+"]");
};
/*}}}*/
/*}}}*/
/*  DOC  CB {{{*/
/*_ t_body_width_show {{{*/
let t_body_width_show = function()
{
    let panel = get_tool("headsup_bw_value"); if(!panel) return;
    let     m = parseInt( document.body.style.marginLeft );
    let     w = parseInt( document.body.clientWidth      )
        -                 document.body.clientLeft          /* borders */
        ;
    if( isNaN(m) ) m = 0;
    if( isNaN(w) ) w = 0;

    panel.innerHTML = "BODY "
        +" <em class='cc1' title='Body   style.marginLeft'      >"+ SYMBOL_LEFT_HALF_BLACK     +" "+ m   +"</em>"
        +" <em class='cc2' title='Body   clientWidth clientLeft'>"+ SYMBOL_BLACK_SMALL_SQUARE  +" "+ w   +"</em>"
        +" <em class='cc3' title='Window innerWidth'            >"+ SYMBOL_BLACK_MEDIUM_SQUARE +" "+ w_W +"</em>"
    ;
    t_eval_wide_or_tall_panel( panel );
};
/*}}}*/
/*_ t_body_layout_CB {{{*/
let t_body_layout_CB = function(e_target)
{
/*{{{*/
let   caller = "t_body_layout_CB("+get_n_lbl(e_target)+")";
let log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf7);

    if( has_moved                                ) return;
    if( e_target.tagName != "EM"                 ) return;
/*}}}*/

    let body_width = parseInt( e_target.innerText.trim() );
if( log_this) log("...body_width=["+body_width+"]");

    if(!isNaN(body_width) ) {
        body_width -= 2 * document.body.clientLeft; /* left and right borders */
/*{{{
        let   m =    (w_W - body_width) / 2;
        document.body.style.marginLeft  = m+"px";
        document.body.style.width       = body_width+"px";
        let style = getComputedStyle( document.body );
        document.body.setAttribute("style", style +"; width: "+ body_width +"px !important");
}}}*/
        document.body.style.width       = body_width+"px";
    }
    else {
        document.body.style.width       = ""/*"initial"*/;
    }

    t_layout_listener();
};
/*}}}*/

/*_ t_body_zoom_show {{{*/
let t_body_zoom_show = function()
{
    let panel = get_tool("headsup_bz_value"); if(!panel) return;

    let zoom_class = document.body.className  ? "cc2" : "cc8";

    let zoom_label
        =  document.body.className.includes("zoom")
        ?  document.body.className
        : (document.body.style.zoom || "default");

    panel.innerHTML = "BODY zoom factor <em class='"+zoom_class+"'>"+zoom_label+"</em>";

    t_eval_wide_or_tall_panel( panel );
};
/*}}}*/
/*_ t_body_zoom_CB {{{*/
/*{{{*/
let   body_zoom_percent = 100;

/*}}}*/
let t_body_zoom_CB = function(e_target)
{
/*{{{*/
    let caller   = "t_body_zoom_CB("+get_n_lbl(e_target)+")";
let log_this = LOG_MAP.EV0_LISTEN || LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf7);

    if(has_moved                                 ) return;
    if(e_target.tagName != "EM"                  ) return;
/*}}}*/

    let old_page_height = get_page_height();

    /* [body_zoom_percent] {{{*/
    body_zoom_percent = parseInt( e_target.innerText.trim() );
if( log_this) log("...body_zoom_percent=["+body_zoom_percent+"]");

    if( !isNaN(body_zoom_percent) )
    {
        let className = "zoom_"+body_zoom_percent;
        set_el_class(document.body , className);
    }
    else {
        body_zoom_percent          = 100 ;
        set_el_class(document.body ,  "");
        set_el_class(dom_tools_html,  "");
    }
    /*}}}*/

    let new_page_height = get_page_height();

    let    s_X = Math.floor(window.scrollX);
    let    s_Y = Math.floor(window.scrollY * new_page_height / old_page_height);


if( log_this)
    log_key_val_group( caller
                       , {            WINDOW : window.innerHeight +" "+ window.innerWidth
                           ,          SCROLL : window.scrollX     +" "+ window.scrollY
                           ,         s_X_s_Y :                s_X +" "+ s_Y
                           , old_page_height : old_page_height
                           , new_page_height : new_page_height
                       }, lf1, false
                     );

    s_X /= (body_zoom_percent  / 100);
    s_Y /= (body_zoom_percent  / 100);
    t_window_scrollTo(s_X, s_Y, "instant");

    t_layout_listener();

/*{{{ to update selection thumbs .. OBSOLETE!
    t_pat_bag3_reselect();
}}}*/
};
/*}}}*/

/*_ prop_tools_CB {{{*/
let prop_tools_CB = function(e_target)
{
/*{{{*/
let   caller = "prop_tools_CB(e_target=["+get_n_lbl(e_target)+"]";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbb+lbH+lf7);
/*}}}*/
    /* [has_moved] [t_preventDefault_has_been_called] [t_event_has_been_consumed] {{{*/
    let keyword = ""; try { keyword = e_target.id                ; } catch(ex) {}
    if(!keyword)      try { keyword = e_target.title      .trim(); } catch(ex) {}
    if(!keyword)      try { keyword = e_target.textContent.trim(); } catch(ex) {}

/*{{{
if( log_this) {
    log("%c...............e_target............=["+ get_n_lbl(e_target)                      +"]", lf8);
    log("%c...............e_target.textContent=["+           e_target.textContent           +"]", lf8);
    log("%c...............e_target.title......=["+           e_target.title                 +"]", lf8);
    log("%c............................keyword=["+ keyword                                  +"]", lf8);
    log("%c..........................has_moved=["+ has_moved                                +"]", lf8);
    log("%c..........t_event_has_been_consumed=["+ t_event_has_been_consumed       (caller) +"]", lf8);
    log("%c...t_preventDefault_has_been_called=["+ t_preventDefault_has_been_called(caller) +"]", lf8);
}
}}}*/

    if( has_moved                                ) return;
/*{{{
    if( t_preventDefault_has_been_called(caller) ) return;
}}}*/
/*{{{
    if( e_target.tagName != "EM"                 ) return;
    if( t_event_has_been_consumed(caller)        ) return;
}}}*/
    /*}}}*/
    /* parse [keyword] {{{*/
    if(logging_toggle( keyword ))
    {
log("%c "+caller+": %c TOGGLED keyword=["+ keyword +"]",lb9, lbF);

        t_store_update_post("DOC LOGGING CB");
    }
    /*}}}*/
    /* SYNC TOOL CLONES {{{*/
    t_sync_tool_clones( caller );

    /*}}}*/
};
/*}}}*/
/*_ dom_select calls {{{*/

let call_s_touchedWord      = function( x,   y) { s_touchedWord      ( x ,   y); /*log_set_TR_RESULT();*/ };
let call_check_NodeIterator = function(id, fil) { check_NodeIterator (id , fil); /*log_set_TR_RESULT();*/ };
let call_check_TreeWalker   = function(id, fil) { check_TreeWalker   (id , fil); /*log_set_TR_RESULT();*/ };
let call_check_childNodes   = function(id, fil) { check_childNodes   (id , fil); /*log_set_TR_RESULT();*/ };
let call_check_tagNodes     = function(id, fil) { check_tagNodes     (id , fil); /*log_set_TR_RESULT();*/ };
/*
let call_setTouchPoint      = function( x,   y) { log(); log( "call_setTouchPoint"      ); setTouchPoint      ( x ,   y); log_set_TR_RESULT(); };
let call_setStartXY         = function( x,   y) { log(); log( "call_setStartXY"         ); setStartXY         ( x ,   y); log_set_TR_RESULT(); };
let call_setEndXY           = function( x,   y) { log(); log( "call_setEndXY"           ); setEndXY           ( x ,   y); log_set_TR_RESULT(); };
*/
/*}}}*/
/*}}}*/

/*}}}*/
/* LAYOUT */
/*{{{*/
/* t_layout_listener {{{*/
/*{{{*/
let LAYOUT_CHANGED_DELAY = 200;
let layout_changed_timer;

/*}}}*/
let t_layout_listener = function(delay=LAYOUT_CHANGED_DELAY)
{
    if(layout_changed_timer) clearTimeout(layout_changed_timer );
    layout_changed_timer   =   setTimeout(layout_changed_handler, delay); /* wait for new window geometry */
};
/*}}}*/
/* t_resize_listener {{{*/
let t_resize_listener = function(e)
{
    if(layout_changed_timer) clearTimeout(layout_changed_timer);
    layout_changed_timer   =   setTimeout(layout_changed_handler, LAYOUT_CHANGED_DELAY); /* wait for new window geometry */

    scroll_changed(e);
};
/*}}}*/
/*_ layout_changed_handler {{{*/
let layout_changed_handler = function()
{
/*{{{*/
let   caller = "layout_changed_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

    t_outline_clear();

    t_update_TOOLS_MAP_GEOMETRY(caller,0);

    t_cache_init_by(caller);

    /* DEV TOOLS: Toggle Device Toolbar */
    if(window.matchMedia("only screen and (min-resolution : 128dpi)").matches != behavior_TOUCH_ELSE_DESKTOP)
        document.location.reload();

    t_cache_layout("Layout changed");

    t_gutter_layout_has_CHANGED();

    /* TOOLS GRID {{{*/
    if( call_t_grid_IS_SIZED() )
    {
        if(has_el_class(dimm_mask, "dimm_target_tool"))
            t_target_tool_feed_stop(caller);
        dimm_start_grid(caller);
    }
    /*}}}*/
    /* DIMMED CONTAINERS {{{*/
    else if(div_slot_containers_displayed())
    {
        dimm_start_slot_containers(caller);

        t_scrollIntoViewIfNeeded_dimm_mask_container_selected( dimm_mask.firstElementChild );
    }
    /*}}}*/
    /* [t_target_tool_feed_deploy] {{{*/
    else if(target_tool && dimm_mask_displayed() && has_el_class(dimm_mask, "dimm_target_tool"))
    {
        if(has_el_class(dimm_mask, "dimm_target_tool"))
            t_target_tool_feed_deploy();
    }
    /*}}}*/
    if( dimm_mask_displayed() ) dimm_start(); /* no args to resize */

    t_sync_layout(caller);

    t_log_onlayout(caller);

    t_body_width_show();
    t_body_zoom_show();

    t_tool_set_top_xy(caller, topTool.x, topTool.y);

    t_TOOL_SET_eval_wide_or_tall_panel();

    layout_changed_timer = null;
};
/*}}}*/
/*}}}*/
/* SCROLL */
/*{{{*/
/* t_scroll_listener {{{*/
/*{{{*/
const SCROLLED_ENOUGH                 =  16;
const WINDOW_SCROLLTO_BY_SCRIPT_DELAY = 100;

let   has_been_scrolled_by_script;
/*}}}*/
let t_scroll_listener = function(e)
{
/*{{{*/
let caller = "t_scroll_listener";
let log_this = LOG_MAP.EV1_DOWN || LOG_MAP.EV3_UP;

    let scrolled_by_script = "";
    let scrolled_by_user   = "";
    let            this_MS = new Date().getTime();
/*}}}*/
        t_target_tool_set_parked(false, "SCROLL");
    /* WITHIN DELAY [SCROLL BY SCRIPT] {{{*/
    if( t_window_scrollTo_DONE_MS )
    {
        let elapsed = this_MS - t_window_scrollTo_DONE_MS;
        if( elapsed < WINDOW_SCROLLTO_BY_SCRIPT_DELAY)
            scrolled_by_script = "WITHIN SCROLL_BY_SCRIPT DELAY OF "+WINDOW_SCROLLTO_BY_SCRIPT_DELAY+"ms";

        t_window_scrollTo_DONE_MS = 0;

if( log_this) log("%c"+caller+"%c WINDOW SCROLL %c ENDED "+elapsed+"ms AGO"
                  ,lbL+lf8    ,lbC+lf9         ,lbR+lf3);
    }
    /*}}}*/
    /* WITHIN DELAY [SCROLL INTO VIEW IF NEEDED] {{{*/
    if( t_scrollIntoViewIfNeeded_DONE_MS )
    {
        let elapsed = this_MS - t_scrollIntoViewIfNeeded_DONE_MS;
        if( elapsed < WINDOW_SCROLLTO_BY_SCRIPT_DELAY)
            scrolled_by_script += " .. INTO VIEW";

        t_scrollIntoViewIfNeeded_DONE_MS = 0;
    }
    /*}}}*/
    /* WITHIN DELAY [SCROLL RECENTER] {{{*/
    if( t_scroll_recenter_DONE_MS )
    {
        let elapsed = this_MS - t_scroll_recenter_DONE_MS;
        if( elapsed < WINDOW_SCROLLTO_BY_SCRIPT_DELAY)
            scrolled_by_script += " .. RECENTER";

        t_scroll_recenter_DONE_MS = 0;
    }
    /*}}}*/
    /* WITHIN DELAY [SCROLL TO LAST HIDDEN NODE] {{{*/
    if( dom_hide4_scroll_to_last_hidden_handled_recently(WINDOW_SCROLLTO_BY_SCRIPT_DELAY) )
    {
        scrolled_by_script += " .. TO LAST HIDDEN NODE";

    }
    /*}}}*/
    if( div_slot_containers_displayed() ) {
        /* KEEP WITHIN [div_slot_containers] BOUNDS {{{*/
        let scrollY_max = dimm_mask.firstElementChild.offsetHeight - window.innerHeight;
        if(window.scrollY > scrollY_max)
        {
if( log_this) logBIG(caller+": .. CLIPPING window.scrollY=["+window.scrollY+"] TO scrollY_max=["+scrollY_max+"]", lf5);
            t_window_scrollTo(window.scrollX, scrollY_max, "instant");

            return;
        }
        /*}}}*/
        /* WAITING FOR [div_slot_containers] SCROLLED_INTO_VIEW {{{*/
        if( !has_el_class(dimm_mask.firstElementChild, SCROLLED_INTO_VIEW) )
        {
            scrolled_by_script += " .. WAITING CONTAINERS INTO VIEW";
        }
        else {
/*{{{
logXXX("IGNORING PENDING SCROLL CONTAINER INTO VIEW");
}}}*/
            return;
        }
        /*}}}*/
    }
    /* INTERRUPTED BY USER .. CLEAR ALL PENDING SCROLL HANDLERS {{{*/
    if( !scrolled_by_script )
    {
        if( t_scrollIntoViewIfNeeded_is_pending() ) {
if( log_this) log("%c SCROLLED BY USER %c CLEAR SCROLL INTO VIEW AND RECENTER", lbL+lf8, lbR+lf9);

            t_scrollIntoViewIfNeeded( null );
        }

        if( dom_hide4_scroll_to_last_hidden_is_pending() ) {
if( log_this) log("%c SCROLLED BY USER %c CLEAR SCROLL TO LAST HIDDEN HANDLER", lbL+lf8, lbR+lf9);

            dom_hide4_scroll_to_last_hidden( null );
        }
    }
/*{{{
    else if( onDown_MS ) {
        let elapsed = this_MS - onDown_MS;
if( log_this) log(caller+"%c scrolled_by_script=["+scrolled_by_script+"] %c ONDOWN TO SCROLL EVENT DELAY %c "+elapsed+"ms"
                  ,       lbH+lf7                                       ,lbL+lf4                        ,lbR+lf4);
    }
}}}*/
    /*}}}*/

if( log_this && scrolled_by_script) log("%c"+caller+" %c "+scrolled_by_script, lbb+lbL+lf8, lbb+lbR+lf3);
if( log_this && scrolled_by_user  ) log("%c"+caller+" %c "+scrolled_by_user  , lbb+lbL+lf7, lbb+lbR+lf3);
    scroll_changed(e, scrolled_by_script);
};
/*}}}*/
/*_ t_is_xy_in_viewport {{{*/
let t_is_xy_in_viewport = function(x,y)
{
    x = Math.floor(x);
    y = Math.floor(y);

    let x_min         =       window.scrollX;
    let y_min         =       window.scrollY;
    let x_max         =       window.scrollX + window.innerWidth ;
    let y_max         =       window.scrollY + window.innerHeight;
    let x_in_viewport = (x >= x_min) && (x <= x_max);
    let y_in_viewport = (y >= y_min) && (y <= y_max);

    let           lfx = x_in_viewport ? lf5 : lf8;
    let           lfy = y_in_viewport ? lf5 : lf8;

/*{{{
log("%c x_in_viewport %c "+x_min+" < "+x+" < "+x_max+" %c y_in_viewport %c "+y_min+" < "+y+" < "+y_max
    ,lbL+lfx         ,lbR+lf9                         ,lbL+lfy         ,lbR+lf9                       );
}}}*/

    return x_in_viewport && y_in_viewport;
};
/*}}}*/
/*_ t_is_xy_near_viewport {{{*/
let t_is_xy_near_viewport = function(x,y)
{
    x = Math.floor(x);
    y = Math.floor(y);

    let x_min         =       window.scrollX - window.innerWidth     ;
    let y_min         =       window.scrollY - window.innerHeight    ;
    let x_max         =       window.scrollX + window.innerWidth  * 2;
    let y_max         =       window.scrollY + window.innerHeight * 2;
    let x_nearviewport = (x >= x_min) && (x <= x_max);
    let y_nearviewport = (y >= y_min) && (y <= y_max);

    let           lfx = x_nearviewport ? lf5 : lf8;
    let           lfy = y_nearviewport ? lf5 : lf8;

/*{{{
log("%c x_nearviewport %c "+x_min+" < "+x+" < "+x_max+" %c y_nearviewport %c "+y_min+" < "+y+" < "+y_max
    ,lbL+lfx          ,lbR+lf9                         ,lbL+lfy          ,lbR+lf9                       );
}}}*/

    return x_nearviewport && y_nearviewport;
};
/*}}}*/
/*_ t_window_scrollTo {{{*/
/*{{{*/
/*{{{
let CACHED_GLOBAL_WINDOW_SCROLLTO = window.scrollTo;
let window_overriden_scrollTo_deleted;
}}}*/

let t_window_scrollTo_DONE_MS;
/*}}}*/
let t_window_scrollTo = function(x, y, scrollBehavior)
{
    x *= (body_zoom_percent  / 100);
    y *= (body_zoom_percent  / 100);
/*{{{
logXXX("%c t_window_scrollTo("+x+", "+y+", "+scrollBehavior+")", lbb+lbH+lf5);
logXXX("...y=["+y+"] (p_H)=["+p_H+"] (y/p_H)=["+parseInt(100 * y / p_H)+"%]");
logXXX("...scrollBehavior=["+scrollBehavior+"]");
}}}*/

    scrollBehavior = scrollBehavior || (prop_get( SCROLL_SMOOTH ) ? "smooth" : "instant");

    t_window_scrollTo_DONE_MS = new Date().getTime();

    if(scrollBehavior == "smooth") { set_smoothing( true); window.scrollTo(x, y); if( !prop_get( SCROLL_SMOOTH ) ) set_smoothing(false); }
    else                           { set_smoothing(false); window.scrollTo(x, y); if(  prop_get( SCROLL_SMOOTH ) ) set_smoothing( true); }

    onMoveDXY.x = 0;
    onMoveDXY.y = 0;
};
/*}}}*/
/*_ set_smoothing {{{*/
/*{{{*/
let html;

/*}}}*/
let set_smoothing = function(smoothing)
{
    if(!html)   html  = document.getElementsByTagName("HTML")[0];
    let is_smoothing  = has_el_class(html,   SCROLL_SMOOTH );

    if( is_smoothing != smoothing) {
/*{{{
logXXX("%c set_smoothing %c "+smoothing, lbL, lbR+(smoothing ? lf5 : lf8));
}}}*/
        set_el_class_on_off(html           , SCROLL_SMOOTH               , smoothing);
        set_el_class_on_off(    prop_get_EL( SCROLL_SMOOTH ), CSS_CHECKED, smoothing);
    }
};
/*}}}*/
/*_ scroll_changed {{{*/
let scroll_changed = function(e, scrolled_by_script="")
{
/*{{{*/
let   caller = "scroll_changed";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller +": ["+ window.scrollX +" "+ window.scrollY +"]"+ (scrolled_by_script ? " scrolled_by_script" : "") + (container_selected ? " container_selected=["+get_id_or_tag(container_selected)+" "+get_n_txt(container_selected)+"]" : "") + (onWork_SEEK_TOOL   ? " onWork_SEEK_TOOL"   : ""));
/*}}}*/
    /* has_been_scrolled_by_script {{{*/
    if(scrolled_by_script && !has_been_scrolled_by_script && (Math.abs(window.scrollY - onDown_SCROLL_XY.y) > SCROLLED_ENOUGH))
    {
        has_been_scrolled_by_script = "HAS SCROLLED .. abs("+(window.scrollY - onDown_SCROLL_XY.y)+") > "+ SCROLLED_ENOUGH;
    }
    /*}}}*/
    t_set_has_moved(has_been_scrolled_by_script || caller);
    /* seeker follow scrolling {{{*/
    if( !t_seeker_sync_is_pending() )
        t_seeker_sync();

    /*}}}*/
    if( div_slot_containers_displayed() )
    {
        /* div_slot_containers {{{*/
        if(dimm_mask.firstElementChild.id == "div_slot_containers")
        {
            /* SCROLLED BY SCRIPT */
            if( scrolled_by_script )
            {
if( log_this) logBIG(caller+": "+ scrolled_by_script +" .. SCROLL INTO VIEW", lf4);

                t_scrollIntoViewIfNeeded_dimm_mask_container_selected( dimm_mask.firstElementChild );
            }
            /* SCROLLED BY USER .. INTERRUPT SCHEDULED SCROLLING */
            else if( t_scrollIntoViewIfNeeded_is_pending() )
            {
if( log_this) logBIG(caller+": "+ scrolled_by_script +" .. SCROLL INTO VIEW CANCELED", lf5);

                t_scrollIntoViewIfNeeded_dimm_mask_container_selected( null );
            }
        }
        /*}}}*/
    }
    /* follow [container_selected] {{{*/
    if(container_selected)
    {
        t_set_onSeekXYL_from_container(container_selected,  caller+" ON ["+get_n_lbl(container_selected)+"]");
    }
    /*}}}*/
    /* display current window scrollY percentage .. (thumb_p) {{{*/
    if( toolbar_thumb )
    {
        /* keep only 2 digits */
        let thumb_p             = 100 * window.scrollY / get_page_height();
        let thumb_p_str         = get_thumb_p_str(thumb_p);
        toolbar_thumb.innerHTML = thumb_p_str.replace(" ","&nbsp;");
    }
    /*}}}*/
    /* track and store [tools_scrollY] {{{*/
    if(!scroll_check_timeout)
    {
/*{{{
console_clear("scroll_changed")
logXXX("SCROLLING START");
}}}*/
        add_el_class(document.body, CSS_SCROLLING);

        scroll_check_timeout = setTimeout(scroll_check_handler, SCROLL_DONE_COOLDOWN);
    }
    /*}}}*/
};
/*}}}*/
/*_ scroll_check_handler {{{*/
/*{{{*/
const SCROLL_DONE_COOLDOWN  =  250;
let   scroll_check_timeout  = null;

let   scroll_last_scrollY   = 0;
/*}}}*/
let scroll_check_handler     = function()
{
/*{{{*/
let   caller = "scroll_check_handler";
let log_this = LOG_MAP.T3_LAYOUT;

    scroll_check_timeout = null;
/*}}}*/
    let                this_scrollY  =      window.scrollY;
    let done_moving = (this_scrollY == scroll_last_scrollY);
    if( done_moving )
    {
        /* [el_to_mark_SCROLLED_INTO_VIEW] MARK DONE {{{*/
        if( el_to_mark_SCROLLED_INTO_VIEW )
        {
if( log_this) log("%c"+caller+" %c ["+get_id_or_tag(el_to_mark_SCROLLED_INTO_VIEW) +"] SCROLLED_INTO_VIEW DONE", lbb+lbL+lf8, lbb+lbR+lf3);

            add_el_class(el_to_mark_SCROLLED_INTO_VIEW, SCROLLED_INTO_VIEW);

            el_to_mark_SCROLLED_INTO_VIEW = null;
        }
        /*}}}*/
        /* SCROLLING DONE: .. CALL [t_clr_has_moved] {{{*/
        t_clr_has_moved("scroll_check_handler");

        del_el_class(document.body, CSS_SCROLLING);

        scroll_done_collect_nodes_in_view();
        /*}}}*/
        /* STORE SCROLL POSITION {{{*/
        store_set_value("tools_scrollY", scroll_last_scrollY);

        /*}}}*/
    }
    else {
        /* RECHECK AGAIN LATER {{{*/
        scroll_last_scrollY  = this_scrollY;
        scroll_check_timeout = setTimeout(scroll_check_handler, SCROLL_DONE_COOLDOWN);
        /*}}}*/
    }
};
/*}}}*/
/*_ scroll_not_done_yet {{{*/
let scroll_not_done_yet = function()
{
    return (scroll_check_timeout != null);
};
/*}}}*/
/* TODO */
/*_ scroll_done_collect_nodes_in_view {{{*/
/*{{{*/
let nodes_in_view_array         = [];

/*}}}*/
let scroll_done_collect_nodes_in_view = function(dir)
{
/*{{{*/
let   caller = "scroll_done_collect_nodes_in_view";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c TODO %c "+caller, lbb+lbL+lf2, lbb+lbR+lf8);
/*..............*/ return;

if( log_this) console.time(caller);
/*}}}*/
    /* CURRENT [VIEWPORT TOP BOTTOM] thumb_p {{{*/
    let view_T = window.scrollY;
    let view_B = window.scrollY+ window.innerHeight;

if( log_this) log("...view_T=["+ view_T +"]");
if( log_this) log("...view_B=["+ view_B +"]");
    /*}}}*/
    /* FORGET PREVIOUSLY VIEWABLE NODES {{{*/
    for(let i = 1; i <= nodes_in_view_array.length; ++i)
        del_el_class(   nodes_in_view_array[i], CSS_VIEWABLE);

    /*}}}*/
    /* COLLECT CURRENTLY VIEWABLE NODES {{{*/
    nodes_in_view_array = [];
    for(let slot = 1; slot < ccs.length; ++slot)
    {
        /* ...skip unpopulated ones */
        if(!ccs[slot] || (ccs[slot].nodes.length < 1)) continue;

        for(let num = 1; num <= ccs[slot].thumbs.length; ++num)
        {
            let       node    = ccs[slot].nodes[num-1];
            let       node_T  = getRealTop( node );
            let       node_B  = node_T + node.offsetHeight;
            if(      (node_T >= view_T)
                  && (node_B <= view_B)
              ) {
                nodes_in_view_array.push( node );
                add_el_class(node, CSS_VIEWABLE);

if( log_this) log(". "+nodes_in_view_array.length+": slot["+slot+"] num["+num+"]");
            }
        }

    }
    /*}}}*/
if( log_this) console.time(caller);
if( log_this) console.timeEnd(caller);
};
/*}}}*/
/*}}}*/
/*}}}*/

/* EVENT CALLBACK */
/*{{{*/

/* 1 [t1_onclick] .. called from [onUp_5_TOOL_ONCLICK] */
/*{{{*/
const T_ONCLICK_DELAY = CLICK_DURATION;
let   t_onclick_e_target;
let   t_onclick_timer;

/*}}}*/
/*  t1_onclick {{{*/
let t1_onclick = function(e_target, delay=0, dblclicked=false)
{
/*{{{*/
let   caller = "t1_onclick("+get_n_lbl(e_target)+", delay=["+delay+"], dblclicked=["+dblclicked+"])";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf5);
/*}}}*/
    /* return .. f(t_event_has_been_consumed) {{{*/
    if( t_event_has_been_consumed(caller) )
    {
if(log_this) console_warn("*** "+caller+": ALREADY CONSUMED BY:"+LF+t_event_consumed_cause);

        return;
    }
    /*}}}*/
    /* or repost .. f(t_onclick_timer) {{{*/
    if(t_onclick_timer) clearTimeout(t_onclick_timer);
    /*............................*/ t_onclick_timer = null;

    t_onclick_e_target   = e_target;

    if( delay ) t_onclick_timer = setTimeout(t1_onclick_handler, delay);
    else                                     t1_onclick_handler();
    /*}}}*/
};
/*}}}*/
/*  t1_onclick_handler {{{*/
let t1_onclick_handler = function()
{
/*{{{*/
let   caller = "t1_onclick_handler";
let log_this = LOG_MAP.EV5_TOOL_CB;

/*}}}*/
    /* [e_target] .. f(parentElement htmlFor firstElementChild) {{{*/
    let e_target = t_onclick_e_target;
    if( e_target.nodeType == Node.TEXT_NODE)
        e_target = e_target.parentElement;

    if(!e_target.id && t_is_a_tool_el(onWork_EL, caller))
    {
        if     ( e_target.htmlFor                              ) e_target = document.getElementById(e_target.htmlFor              ); /* INPUT label for */
        else if( e_target.parentElement.htmlFor                ) e_target = document.getElementById(e_target.parentElement.htmlFor); /* INPUT label for */
        else if( e_target.firstChild.nodeType != Node.TEXT_NODE) e_target = e_target.firstChild;
    }

    if(!e_target) return;
    /*}}}*/
    /* ID by content {{{*/
    if(!e_target.id ) {
        if(e_target.textContent && (e_target.textContent.length <= 64))
            e_target.id = e_target.textContent.trim();
    }
    /*}}}*/
    /* [bag_id] {{{*/
    let   bag_id = get_bag_id(e_target);

    /*}}}*/
/*{{{*/
if(log_this) {
    let s = log_key_val(       caller
                         , {   e_target : get_n_lbl( e_target        )
                             ,   bag_id :            bag_id
                             ,  standby : get_n_lbl( onStandby_PANEL )
                          }
                         , lf5
                       );
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly( s );

    t_log_event_status(caller+": e_target.id=["+e_target.id+"] bag_id=["+bag_id+"]", lf5);
}
/*}}}*/
    t1_onclick_e_target_bag_id(e_target, bag_id);
};
/*}}}*/
/*  t1_onclick_e_target_bag_id {{{*/
let t1_onclick_e_target_bag_id = function(e_target, bag_id)
{
/*{{{*/
let   caller = "t1_onclick_e_target_bag_id";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this)
    log("%c"+caller+"%c"+get_n_lbl(e_target)+"%c bag_id=["+bag_id+"]"
       ,lbL         ,lbC+lf3                 ,lbR+lf4);
/*}}}*/
    /* 1/5 CB BAG PIN  {{{*/
    let consumed_by;
    if( has_el_class(e_target, CSS_PUSH_PIN) ) { t_click_panel_pin_CB(onWork_PANEL, e_target); consumed_by = bag_id+"."+CSS_PUSH_PIN; }
    if( has_el_class(e_target, CSS_CLOSEPIN) ) { t_click_panel_pin_CB(onWork_PANEL, e_target); consumed_by = bag_id+"."+CSS_CLOSEPIN; }
    if( has_el_class(e_target, CSS_SCALEPIN) ) { t_click_panel_pin_CB(onWork_PANEL, e_target); consumed_by = bag_id+"."+CSS_SCALEPIN; }
    if( has_el_class(e_target, CSS_CLEARPIN) ) { t_click_panel_pin_CB(onWork_PANEL, e_target); consumed_by = bag_id+"."+CSS_CLEARPIN; }

    /*}}}*/
    /* 2/5 CB BAG DELEGATE {{{*/
    if(!consumed_by && bag_id)
    {
        switch(bag_id)
        {
        case "sel_bag"      :
        case "seeker_PU"    :
        case "seeker_PD"    : t1_onclick_seek_or_sel(e_target, bag_id ); consumed_by = bag_id; break;

        case "pat_bag"      : t1_handle_pat_bag     (e_target         ); consumed_by = bag_id; break;

/*{{{
        case "headsup_w"    : t3_wording_CB         (e_target, "click"); consumed_by = bag_id; break;
}}}*/
        case "headsup_bw"   : t_body_layout_CB      (e_target         ); consumed_by = bag_id; break;
        case "headsup_bz"   : t_body_zoom_CB        (e_target         ); consumed_by = bag_id; break;

        case "dom_traversal": t_dom_traversal_CB    (e_target, "click"); consumed_by = bag_id; break;

        case "dev_log_map"  :
        case "prop_bag"     : prop_tools_CB         (e_target         ); consumed_by = bag_id; break;

        case "fly_div"      : t_fly_clr_div         (e_target         ); consumed_by = bag_id; break;

        default:
if(log_this) log("%c"+caller+"%c ["+bag_id+"] has no delegation from ["+get_n_lbl(e_target)+"]"
                 ,lbL        ,lbH+lf8                                                          );
        break;
        }
    }
    /*}}}*/
    /* 3/5 CB [e_target] {{{*/
    if(!consumed_by)
    {
        if( t1_onclick_e_target(e_target) )
            consumed_by = "["+e_target.id+"] HANDLER";

    }
    /*}}}*/
    /* 4/5 EXTRA [e_target] CB {{{*/
    if(!consumed_by)
    {
        switch(e_target.id)
        {
        case "pat_sort"     : t1_handle_pat_bag_sort(); consumed_by = e_target.id; break;

        case "console_clear": console_clear   (caller); consumed_by = e_target.id; break;

        case "dimm_mask"    : {
            dimm_stop(caller);
            if(has_el_class(dimm_mask, "dimm_target_tool")) t_target_tool_feed_stop("dimm_start");
        }
        consumed_by = e_target.id;
        break;

        case "recycle"     : t3_wording_CB(e_target, "click"); consumed_by = e_target.id;   break;
        case "tools_filter": t3_wording_CB(e_target, "click"); consumed_by = e_target.id;   break;

        default:
        log("%c"+caller+"%c NO EXTRA HANDLER FOR %c e_target=["+get_n_lbl(e_target)+"]"
            ,lbL        ,lbR+lf2                ,lbH+lf4                               );
        break;
        }
    }
    /*}}}*/
    /* 5/5 DEFAULT PROP TOGGLE [e_target] {{{*/
    if(!consumed_by)
    {
        consumed_by = t1_prop_id_state_CB(e_target.id, "toggle");
    }
    /*}}}*/
if( log_this) log("%c"+caller+"%c consumed_by %c"+consumed_by, lbL, lbR+lf1, lbR+lf3);
};
/*}}}*/
/*  t1_onclick_e_target {{{*/
let t1_onclick_e_target = function(e_target)
{
/*{{{*/
let   caller = "t1_onclick_e_target("+get_n_lbl(e_target)+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf5);
/*}}}*/
    /* [hotring] {{{*/
    if( e_target.id == "hotring"                           ) { t_move_TOOLS_TOGGLE_GRID(caller); return true; }

    /*}}}*/
    /* t_is_a_toggle_option {{{*/
    if( t_is_a_toggle_option(e_target.id)                  ) { t1_prop_id_toggle( e_target.id   );   return true; }

    /*}}}*/
    /* pin .. (has_el_class) {{{*/
    if( has_el_class(e_target, CSS_PUSH_PIN)               ) { t_click_panel_pin_CB(onWork_PANEL, e_target); return true; }
    if( has_el_class(e_target, CSS_CLOSEPIN)               ) { t_click_panel_pin_CB(onWork_PANEL, e_target); return true; }
    if( has_el_class(e_target, CSS_SCALEPIN)               ) { t_click_panel_pin_CB(onWork_PANEL, e_target); return true; }
    if( has_el_class(e_target, CSS_CLEARPIN)               ) { t_click_panel_pin_CB(onWork_PANEL, e_target); return true; }
    /*}}}*/
    /* transcript {{{*/
    if( e_target.id == "transcript1_clearpin"              ) {                               log_clr_TR1(caller); return true; }
    if( e_target.id == "transcript2_clearpin"              ) {                               log_clr_TR2(caller); return true; }
    if( is_el_or_child_of_parent_el(e_target, transcript1) ) { if(is_a_dblclick_last_result) log_clr_TR1(caller); return true; }
    if( is_el_or_child_of_parent_el(e_target, transcript2) ) { if(is_a_dblclick_last_result) log_clr_TR2(caller); return true; }

     /*}}}*/
    /* [dom_hide] {{{*/
    if( e_target.id == "dom_hide1_reset"                 ) { dom_hide1_reset                ( ); return true; }
    if( e_target.id == "dom_hide2_store_reload"          ) { dom_hide2_store_reload         ( ); return true; }
    if( e_target.id == "dom_hide2_store_save"            ) { dom_hide2_store_save           ( ); return true; }
    if( e_target.id == "dom_hide4_scroll_to_last_hidden" ) { dom_hide4_scroll_to_last_hidden( ); return true; }
    if( e_target.id == "dom_hide5_start_history"         ) { dom_hide5_start_history        ( ); return true; }

    if( e_target.id == "dom_hide1_collect_nodes_1"       ) { dom_hide1_collect_nodes        (1); return true; }
    if( e_target.id == "dom_hide1_collect_nodes_2"       ) { dom_hide1_collect_nodes        (2); return true; }
    if( e_target.id == "dom_hide1_collect_nodes_3"       ) { dom_hide1_collect_nodes        (3); return true; }
    if( e_target.id == "dom_hide1_collect_nodes_4"       ) { dom_hide1_collect_nodes        (4); return true; }
    if( e_target.id == "dom_hide1_container_clicked"     ) { dom_hide1_container_clicked    ( ); return true; }

    /*}}}*/
    /* [dom_grid] .. () {{{*/
    if( e_target.id == "dom_grid_playground"             ) { e_target.firstElementChild .style.display = "initial"; t_grid_logging_toggle( true); return true; }
    if( e_target.id == "dom_grid_close_em"               ) { e_target.parentElement     .style.display =    "none"; t_grid_logging_toggle(false); return true; }

    /*}}}*/
    /* [test_panel] .. (RELOAD CLEAR REGEX BEHAVIOR) {{{*/
    if( e_target.id == "RELOAD"                            ) { document.location.reload();          return true; }
    if( e_target.id == "CLEAR"                             ) { t_clear(caller);                     return true; }
    if( e_target.id == "REGEX"                             ) { t_log_regex();                       return true; }
    if( e_target.id == "BEHAVIOR"                          ) { t_log_behavior();                    return true; }
    if( e_target.id == "HIGHLIGHT"                         ) { t_outline_viewport_top_containers(); return true; }

    /*}}}*/
    return false;
};
/*}}}*/
/*  t1_prop_id_state_CB {{{*/
let t1_prop_id_state_CB = function(id, checked)
{
/*{{{*/
let caller = "t1_prop_id_state_CB("+id+" , checked=["+checked+"])";
let log_this = LOG_MAP.T3_LAYOUT || LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf5);
/*}}}*/
    /* SET TOOL checked attribute {{{*/
    let tool_el       = get_tool         (id); if(log_this && tool_el      ) console_dir(tool_el      , "...tool_el"      );
    let tool_clone    = get_tool_clone   (id); if(log_this && tool_clone   ) console_dir(tool_clone   , "...tool_clone"   );
    let tool_embedded = get_tool_embedded(id); if(log_this && tool_embedded) console_dir(tool_embedded, "...tool_embedded");

    if( tool_clone    ) tool_clone   ["checked"] = checked;
    if( tool_el       ) tool_el      ["checked"] = checked;
    if( tool_embedded ) tool_embedded["checked"] = checked;

    /*}}}*/
    /* SYNC TOOLS GUI DEPENDENCIES {{{*/
    t_sync_styles(caller);

    /*}}}*/
    /* SYNC OPTIONAL PLAYGROUND CLONE {{{*/
    t1_clone_id_state_CB(id, checked);

    /*}}}*/
    /* OPTIONAL PLAYGROUND DOC TRANSCRIPTS {{{*/
    if(typeof playground_prop_CB != "undefined") playground_prop_CB(id, checked);

    /*}}}*/
    /* OPTIONAL CASCADE CALL {{{*/
    switch(id)
    {
    case "t_target_tool_reorder":
if(log_this) log("%c calling [funcion "+id+"]", lbb+lbH+lf7);

        t_target_tool_reorder(caller);
    break;
    }
    /*}}}*/
    let state
        = tool_el
        ? tool_el.checked
        : checked
    ;
if( log_this) log("%c"+caller+"%c return "+state, lbL, lbR+lf1);
    return state;
};
/*}}}*/
/*_ t1_prop_id_toggle {{{*/
let t1_prop_id_toggle = function(keyword)
{
/*{{{*/
let   caller = "t1_prop_id_toggle("+keyword+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/
    /* [has_moved] [t_preventDefault_has_been_called] [t_event_has_been_consumed] {{{*/

    if( log_this) log("...................keyword %c["+ keyword                 +"]", lb0);
    if( log_this) log(".................has_moved %c "+ has_moved               +" ", lb2);
    if( log_this) log("....t_event_consumed_cause %c "+ t_event_consumed_cause  +" ", lb2);
    if( log_this) log("...t_preventDefault_caller %c "+ t_preventDefault_caller +" ", lb2);

    let                                                 dismissed_by = "";
    if     ( has_moved                                ) dismissed_by = "has_moved";
    else if( t_event_has_been_consumed(caller)        ) dismissed_by = t_event_consumed_cause;
    /*
    else if( t_preventDefault_has_been_called(caller) ) dismissed_by = t_preventDefault_caller;
     */

    if(log_this && dismissed_by) log(caller+": %c dismissed_by ["+ dismissed_by+"]", lb2);
    if(dismissed_by) {
if(log_this) console.trace();
        return;
    }
    /*}}}*/
    /* narrow affixed keyword {{{*/
    if( keyword.startsWith(SQUEEZE_CYCLE) )
        keyword = SQUEEZE_CYCLE;

    /*}}}*/
    /* (keyword) (changes) {{{*/
    let changes = "";
    switch(keyword)
    {

    case ANCHOR_FREEZE: if(!prop_get( WORDING )) changes +=  keyword  ; prop_toggle(ANCHOR_FREEZE); break;

    case  TOOLS_TRAP      : changes += keyword; prop_toggle( keyword ); break;

    case  THEME_DARK      : changes += keyword; prop_toggle( keyword ); break;
    case "theme_LIGHT"    : changes += keyword; prop_set( THEME_DARK  ,  false   ); break;
    case "theme_DARK"     : changes += keyword; prop_set( THEME_DARK  ,  true    ); break;

    case  WORDING         : changes += keyword; prop_toggle( keyword ); break;

    case  CONTAINERS_HI   : changes += keyword; prop_toggle( keyword ); break;
    case  SCROLL_SMOOTH   : changes += keyword; prop_toggle( keyword ); break;
    case  OVERFLOW_VISI   : changes += keyword; prop_toggle( keyword ); break;

    case  SHOW_SEEKZONE   : changes += keyword; prop_toggle( keyword ); break;
    case  PIN_SEEKSPOT    : changes += keyword; prop_toggle( keyword ); break;
    case  LOG_SEEKSPOT    : changes += keyword; prop_toggle( keyword ); break;

    case  MASK_OR_HIDE    : changes += keyword; prop_toggle( keyword ); break;
    case  SITE_OR_PAGE    : changes += keyword; prop_toggle( keyword ); break;
    case  EDIT_OR_STAGE   : changes += keyword; prop_toggle( keyword ); break;
    case  DOM_HIDE1_RESET : changes += keyword; prop_toggle( keyword ); break;
    case  DENY_OR_ALLOW   : changes += keyword; prop_toggle( keyword ); break;

    case  TOOLS_EXTRAS    : changes += keyword; prop_toggle( keyword ); break;

    case  WORDS_EXACT     : changes += keyword; prop_set   ( keyword , true); break;
    case  WORDS_SEGMENT   : changes += keyword; prop_set   ( keyword , true); break;
    case  WORDS_HEAD_TAIL : changes += keyword; prop_set   ( keyword , true); break;
    case  WORDS_OPCYCLE   : changes += keyword; prop_toggle( keyword       ); break;

    case  TOOLS_SCROLL    : changes += keyword; prop_toggle( keyword ); break;

    case  SQUEEZE_CYCLE   : changes += keyword; t1_cycle_onWork_EL_classList(SQUEEZE_CYCLE_CLASSLIST); break;

    default               :
    /* DYNAMIC KEYWORDS {{{*/
    let keyword_array = t_get_words_drop_affix_array();
    for(let i=0; i < keyword_array.length; ++i)
    {
        let id = keyword_array[i];
        if(keyword == id) {
            changes += keyword;
            prop_toggle(keyword);
            break;
        }
    }
    /*}}}*/
if(!changes) log("%c "+caller+" %c "+keyword+" %c *** not handled ***", lbH+lf4, lbb+lbL+lf2, lbb+lbR+lf2);
    }
/*{{{
logXXX("changes=["+changes+"]");
}}}*/
    if(changes) {
if(log_this) t_log_option_changes(changes);
        t_log_transcript_info("<em class='cc8'>"+caller+"</em> changes <em class='cc9'>"+changes+"</em>");
    }
    else {
        t_log_transcript_info("<em class='cc8'>"+caller+"</em> changes <em class='cc0'>none</em>");
    }
    /*}}}*/
    /* SITE AND PAGE {{{*/
    /* OVERFLOW_VISI SCROLL_SMOOTH */
    if(         changes.includes( OVERFLOW_VISI  )
            ||  changes.includes( SCROLL_SMOOTH  )
            ||  changes.includes( PIN_SEEKSPOT   )
      ) {
        t_store1_save_all_settings(); /* SITE [THEME LOGGING LAYOUT] .. PAGE [WORDING] */
    }
    else {
        /* SITE THEME */
        if(     changes.includes( ANCHOR_FREEZE  )
            ||  changes.includes( CONTAINERS_HI  )
            ||  changes.includes( THEME_DARK     )
            ||  changes.includes( TOOLS_TRAP     )
            ||  changes.includes( TOOLS_EXTRAS   )
          ) {
            t_store2_save_site_theme();
        }
        /* PAGE WORDING */
        if(     changes.includes( WORDING        )
            ||  changes.includes( WORDS_EXACT    )
            ||  changes.includes( WORDS_SEGMENT  )
            ||  changes.includes( WORDS_HEAD_TAIL)
            ||  changes.includes( WORDS_OPCYCLE  )
            ||  t_get_words_drop_affix_array().includes(changes)
          ) {
            t_store5_save_page_wording();
        }
    }
    /*}}}*/
    /* SHOW_SEEKZONE {{{*/
    if( prop_get( SHOW_SEEKZONE ))
    {
        if(     changes.includes( LOG_SEEKSPOT   )
            ||  changes.includes( SITE_OR_PAGE   )
            ||  changes.includes( PIN_SEEKSPOT   )
            ||  changes.includes( SHOW_SEEKZONE  )
          ) {
            t_seekzone1_show(caller);
            t_sync_seek_back(caller);
        }
    }
    /*}}}*/
    /* TOOLS_SCROLL {{{*/
    if(         changes.includes( TOOLS_SCROLL   ))
    {
        t_store4_save_site_layout(TOOLS_SCROLL);
    }
    /*}}}*/
    /* sync_containers_hi {{{*/
    if(       changes.includes( CONTAINERS_HI  )
           || changes.includes( THEME_DARK     )
           || changes.includes("theme_DARK"    )
           || changes.includes("theme_LIGHT"   )
      )
        sync_containers_hi();

    /*}}}*/
    /* t_sync_wording {{{*/
    if(            changes.includes( ANCHOR_FREEZE  )
           ||      changes.includes( THEME_DARK     )
           ||      changes.includes( WORDING        )
           ||      changes.includes( CONTAINERS_HI  )
           ||      changes.includes("theme_DARK"    )
           ||      changes.includes("theme_LIGHT"   )
      )
        t_sync_wording(caller);

    if( changes.includes( WORDS_EXACT       ) ) t3_wording_CB(null, WORDS_EXACT    );
    if( changes.includes( WORDS_SEGMENT     ) ) t3_wording_CB(null, WORDS_SEGMENT  );
    if( changes.includes( WORDS_HEAD_TAIL   ) ) t3_wording_CB(null, WORDS_HEAD_TAIL);

    /*}}}*/
    /* t_sync_tools_scroll t_sync_layout t_sync_tools_extras {{{*/
    if( changes.includes( TOOLS_SCROLL     ) ) t_sync_tools_scroll();
    if( changes.includes( TOOLS_SCROLL     ) ) t_sync_layout(caller);
    if( changes.includes( TOOLS_EXTRAS     ) ) t_sync_layout(caller);
    if( changes.includes( TOOLS_EXTRAS     ) ) t_sync_tools_extras(caller);

    /*}}}*/
    /* t_sync_styles {{{*/
    t_sync_styles(caller);

    /*}}}*/
    /* SYNC TOOL CLONES {{{*/
    t_sync_tool_clones( caller );

/*{{{
if( log_this) prop_log_MAP(caller);
}}}*/
    /*}}}*/
    t_store_update_post("PROP TOGGLED ["+keyword+"]");
};
/*}}}*/
/*  t1_cycle_onWork_EL_classList {{{*/
let t1_cycle_onWork_EL_classList = function(classList)
{
    let el;
    for(let i=0; i < classList.length ; ++i)
    {
        if(el = get_el_parent_with_class(onWork_EL, classList[i]))
            break;
    }

    if(el) cycle_el_classList(el, SQUEEZE_CYCLE_CLASSLIST);
};
/*}}}*/
/*_ t1_onclick_seek_or_sel {{{*/
let t1_onclick_seek_or_sel = function(e_target, bag_id)
{
/*{{{*/
let   caller = "t1_onclick_seek_or_sel";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) t_log_event_status(caller, lf5);
/*}}}*/
    /* [action switch] {{{*/
    let bag_id_is_on_standby
        =   onStandby_PANEL
        && (onStandby_PANEL.id == bag_id) ;

    let e_target_is_seeker_handle_left_or_right
        =      e_target.classList.contains( CSS_SEEKER_HANDLE)
        && (   has_el_class(e_target      , CSS_LEFT         )
            || has_el_class(e_target      , CSS_RIGHT        ));

    let action
        =      ( "seeker_PU" == bag_id                  ) ? "seeker_up_clicked"
        :      ( "seeker_PD" == bag_id                  ) ? "seeker_down_clicked"
    /*___________"sel_bag"_______________(or_whatever)_*/
        :      ( is_a_thumb_el(e_target)                ) ? "sel_clicked"
        :      ( e_target_is_seeker_handle_left_or_right) ?  SEL_BACK
        :      ( bag_id_is_on_standby                   ) ? "standby_release"
        :                                                   "standby"
    ;

if( log_this) log("%c "+caller+": %c bag_id ["+bag_id+"] %c e_target ["+get_n_lbl(e_target)+"] %c action ["+action+"]"
                  , lb1          ,lb2                   ,lb3                                  ,lb4                    );
if( log_this && (LOG_MAP.EV8_FLOATLOG || fly_log_checked)) t_log_stage_msg(STAGE_2_ACTION, " <em class='cc9'>"+action+"</em>");
    /*}}}*/
    switch(action) {
        case "seeker_up_clicked": /* .. [target_tool] {{{*/
        {
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>"+action+"</em>");

/*{{{
            if(target_tool && (target_tool == onWork_SEEK_TOOL))
            {
                t1_onclick_e_target(target_tool);
            }
}}}*/

            /* SHOW seeker_PD {{{*/
            if((onDown_EL == seeker_CU) && t_seeker_PD_is_hiding() && !is_onSeekXYL_onTarget())
            {
if(log_this) log_add_TR_EVENT("_<em class='cc5'>SHOW seeker_PD</em> "+onSeekXYL.label);
                t_seeker_PD_show();
                t_toggle_panel_magnified(seeker_PD, false);
                t_seeker_move_on_last_highlight_slot_num();
            }
            /*}}}*/
            /* HIDE seeker_PU {{{*/
            else if( t_seeker_PU_is_active() )
            {
if(log_this) log_add_TR_EVENT("_<em class='cc8'>HIDE seeker_PU</em> "+onSeekXYL.label);
                t_seeker_PU_hide("instant");
            }
            /*}}}*/
        }
        break;
        /*}}}*/
        case "seeker_down_clicked": /*{{{*/
        {
            /* 1. TOGGLE SEL_BACK {{{*/
if(log_this) log(".switch ["+action+"]");
            let e_target_is_seeker_handle_left_or_right
                =  e_target.classList.contains(CSS_SEEKER_HANDLE)
                && (   has_el_class(e_target,  CSS_LEFT         )
                    || has_el_class(e_target,  CSS_RIGHT        ))
            ;

            if( e_target_is_seeker_handle_left_or_right )
            {
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>TOGGLE "+SEL_BACK+"</em>");

                prop_toggle( SEL_BACK );
if(log_this) log_add_TR_SELECT("_<em class='cc3'>SELECT <em class='cc9'>"+(prop_get( SEL_BACK ) ? "BACKWARD" : "FORWARD")+"</em></em>");

                t_sync_seek_back(caller);
            }
            /*}}}*/
            /* 2. SCROLL TO [e_target.id]{{{*/
            else if(e_target.id.startsWith("thumb_s_"))
            {
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>SCROLL TO "+e_target.id+"</em>");

                t_onclick_target_handle_scroll_to_slot_num(e_target, caller);
            }
            /*}}}*/
            /* 3. MAGNIFY [seeker_PD] {{{*/
            else if( !t_is_panel_magnified(seeker_PD) )
            {
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>MAGNIFY seeker_PD</em>");

                t_toggle_panel_magnified(seeker_PD, "toggle");
            }
            /*}}}*/
            /* 4. HIDE [seeker_PD] {{{*/
            else {
if(log_this) log_add_TR_EVENT("_<em class='cc8'>HIDE seeker_PD</em>");

                t_seeker_PD_hide();
            }
            /*}}}*/
        }
        break;
        /*}}}*/
        case "sel_clicked": /*{{{*/
        {
            /* t_onclick_target_handle_scroll_to_slot_num {{{*/
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>"+action+"</em>");

            t_onclick_target_handle_scroll_to_slot_num(e_target, caller);
            /*}}}*/
        }
        break;
        /*}}}*/
        case  SEL_BACK : /*{{{*/
        {
            /* prop_toggle t_sync_seek_back {{{*/
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>"+action+"</em>");
            prop_toggle( SEL_BACK );

if(log_this) log_add_TR_EVENT("_<em class='cc3'>SELBAG SELECT <em class='cc9'>"+(prop_get( SEL_BACK ) ? "BACKWARD" : "FORWARD")+"</em></em>");
            t_sync_seek_back(caller);
            /*}}}*/
        }
        break;
        /*}}}*/
        case "standby": /*{{{*/
        {
            /*{{{*/
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>"+action+" bag_id ["+bag_id+"]</em>");

            t_standby_bag_id( bag_id );
            /*}}}*/
        }
        break;
        /*}}}*/
        case "standby_release": /*{{{*/
        {
            /*{{{*/
if(log_this) log_add_TR_EVENT(".switch <em class='cc1'>"+action+" bag_id ["+bag_id+"]</em>");

            if(onStandby_PANEL) t_standby3_release(caller);
            /*}}}*/
        }
        break;
        /*}}}*/
        /* default {{{*/
        default:
        {
logBIG(caller+": default: action=["+action+"] .. bag_id=["+bag_id+"]");
        }
        /*}}}*/
    }
};
/*}}}*/

/* 2 [t2_input_CB] .. called from t_add_LISTENERS */
/*  t2_input_CB .. t2_window_keyup_CB {{{*/
let t2_window_keyup_CB = function(e)
{
    t2_input_CB(e, "window")
};
let t2_input_CB = function(e, listener_tag="input")
{
/*{{{*/
let e_target = t_get_event_target(e, "t2_input_CB");
let caller = "t2_input_CB";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+"("+e.type+", "+listener_tag+"): on "+get_n_lbl(e_target));
/*}}}*/

    switch(e.type)
    {
    case "keydown" : t2_input_handle(e, e_target, listener_tag); break;
    case "keyup"   : t2_input_handle(e, e_target, listener_tag); break;
    case "change"  : {
        if     ( is_el_or_child_of_parent_el(e_target, headsup_w    ) ) t3_wording_CB     (e_target, e.type);
        else if( is_el_or_child_of_parent_el(e_target, dom_traversal) ) t_dom_traversal_CB(e_target, e.type);
    }
    break;
    default:
    }

};
/*}}}*/
/*_ t2_input_handle {{{*/
/*{{{*/
const CHAR_CODE_A         = 65;
const CHAR_CODE_B         = 66;
const CHAR_CODE_C         = 67;
const CHAR_CODE_F         = 70;
const CHAR_CODE_SPACE     = 32;
const CHAR_CODE_ESC       = 27;

const CHAR_CODE_BACKSPACE =  8;
const CHAR_CODE_SHIFT     = 16;
const CHAR_CODE_CONTROL   = 17;
const CHAR_CODE_ALT       = 18;
const CHAR_CODE_LEFT      = 37;
const CHAR_CODE_UP        = 38;
const CHAR_CODE_RIGHT     = 39;
const CHAR_CODE_DOWN      = 40;
const CHAR_CODE_DELETE    = 46;

/*}}}*/
let t2_input_handle = function(e, e_target, listener_tag)
{
/*{{{*/
let   caller = "t2_input_handle";
let log_this = LOG_MAP.EV5_TOOL_CB;

let charCode = (e.keyCode) ? e.keyCode : e.which;

if(log_this) log(caller+"("+e.type+", "+listener_tag+"): on "+get_n_lbl(e_target)+" .. charCode=["+charCode+"]");
/*}}}*/
/*{{{
:new C:/LOCAL/GAMES/IVANWFR/INPUT/Truly_Ergonomic/trulyergonomic/javascripts/layout.js
}}}*/
    t_clr_has_moved(caller); /* this is a new event-chain */
    switch(charCode) {
        /* IGNORE {{{*/
        case  8: if( log_this) log("%c BACKSPACE %c IGNORE",lbL,lbR+lf2); break;
        case 16: if( log_this) log("%c SHIFT     %c IGNORE",lbL,lbR+lf2); break;
        case 17: if( log_this) log("%c CONTROL   %c IGNORE",lbL,lbR+lf2); break;
        case 18: if( log_this) log("%c ALT       %c IGNORE",lbL,lbR+lf2); break;
        case 37: if( log_this) log("%c LEFT      %c IGNORE",lbL,lbR+lf2); break;
        case 39: if( log_this) log("%c RIGHT     %c IGNORE",lbL,lbR+lf2); break;
        case 46: if( log_this) log("%c DELETE    %c IGNORE",lbL,lbR+lf2); break;

/*{{{
        case 38: if( log_this) log("%c UP        %c IGNORE",lbL,lbR+lf2); break;
        case 40: if( log_this) log("%c DOWN      %c IGNORE",lbL,lbR+lf2); break;
}}}*/
        /*}}}*/
        /* [CTRL-SHIFT-F] .. [FIND IN PAGE] {{{*/
        case CHAR_CODE_F:
        if(onDown_CTRL && onDown_SHIFT && tools_filter_input)
        {
if( log_this) log("%c CTRL F %c FIND IN PAGE",lbLlbR+lf2);

            if(headsup_w)
            {
                let map = tools_map_get(headsup_w);
                if(map && !map.selected) {
                    t_grid_TOOLS_SELECT_panel(headsup_w, true);
                    t_grid_TOOLS_MAP_changed();
                }
                t_gutter_drag_hotspot_to_LAST_WINDOW_XY();
            }

            t_set_onWork_EL_last_used(tools_filter_input);

            add_el_class(e_target,CSS_FOCUSSED);

            t_post_focus_to(tools_filter_input);
        }
        break;
        /*}}}*/
        /* [ESCAPE] .. [UNDO CHANGES] {{{*/
        case 27:
        if(listener_tag == "input") {
if( log_this) log("%c ESCAPE %c ESCAPE CURRENT STATE",lbL,lbR+lf2);

            e_target.value = e_target.value_set ? e_target.value_set : "";
            /* del_el_class(e_target,CSS_FOCUSSED); */

            t_ESCAPE_CURRENT_STATE();

        }
        break;
        /*}}}*/
        /* [RETURN] .. [SUBMIT] {{{*/
        case 13:
        if(listener_tag == "input") {
if( log_this) log("%c RETURN %c SUBMIT",lbL,lbR+lf2);

            if( logging_something() )
                t_log_transcript_event_top("<em class='cc8'>"+caller+"</em>"
                    +                      " "+e_target.id+" <em class='cc9'>"+e_target.value+"</em>");

            t3_wording_CB(e_target, "submit");

            e_target.selectionStart = e_target.value.length-1;
            e_target.selectionEnd   = e_target.value.length;
            t_focus(                  e_target );

        }
        break;
        /*}}}*/
/*{{{
        default:
        if     (e_target.id == "tools_node_input"  ) set_id_class_on_off(e_target.id, "focussed", (e_target.value != tools_node  ));
        else if(e_target.id == "tools_filter_input") set_id_class_on_off(e_target.id, "focussed", (e_target.value != tools_filter));
}}}*/
    }

    if(listener_tag == "input")
    {
        switch(charCode) {
        case 38: t_set_tools_filter_from_all_csv_dir(-1); break;
        case 40: t_set_tools_filter_from_all_csv_dir(+1); break;
        }
    }
};
/*}}}*/

/*_ t_set_tools_filter_from_all_csv_dir {{{*/
/*{{{*/
let all_csv     = "";
let all_csv_idx =  0;

/*}}}*/
let t_set_tools_filter_from_all_csv_dir = function(dir)
{
let   caller = "t_set_tools_filter_from_all_csv_dir("+dir+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

    let max = csv_count(all_csv);
    if(!max) return;

    all_csv_idx = (all_csv_idx + dir + max) % max;
    let     csv = csv_get(all_csv, 1+all_csv_idx);

if(log_this)
    log_key_val_group( caller
                       , {           max : max
                           , all_csv_idx : all_csv_idx
                           ,         csv : csv
                       }
                       , lf3, false
                     );

    t_set_tool_id_value("tools_filter", csv);
};
/*}}}*/
/*_ t_ESCAPE_CURRENT_STATE {{{*/
let t_ESCAPE_CURRENT_STATE = function()
{
/*{{{*/
let   caller = "t_ESCAPE_CURRENT_STATE";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/

    /* TOOLS ON GRID {{{*/
    if( call_t_grid_IS_ON_GRID() )
    {
if( log_this) logBIG("ESCAPE FROM TOOLS ON GRID");
        t_move_TOOLS_OFF_GRID(caller);

    }
    /*}}}*/
    /* SLOT CONTAINERS DISPLAYED {{{*/
    else if( div_slot_containers_displayed() )
    {
/*{{{
log("...div_slot_containers.className=["+div_slot_containers.className+"]")
}}}*/
        if( has_el_class(div_slot_containers, CSS_FULLSCREEN))
        {
if( log_this) logBIG("ESCAPE SLOT CONTAINERS FULLSCREEN");
            t_slot_container_set_fullscreen();
        }
        else {
if( log_this) logBIG("ESCAPE SLOT CONTAINERS DISPLAYED");
            t_window_scrollTo(0, onDown_SCROLL_XY.y);
            dimm_stop( caller );
        }
    }
    /*}}}*/
    else {
        console_clear("NOTHING TO ESCAPE FROM");

if( log_this) t_log_event_status(caller, lf4);
        if(onWork_EL_last_used == tools_filter_input)
            t_gutter_drag_hotspot_to_LAST_GUTTER_XY();
    }

};
/*}}}*/

/* 3 [t3_wording_CB] */
/*_ t3_wording_CB {{{*/
let t3_wording_CB = function(e_target, action)
{
    /* [has_moved] {{{*/
let caller = "t3_wording_CB("+get_n_lbl(e_target)+" , action=["+action+"]) "+ t_event_consumed_cause;
let log_this   = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+(has_moved ? ": has_moved=["+has_moved+"]" : ""));

    if( has_moved ) return;
/*}}}*/
    /* INPUT .. (cool down on submit) {{{*/

    if(e_target) del_el_class(e_target, CSS_FOCUSSED);

    /*}}}*/
    /* INPUT .. [WORDS_OPCYCLE] {{{*/
    if(e_target && (e_target.tagName == "INPUT"))
    {
if(log_this) log("...tools_filter_input.value=["+tools_filter_input.value+"]");
        switch(action)
        {
        /* case submit : keyup (WORDS_OPCYCLE) {{{*/
        case "submit":
        {
if(log_this) log("...case ACTION "+action+":");
            let slot = get_slot_matching_pattern( tools_filter_input.value );
            if(      prop_get( WORDS_OPCYCLE ) )
            {
                /* CYCLE-RE-SELECT {{{*/
                if( slot ) {
if(log_this) log("%c WORDS OPTIONS CYCLE SLOT ["+slot+"]",lb6);
                    clear_slot(slot);
                    t_onPatternUpdate("CLEARING SLOT <em>"+ slot +"</em>", caller);
                    cycle_on_last_cleared_pattern();
                    t_call_dom_traversal();
                    return;
                }
                /*}}}*/
                /* CYCLE-FRESH-SELECT {{{*/
                else {
if(log_this) log("%c WORDS OPTIONS CYCLE FRESH-SELECT",lb7);
                    t_call_dom_traversal();
                    return;
                }
                /*}}}*/
            }
            else if(slot)
            {
if(log_this) log("%c CLEAR SELECTION SLOT ["+slot+"]",lb3);

                t_clear_slot( slot );
                return;
            }
            /* FRESH-SELECT {{{*/
            else {
if(log_this) log("%c WORDS NEW-SELECT",lb4);

                t_call_dom_traversal();
                return;
            }
            /*}}}*/
        }
         /*}}}*/
        /* case click : (ignored) {{{*/
        case "click":
        {
if(log_this) log("...case ACTION "+action+":");
/*{{{
}}}*/
                t_focus( tools_filter_input );
                tools_filter_input.selectionEnd   = tools_filter_input.value.length;
                tools_filter_input.selectionStart = 0;
                t_focus( tools_filter_input );
            return;
        }
        break;
        /*}}}*/
        }
    }
    /*}}}*/
    /* [tools_filter] [recycle] [words_exact words_segment words_head_tail] {{{*/
    let    keyword;
    if(   !keyword) try { keyword =                e_target.id;                   } catch(ex) {}
    if(   !keyword) try { keyword = get_first_word(e_target.textContent, caller); } catch(ex) {}
    if(   !keyword)       keyword = action;
if(log_this) logBIG( keyword );

    switch(keyword) {
        /* headsup: tools_filter {{{*/
        case "tools_filter":
        {
if(log_this) log("...case "+keyword+":");

            if(e_target.id != "tools_filter") t_set_tool_id_value("tools_filter", e_target.value);

            if(e_target) del_el_class(e_target, CSS_FOCUSSED);

/*{{{
            let msg    = "<em class='big'>CHANGED FILTER</em> : <em>"+ e_target.value +"</em>";
if(e_target && log_this) log_add_TR_SELECT(msg);

            t_call_dom_traversal();
}}}*/
        }
        break;
        /*}}}*/
        /* headsup: recycle {{{*/
        case "recycle":
        {
if(log_this) log("...case "+keyword+":");

            /* TODO: animate recycle */

            /* INPUT */
            let   slotted = s_get_slotted_pattern_count();
            let all_count = csv_count(all_csv);
            let    action = slotted
                            ? "hiding "+slotted+" of "+all_count
                            :                   "all "+all_count+" cleared"
            ;
            t_set_tool_id_value("tools_filter", action);
            if(!slotted) t_pat_bag3_dump_all();

            t_pat_bag5_hide_sel();

            if( tools_filter_input )
            {
                t_focus( tools_filter_input );
                tools_filter_input.selectionStart = 0;
                tools_filter_input.selectionEnd   = tools_filter_input.value.length;
                t_focus( tools_filter_input );
            }
        }
        break;
        /*}}}*/
        /* headsup: words_exact words_segment words_head_tail {{{*/
        case WORDS_EXACT     :
        case WORDS_SEGMENT   :
        case WORDS_HEAD_TAIL :
        {
if(log_this) log("...case "+keyword+":");

            t_call_dom_traversal();
        }
        break;
        /*}}}*/
        /* default .. (ignore when traversal params unchanged) {{{*/
        case "no_keyword"  :
        default:
        {
if(log_this) log("...default: keyword=["+keyword+"]");

        }
        /*}}}*/
    }
    /*}}}*/
    t_cache_init_by(caller);
};
/*}}}*/

/*}}}*/

/** PAT */
/*{{{*/
/*{{{*/

let alt_csv = "";
let bak_csv = "";
let bin_csv = "";
let off_csv = "";
let pat_csv = "";
let sel_csv = "";

let bot_div;
let  fly_log;
let  pat_sort;
let  fly_log_checked = false;
let  bag_log;

let off_bag;
let bak_bag;
let alt_bag;

let bag_rot; /* bags rotate button (pat..bak..alt) */

let mov_div;

let hov1;
let hov2;
let hov3;
let hov4;

/*{{{
let bak_bag_place_holder;
let off_bag_place_holder;
let pat_bag_place_holder;
let mov_dst;
}}}*/

/*}}}*/

/* PAT CSV {{{*/
/*_ t_are_pat_sorted {{{*/
let t_are_pat_sorted = function()
{
    if(!sel_csv) return false;

    let csv = csv_sort( pat_csv );

    return csv == sel_csv;
};
/*}}}*/
/*_ t_are_pat_reversed {{{*/
let t_are_pat_reversed = function()
{
    if(!sel_csv) return false;

    let csv = csv_reverse( pat_csv );

    return csv == sel_csv;
};
/*}}}*/

/*_ csv_add_pat_csv {{{*/
let csv_add_pat_csv = function(pattern)
{
    if(!csv_contains(     pat_csv, pattern))
        pat_csv = csv_add(pat_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_add_off_csv {{{*/
let csv_add_off_csv = function(pattern)
{
    off_csv = csv_add(off_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_add_bak_csv {{{*/
let csv_add_bak_csv = function(pattern)
{
    bak_csv = csv_add(bak_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_add_alt_csv {{{*/
let csv_add_alt_csv = function(pattern)
{
    alt_csv = csv_add(alt_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_add_bin_csv {{{*/
let csv_add_bin_csv = function(pattern)
{
    bin_csv = csv_add(bin_csv, pattern); /* moved from */
};
/*}}}*/

/*_ csv_del_pat_csv {{{*/
let csv_del_pat_csv = function(pattern)
{
    pat_csv = csv_del(pat_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_del_off_csv {{{*/
let csv_del_off_csv = function(pattern)
{
    off_csv = csv_del(off_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_del_bak_csv {{{*/
let csv_del_bak_csv = function(pattern)
{
    bak_csv = csv_del(bak_csv, pattern); /* moved from */
};
/*}}}*/
/*_ csv_del_alt_csv {{{*/
let csv_del_alt_csv = function(pattern)
{
    alt_csv = csv_del(alt_csv, pattern); /* moved from */
};
/*}}}*/

/*_ csv_move_pattern_to_pat {{{*/
let csv_move_pattern_to_pat = function(pattern)
{
    /* FROM */
    csv_del_bak_csv( pattern );
    csv_del_off_csv( pattern );
    csv_del_alt_csv( pattern );

    /* TO */
    csv_add_pat_csv( pattern );
};
/*}}}*/
/*_ csv_move_pattern_to_off {{{*/
let csv_move_pattern_to_off = function(pattern)
{
    /* FROM */
    csv_del_pat_csv( pattern );
    csv_del_bak_csv( pattern );
    csv_del_alt_csv( pattern );

    /* TO */
    csv_add_off_csv( pattern );
};
/*}}}*/
/*_ csv_move_pattern_to_bak {{{*/
let csv_move_pattern_to_bak = function(pattern)
{
    /* FROM */
    csv_del_pat_csv( pattern );
    csv_del_off_csv( pattern );
    csv_del_alt_csv( pattern );

    /* TO */
    csv_add_bak_csv( pattern );
};
/*}}}*/
/*_ csv_move_pattern_to_alt {{{*/
let csv_move_pattern_to_alt = function(pattern)
{
    /* FROM */
    csv_del_pat_csv( pattern );
    csv_del_off_csv( pattern );
    csv_del_bak_csv( pattern );

    /* TO */
    csv_add_alt_csv( pattern );
};
/*}}}*/
/*_ csv_move_pattern_to_bin {{{*/
let csv_move_pattern_to_bin = function(pattern)
{
    /* FROM */
    csv_del_pat_csv( pattern );
    csv_del_off_csv( pattern );
    csv_del_bak_csv( pattern );
    csv_del_alt_csv( pattern );

    /* TO */
    csv_add_bin_csv( pattern );
};
/*}}}*/

/*_ csv_clr_bak_csv .. (into bin_csv) {{{*/
let csv_clr_bak_csv = function()
{
    bin_csv = bak_csv;
    bak_csv = "";
};
/*}}}*/
/*}}}*/

/* PAT HANDLE */ /*{{{*/
/*  t1_handle_pat_bag {{{*/
/*{{{*/
let last_bak_alt_move;

/*}}}*/
let t1_handle_pat_bag = function(e_target)
{
/*{{{*/
let   caller = "t1_handle_pat_bag";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller+": id=["+e_target.id+"]",lbF);
/*}}}*/
    /* pat_bag_is_on_standby {{{*/
    let pat_bag_is_on_standby = (onStandby_PANEL && (onStandby_PANEL.id == pat_bag.id));
    if( pat_bag_is_on_standby)
    {
        t_standby3_release( caller );
    }
    /*}}}*/
    /* [pat_sort] CLICK {{{*/
    else if(e_target.id == "pat_sort")
    {
        t1_handle_pat_bag_sort();
    }
    /*}}}*/
    /* [bag_rot] CLICK {{{*/
    else if(e_target.id == "bag_rot")
    {
        t1_handle_pat_bag_rot();
    }
    /*}}}*/
    /* [fly_log] CLICK {{{*/
    else if(e_target.id == "fly_log") {
        let state = has_el_class(e_target, CSS_CHECKED);
        t_log_set_state( !state ); /* set run-time [DISPLAY OPTION] .. leaving saved [LOGGING OPTION] unchanged */
    }
    /*}}}*/
    else {
        t_pat_bag_stage_target( e_target );
    }
};
/*}}}*/
/*_ t_pat_bag_stage_target {{{*/
/*{{{*/
/*
/\(SEL\|PAT\|OFF\|BAK\|STANDBY\|OPENED\)
                                     /\(CLOSED\|NONE\|SOME\|MANY\)
/\(SEL\|PAT\|OFF\|BAK\|STANDBY\|OPENED\|CLOSED\|NONE\|SOME\|MANY\)
/\(SEL\|PAT\|OFF\|BAK\|STANDBY\|OPENED\|CLOSED\|NONE\|SOME\|MANY\|CLICKED\|IDLE\)

*/
/*................................................................................................(SEL PAT OFF BAK CLICKED STANDBY).........................*/
const STAGE1__PAT_CLICKED____________________ACTION_TOGGLE_PAT     = { color:1 , level:"1", context:"PAT_CLICKED"                   , action:"TOGGLE_PAT"     };

const STAGE2__BAK_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG       = { color:2 , level:"2", context:"BAK_MANY_SEL_NONE__BAG_CLOSED" , action:"OPEN_BAG"       };
const STAGE3__BAK_SOME___________BAK_CLICKED_ACTION_DUMP_BAK       = { color:3 , level:"3", context:"BAK_SOME___________BAK_CLICKED", action:"DUMP_BAK"       };
const STAGE3__ALT_SOME___________ALT_CLICKED_ACTION_ALT_OFF        = { color:3 , level:"3", context:"ALT_SOME___________ALT_CLICKED", action:"ALT_OFF"        };
const STAGE4__BAK_NONE_SEL_SOME______________ACTION_HIDE_SEL       = { color:5 , level:"5", context:"BAK_NONE_SEL_SOME"             , action:"HIDE_SEL"       };
const STAGE4__ALT_NONE_SEL_SOME______________ACTION_HIDE_SEL       = { color:5 , level:"5", context:"ALT_NONE_SEL_SOME"             , action:"HIDE_SEL"       };

const STAGE2__OFF_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG       = { color:2 , level:"2", context:"OFF_MANY_SEL_NONE__BAG_CLOSED" , action:"OPEN_BAG"       };
const STAGE3__OFF_SOME___________OFF_CLICKED_ACTION_BACK_OFF       = { color:3 , level:"3", context:"OFF_SOME___________OFF_CLICKED", action:"BACK_OFF"       };
const STAGE4__OFF_SOME_SEL_NONE__BAG_OPENED__ACTION_SHOW_OFF       = { color:4 , level:"4", context:"OFF_MANY_SEL_NONE__BAG_OPENED" , action:"SHOW_OFF"       };
const STAGE5__OFF_NONE_SEL_SOME______________ACTION_HIDE_SEL       = { color:5 , level:"5", context:"OFF_NONE_SEL_SOME"             , action:"HIDE_SEL"       };

const STAGE6__STANDBY_IDLE___________________ACTION_STANDBY_ON     = { color:6 , level:"6", context:"STANDBY_IDLE"                  , action:"STANDBY_ON"     };
const STAGE7__STANDBY_CLOSED_________________ACTION_STANDBY_OPENED = { color:7 , level:"7", context:"STANDBY_CLOSED"                , action:"STANDBY_OPENED" };
const STAGE8__STANDBY_OPENED_________________ACTION_STANDBY_DONE   = { color:8 , level:"8", context:"STANDBY_OPENED"                , action:"STANDBY_DONE"   };

/*}}}*/
let t_pat_bag_stage_target = function(e_target)
{
/* {{{*/
let   caller = "t_pat_bag_stage_target("+get_n_lbl(e_target)+")";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log(caller);
/*}}}*/
    /* (FIXME NO NEED: .. single click on bak_bag does the job) .. [bak_bag is_a_dblclick_last_result] - CLEAR BAG {{{*/
/*{{{
if( log_this) log("...is_a_dblclick_last_result "+is_a_dblclick_last_result);
    if((e_target == bak_bag) && is_a_dblclick_last_result)
    {
        let count = csv_count(bak_csv);
if(log_this) log("...csv_count(bak_csv)=["+count+"]");
        if( count) {
            let clearing_action =  " CLEARING ("+count+") items FROM <em class='cc0'>bak</em>";
            csv_clr_bak_csv();
            t_onPatternUpdate(clearing_action, caller);
        }
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_1_INPUT, "<em class='cc0'>DBL_CLICK on bak_bag</em>");
        return;
    }
}}}*/
    /*}}}*/
    /* UI {{{*/
    if(e_target.nodeType == Node.TEXT_NODE) e_target = e_target.parentElement;

    let            parent_div = get_el_parent_with_tag(e_target,"DIV");
    let pat_bag_is_on_standby = ((onStandby_PANEL != null ) && (onStandby_PANEL == e_target));
    let pat_bag_is_opened     = (        has_el_class( pat_bag, CSS_OPEN_BAG)              );

    let pattern_clicked       = (e_target.tagName == "EM") || e_target.id.startsWith( "pattern");
    let pat_bag_clicked       = (parent_div == pat_bag);
    let bak_bag_clicked       = (parent_div == bak_bag);
    let alt_bag_clicked       = (parent_div == alt_bag);
    let off_bag_clicked       = (parent_div == off_bag);
    let bot_div_clicked       = (parent_div == bot_div);

if(log_this) log("...parent_div......................=["+ get_n_lbl(parent_div) +"]");
if(log_this) log("...pat_bag_is_on_standby...........=["+ pat_bag_is_on_standby +"]");
if(log_this) log("...pat_bag_is_opened...............=["+ pat_bag_is_opened     +"]");
if(log_this) log("...pattern_clicked.................=["+ pattern_clicked       +"]");
if(log_this) log("...bak_bag_clicked.................=["+ bak_bag_clicked       +"]");
if(log_this) log("...alt_bag_clicked.................=["+ alt_bag_clicked       +"]");
if(log_this) log("...off_bag_clicked.................=["+ off_bag_clicked       +"]");
if(log_this) log("...bot_div_clicked.................=["+ bot_div_clicked       +"]");
    /*}}}*/
    /* CSV {{{*/
    let sel_csv_is_empty         = (           csv_count( sel_csv ) < 1             );
    let off_csv_one_or_more      = (           csv_count( off_csv ) > 0             );
    let off_csv_more_than_one    = (           csv_count( off_csv ) > 1             );
    let bak_csv_one_or_more      = (           csv_count( bak_csv ) > 0             );
    let bak_csv_more_than_one    = (           csv_count( bak_csv ) > 1             );
    let alt_csv_one_or_more      = (           csv_count( alt_csv ) > 0             );
    let alt_csv_more_than_one    = (           csv_count( alt_csv ) > 1             );

if(log_this) log("...sel_csv_is_empty................=["+ sel_csv_is_empty      +"]");
if(log_this) log("...off_csv_one_or_more.............=["+ off_csv_one_or_more   +"]");
if(log_this) log("...off_csv_more_than_one...........=["+ off_csv_more_than_one +"]");
if(log_this) log("...bak_csv_one_or_more.............=["+ bak_csv_one_or_more   +"]");
if(log_this) log("...bak_csv_more_than_one...........=["+ bak_csv_more_than_one +"]");
if(log_this) log("...alt_csv_one_or_more.............=["+ alt_csv_one_or_more   +"]");
if(log_this) log("...alt_csv_more_than_one...........=["+ alt_csv_more_than_one +"]");
    /*}}}*/
    /* stage {{{*/
    /*_______PAT________________________________________________________________*/
    let stage
        = (  pattern_clicked                                                     ) ? STAGE1__PAT_CLICKED____________________ACTION_TOGGLE_PAT

    /*_______BAK_OR_OFF_________________NO_SEL_____________________BAG_CLOSED___*/
        : (  bak_csv_more_than_one  &&  sel_csv_is_empty  &&  !pat_bag_is_opened ) ? STAGE2__BAK_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG
        : (  off_csv_more_than_one  &&  sel_csv_is_empty  &&  !pat_bag_is_opened ) ? STAGE2__OFF_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG

    /*_____________________________________________________________DIV_CLICKED__*/
        : (  off_csv_one_or_more                          &&   off_bag_clicked   ) ? STAGE3__OFF_SOME___________OFF_CLICKED_ACTION_BACK_OFF
        : (  alt_csv_one_or_more                          &&   alt_bag_clicked   ) ? STAGE3__ALT_SOME___________ALT_CLICKED_ACTION_ALT_OFF
        : (  bak_csv_one_or_more                          &&   bak_bag_clicked   ) ? STAGE3__BAK_SOME___________BAK_CLICKED_ACTION_DUMP_BAK

    /*_______OFF________________________SEL________________________DIV__________*/
        : (  off_csv_one_or_more    &&  sel_csv_is_empty                         ) ? STAGE4__OFF_SOME_SEL_NONE__BAG_OPENED__ACTION_SHOW_OFF
        : ( !off_csv_one_or_more    && !sel_csv_is_empty                         ) ? STAGE5__OFF_NONE_SEL_SOME______________ACTION_HIDE_SEL
    /*_______BAK________________________SEL________________________DIV__________*/
        : ( !bak_csv_one_or_more    && !sel_csv_is_empty                         ) ? STAGE4__BAK_NONE_SEL_SOME______________ACTION_HIDE_SEL
    /*_______ALT________________________SEL________________________DIV__________*/
        : ( !alt_csv_one_or_more    && !sel_csv_is_empty                         ) ? STAGE4__ALT_NONE_SEL_SOME______________ACTION_HIDE_SEL
    /*_______PAT_BAG_STANDBY____________________________________________________*/
        : ( !pat_bag_is_on_standby                        &&   pat_bag_clicked   ) ? STAGE6__STANDBY_IDLE___________________ACTION_STANDBY_ON
        : ( !pat_bag_is_opened                                                   ) ? STAGE7__STANDBY_CLOSED_________________ACTION_STANDBY_OPENED
        :                                                                            STAGE8__STANDBY_OPENED_________________ACTION_STANDBY_DONE
    ;

    /*}}}*/
    /* [t_log_stage] {{{*/
        let  something_clicked
            =  pattern_clicked
            || bak_bag_clicked
          /*|| alt_bag_clicked */
            || off_bag_clicked
            || bot_div_clicked
        ;
    if(LOG_MAP.EV8_FLOATLOG || fly_log_checked)
        t_log_stage(stage, something_clicked, pattern_clicked, e_target, parent_div);

    /*}}}*/
    /* [t_pat_bag_status_set_innerText] {{{*/
    t_pat_bag_status_set_innerText(stage.level+" "+stage.context+" "+stage.action);

    /*}}}*/

if( log_this) log("%c "+caller+" %c level %c "+stage.level   +" %c context %c "+stage.context+" %c action %c "+ stage.action
                  ,lbH+lbb+lf7  ,lbL     ,lbR+lfX[stage.color] ,lbL       ,lbR+lf9             ,lbL      ,lbR+lf9);
    switch(stage) {
        case STAGE1__PAT_CLICKED____________________ACTION_TOGGLE_PAT     : t_pat_bag1_toggle_pat   (e_target); break;

        case STAGE2__BAK_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG       : t_pat_bag2_bag_open     ();         break;
        case STAGE2__OFF_MANY_SEL_NONE__BAG_CLOSED__ACTION_OPEN_BAG       : t_pat_bag2_bag_open     ();         break;

        case STAGE3__OFF_SOME___________OFF_CLICKED_ACTION_BACK_OFF       : t_pat_bag3_back_off     ();         break;
        case STAGE3__ALT_SOME___________ALT_CLICKED_ACTION_ALT_OFF        : t_pat_bag3_alt_off      ();         break;
        case STAGE3__BAK_SOME___________BAK_CLICKED_ACTION_DUMP_BAK       : t_pat_bag3_dump_bak     ();         break;

        case STAGE4__BAK_NONE_SEL_SOME______________ACTION_HIDE_SEL       : t_pat_bag5_hide_sel     ();         break;
        case STAGE4__ALT_NONE_SEL_SOME______________ACTION_HIDE_SEL       : t_pat_bag5_hide_sel     ();         break;

        case STAGE4__OFF_SOME_SEL_NONE__BAG_OPENED__ACTION_SHOW_OFF       : t_pat_bag4_show_off     ();         break;
        case STAGE5__OFF_NONE_SEL_SOME______________ACTION_HIDE_SEL       : t_pat_bag5_hide_sel     ();         break;

        case STAGE6__STANDBY_IDLE___________________ACTION_STANDBY_ON     : t_pat_bag6_standby      ();         break;
        case STAGE7__STANDBY_CLOSED_________________ACTION_STANDBY_OPENED : t_pat_bag7_standby_open ();         break;
        case STAGE8__STANDBY_OPENED_________________ACTION_STANDBY_DONE   : t_pat_bag8_standby_done ();         break;
        default:
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked)
            t_log_stage_msg(STAGE_2_ACTION, "<div class='cc2'>*** "+stage.level+" "+stage.context+" "+stage.action+"*** <em class='cc8'>"+caller+"</em></div>");
        break;
    }
};
/*}}}*/
/*_ t1_handle_pat_bag_sort {{{*/
let t1_handle_pat_bag_sort = function()
{
/* {{{*/
let   caller = "t1_handle_pat_bag_sort";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+": t_pat_bag3_reselect_sort_direction=["+t_pat_bag3_reselect_sort_direction+"]");
/*}}}*/
    let pat_sorted   =                t_are_pat_sorted  ();
    let pat_reversed = !pat_sorted && t_are_pat_reversed();

    switch(t_pat_bag3_reselect_sort_direction)
    {
    default:
    case  0: t_pat_bag3_reselect_sort_direction = (pat_sorted   ? -1 :  1); break; /* from user_set .. alternate current order */
    case  1: t_pat_bag3_reselect_sort_direction = (pat_sorted   ?  0 : -1); break; /* when in phase .. transition by user_set */
    case -1: t_pat_bag3_reselect_sort_direction = (pat_reversed ?  0 :  1); break; /* when in phase .. transition by user_set */
    }
if( log_this) log("...t_pat_bag3_reselect_sort_direction=["+ t_pat_bag3_reselect_sort_direction+"]");
if( log_this) log("...........................pat_sorted=["+ pat_sorted                        +"]");
if( log_this) log(".........................pat_reversed=["+ pat_reversed                      +"]");
    if(t_pat_bag3_reselect_sort_direction != 0)
    {
        if(     (!pat_sorted   && (t_pat_bag3_reselect_sort_direction > 0))
             || (!pat_reversed && (t_pat_bag3_reselect_sort_direction < 0))
          )
            t_pat_bag3_reselect();
    }
    else {
        t_sync_pat_buttons( caller );
    }
};
/*}}}*/
/*_ t1_handle_pat_bag_rot {{{*/
let t1_handle_pat_bag_rot = function()
{
/* {{{*/
let   caller = "t1_handle_pat_bag_rot";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/
    /* current [pat_csv] [bak_csv] [alt_csv] {{{*/
    let hiding_csv = s_clear_slot_all();        /* ignore current selections */
    pat_csv        = csv_cat(pat_csv, off_csv); /* select current patterns   */
    off_csv        = "";

if( log_this) log("%c pat_csv %c["+pat_csv+"]",lbL+lf4, lbR);
if( log_this) log("%c bak_csv %c["+bak_csv+"]",lbL+lf2, lbR);
if( log_this) log("%c alt_csv %c["+alt_csv+"]",lbL+lf6, lbR);

    /*}}}*/
    /* bags parmutations {{{*/
    let to = SYMBOL_RIGHT_ARROW; let ft = SYMBOL_RIGHT_LEFT_ARROW;
    /*TODO: longer code lines!...295chars*/ let move;                                                                                                                                        let l_x;
    if     ( pat_csv &&  bak_csv &&  alt_csv) { move = "<span class='bg4'>PAT</span>"+ft+"<span class='bg6'>ALT</span>"                                                                    ; l_x=1; let tmp = alt_csv;  alt_csv = String(pat_csv);  pat_csv = String(    tmp);                }
    else if( pat_csv &&  bak_csv && !alt_csv) { move = "<span class='bg2'>BAK</span>"+to+"<span class='bg6'>ALT</span>"                                                                    ; l_x=2;                     alt_csv = String(bak_csv);  bak_csv =             "" ;                }
    else if( pat_csv && !bak_csv &&  alt_csv) { move = "<span class='bg4'>PAT</span>"+to+"<span class='bg2'>BAK</span>..<span class='bg6'>ALT</span>"+to+"<span class='bg4'>PAT</span>"; l_x=3;                     bak_csv = String(pat_csv);  pat_csv = String(alt_csv);  alt_csv = ""; }
    else if( pat_csv && !bak_csv && !alt_csv) { move = "<span class='bg4'>PAT</span>"+to+"<span class='bg6'>ALT</span>"                                                                    ; l_x=4;                     alt_csv = String(pat_csv);  pat_csv =             "" ;                }
    else if(!pat_csv &&  bak_csv &&  alt_csv) { move = "<span class='bg6'>ALT</span>"+to+"<span class='bg4'>PAT</span>..<span class='bg2'>BAK</span>"+to+"<span class='bg6'>ALT</span>"; l_x=5;                     pat_csv = String(alt_csv);  alt_csv = String(bak_csv);  bak_csv = ""; }
    else if(!pat_csv &&  bak_csv && !alt_csv) { move = "<span class='bg2'>BAK</span>"+to+"<span class='bg6'>ALT</span>"                                                                    ; l_x=6;                     alt_csv = String(bak_csv);  bak_csv =             "" ;                }
    else if(!pat_csv && !bak_csv &&  alt_csv) { move = "<span class='bg6'>ALT</span>"+to+"<span class='bg4'>PAT</span>"                                                                    ; l_x=7;                     pat_csv = String(alt_csv);  alt_csv =             "" ;                }
    else if(!pat_csv && !bak_csv && !alt_csv) { move = "BAGS EMPTY";                                                                                                                             l_x=8; }

    last_bak_alt_move = move;

    let lfx = lfX[l_x];
if(log_this) log("%c "+SDX[l_x]+" %c "+move, lbB+lfx, lbH+lfx);
    /*}}}*/
    /* UPDATE UI {{{*/

    t_cleanup_div( sel_bag );
    t_cleanup_div( pat_bag );
    t_cleanup_div( off_bag );
    t_cleanup_div( bak_bag );
    t_cleanup_div( alt_bag );

    t_pat_bag3_reselect( pat_csv );

if( log_this) log("%c pat_csv %c["+pat_csv+"]",lbL+lf4, lbR);
if( log_this) log("%c bak_csv %c["+bak_csv+"]",lbL+lf2, lbR);
if( log_this) log("%c alt_csv %c["+alt_csv+"]",lbL+lf3, lbR);

    bag_rot.title
        = move
        + LF      + csv_count(pat_csv)+" PAT   "+pat_csv
        + LF      + csv_count(bak_csv)+" BAK   "+bak_csv
        + LF      + csv_count(alt_csv)+" ALT   "+alt_csv
    ;

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly("<pre class='cc7'>"+bag_rot.title+"</pre>");
    /*}}}*/
};
/*}}}*/
/*. t_pat_bag1_slot_pattern {{{*/
let t_pat_bag1_slot_pattern = function(pattern, msg)
{
    /*{{{*/
    let caller  = "t_pat_bag1_slot_pattern("+pattern+")";
let log_this    = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf1);
    /*}}}*/
    /* SEARCH DOCUMENT FOR PAT {{{*/
    set_tools_filter( pattern );
    let tools_filter = t_get_tool_id_value("tools_filter");
    call_check_TreeWalker("body", tools_filter);

    /*}}}*/
    /* SHOW   [    SLOTTED PAT] {{{*/
    if(     get_slot_of_pattern( pattern )) {
        csv_move_pattern_to_pat( pattern );

        t_onPatternUpdate(msg, caller);
    }
    /*}}}*/
    /* BACK   [NOT   FOUND PAT] {{{*/
    else {
        csv_move_pattern_to_bak( pattern );

        t_onPatternUpdate(SYMBOL_BAK+" OFF <em class='cc8'>"+ ellipsis_short(pattern) +"</em>", caller);
    }
    /*}}}*/
};
/*}}}*/
/*. t_pat_bag1_hide_pattern {{{*/
let t_pat_bag1_hide_pattern = function(pattern, msg)
{
    /*{{{*/
    let caller  = "t_pat_bag1_hide_pattern("+pattern+")";
let log_this    = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf1);
    /*}}}*/
    /* HIDE   [    CLEARED PAT] {{{*/
    let slot = get_slot_matching_pattern(pattern);
    if( slot) {
        clear_slot( slot );
        csv_move_pattern_to_off( pattern );

        t_onPatternUpdate(msg, caller);
    }
    /*}}}*/
    /* HIDE   [NOT SLOTTED PAT] {{{*/
    else {
        csv_move_pattern_to_off( pattern );

        t_onPatternUpdate(SYMBOL_HID+" not found <em class='cc8'>"+ ellipsis_short(pattern) +"</em>", caller);
    }
    /*}}}*/
};
/*}}}*/
/*. t_pat_bag1_back_pattern {{{*/
let t_pat_bag1_back_pattern = function(pattern, msg)
{
    /*{{{*/
    let caller  = "t_pat_bag1_back_pattern("+pattern+")";
let log_this    = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf1);
    /*}}}*/
    /* BACK   [    CLEARED PAT] {{{*/
    let             slot = get_slot_matching_pattern(pattern);
    if(             slot) {
        clear_slot( slot );
        csv_move_pattern_to_bak( pattern );

        t_onPatternUpdate(msg, caller);
    }
    /*}}}*/
    /* BACK   [NOT SLOTTED PAT] {{{*/
    else {
        csv_move_pattern_to_bak( pattern );

        t_onPatternUpdate(SYMBOL_BAK+" OFF <em class='cc0'>"+ ellipsis_short(pattern) +"</em>", caller);
    }
    /*}}}*/
};
/*}}}*/
/*. t_pat_bag1_alt_pattern {{{*/
let t_pat_bag1_alt_pattern = function(pattern, msg)
{
    /*{{{*/
    let caller  = "t_pat_bag1_alt_pattern("+pattern+")";
let log_this    = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf1);
    /*}}}*/
    /* ALT    [    CLEARED PAT] {{{*/
    let             slot = get_slot_matching_pattern(pattern);
    if(             slot) {
        clear_slot( slot );
        csv_move_pattern_to_alt( pattern );

        t_onPatternUpdate(msg, caller);
    }
    /*}}}*/
    /* ALT    [NOT SLOTTED PAT] {{{*/
    else {
        csv_move_pattern_to_alt( pattern );

        t_onPatternUpdate(SYMBOL_BAK+" OFF <em class='cc0'>"+ ellipsis_short(pattern) +"</em>", caller);
    }
    /*}}}*/
};
/*}}}*/

/*_ t_pat_bag1_toggle_pat {{{*/
let t_pat_bag1_toggle_pat = function(e_target)
{
/*{{{*/
    let want_pattern = e_target.title;
let caller  = "t_pat_bag1_toggle_pat("+want_pattern+")";
let log_this    = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf1);
    /*}}}*/
    /* [pattern] [slot] {{{*/
    if(!want_pattern) {
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_1_INPUT, "<em class='cc0'>NO PATTERN TO TOGGLE</em>");

        return;
    }

    let slot = get_slot_matching_pattern( want_pattern );
if(log_this) log("...slot=["+slot+"]");
    /*}}}*/
    /* TOGGLE [pat_clicked] {{{*/
    flip_el_class(e_target,CSS_PAT_CLICKED);

    /*}}}*/
    if(slot) {
        /* HIDE TOGGLED PATTERN {{{*/
        if(want_pattern == ccs[slot].pattern)
        {
if(log_this) log("HIDE TOGGLED PATTERN");
            t_pat_bag1_hide_pattern(ccs[slot].pattern, SYMBOL_HID+" SEL <em class='cc"+slot+"'>"+ccs[slot].pattern+"</em>");
            if( prop_get( WORDS_OPCYCLE ) )
                setTimeout(cycle_on_last_cleared_pattern, PATTERN_CYCLE_DELAY);
        }
        /*}}}*/
        else {
            /* HIDE ALL COLIDING PATTERNS {{{*/
            do {
if(log_this) log("HIDE COLIDING PATTERN IN SLOT ["+slot+"]");
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly(SYMBOL_COLIDE+" <em class='cc4'>"+want_pattern+"</em> "+SYMBOL_DISMISS+" <em class='cc4'>"+ccs[slot].pattern+"</em>");
                t_pat_bag1_hide_pattern(ccs[slot].pattern, SYMBOL_HID+" SEL <em class='cc"+slot+"'>"+ccs[slot].pattern+"</em>");
            }
            while(slot = get_slot_matching_pattern( want_pattern ));
            /*}}}*/
            /* THEN SHOW TOGGLED PATTERN {{{*/
if(log_this) log("THEN SHOW TOGGLED PATTERN slot=["+slot+"]");

            t_pat_bag1_slot_pattern(want_pattern, SYMBOL_SEL+" <em class='cc1'>"+want_pattern+"</em>");
            /*}}}*/
        }
    }
    /* SHOW TOGGLED PATTERN {{{*/
    else {
if(log_this) log("SHOW TOGGLED PATTERN");
        t_pat_bag1_slot_pattern(    want_pattern, SYMBOL_SEL+" <em class='cc1'>"+want_pattern+"</em>");

    }
    /*}}}*/
};
/*}}}*/

/*_ t_pat_bag2_bag_open {{{*/
let t_pat_bag2_bag_open = function()
{
/*{{{*/
let   caller = "t_pat_bag2_bag_open";
let log_this = LOG_MAP.S2_SELECT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c "+caller, lbB+lf2);
/*}}}*/
    t_pat_bag_open("t_pat_bag2_bag_open", "Showing OFF selections");
};
/*}}}*/

/*_ t_pat_bag3_back_off {{{*/
let t_pat_bag3_back_off = function()
{
/*{{{*/
let caller = "t_pat_bag3_back_off";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf4);
/*}}}*/
    let tmp_csv  =    String( off_csv );
    let    count = csv_count( tmp_csv );
    let patterns = "";

    for(let pos = 1; pos <= count; ++pos)
    {
        /* SHOW   [    SLOTTED PAT] {{{*/
        let pattern = csv_get(tmp_csv, pos     );
        if(     get_slot_of_pattern(   pattern )) {
            csv_move_pattern_to_pat(   pattern );
        }
        /*}}}*/
        /* DUMP   [NOT SLOTTED PAT] {{{*/
        else {
            csv_move_pattern_to_bak(   pattern);

            patterns += pattern+" ";
        }
        /*}}}*/
    }

    t_onPatternUpdate(SYMBOL_BAK+" "+count+" <em class='cc8'>"+ ellipsis_short(patterns) +"</em>", caller);
};
/*}}}*/
/*_ t_pat_bag3_alt_off  {{{*/
let t_pat_bag3_alt_off = function()
{
/*{{{*/
let   caller = "t_pat_bag3_alt_off";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf3);
/*}}}*/
    let tmp_csv  =    String( alt_csv );
    let    count = csv_count( tmp_csv );
    let patterns = "";

    for(let pos = 1; pos <= count; ++pos)
    {
        /* SHOW   [    SLOTTED PAT] {{{*/
        let pattern = csv_get(tmp_csv, pos     );
        if(     get_slot_of_pattern(   pattern )) {
            csv_move_pattern_to_pat(   pattern );
        }
        /*}}}*/
        /* DUMP   [NOT SLOTTED PAT] {{{*/
        else {
            csv_move_pattern_to_bak(   pattern);

            patterns += pattern+" ";
        }
        /*}}}*/
    }

    t_onPatternUpdate(SYMBOL_BAK+" "+count+" <em class='cc8'>"+ ellipsis_short(patterns) +"</em>", caller);
};
/*}}}*/
/*_ t_pat_bag3_dump_bak {{{*/
let t_pat_bag3_dump_bak = function()
{
/*{{{*/
let   caller = "t_pat_bag3_dump_bak";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf3);
/*}}}*/
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_CLEAR_BAK, "want");

    let tmp_csv  =    String( bak_csv );
    let    count = csv_count( tmp_csv );
    let patterns = "";
    for(let pos = 1; pos <= count; ++pos)
    {
        /* TO PAT [    SLOTTED PAT] {{{*/
        let pattern = csv_get(tmp_csv, pos     );
        if(     get_slot_of_pattern(   pattern )) {
            csv_move_pattern_to_pat(   pattern );
        }
        /*}}}*/
        /* TO BIN [NOT SLOTTED PAT] {{{*/
        else {
            csv_move_pattern_to_bin(   pattern);
            patterns += pattern+" ";
        }
        /*}}}*/
    }

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_CLEAR_BIN, "done");

    let dumping_action
        = " DUMPING ("+count+") <em class='cc2'>"+ ellipsis_short(patterns) +"</em> TO <em class='cc0'>bin</em>";
    t_onPatternUpdate(dumping_action, caller);
};
/*}}}*/
/*_ t_pat_bag3_dump_all {{{*/
let t_pat_bag3_dump_all = function()
{
/*{{{*/
let   caller = "t_pat_bag3_dump_all";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf3);
/*}}}*/
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_CLEAR_BAK, "want");

    let tmp_csv  =    String( all_csv );
    let    count = csv_count( tmp_csv );
    let patterns = "";
    for(let pos = 1; pos <= count; ++pos)
    {
        /* TO PAT [    SLOTTED PAT] {{{*/
        let pattern = csv_get(tmp_csv, pos     );
        if(     get_slot_of_pattern(   pattern )) {
            csv_move_pattern_to_pat(   pattern );
        }
        /*}}}*/
        /* TO BIN [NOT SLOTTED PAT] {{{*/
        else {
            csv_move_pattern_to_bin(   pattern);
            patterns += pattern+" ";
        }
        /*}}}*/
    }

if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv(SYMBOL_CLEAR_BIN, "done");

    let dumping_action
        = " DUMPING ("+count+") <em class='cc2'>"+ ellipsis_short(patterns) +"</em> TO <em class='cc0'>bin</em>";
    t_onPatternUpdate(dumping_action, caller);
};
/*}}}*/

/* t_pat_bag3_reselect_all {{{*/
/*{{{*/
const T_PAT_BAG3_RESELECT_DELAY = 1000;
let   t_pat_bag3_reselect_timer;

/*}}}*/
let   t_pat_bag3_reselect_all = function()
{
/*{{{*/
let   caller = "t_pat_bag3_reselect_all";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf3);
/*}}}*/
    if(t_pat_bag3_reselect_timer) clearTimeout( t_pat_bag3_reselect_timer  );
    t_pat_bag3_reselect_timer     = setTimeout(t_pat_bag3_reselect_handler, T_PAT_BAG3_RESELECT_DELAY);
};
/*}}}*/
/*_ t_pat_bag3_reselect_handler {{{*/
let t_pat_bag3_reselect_handler = function()
{
/*{{{*/
let caller = "t_pat_bag3_reselect_handler";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf3);
/*}}}*/
    /* clear all slots {{{*/
    let reselected_csv = s_clear_slot_all();
if( log_this) csv_log(reselected_csv, "currently slotted");

    /*}}}*/
    /* ++ reinject unselected patterns {{{*/

        reselected_csv = csv_cat(reselected_csv, pat_csv);
        reselected_csv = csv_cat(reselected_csv, off_csv);
        reselected_csv = csv_cat(reselected_csv, bak_csv);
if( log_this) csv_log(reselected_csv, "bak_bag_too");

    /*}}}*/
    t_pat_bag3_reselect( reselected_csv );
};
/*}}}*/
/*_ t_pat_bag3_reselect {{{*/
let t_pat_bag3_reselect_sort_direction = 0;
let t_pat_bag3_reselect = function(reselected_csv="NONE")
{
/*{{{*/
let caller = "t_pat_bag3_reselect";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller+": direction="+t_pat_bag3_reselect_sort_direction+"", lbB+lf3);
/*}}}*/
    /* default to reselect currently slotted patterns {{{*/
    if(reselected_csv == "NONE")
    {
        reselected_csv = s_clear_slot_all();
    }
    /*}}}*/
    /* sort .. [eventually] {{{*/
    if(reselected_csv && (t_pat_bag3_reselect_sort_direction != 0))
    {
if( log_this) csv_log(reselected_csv, "reselected_csv");

        let    reverse = (t_pat_bag3_reselect_sort_direction < 0);
        reselected_csv = csv_sort(reselected_csv, reverse);

if( log_this) csv_log(reselected_csv, "(reverse="+reverse+")");
    }
    /*}}}*/
    /* re-slot {{{*/
    if(reselected_csv)
    {
        let       count = csv_count( reselected_csv );
        for(let pos=1; pos<=count; ++pos)
        {
            let pattern = csv_get(reselected_csv, pos);

            t_pat_bag1_slot_pattern(pattern, SYMBOL_SEL+" <em class='cc1'>"+pattern+"</em>");
        }
    }
    /*}}}*/
    t_sync_pat_buttons( caller );
};
/*}}}*/

/*_ t_pat_bag4_show_off {{{*/
let t_pat_bag4_show_off = function()
{
/*{{{*/
let caller = "t_pat_bag4_show_off";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf4);
/*}}}*/
    t_sel_pat_bag_all();
};
/*}}}*/
/*_ t_pat_bag5_hide_sel {{{*/
let t_pat_bag5_hide_sel = function()
{
/*{{{*/
let   caller = "t_pat_bag5_hide_sel";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf5);
/*}}}*/
    let tmp_csv  =    String( pat_csv );
    let   count  = csv_count( pat_csv );
    let patterns = "";

    for(let pos  = 1; pos <= count; ++pos)
    {
        /* HIDE   [    SLOTTED PAT] {{{*/
        let pattern   = csv_get(tmp_csv, pos);
        csv_add_off_csv(pattern);
        patterns += pattern+" ";

        /*}}}*/
    }
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, SYMBOL_HID+" x"+count+" <em class='cc8'>"+ ellipsis_short(patterns) +"</em>");

    let hiding_csv = s_clear_slot_all();
if( log_this) log("...hiding_csv=["+hiding_csv+"]");
    /* .. clear_slot
     * .. t_clear_slot_sync
     * .. t_onPatternUpdate
     */

};
/*}}}*/
/*_ t_pat_bag6_standby {{{*/
let t_pat_bag6_standby = function()
{
/*{{{*/
let   caller = "t_pat_bag6_standby";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf6);
/*}}}*/
    t_standby_bag_id( pat_bag.id );
};
/*}}}*/
/*_ t_pat_bag7_standby_open {{{*/
let t_pat_bag7_standby_open = function()
{
/*{{{*/
let   caller = "t_pat_bag7_standby_open";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf7);
/*}}}*/
/*{{{
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, "Setting STANDBY OPENED");
}}}*/
    t_pat_bag_open("t_pat_bag7_standby_open", "Standby OPEN");
};
/*}}}*/
/*_ t_pat_bag8_standby_done {{{*/
let t_pat_bag8_standby_done = function()
{
/*{{{*/
let   caller = "t_pat_bag8_standby_done";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c "+caller, lbB+lf8);
/*}}}*/
/*{{{
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, "Setting STANDBY EMPTY");
}}}*/
    t_pat_bag_close("t_pat_bag8_standby_done", "Standby DONE");
};
/*}}}*/
/*_ t_pat_bag9_grab_child {{{*/
/*{{{*/
let off_bag_rect;
let bak_bag_rect;
let alt_bag_rect;
let mov_pat_span;
let pat_bag_was_grid_onGrab;

/*}}}*/
let t_pat_bag9_grab_child = function(parent_div)
{
/*{{{*/
let   caller = "t_pat_bag9_grab_child("+get_n_lbl(parent_div)+")";
let log_this = (LOG_MAP.S2_SELECT || LOG_MAP.EV2_MOVE);

if( log_this) t_log_event_status(caller, lf4);
/*}}}*/
    /* [mov_div] {{{*/
    mov_div.style.display = "block";
    mov_div.style.zIndex  = onWork_EL.style.zIndex + 1;

    mov_div.innerHTML     = onWork_EL.outerHTML;
    t_pat_bag_set_moving_item_label(mov_div.innerHTML);

    /*}}}*/
    /* [mov_pat_span] {{{*/
    mov_pat_span = get_el_parent_with_tag(onWork_EL, "SPAN");

    /*}}}*/
    /* [mov_src] [mov_src_div] [mov_dst_div] {{{*/
    mov_src_div  = parent_div;
    mov_dst_div  = null;

/*
add_el_class(onWork_EL  , CSS_MOV_SRC    );
*/
    add_el_class(mov_src_div, CSS_MOV_SRC);
    /*}}}*/
    /* on grab layout rectangles {{{*/
    pat_bag_was_grid_onGrab = has_el_class(pat_bag, CSS_GRID_BAG);

    off_bag_rect = {
        top    : off_bag.offsetTop                        ,
        left   : off_bag.offsetLeft                       ,
        bottom : off_bag.offsetTop  + off_bag.offsetHeight,
        right  : off_bag.offsetLeft + off_bag.offsetWidth ,
    };

    bak_bag_rect = {
        top    : bak_bag.offsetTop                        ,
        left   : bak_bag.offsetLeft                       ,
        bottom : bak_bag.offsetTop  + bak_bag.offsetHeight,
        right  : bak_bag.offsetLeft + bak_bag.offsetWidth ,
    };

    alt_bag_rect = {
        top    : alt_bag.offsetTop                        ,
        left   : alt_bag.offsetLeft                       ,
        bottom : alt_bag.offsetTop  + alt_bag.offsetHeight,
        right  : alt_bag.offsetLeft + alt_bag.offsetWidth ,
    };

    /*}}}*/
    /* DIM BG (light) {{{*/
    dimm_start_pat_bag( caller );

    /*}}}*/
    return mov_div;
};
/*}}}*/
/*_ t_pat_bag9_grab_item_is_mov_div {{{*/
let t_pat_bag9_grab_item_is_mov_div = function()
{
    return (onWork_EL == mov_div);

};
/*}}}*/
/*_ t_pat_bag9_grab_item_mov_div_is_showing {{{*/
let t_pat_bag9_grab_item_mov_div_is_showing = function()
{
    return (mov_div && (mov_div.style.display != "none"));
};
/*}}}*/
/*XXX t_pat_bag9_grab_item_mov_div_xy -OR- t_pat_bag_mov_div_get_dst_near_xy */
/*. t_pat_bag9_grab_item_mov_div_xy {{{*/
let t_pat_bag9_grab_item_mov_div_xy = function(e, x,y)
{
    /* [mov_dst_div] .. (near or hovering) {{{*/
    let caller = "t_pat_bag9_grab_item_mov_div_xy";
/*{{{
log(caller);
console.dir(     e         )
console.dir("A "+onDown_ALT  )
console.dir("C "+onDown_CTRL )
console.dir("S "+onDown_SHIFT)
}}}*/
    let bag;

    let hovering_or_nearing = onDown_SHIFT;

    if( hovering_or_nearing )
        bag =  t_pat_bag_mov_div_is_xy_hovering_bag(x, y, off_bag) ? off_bag
            :  t_pat_bag_mov_div_is_xy_hovering_bag(x, y, bak_bag) ? bak_bag
            :  t_pat_bag_mov_div_is_xy_hovering_bag(x, y, alt_bag) ? alt_bag
            :                                                        pat_bag
        ;
    else
        bag = t_pat_bag_mov_div_get_dst_near_xy(x, y);

    add_el_class(bag, (hovering_or_nearing ? CSS_HOVERING : "nearing"));
    /*}}}*/
    /* [mov_dst_div] .. (move to) {{{*/
    let                                                pattern = mov_div.firstElementChild.title;

    if     ((bag == bak_bag) && !csv_contains(bak_csv, pattern)) t_pat_bag_hover_div_accept( bak_bag     );
    else if((bag == alt_bag) && !csv_contains(alt_csv, pattern)) t_pat_bag_hover_div_accept( alt_bag     );
    else if((bag == off_bag) && !csv_contains(off_csv, pattern)) t_pat_bag_hover_div_accept( off_bag     );
    else if((bag == pat_bag) && !csv_contains(pat_csv, pattern)) t_pat_bag_hover_div_accept( pat_bag     );
    else if((bag == pat_bag) &&  csv_contains(off_csv, pattern)) t_pat_bag_hover_div_accept( pat_bag     );
    else                                                         t_pat_bag_hover_div_accept( mov_src_div );

/*{{{
    if     ((bag == bak_bag)) log(" csv_contains(bak_csv, ["+pattern+"])"+ csv_contains(bak_csv, pattern));
    else if((bag == off_bag)) log(" csv_contains(off_csv, ["+pattern+"])"+ csv_contains(off_csv, pattern));
    else if((bag == pat_bag)) log(" csv_contains(pat_csv, ["+pattern+"])"+ csv_contains(pat_csv, pattern));
}}}*/
    /*}}}*/
    /* [pat_bag off_bag bak_bag] .. (hovering nearing dimmed) {{{*/
/*
/\(add\|del\)_el_class.*\(pat\|off\|bak\)_\(bag\|div\)
*/
    /* neutralize all */
    let el;
    el = pat_bag; del_el_class(el, CSS_HOVERING); del_el_class(el, "nearing"); del_el_class(el, CSS_DIMMED);
    el = bak_bag; del_el_class(el, CSS_HOVERING); del_el_class(el, "nearing"); del_el_class(el, CSS_DIMMED);
    el = alt_bag; del_el_class(el, CSS_HOVERING); del_el_class(el, "nearing"); del_el_class(el, CSS_DIMMED);
    el = off_bag; del_el_class(el, CSS_HOVERING); del_el_class(el, "nearing"); del_el_class(el, CSS_DIMMED);

    /* highlight dst */
    del_el_class(mov_dst_div, CSS_DIMMED);
    if(mov_dst_div != mov_src_div) {
        add_el_class( mov_dst_div, (hovering_or_nearing ? CSS_HOVERING : "nearing"));
        del_el_class( mov_div, CSS_GRAYED_OUT);
    }
    else {
        add_el_class( mov_div, CSS_GRAYED_OUT);
    }

    /* dimm others */
/*
    if(mov_dst_div != pat_bag) add_el_class(pat_bag, CSS_DIMMED);
    if(mov_dst_div != off_bag) add_el_class(off_bag, CSS_DIMMED);
    if(mov_dst_div != bak_bag) add_el_class(bak_bag, CSS_DIMMED);
*/
    /* dimm source */
    if(mov_src_div == pat_bag) add_el_class(pat_bag, CSS_DIMMED);
    if(mov_src_div == off_bag) add_el_class(off_bag, CSS_DIMMED);
    if(mov_src_div == bak_bag) add_el_class(bak_bag, CSS_DIMMED);
    if(mov_src_div == alt_bag) add_el_class(alt_bag, CSS_DIMMED);

/*}}}*/
    /* [mov_div] .. (drift) {{{*/
    let mov_L = mov_pat_span.lastChild.offsetLeft;
    let mov_T = mov_pat_span.lastChild.offsetTop ;

    let bag_x = (bag == pat_bag)     ? 0 : bag.offsetLeft;
    let bag_y = (bag == pat_bag)     ? 0 : bag.offsetTop ;

    let mov_x = (bag == mov_src_div) ? mov_L : bag_x + mov_L;
    let mov_y = (bag == mov_src_div) ? mov_T : bag_y + mov_T;

t_show_hov_1(mov_x, mov_y);
t_show_hov_2(mov_x, mov_y);
/*{{{
}}}*/
    let dx = x - mov_x;
    let dy = y - mov_y ;

    let left = mov_x + dx * 0.5;
    let top  = mov_y + dy * 0.5;

/*{{{
let lb4 = (bag == pat_bag) ? lbb[4]
    :     (bag == off_bag) ? lbX[8]
    :     (bag == bak_bag) ? lbX[0]
    :     (bag == alt_bag) ? lbX[6]
    :                        lbX[2]
;
log("%c"+bag.id+" %c XY=["+left+" "+top+"] %c OXY=["+mov_x+" "+mov_y+"] %c DXY=["+dx+" "+dy+"]", lbF+lb4, lbA, lbA, lb4);
}}}*/

    mov_div.style.left = left +"px";
    mov_div.style.top  = top +"px";

    /*}}}*/
    /* [bag] .. (drift) {{{*/
/*
    dx     = x - bag.offsetLeft   ;
    dy     = y - bag.offsetHeight ;

    let mx = -(dx * 0.1);
    let my = -(dy * 0.1);

    bag.style.marginLeft = mx +"px";
    bag.style.marginTop  = my +"px";
*/
    /*}}}*/
};
/*}}}*/
/*_ t_pat_bag9_grab_item_mov_div_drop {{{*/
let t_pat_bag9_grab_item_mov_div_drop = function()
{
    /*{{{*/
    let caller = "t_pat_bag9_grab_item_mov_div_drop";
let log_this   = (LOG_MAP.S2_SELECT || LOG_MAP.EV2_MOVE);

if( log_this) t_log_event_status(caller, lf4);
    /*}}}*/
    /* DIM BG (undisplay) {{{*/
    dimm_stop(caller);

    /*}}}*/
    /* HIDE [mov_div] {{{*/
    mov_div.style.display = "none";

    mov_div.innerHTML     = "";
    t_pat_bag_set_moving_item_label(mov_div.innerHTML);

    /*}}}*/
    /* [mov_src_div] [mov_dst_div] [mov_src] {{{*/
/*{{{
    if( has_el_class(mov_src_div, CSS_MOV_SRC))
    {
        let                  elements        = mov_src_div.getElementsByTagName("EM");
        for(let i=0; i <     elements.length ; ++i) {
            if( has_el_class(elements[i]     , CSS_MOV_SRC) )
                del_el_class(elements[i]     , CSS_MOV_SRC);
        }

        del_el_class(mov_src_div, CSS_MOV_SRC);
    }
}}}*/
    del_el_class(pat_bag     , CSS_MOV_SRC);
    del_el_class(off_bag     , CSS_MOV_SRC);
    del_el_class(bak_bag     , CSS_MOV_SRC);
    del_el_class(alt_bag     , CSS_MOV_SRC);
    del_el_class(mov_pat_span, CSS_MOV_SRC);

    mov_pat_span = null;
    mov_src_div  = null;
    mov_dst_div  = null;
    /*}}}*/
    /* t_hide_hov {{{*/
    t_hide_hov();

    /*}}}*/
    /* [moving] [hovering] [dimmed] {{{*/
    del_el_class(mov_div, CSS_MOVING);

    del_el_class(bak_bag, CSS_HOVERING); del_el_class(bak_bag, CSS_DIMMED); del_el_class(bak_bag, "nearing");
    del_el_class(alt_bag, CSS_HOVERING); del_el_class(alt_bag, CSS_DIMMED); del_el_class(alt_bag, "nearing");
    del_el_class(off_bag, CSS_HOVERING); del_el_class(off_bag, CSS_DIMMED); del_el_class(off_bag, "nearing");
    del_el_class(pat_bag, CSS_HOVERING); del_el_class(pat_bag, CSS_DIMMED); del_el_class(pat_bag, "nearing");

    /*}}}*/
    t_pat_bag_open_or_close(caller);
};
/*}}}*/
/*_ t_pat_bag9_move_item_to_div {{{*/
let t_pat_bag9_move_item_to_div = function(to_div)
{
/*
log("t_pat_bag9_move_item_to_div:");
log(". mov_div.firstElementChild.title...["+mov_div.firstElementChild.title+"]");
*/

    let ccX
        = (to_div == pat_bag) ? "cc1"
        : (to_div == off_bag) ? "cc5"
        : (to_div == bak_bag) ? "cc2"
        : (to_div == alt_bag) ? "cc6"
        : "";

    let moving_action
        = " MOVING <em class='cc9'>"    + get_n_lbl( mov_div.firstElementChild ) +"</em>"
        +     " TO <em class='"+ccX+"'>"+ get_n_lbl( to_div ) +"</em>"
    ;
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, moving_action);

    let pattern = mov_div.firstElementChild.title;

    switch(to_div) {
        case pat_bag: t_pat_bag1_slot_pattern(pattern, SYMBOL_SEL +" <em class='"+ccX+"'>"+pattern+"</em>"); break;
        case off_bag: t_pat_bag1_hide_pattern(pattern, SYMBOL_HID +" <em class='"+ccX+"'>"+pattern+"</em>"); break;
        case bak_bag: t_pat_bag1_back_pattern(pattern, SYMBOL_BAK +" <em class='"+ccX+"'>"+pattern+"</em>"); break;
        case alt_bag: t_pat_bag1_alt_pattern (pattern, SYMBOL_ALT +" <em class='"+ccX+"'>"+pattern+"</em>"); break;
    }

    return moving_action;
};
/*}}}*/
/*}}}*/

/* PAT LAYOUT */ /*{{{*/
/*. t_build_bag_tools {{{*/
let t_build_bag_tools = function()
{
    if(!dom_tools_html) return;
    /* fly_div {{{*/
    fly_div    = document.createElement("DIV"  );
    fly_div.id = "fly_div";
    t_set_CSS_PINNED(fly_div, true);

    let xy = store_parseXY("fly_div_XY");
/*{{{
logBIG("t_log_onlayout: store_parseXY('fly_div_XY')=["+xy+"]", lf4);
}}}*/
    if(xy) {
        fly_div.style.left = xy.x+"px";
        fly_div.style.top  = xy.y+"px";
    }

    dom_tools_html.appendChild(fly_div);

    /*}}}*/
    /* off_bag {{{*/
    off_bag = document.createElement("DIV"  ); off_bag.id = "off_bag"; add_el_class( off_bag, CSS_EMPTY);
    off_bag.title = "OFF BAG";

/* off_bag_place_holder {{{
    off_bag.insertAdjacentHTML("beforeend", place_holder_line);
    off_bag_place_holder = off_bag.firstElementChild;
}}}*/
    /*}}}*/
    /* bak_bag {{{*/
    bak_bag = document.createElement("DIV"  ); bak_bag.id = "bak_bag";
    bak_bag.title = "BAK BAG";

/* bak_bag_place_holder {{{
    let place_holder_line
        = "<span class='pat_span place_holder'><em class='num_em'>"+SYMBOL_CHECK_MARK+"</em>&nbsp;"
        + "<em class='cc1'>&nbsp;</em>"
        + "</span>"
    ;
    bak_bag.insertAdjacentHTML("beforeend", place_holder_line);
    bak_bag_place_holder = bak_bag.firstElementChild;
}}}*/
    /*}}}*/
    /* alt_bag {{{*/
    alt_bag = document.createElement("DIV"  ); alt_bag.id = "alt_bag";
    alt_bag.title = "ALT BAG";

    /*}}}*/
    /* bot_div bag_log bag_rot pat_sort fly_log {{{*/
    bot_div  = document.createElement("DIV"); bot_div .id = "bot_div" ;
    bag_log  = document.createElement("DIV"); bag_log .id = "bag_log" ; add_el_class(bag_log, CSS_TXT_LOG);
    fly_log  = document.createElement("DIV"); fly_log .id = "fly_log" ;
    pat_sort = document.createElement("DIV"); pat_sort.id = "pat_sort";
    bag_rot  = document.createElement("DIV"); bag_rot .id = "bag_rot" ;

    fly_log .title = "flying log"+LF+".. click them to hide";
    pat_sort.title = "sort";
    bag_rot .title = "BAGS CONTENT"+ LF
        + LF       + csv_count(pat_csv)+" PAT   "+pat_csv
        + LF       + csv_count(bak_csv)+" BAK   "+bak_csv
        + LF       + csv_count(alt_csv)+" ALT   "+alt_csv
    ;

    bot_div.appendChild( bag_log  );
    bot_div.appendChild( fly_log  );
    bot_div.appendChild( pat_sort );
    bot_div.appendChild( bag_rot  );
    /*}}}*/
    /* bag_swap {{{*/
/*{{{
:new %:h/../stylesheet/dom_tools.css

 -----------------DIV-----------------
 -----------------top-----------------
 -----[PAT]---------------[BAK]-------
 -----------------tip-----------------
 -----------s_e--------s_w------------
 -------------------------------------
 ----------------[ALT]----------------
 -------------------------------------

}}}*/
/*{{{
    swap_div    = document.createElement("DIV"); swap_div.id = "swap_div";
    swap_tip    = document.createElement("DIV"); swap_tip.id = "swap_tip";
    swap_pat    = document.createElement("DIV"); swap_pat.id = "swap_pat";
    swap_bak    = document.createElement("DIV"); swap_bak.id = "swap_bak";
    swap_alt    = document.createElement("DIV"); swap_alt.id = "swap_alt";
    swap_top    = document.createElement("DIV"); swap_top.id = "swap_top";
    swap_s_e    = document.createElement("DIV"); swap_s_e.id = "swap_s_e";
    swap_s_w    = document.createElement("DIV"); swap_s_w.id = "swap_s_w";

    swap_div.appendChild( swap_tip );
    swap_div.appendChild( swap_pat );
    swap_div.appendChild( swap_bak );
    swap_div.appendChild( swap_alt );
    swap_div.appendChild( swap_top );
    swap_div.appendChild( swap_s_e );
    swap_div.appendChild( swap_s_w );

    shadow_root.insertBefore(swap_div, shadow_root.firstElementChild);
}}}*/
    /*}}}*/
    /* mov_div {{{*/
    mov_div = document.createElement("DIV"  ); mov_div.id = "mov_div" ;
    mov_div.style.display = "none";

/*{{{
    mov_dst = document.createElement("DIV"  ); mov_dst.id = "mov_dst" ;
    mov_dst.style.display = "none";
}}}*/
    /*}}}*/
    /* pat_bag composition {{{*/
    pat_bag.appendChild(off_bag);
    pat_bag.appendChild(bak_bag);
    pat_bag.appendChild(alt_bag);
    pat_bag.appendChild(bot_div);
    pat_bag.appendChild(mov_div);

/* pat_bag_place_holder {{{
    pat_bag.insertAdjacentHTML("beforeend", place_holder_line);
    pat_bag_place_holder = pat_bag.firstElementChild;
}}}*/
    /*}}}*/
    /* hov1..hov4 {{{*/
    hov1    = document.createElement("DIV" ); hov1.id    = "hov1"   ; hov1.innerText = SYMBOL_LOWER_RIGHT;
    hov2    = document.createElement("DIV" ); hov2.id    = "hov2"   ; hov2.innerText = SYMBOL_UPPER_LEFT;
    hov3    = document.createElement("DIV" ); hov3.id    = "hov3"   ; hov3.innerText = SYMBOL_LOWER_RIGHT;
    hov4    = document.createElement("DIV" ); hov4.id    = "hov4"   ; hov4.innerText = SYMBOL_UPPER_LEFT;

    hov1   .style.display = "none";
    hov2   .style.display = "none";
    hov3   .style.display = "none";
    hov4   .style.display = "none";

    pat_bag.appendChild(hov1   );
    pat_bag.appendChild(hov2   );
    pat_bag.appendChild(hov3   );
    pat_bag.appendChild(hov4   );
    /*}}}*/
};
/*}}}*/
/*_ t_sync_pat_buttons {{{*/
let t_sync_pat_buttons = function(_caller)
{
    /* [pat_csv] is sorted in ascending alphabetic order {{{*/
    if( pat_sort ) {
        let pat_user_set = (t_pat_bag3_reselect_sort_direction == 0);
        let pat_sorted   =                t_are_pat_sorted();
        let pat_reversed = !pat_sorted && t_are_pat_reversed();
/*{{{
        set_el_class_removing(pat_sort, pat_sorted ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
}}}*/

        pat_sort.innerHTML
            = pat_user_set ? (                SYMBOL_CHECK_MARK                       )
            : pat_sorted   ? ("<sup>A</sup>"+ SYMBOL_UP                +"<sub>Z</sub>")
            : pat_reversed ? ("<sup>Z</sup>"+ SYMBOL_DOWN              +"<sub>A</sub>")
            :                (                SYMBOL_UP+LF+SYMBOL_DOWN                )
        ;

        set_el_class_on_off(pat_sort, CSS_CHECKED , (pat_sorted || pat_reversed));
        set_el_class_on_off(pat_sort, CSS_USER_SET,  pat_user_set               );

/*{{{
logBIG("...pat_sort.className=["+pat_sort.className+"]")
}}}*/
    }
    /*}}}*/
    /* [alt_csv] contains an alternate set of patterns {{{*/
    if( bag_rot )
    {
/*{{{
        if( !bag_rot.innerHTML )
        {
            if( alt_csv ) { bag_rot.innerHTML = csv_count(alt_csv); add_el_class(el, CSS_CHECKED); }
            else          { bag_rot.innerHTML = SYMBOL_NOT_CHECKED; del_el_class(el, CSS_CHECKED); }
        }
}}}*/

        if( !last_bak_alt_move ) last_bak_alt_move = "BAGS CONTENT";
        bag_rot.innerHTML
            =  last_bak_alt_move + "<br>"
            + "<span class='bg4'>pat"+csv_count(pat_csv)+"</span> "
            + "<span class='bg2'>bak"+csv_count(bak_csv)+"</span> "
            + "<span class='bg6'>alt"+csv_count(alt_csv)+"</span>"
        ;
    }
    /*}}}*/
};
/*}}}*/
/*_ t_show_hov_1 t_show_hov_2 t_hide_hov {{{*/
let t_show_hov_1 = function(x,y) { if(typeof hov1 == "undefined") return; hov1.style.display = "inline-block"; hov1.style.left = x+"px"; hov1.style.top = y+"px"; };
let t_show_hov_2 = function(x,y) { if(typeof hov2 == "undefined") return; hov2.style.display = "inline-block"; hov2.style.left = x+"px"; hov2.style.top = y+"px"; };
let t_hide_hov   = function()
{
    if(typeof hov1 != "undefined") hov1.style.display = "none";
    if(typeof hov2 != "undefined") hov2.style.display = "none";
    if(typeof hov3 != "undefined") hov3.style.display = "none";
    if(typeof hov4 != "undefined") hov4.style.display = "none";
};
/*{{{
}}}*/
/*}}}*/
/*_ t_hov_rect {{{*/
let t_hov_rect = function(moving_rect, hovered_rect)
{
    hov1.style.display= "block"; hov1.style.left = ( moving_rect.left )+"px"; hov1.style.top = ( moving_rect.top   )+"px";
    hov2.style.display= "block"; hov2.style.left = ( moving_rect.right)+"px"; hov2.style.top = ( moving_rect.bottom)+"px";
    hov3.style.display= "block"; hov3.style.left = (hovered_rect.left )+"px"; hov3.style.top = (hovered_rect.top   )+"px";
    hov4.style.display= "block"; hov4.style.left = (hovered_rect.right)+"px"; hov4.style.top = (hovered_rect.bottom)+"px";
};
/*}}}*/
/*_ t_pat_bag_open_or_close {{{*/
let t_pat_bag_open_or_close = function(_caller)
{
    /*{{{*/
    let caller = "t_pat_bag_open_or_close";
let log_this = LOG_MAP.S2_SELECT;
if( log_this) log(caller+" .. CALLED BY "+ _caller);
if( log_this) log("...onWork_MOVABLE_CHILD=["+onWork_MOVABLE_CHILD+"]");

    /*}}}*/
    /* msg {{{*/
    let no_change_msg                  = "Panel left "+ (has_el_class(pat_bag, CSS_OPEN_BAG) ? "OPENED" : "CLOSED");
    let sel_none_off_some_msg          = "Panel OPENED: some to choose";
    let sel_none_off_none_bak_none_msg = "Panel CLOSED: none to choose";
    let sel_some_msg                   = "Panel CLOSED: some selection";
    let sel_some_bak_none_msg          = "Panel CLOSED: SEL some BAK none";

    /*}}}*/
    /* count {{{*/
    let sel_count = s_get_slotted_pattern_count();
    let off_count = csv_count(off_csv);
    let bak_count = csv_count(bak_csv);

    let sel_none_off_some              = (!sel_count &&  off_count                );
    let sel_none_off_none_bak_none     = (!sel_count && !off_count   && !bak_count);
    let sel_some                       = ( sel_count                              );
    let sel_some_bak_none              = ( sel_count                 && !bak_count);

    let sel = " <em class='have cc"+ (sel_count ? 1 : 8)+"'>SEL "+ sel_count +"</em>";
    let off = " <em class='have cc"+ (off_count ? 5 : 8)+"'>OFF "+ off_count +"</em>";
    let bak = " <em class='have cc"+ (bak_count ? 2 : 8)+"'>BAK "+ bak_count +"</em>";

    /*}}}*/
    /* OPEN OR CLOSE {{{*/

    let close_canceled =  false /* !onWork_MOVABLE_CHILD */; /* t_pat_bag_close_handler will reschedule itself */

    if     (sel_none_off_some                            ) t_pat_bag_open (caller, sel_none_off_some_msg          + sel + off + bak);
    else if(sel_some                   && !close_canceled) t_pat_bag_close(caller, sel_some_msg                   + sel + off + bak);
/*  else if(sel_some_bak_none          && !close_canceled) t_pat_bag_close(caller, sel_some_bak_none_msg          + sel + off + bak); */
    else if(sel_none_off_none_bak_none && !close_canceled) t_pat_bag_close(caller, sel_none_off_none_bak_none_msg + sel + off + bak);
    else if(LOG_MAP.EV8_FLOATLOG || fly_log_checked      ) t_log_stage_msg(STAGE_3_RESULT, no_change_msg          + sel + off + bak);

    /*}}}*/
/* {{{

    let sel_none_off_more_msg          = "Panel OPENED: more to choose";
    let sel_none_off_more              = (!sel_count &&  off_count>1 );

    else if(sel_none_off_more                         ) t_pat_bag_open (caller, sel_none_off_more_msg  + sel + off + bak);
    else if(              !off_count                  ) t_pat_bag_close(caller,     "No   OFF selections to choose from");
    else if(              !off_count     && !bak_count) t_pat_bag_close(caller,     "No other selection  to choose from");
    else if(!sel_count                                ) t_pat_bag_close(caller,           "No selection  to choose from");
    else                                                t_pat_bag_close(caller, "Some slotted selection"                );

}}}*/
};
/*}}}*/
/* UPDATE */
/*. t_pat_bag_set_moving_item_label {{{*/
let t_pat_bag_set_moving_item_label  = function(moving_item_label)
{
    let caller =          "t_pat_bag_set_moving_item_label("+moving_item_label+")";
if(LOG_MAP.S2_SELECT) log(caller);

    if(moving_item_label) add_el_class(pat_bag, CSS_HAS_MOVING_CHILD);
    else                  del_el_class(pat_bag, CSS_HAS_MOVING_CHILD);

    let bag_is_opened    = has_el_class(pat_bag, CSS_OPEN_BAG);

    if( (moving_item_label && !bag_is_opened) )
        t_pat_bag_open(caller, "OPENED - MOVING ITEM "+moving_item_label);
};
/*}}}*/
/*. t_pat_bag_open {{{*/
let t_pat_bag_open  = function(_caller, msg="Pattern bag opened")
{
    /* LOG {{{*/
let log_this = LOG_MAP.S2_SELECT;
if( log_this) log("t_pat_bag_open %c .. CALLED BY "+ _caller+" %c .. msg=["+msg+"]", lb0, lbF);
if(msg) if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, msg);
    /*}}}*/
    /* OPEN {{{*/

    if(!has_el_class(pat_bag, CSS_OPEN_BAG))
    {
        if( logging_something() )
            t_log_transcript_event_bot("<span style='color:red;'>"+SYMBOL_BLACK_CIRCLE+"</span>"
                +                      " <span>open_bag</span>"
                +                      " <em>"+msg+"</em>"
            );

        add_el_class(pat_bag, CSS_OPEN_BAG);

        t_sync_pat_off_bak_innerHTML();
        t_cache_layout(msg);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_pat_bag_close {{{*/
/*{{{*/
let T_PAT_BAG_CLOSE_DELAY            = 1000;
let T_PAT_BAG_CLOSE_RESCHEDULE_DELAY = 1000;
let t_pat_bag_close_timer;
let t_pat_bag_close_msg;
/*}}}*/
let t_pat_bag_close = function(_caller, msg="PATTERN BAG CLOSED")
{
    /* LOG {{{*/
let log_this = LOG_MAP.S2_SELECT;
if( log_this) log("t_pat_bag_close_handler %c .. CALLED BY "+ _caller+" %c .. msg=["+msg+"]", lb0, lbF);
if(msg) if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION, msg);

    /*}}}*/
    /* PAT_BAG DELAYED CLOSE {{{*/
    t_pat_bag_close_msg = msg;
    if(t_pat_bag_close_timer) clearTimeout( t_pat_bag_close_timer  );
    t_pat_bag_close_timer     = setTimeout( t_pat_bag_close_handler, T_PAT_BAG_CLOSE_DELAY);
    /*}}}*/
};
/*}}}*/
/*. t_pat_bag_close_handler {{{*/
let t_pat_bag_close_handler = function()
{
    t_pat_bag_close_timer = null;

    if( has_el_class(pat_bag, CSS_OPEN_BAG) )
    {
        let close_canceled
            = onWork_MOVABLE_CHILD
            ?  true
            :  false;

        if( logging_something() )
        {
            let s_style = close_canceled ? "color:yellow" : "color:green";
            let t_style = close_canceled ? "color:yellow" : "text-decoration:line-through";
            let t_text  = close_canceled ? "kept open while moving child" : t_pat_bag_close_msg;
            t_log_transcript_event_bot( "<span style='"+ s_style +";'>"+SYMBOL_BLACK_CIRCLE+"</span>"
                +                      " <span style='"+ t_style +";'>open_bag</span>"
                +                      " <em>"+          t_text  +"</em>"
            );
        }

        /* close postponed */
        if(close_canceled) {
            t_pat_bag_close_timer = setTimeout(t_pat_bag_close_handler, T_PAT_BAG_CLOSE_RESCHEDULE_DELAY);
        }
        else {
            del_el_class(pat_bag, CSS_OPEN_BAG);

            t_sync_pat_off_bak_innerHTML();
            t_cache_layout("t_pat_bag_close_handler");
        }
    }
};
/*}}}*/
/*_ t_pat_bag_mov_div_is_xy_hovering_bag {{{*/
let t_pat_bag_mov_div_is_xy_hovering_bag = function(x,y,hov_div)
{
    /* RECT: moving object rectangle */
    let mov_div_rect = {
        top    : y                                        ,
        left   : x                                        ,
        bottom : y                  + mov_div.offsetHeight,
        right  : x                  + mov_div.offsetWidth ,
    };

    /* RECT: container accepting moving object */
    /*.................(container)................(contained)......*/
    let hov_div_top  = (hov_div == pat_bag) ? 0 : hov_div.offsetTop ;
    let hov_div_left = (hov_div == pat_bag) ? 0 : hov_div.offsetLeft;

    let hov_div_rect = {
        top    : hov_div_top                              ,
        left   : hov_div_left                             ,
        bottom : hov_div_top        + hov_div.offsetHeight,
        right  : hov_div_left       + hov_div.offsetWidth ,
    };

    let overlapping
        = !(   (mov_div_rect.right  < hov_div_rect.left  )
            || (mov_div_rect.left   > hov_div_rect.right )
            || (mov_div_rect.bottom < hov_div_rect.top   )
            || (mov_div_rect.top    > hov_div_rect.bottom)
        );

    if(overlapping || (hov_div == pat_bag))
        t_hov_rect(mov_div_rect, hov_div_rect);
/*
*/

    return overlapping;
};
/*}}}*/
/* TODO WHEN TO USE t_pat_bag_mov_div_get_dst_near_xy */
/*_ t_pat_bag_mov_div_get_dst_near_xy {{{*/
let t_pat_bag_mov_div_get_dst_near_xy = function(x,y)
{
    if(pat_bag_was_grid_onGrab)
    {
        let h_22 = pat_bag.offsetHeight / 2;
        let w_32 = pat_bag.offsetWidth / 3;
        let w_33 = pat_bag.offsetWidth / 3 * 2;

        if     (x > w_33  ) return alt_bag; /* Right       */
        else if(x > w_32  ) return bak_bag; /* Right       */
        else if(y > h_22  ) return off_bag; /* Left Bottom */
        else                return pat_bag; /* Left Top    */
    }
    else {
        let h_42 = pat_bag.offsetHeight / 4;
        let h_43 = pat_bag.offsetHeight / 4 * 2;
        let h_44 = pat_bag.offsetHeight / 4 * 3;

        if     (y <  h_42 ) return pat_bag; /* TOP */
        else if(y <  h_43 ) return off_bag; /* 2/4 */
        else if(y <  h_44 ) return bak_bag; /* 3/4 */
        else                return alt_bag; /* BOT */
    }

};
/*}}}*/
/*_ t_pat_bag_hover_div_accept {{{*/
let t_pat_bag_hover_div_accept = function(div)
{
/*
log("t_pat_bag_hover_div_accept("+get_n_lbl(div)+")");
*/
    mov_dst_div = div;

/*
log("t_pat_bag_hover_div_accept("+get_n_lbl(div)+"): ...mov_pat_span=["+get_n_lbl(mov_pat_span)+"]");
*/
    if(mov_pat_span.parentNode != mov_dst_div)
    {
        if     (off_bag        == mov_dst_div) off_bag.appendChild ( mov_pat_span                    );
        else if(bak_bag        == mov_dst_div) bak_bag.insertBefore( mov_pat_span, bak_bag.firstElementChild);
        else if(alt_bag        == mov_dst_div) alt_bag.insertBefore( mov_pat_span, alt_bag.firstElementChild);
        else if(pat_bag        == mov_dst_div) pat_bag.insertBefore( mov_pat_span, off_bag           );
    }
/*
*/
/*{{{
    switch(div) {
        case bak_bag: {
            bak_bag_place_holder.style.display =  "none";
            off_bag_place_holder.style.display = "block";
            pat_bag_place_holder.style.display = "block";
        }
        break;
        case off_bag: {
            bak_bag_place_holder.style.display = "block";
            off_bag_place_holder.style.display =  "none";
            pat_bag_place_holder.style.display = "block";
        }
        break;
        case pat_bag: {
            bak_bag_place_holder.style.display = "block";
            off_bag_place_holder.style.display = "block";
            pat_bag_place_holder.style.display =  "none";
        }
        break;
    }
}}}*/
/*{{{
    switch(div) {
        case bak_bag:
        if(  bak_bag_place_holder.parentNode) bak_bag.removeChild ( bak_bag_place_holder, bak_bag.firstElementChild );
        if( !off_bag_place_holder.parentNode) off_bag.insertBefore( off_bag_place_holder, off_bag.firstElementChild );
        if( !pat_bag_place_holder.parentNode) pat_bag.insertBefore( pat_bag_place_holder, off_bag.nextElementSibling);
        break;
        case off_bag:
        if( !bak_bag_place_holder.parentNode) bak_bag.insertBefore( bak_bag_place_holder, bak_bag.firstElementChild );
        if(  off_bag_place_holder.parentNode) off_bag.removeChild ( off_bag_place_holder                     );
        if( !pat_bag_place_holder.parentNode) pat_bag.insertBefore( pat_bag_place_holder, off_bag.nextElementSibling);
        break;
        case pat_bag:
        if( !bak_bag_place_holder.parentNode) bak_bag.insertBefore( bak_bag_place_holder, bak_bag.firstElementChild );
        if( !off_bag_place_holder.parentNode) off_bag.insertBefore( off_bag_place_holder, off_bag.firstElementChild );
        if(  pat_bag_place_holder.parentNode) pat_bag.removeChild ( pat_bag_place_holder                     );
        break;
    }
}}}*/
/*{{{
    if(mov_dst.parentNode) mov_dst.parentNode.removeChild( mov_dst );
    if     (div == pat_bag) div.insertBefore(mov_dst, off_bag.nextElementSibling);
    else                    div.insertBefore(mov_dst,     div.firstElementChild );
}}}*/
/*{{{
    switch(div) {
        case bak_bag:
        if( !bak_bag_place_holder.parentNode) bak_bag.insertBefore( bak_bag_place_holder, bak_bag.firstElementChild );
        break;

        case off_bag:
        if( !off_bag_place_holder.parentNode) off_bag.insertBefore( off_bag_place_holder, off_bag.firstElementChild );
        break;

        case pat_bag:
        if( !pat_bag_place_holder.parentNode) pat_bag.insertBefore( pat_bag_place_holder, off_bag.nextElementSibling);
        break;

    }
}}}*/
/*{{{
    let place_holder_line
        = "<span class='pat_span place_holder'><em class='num_em'>"+SYMBOL_CHECK_MARK+"</em>&nbsp;"
        + "<em class='cc1'>&nbsp;</em>"
        + "</span>"
    ;
    switch(div) {
        case bak_bag:
        bak_bag_place_holder.innerHTML = mov_dst.innerHTML;
        off_bag_place_holder.innerHTML = place_holder_line;
        pat_bag_place_holder.innerHTML = place_holder_line;
        break;

        case off_bag:
        bak_bag_place_holder.innerHTML = place_holder_line;
        off_bag_place_holder.innerHTML = mov_dst.innerHTML;
        pat_bag_place_holder.innerHTML = place_holder_line;
        break;

        case pat_bag:
        bak_bag_place_holder.innerHTML = place_holder_line;
        off_bag_place_holder.innerHTML = place_holder_line;
        pat_bag_place_holder.innerHTML = mov_dst.innerHTML;
        break;
    }
}}}*/
/* accepting place_holder opacity {{{*/
/*
    switch(div) {
        case bak_bag: {
            bak_bag_place_holder.style.opacity = (div == mov_src_div) ? 0 : 1.0;
            off_bag_place_holder.style.opacity = 0.2;
            pat_bag_place_holder.style.opacity = 0.2;
        }
        break;
        case off_bag: {
            bak_bag_place_holder.style.opacity = 0.2;
            off_bag_place_holder.style.opacity = (div == mov_src_div) ? 0 : 1.0;
            pat_bag_place_holder.style.opacity = 0.2;
        }
        break;
        case pat_bag: {
            bak_bag_place_holder.style.opacity = 0.2;
            off_bag_place_holder.style.opacity = 0.2;
            pat_bag_place_holder.style.opacity = (div == mov_src_div) ? 0 : 1.0;
        }
        break;
    }
*/
/*}}}*/
};
/*}}}*/
/*_ t_sel_pat_bag_all {{{*/
let t_sel_pat_bag_all = function()
{
    /*{{{*/
    let caller = "t_sel_pat_bag_all";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log(caller);
    /*}}}*/

    /* SEARCH DOCUMENT FOR NOT ALREADY SLOTTED PATTERNS {{{*/
    let       count = csv_count( pat_csv );
if( log_this) log("...ALREADY SLOTTED PATTERNS x"+count);

    let     tmp_csv =    String( pat_csv );
    let slotted_csv = "";
    let missing_csv = "";

    for(let pos=1; pos<=count; ++pos)
    {
        let pattern = csv_get(tmp_csv, pos);
if(log_this) log("...pattern["+pos+"]=["+pattern+"]");

        if( !get_slot_of_pattern(pattern) )
        {
            set_tools_filter( pattern );
            let tools_filter = t_get_tool_id_value("tools_filter");
            call_check_TreeWalker("body", tools_filter);
        }
        /* SHOW   [    SLOTTED PAT] {{{*/
        if(     set_slot_of_pattern(pos, pattern))
        {
            csv_move_pattern_to_pat( pattern );

            slotted_csv = csv_add(slotted_csv, pattern);
        }
        /*}}}*/
        /* BACK   [NOT   FOUND PAT] {{{*/
        else {
            csv_move_pattern_to_bak( pattern );

            missing_csv = csv_add(missing_csv, pattern);
        }
        /*}}}*/
    }
    /*}}}*/

    let msg = "";

    let s_count = csv_count( slotted_csv );
    let b_count = csv_count( bak_csv );

    if(slotted_csv)
        msg
        =  " <em class='done cc9'>FOUND "+  s_count                       +"</em>"
        +  " <em class='have cc1'>"+        ellipsis_short( slotted_csv ) +"</em>"
    ;
    else
        msg
        =  " <em class='done cc9'>NO SELECTION</em>"
    ;

    if(missing_csv)
        msg
        += " .."
        +  " <em class='done cc8'>MISSED "+ b_count                       +"</em>"
        +  " <em class='have cc8'>"+        ellipsis_short( missing_csv ) +"</em>"
    ;


    /* OPEN BAGS WHEN NOT ALL SELECTED */
    if(csv_count( off_csv ) || csv_count( bak_csv ))
        t_pat_bag_open(caller, "OPEN BAGS WHEN NOT ALL SELECTED");

    t_onPatternUpdate(msg, caller);
};
/*}}}*/
/*_ t_sync_pat_off_bak_innerHTML {{{*/
/*{{{*/
const SYNC_PAT_OFF_BAK_INNERHTML_DELAY = 250;
let   sync_pat_off_bak_innerHTML_timer = null;
/*}}}*/
let t_sync_pat_off_bak_innerHTML = function()
{
/*
log("===t_sync_pat_off_bak_innerHTML_handler");
*/
    if(sync_pat_off_bak_innerHTML_timer) clearTimeout( sync_pat_off_bak_innerHTML_timer  );
    sync_pat_off_bak_innerHTML_timer     = setTimeout( t_sync_pat_off_bak_innerHTML_handler, SYNC_PAT_OFF_BAK_INNERHTML_DELAY);
};
/*}}}*/
/*_ t_sync_pat_off_bak_innerHTML_handler {{{*/
let t_sync_pat_off_bak_innerHTML_handler = function()
{
/*
log("___sync_pat_off_bak_innerHTML_handler");
*/
    sync_pat_off_bak_innerHTML_timer     = null;

    t_set_4_pat_off_bak_alt_innerHTML("sync_pat_off_bak_innerHTML_timer");
};
/*}}}*/
/*}}}*/

/* PAT FOOTER */ /*{{{*/
/*_ t_pat_bag_status {{{*/
/*{{{*/
let T_PAT_BAG_STATUS_DELAY = 1000;
let t_pat_bag_status_timer;
/*}}}*/
let t_pat_bag_status = function(delay=T_PAT_BAG_STATUS_DELAY)
{
    if(       t_pat_bag_status_timer) clearTimeout( t_pat_bag_status_timer);
    if(delay) t_pat_bag_status_timer  = setTimeout( t_pat_bag_status_handler, T_PAT_BAG_STATUS_DELAY);
    else                                            t_pat_bag_status_handler();
};
/*}}}*/
/*_ t_pat_bag_status_handler {{{*/
let t_pat_bag_status_handler = function()
{
    t_pat_bag_status_timer = null;

    t_pat_bag_status_set_innerText( t_pat_bag_status_get_status_line() );

    t_eval_wide_or_tall_panel( pat_bag );
};
/*}}}*/
/*_ t_pat_bag_status_get_status_line {{{*/
let t_pat_bag_status_get_status_line = function()
{
    let empty = !s_get_slotted_pattern_count();

    let b = csv_count(bak_csv);
    let o = csv_count(off_csv);
    let p = csv_count(pat_csv);
    let s = csv_count(sel_csv);

    let more
        =     s ? (" more")
        :         (""     )
    ;

    let selected
        = empty ? (    "None selected")
        :         (s+"/"+p+" selected");

    let can_do
        =  (o+b)? ((o+b) +" "+more+" to choose from")
        :         ("nothing "+more+" to choose from")
      /*:         ("nothing "+more+LF+" to "+LF+" choose "+LF+" from") .. checking bag_log layout */
    ;

    let pat_bag_status
        = selected
        + LF +SYMBOL_RIGHT_ARROW + can_do
/*      = selected      +SYMBOL_RIGHT_ARROW+ can_do ... NO! THIS WRAPS AT RANDOM */
    ;

    return pat_bag_status;
};
/*}}}*/
/*. t_pat_bag_status_set_innerText {{{*/
/*{{{*/
let em_pixels;

/*}}}*/
let t_pat_bag_status_set_innerText = function(innerText)
{
let log_this = LOG_MAP.S2_SELECT;

    if(!em_pixels) {
        let    cs = window.getComputedStyle(fly_log);
        em_pixels = parseInt(cs.width) / 1.4;
    }
    let lines = 2;

    let    l = innerText.indexOf(LF);
    let head = (l > 0) ? innerText.substring(0,l+1) : ""       ; /* LF included .. (  only with  a head-line) */
    let tail = (l > 0) ? innerText.substring(  l+1) : innerText; /* second line .. (or all with no head-line) */

    bot_div.title     = innerText;

    let  len = parseInt(bot_div.clientWidth / em_pixels);
/*{{{
    bag_log.innerText = head + ellipsis(tail, len);
}}}*/
    bag_log.innerText = head +          tail      ;

if(log_this) log("t_pat_bag_status_set_innerText: %c "+len+" %c "+ strip_CR_LF(bag_log.innerText) +" ", lbF+lb4, lb8);
};
/*}}}*/
/*}}}*/

/* PAT STORE */ /*_ t_onPatternUpdate_done {{{*/
let t_onPatternUpdate_done = function()
{
/*{{{*/
let caller   = "t_onPatternUpdate_done";
let log_this = LOG_MAP.S2_SELECT;

if( log_this ) log(caller);
/*}}}*/

    t_store_patterns_csv();

    t_pat_bag_open_or_close(caller);

    t_pat_bag_status();

    t_sync_seek_back  ( caller );
    t_sync_tool_clones( caller );
    t_cache_init_by   ( caller );
    t_sync_pat_buttons( caller );
};
/*}}}*/

/*_ t_store_patterns_csv {{{*/
/*{{{*/
let STORE_PATTERNS_CSV_DELAY = 2000;
let t_store_patterns_timer;
/*}}}*/
/*_ t_store_patterns_csv {{{*/
let t_store_patterns_csv = function()
{
    if(t_store_patterns_timer) clearTimeout( t_store_patterns_timer);
    t_store_patterns_timer   =   setTimeout( t_store_patterns_handler, STORE_PATTERNS_CSV_DELAY);
};
/*}}}*/
/*_ t_store_patterns_handler {{{*/
let t_store_patterns_handler = function()
{
/*{{{*/
let   caller = "t_store_patterns_handler";
let log_this = LOG_MAP.S2_SELECT;

if( log_this) log("%c"+caller, lbF+lb7);
/*}}}*/
    t_store_patterns_timer = null;

    /* SAVING PAGE PATTERNS */
    store_set_value("alt_csv", alt_csv);
    store_set_value("bak_csv", bak_csv);
    store_set_value("off_csv", off_csv);
    store_set_value("pat_csv", pat_csv);
    store_set_value("sel_csv", sel_csv);

    /* [headsup_w] [all_csv] {{{*/
    all_csv         = csv_cat(pat_csv, off_csv);
    all_csv         = csv_cat(all_csv, bak_csv);
    all_csv         = csv_cat(all_csv, alt_csv);

    let     recycle = prop_get_EL("recycle");
    let     slotted = s_get_slotted_pattern_count();
    if     (slotted) recycle.innerText = SYMBOL_RECYCLE;
    else if(all_csv) recycle.innerText = SYMBOL_DOUBLE_VBAR;
    else             recycle.innerText = SYMBOL_ELLIPSIS;

    recycle.title
        = slotted
        ? "showing "+slotted+" of "+ csv_count(all_csv)+" stored patterns"
        :                            csv_count(all_csv)+" stored patterns"
    ;
    /*}}}*/

    t_store_patterns_consider_removing_all_page_items(caller);

};
/*}}}*/
/*_ t_store_patterns_consider_removing_all_page_items {{{*/
/*{{{*/
const CLEAR_STORAGE_MSG
    = "No Page data worth storing:"+LF
    + "---"+LF
    + "...drag hotspot into gutter to clear storage"+LF
    + "...also clears tools selection and layout"
;

/*}}}*/
let t_store_patterns_consider_removing_all_page_items = function(reason)
{
/*{{{*/
let   caller = "t_store_patterns_consider_removing_all_page_items("+reason+")";
let log_this = LOG_MAP.T0_STORE;

/*}}}*/

    let has_document_wording_feature
        =  is_a_DOM_LOAD_featured_function("t_store_patterns_csv");

    let has_pat_csv
        =   has_document_wording_feature
        && (pat_csv && (pat_csv != off_csv));

    let has_bak_csv
        =   has_document_wording_feature
        &&  bak_csv;

    let has_alt_csv
        =   has_document_wording_feature
        &&  alt_csv;

    let some_reason_not_to
        =  has_pat_csv              ? "Storing x"+ csv_count(pat_csv)          +  " current Selection(s)          in green bag:"+LF+ pat_csv
        :  has_bak_csv              ? "Storing x"+ csv_count(bak_csv)          +   " hidden Selection(s) in store in   red bag:"+LF+ bak_csv
        :  has_alt_csv              ? "Storing x"+ csv_count(alt_csv)          +" alternate Selection(s) in store in  blue bag:"+LF+ alt_csv
        :  node_to_hide_csv         ? "Hiding "  + csv_count(node_to_hide_csv) +          " Panel(s)"
        : !t_gutter_is_hotspot_IN() ? CLEAR_STORAGE_MSG
        :                             "";
if(log_this) {
    let s = log_key_val(       caller
                         , {   some_reason_not_to           : some_reason_not_to
                             , has_document_wording_feature : has_document_wording_feature
                             , has_pat_csv                  : has_pat_csv
                             , has_bak_csv                  : has_bak_csv
                             , has_alt_csv                  : has_alt_csv
                             ,     pat_csv                  :     pat_csv
                             ,     bak_csv                  :     bak_csv
                             ,     alt_csv                  :     alt_csv
                          }
                         , lf3
                       );
}
    if(!some_reason_not_to)
    {
if( log_this) log("... REMOVING PAGE localStorage:");
        store_remove_all_page_items();
        t_store_show_all_page_items_removed(true, "Page data storage cleared");
        return true;
    }
    else {
        t_store_show_all_page_items_removed(false, some_reason_not_to);
        return false;
    }
};
/*}}}*/
/*_ t_store_show_all_page_items_removed {{{*/
/*{{{*/
const ALL_PAGE_ITEMS_REMOVED = "all_page_items_removed";

/*}}}*/
let t_store_show_all_page_items_removed = function(removed, reason)
{
    let restoring_removed_page_items = has_el_class(hotring, ALL_PAGE_ITEMS_REMOVED);

    set_el_class_on_off(hotring, ALL_PAGE_ITEMS_REMOVED, removed);

    hotring.title =    strip_to_lines( reason );

    /* restore previously removed settings */
    if(restoring_removed_page_items && !removed)
        t_store1_save_all_settings();
};
/*}}}*/
/*}}}*/

/*}}}*/

/* OUTLINE */
/*{{{*/
/*{{{*/
const OUTLINE_SCAN_STEP_MAX = 3;
const OUTLINE_SCAN_SIGN_MAX = [
    { x: 1 , y: 1 } /* RIGHT  ABOVE  */
  , { x: 1 , y:-1 } /* RIGHT  BELOW  */
  , { x:-1 , y: 1 } /* LEFT   ABOVE  */
  , { x:-1 , y:-1 } /* LEFT   BELOW  */
];

const COLORX
    = [   "#964B00"
        , "#FF0000"
        , "#FFA500"
        , "#FFFF00"
        , "#9ACD32"
        , "#6495ED"
        , "#EE82EE"
        , "#A0A0A0"
        , "#FFFFFF"
        , "#000000"
    ];

let outlined_divs = [];
let outlined_dots = [];
let outlined_dots_used_since_t_outline_clear;
/*}}}*/
/*_ t_outline_viewport_top_containers {{{*/
let t_outline_viewport_top_containers = function()
{
/*{{{*/
let caller = "t_outline_viewport_top_containers";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
if( log_this) console.time(caller);
    /* clear previous {{{*/
    t_outline_clear();

    /*}}}*/
    /* outline current {{{*/
    let v_W = window.innerWidth ;
    let v_H = window.innerHeight;
    let w_2 = v_W / 2;
    let h_2 = v_H / 2;

    /*}}}*/
    /* CIRCLE SCAN AROUND VIEWPORT CENTER {{{*/
    let          step_Y  = v_H / 2 /  OUTLINE_SCAN_STEP_MAX        ;
    let          step_X  = v_W / 2 /  OUTLINE_SCAN_STEP_MAX        ;
    let             num  = 0;
    for(        let col  = 0; (col <= OUTLINE_SCAN_STEP_MAX       ); ++col) { let d_x = col * step_X;
        for(    let row  = 0; (row <= OUTLINE_SCAN_STEP_MAX       ); ++row) { let d_y = row * step_Y;
            for(let dir  = 0; (dir <  OUTLINE_SCAN_SIGN_MAX.length); ++dir)
            {
                if((col == 0)     && (OUTLINE_SCAN_SIGN_MAX[dir].x != 1)) continue; /* skip zero mirror */
                if((row == 0)     && (OUTLINE_SCAN_SIGN_MAX[dir].y != 1)) continue;

                let left = w_2 + d_x *  OUTLINE_SCAN_SIGN_MAX[dir].x ;
                let top  = h_2 + d_y *  OUTLINE_SCAN_SIGN_MAX[dir].y ;

if( log_this)   t_outline_dot(left, top, num);

                if(range = get_range_from_caret ( left, top))
                    num  = t_outline_range(range, left, top, num);
                if((col == 0) && (row == 0)) break; /* directionless case */
            }
        }
    }
/*{{{
}}}*/
    /*}}}*/
if( log_this) console.timeEnd(caller);
};
/*}}}*/
/*_ t_outline_range {{{*/
let t_outline_range = function(range, left, top, num)
{
/*{{{*/
let caller = "t_outline_range";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log_range(range, caller);
/*}}}*/
    /* container {{{*/
    let el = range.startContainer;
    if( el.nodeType == Node.TEXT_NODE) el = el.parentElement;

    /*}}}*/
    /* outined already {{{*/
    if(has_el_class(el, "outlined")               ) return num;
    add_el_class   (el, "outlined");

    /*}}}*/
    /* viewport .. top-left not within {{{*/
    let tl   = get_el_xy(el, caller);
    if( tl.x < (window.scrollX                   )) return num;
    if( tl.y < (window.scrollY                   )) return num;
    if( tl.x > (window.scrollX+window.innerWidth )) return num;
    if( tl.y > (window.scrollY+window.innerHeight)) return num;

    /*}}}*/
    /* viewport .. bottom-right not within {{{*/
    let br   = get_el_xy(el, caller);
    br.x += el.offsetWidth;
    br.y += el.offsetHeight;
    if( br.x < (window.scrollX                   )) return num;
    if( br.y < (window.scrollY                   )) return num;
    if( br.x > (window.scrollX+window.innerWidth )) return num;
    if( br.y > (window.scrollY+window.innerHeight)) return num;

    /*}}}*/
    /* new div {{{*/
    let div = outlined_divs[num];
    if(!div) {
        div = document.createElement("DIV");
        add_el_class(div, "outlined_divs");
        document.documentElement.appendChild(div);
        outlined_divs[num] = div;
    }
    /*}}}*/
    /* show div {{{*/
    div.style.top             = (tl.y           -     div.style.borderWidth) +"px";
    div.style.left            = (tl.x           -     div.style.borderWidth) +"px";
    div.style.width           = (el.offsetWidth + 2 * div.style.borderWidth) +"px";
    div.style.height          = (el.offsetHeight+ 2 * div.style.borderWidth) +"px";

    div.style.zIndex          = el.style.zIndex + 1;
    div.style.borderColor     = COLORX[num % 10];
    div.style.display         = "block";

    /*}}}*/
    return num + 1;
};
/*}}}*/
/*_ t_outline_dot {{{*/
let t_outline_dot = function(left, top, num)
{
    /* new dot {{{*/
    let div = outlined_dots[outlined_dots_used_since_t_outline_clear];
    if(!div) {
        div = document.createElement("DIV");
        add_el_class(div, "outlined_dots");
        document.documentElement.appendChild(div);
        outlined_dots[outlined_dots_used_since_t_outline_clear] = div;
    }

    outlined_dots_used_since_t_outline_clear += 1;
    /*}}}*/
    /* show div {{{*/
    div.style.top             = (window.scrollY + top )+"px";
    div.style.left            = (window.scrollX + left)+"px";

    div.style.backgroundColor = COLORX[num % 10];
    div.style.display         = "block";
/*{{{
    div.innerHTML             = num+1;
}}}*/
    div.innerHTML             = outlined_dots_used_since_t_outline_clear;

    /*}}}*/
};
/*}}}*/
/*_ t_outline_clear {{{*/
let t_outline_clear = function()
{
    /* declassify document containers {{{*/
    let className = "outlined";
    let node_list = document.querySelectorAll("."+className);
    for(let i=0; i < node_list.length; ++i)
        del_el_class(node_list[i], className);

    /*}}}*/
    /* hide outlined_divs {{{*/
    for(let i=0; i < outlined_divs.length; ++i)
        outlined_divs[i].style.display = "none";

/*}}}*/
    /* hide outlined_dots {{{*/
    for(let i=0; i < outlined_dots.length; ++i)
        outlined_dots[i].style.display = "none";

    /*}}}*/
    outlined_dots_used_since_t_outline_clear = 0;
};
/*}}}*/
/*}}}*/
/** LAYOUT */
/*{{{*/
/* SPREAD MOVE STATE CACHE POSITION OPTIONAL STYLE {{{*/
/*{{{*/
let fully_spread_since_onDown;

/*}}}*/

/* LOAD */
/*_ is_dom_grid_loaded {{{*/
let is_dom_grid_loaded = function()
{
    return (typeof t_grid_ON_OFF_CB != "undefined");
};
/*}}}*/
/*_ log_dom_grid_js_not_loaded {{{*/
let log_dom_grid_js_not_loaded = function (_caller)
{
logXXX("%c *** dom_grid.js NOT LOADED *** .. CALLED BY "+ _caller, lbH+lf3);
console.trace();
};
/*}}}*/

/* POSITION */
/*  t_sync_tools_scroll {{{*/
let t_sync_tools_scroll = function()
{
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T2_GRID;

    let caller = "t_sync_tools_scroll";

    let position =  prop_get( TOOLS_SCROLL )  ? "absolute" : "fixed";
if(log_this) log(caller+"...tools_scroll=[%c "+prop_get( TOOLS_SCROLL )+" %c]", lb6,lbA);
if(log_this) log(caller+"...position....=[%c "+position    +" %c]", lb5,lbA);

    let position_has_changed = (hotspot.style.position != position);
    if( position_has_changed)
    {
        t_cache_init_by(caller);
        t_cache_layout("TOOLS_SCROLL "+prop_get( TOOLS_SCROLL ));

        t_sync_tools_position(caller, position_has_changed);
    }
};
/*}}}*/
/*_ t_sync_tools_position {{{*/
let t_sync_tools_position = function(_caller)
{
/*{{{*/
    let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T2_GRID;
if(log_this) log("t_sync_tools_position .. CALLED BY "+ _caller);

    let position =  prop_get( TOOLS_SCROLL ) ? "absolute" : "fixed";
if(log_this) log("...FROM position=["+hotspot.style.position+"]");
if(log_this) log(".....TO position=["+              position+"]");

/*}}}*/
/*{{{
    let      xy  = get_el_xy(hotspot, _caller);
    let x  = xy.x;
    let y  = xy.y;
}}}*/
    let x  = topTool.x;
    let y  = topTool.y;

    if(position == "fixed") {
        x -= window.scrollX;
        y -= window.scrollY;
    }
    else {
        x += window.scrollX;
        y += window.scrollY;
    }
/*{{{
logBIG("t_sync_tools_position ["+position+"] XY=["+x+" "+y+"]")
}}}*/

    t_tool_set_top_xy("t_sync_tools_position", x, y, position);
};
/*}}}*/

/* OPTIONAL */
/*_ t_sync_tools_extras {{{*/
let t_sync_tools_extras = function(_caller)
{
let log_this = LOG_MAP.T2_GRID;

    let state = prop_get( TOOLS_EXTRAS );
if(log_this) log("t_sync_tools_extras .. CALLED BY "+ _caller+": tools_extras=["+state+"]");

    let el;
    if( el = dom_traversal) set_id_class_on_off(el.id, "hidden", !state || !t_is_a_selected_panel(el));
    if( el = dev_log_map  ) set_id_class_on_off(el.id, "hidden", !state || !t_is_a_selected_panel(el));
    if( el = test_panel   ) set_id_class_on_off(el.id, "hidden", !state || !t_is_a_selected_panel(el));
    if( el = dom_load_tags) set_id_class_on_off(el.id, "hidden", !state || !t_is_a_selected_panel(el));

};
/*}}}*/
/*_ t_sync_wording {{{*/
let t_sync_wording = function(_caller)
{
/*{{{*/
    let caller = "t_sync_wording";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+": wording=["+ prop_get( WORDING ) +"] %c CALLED BY "+_caller, lbH+lf5);
/*}}}*/

    if(typeof dom_wording_cycle == "undefined") return;

    let cycle_step
        = !prop_get( WORDING        ) ? "OFF"
        : (prop_get( THEME_DARK     ) ? "DARK" : "LIGHT")
    ;

    let anchor_freeze_by_wording_or_user
        =  prop_get( WORDING       )
        || prop_get( ANCHOR_FREEZE )
        || prop_get( EDIT_OR_STAGE )
    ;
if( log_this) log(caller+": anchor_freeze_by_wording_or_user=["+anchor_freeze_by_wording_or_user+"]");
    dom_wording_cycle(cycle_step, anchor_freeze_by_wording_or_user);
};
/*}}}*/

/* PINS */
/* TODO: call t_eval_wide_or_tall_panel on transcript contents change */
/*_ t_eval_wide_or_tall_panel {{{*/
let t_eval_wide_or_tall_panel = function(tool_panel)
{
    if(!tool_panel.offsetWidth || !tool_panel.offsetHeight) return;
/*{{{
logBIG("t_eval_wide_or_tall_panel("+get_n_lbl(tool_panel)+"): WH=["+tool_panel.offsetWidth+" "+tool_panel.offsetHeight+"]")
}}}*/

    /* manage pin top-right pin layout */
    if(   !get_el_child_with_class(tool_panel,    CSS_PUSH_PIN  )
       && !get_el_child_with_class(tool_panel,    CSS_CLOSEPIN  )
       && !get_el_child_with_class(tool_panel,    CSS_SCALEPIN  )
       && !get_el_child_with_class(tool_panel,    CSS_CLEARPIN  )
      ) {
        del_el_class(tool_panel,                  CSS_WIDE_PANEL);
        del_el_class(tool_panel,                  CSS_TALL_PANEL);
    }
    else {

        /* manage pin right padding */
        if(tool_panel.offsetWidth > tool_panel.offsetHeight) {
            if(!has_el_class(         tool_panel, CSS_WIDE_PANEL))
                set_el_class_removing(tool_panel, CSS_WIDE_PANEL, [CSS_TALL_PANEL]);
        }
        /* manage pin   top padding */
        else {
            if(!has_el_class(         tool_panel, CSS_TALL_PANEL))
                set_el_class_removing(tool_panel, CSS_TALL_PANEL, [CSS_WIDE_PANEL]);
        }
    }

};
/*}}}*/

/*_ t_add_toolpins_on_panel {{{*/
let t_add_toolpins_on_panel = function(panel)
{
    t_add_push_pin_on_panel( panel );
    t_add_closepin_on_panel( panel );
    t_add_scalepin_on_panel( panel );
    if(      (panel.id == "transcript1")
          || (panel.id == "transcript2")
          || (panel.id == "pat_bag"    )
      )
        t_add_clearpin_on_panel(panel);
};
/*}}}*/
/*_ t_add_push_pin_on_panel {{{*/
let t_add_push_pin_on_panel = function(tool_panel)
{
    /* inserted already {{{*/
    let push_pin = get_el_child_with_class(tool_panel, CSS_PUSH_PIN);
    if( push_pin ) return;

    /*}}}*/
    /* create class id title content insert {{{*/
    push_pin           = document.createElement("em");
    push_pin.className = "push_pin cc8";
    push_pin.id        = tool_panel.id +"_push_pin";
    push_pin.title     = "Pin "+tool_panel.id;
    push_pin.innerHTML = SYMBOL_PUSH_PIN;

    /*}}}*/
    /* [push_pin] closepin scalepin clearpin {{{*/
    tool_panel.insertBefore(push_pin, tool_panel.firstElementChild);

    /*}}}*/
    /* layout portrait or landscape {{{*/
    t_eval_wide_or_tall_panel( tool_panel );

    add_el_class(tool_panel, CSS_PIN_ON_PANEL);
    /*}}}*/
};
/*}}}*/
/*_ t_add_closepin_on_panel {{{*/
let t_add_closepin_on_panel = function(tool_panel)
{
    /* inserted already {{{*/
    let closepin = get_el_child_with_class(tool_panel, CSS_CLOSEPIN);
    if( closepin ) return;

    /*}}}*/
    /* create class id title content insert {{{*/
    closepin           = document.createElement("em");
    closepin.className = "closepin";
    closepin.id        = tool_panel.id +"_closepin";
    closepin.title     = "Close "+tool_panel.id;
    closepin.innerHTML = SYMBOL_CLOSEPIN;

    /*}}}*/
    /* [push_pin closepin scalepin clearpin] {{{*/
    let     prevpin;
    if     (prevpin = get_el_child_with_class(tool_panel, CSS_PUSH_PIN)) tool_panel.insertBefore(closepin, prevpin.nextElementSibling);
    else {  prevpin = tool_panel.firstElementChild;                           tool_panel.insertBefore(closepin, prevpin            ); }

    /*}}}*/
    /* layout portrait or landscape {{{*/
    t_eval_wide_or_tall_panel( tool_panel );

    add_el_class(tool_panel, CSS_PIN_ON_PANEL);
    /*}}}*/
};
/*}}}*/
/*_ t_add_scalepin_on_panel {{{*/
let t_add_scalepin_on_panel = function(tool_panel)
{
    /* inserted already {{{*/
    let scalepin = get_el_child_with_class(tool_panel, CSS_SCALEPIN);
    if( scalepin ) return;

    /*}}}*/
    /* create class id title content insert {{{*/
    scalepin           = document.createElement("em");
    scalepin.className = CSS_SCALEPIN;
    scalepin.id        = tool_panel.id +"_scalepin";
    scalepin.title     = "Magnify "+tool_panel.id;

    /*}}}*/
    /* push_pin closepin [scalepin] clearpin {{{*/
    let     prevpin;
    if     (prevpin = get_el_child_with_class(tool_panel, CSS_CLOSEPIN)) tool_panel.insertBefore(scalepin, prevpin.nextElementSibling);
    else if(prevpin = get_el_child_with_class(tool_panel, CSS_PUSH_PIN)) tool_panel.insertBefore(scalepin, prevpin.nextElementSibling);
    else {  prevpin = tool_panel.firstElementChild;                           tool_panel.insertBefore(scalepin, prevpin            ); }

    /*}}}*/
    /* layout portrait or landscape {{{*/
    t_eval_wide_or_tall_panel( tool_panel );

    add_el_class(tool_panel, CSS_PIN_ON_PANEL);
    /*}}}*/
};
/*}}}*/
/*_ t_add_clearpin_on_panel {{{*/
let t_add_clearpin_on_panel = function(tool_panel)
{
    /* inserted already {{{*/
    let clearpin = get_el_child_with_class(tool_panel, CSS_CLEARPIN);
    if( clearpin ) return;

    /*}}}*/
    /* create class id title content insert {{{*/
    clearpin           = document.createElement("em");
    clearpin.className = "clearpin";
    clearpin.id        = tool_panel.id +"_clearpin";
    clearpin.title     = "Clear "+tool_panel.id;
    clearpin.innerHTML = SYMBOL_RECYCLE;

    tool_panel.insertBefore(clearpin, tool_panel.firstElementChild);
    /*}}}*/
    /* push_pin closepin scalepin [clearpin] {{{*/
    let     prevpin;
    if     (prevpin = get_el_child_with_class(tool_panel, CSS_SCALEPIN)) tool_panel.insertBefore(clearpin, prevpin.nextElementSibling);
    else if(prevpin = get_el_child_with_class(tool_panel, CSS_CLOSEPIN)) tool_panel.insertBefore(clearpin, prevpin.nextElementSibling);
    else if(prevpin = get_el_child_with_class(tool_panel, CSS_PUSH_PIN)) tool_panel.insertBefore(clearpin, prevpin.nextElementSibling);
    else {  prevpin = tool_panel.firstElementChild;                    tool_panel.insertBefore(clearpin, prevpin                   ); }

    /*}}}*/
    /* layout portrait or landscape {{{*/
    t_eval_wide_or_tall_panel( tool_panel );

    add_el_class(tool_panel, CSS_PIN_ON_PANEL);
    /*}}}*/
};
/*}}}*/

/*_ t_has_pinclass_on_panel {{{*/
let t_has_push_pin_on_panel = function(tool_panel) { return t_has_pinclass_on_panel(tool_panel, CSS_PUSH_PIN); };
let t_has_closepin_on_panel = function(tool_panel) { return t_has_pinclass_on_panel(tool_panel, CSS_CLOSEPIN); };
let t_has_scalepin_on_panel = function(tool_panel) { return t_has_pinclass_on_panel(tool_panel, CSS_SCALEPIN); };
let t_has_clearpin_on_panel = function(tool_panel) { return t_has_pinclass_on_panel(tool_panel, CSS_CLEARPIN); };
let t_has_pinclass_on_panel = function(tool_panel, pin_class)
{
    return (get_el_child_with_class(tool_panel, pin_class) != null);
};
/*}}}*/
/*_ t_del_pin_css_on_panel {{{*/

let t_del_push_pin_on_panel = function(tool_panel) { t_del_pin_css_on_panel(tool_panel, CSS_PUSH_PIN); };
let t_del_closepin_on_panel = function(tool_panel) { t_del_pin_css_on_panel(tool_panel, CSS_CLOSEPIN); };
let t_del_scalepin_on_panel = function(tool_panel) { t_del_pin_css_on_panel(tool_panel, CSS_SCALEPIN); };
let t_del_clearpin_on_panel = function(tool_panel) { t_del_pin_css_on_panel(tool_panel, CSS_CLEARPIN); };
let t_del_toolpins_on_panel = function(tool_panel) { t_del_pin_css_on_panel(tool_panel, CSS_PUSH_PIN);
                                                     t_del_pin_css_on_panel(tool_panel, CSS_CLOSEPIN);
                                                     t_del_pin_css_on_panel(tool_panel, CSS_SCALEPIN);
                                                     t_del_pin_css_on_panel(tool_panel, CSS_CLEARPIN); };

let t_del_pin_css_on_panel = function(tool_panel, pin_class)
{
    let el = get_el_child_with_class(tool_panel, pin_class);
    if(!el )   return;

    tool_panel.removeChild( el );

    del_el_class(tool_panel, CSS_PIN_ON_PANEL); /* manage pin top-right padding    */
    del_el_class(tool_panel, CSS_WIDE_PANEL  ); /* manage pin top-right pin layout */
    del_el_class(tool_panel, CSS_TALL_PANEL  ); /* manage pin top-right pin layout */
};
/*}}}*/

/*_ t_click_panel_pin_CB {{{*/
let t_click_panel_pin_CB = function(panel, pin)
{
/*{{{*/
    let caller = "t_click_panel_pin_CB";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log("%c"+caller+"%c"+get_n_lbl(panel)+"%c"+get_n_lbl(pin)+"])"
        ,          lbL+lf5    ,lbC+lf3              ,lbR+lf4                );
/*}}}*/
let result;
    if     (         panel.id == "fly_div"  ) t_fly_set("");
    else if( has_el_class(pin , CSS_PUSH_PIN) ) result = "handling done onDown";
    else if( has_el_class(pin , CSS_CLOSEPIN) ) t_tools_panel_select(panel, false);
    else if( has_el_class(pin , CSS_SCALEPIN) ) result = onLong_press4_TOOL_PANEL_MAGNIFY();
    else if( has_el_class(pin , CSS_CLEARPIN) ) t_clear(caller);

if(log_this && result) log("%c"+result, lbH+lf5);
};
/*}}}*/

/*_ t_clear_panel_pined_innerHTML {{{*/
let t_clear_panel_pined_innerHTML = function(panel)
{
/*{{{
logXXX("t_clear_panel_pined_innerHTML("+get_n_lbl(panel)+")");
}}}*/

    let push_pin = get_el_child_with_class(panel, CSS_PUSH_PIN); if( push_pin ) panel.removeChild(push_pin);
    let closepin = get_el_child_with_class(panel, CSS_CLOSEPIN); if( closepin ) panel.removeChild(closepin);
    let scalepin = get_el_child_with_class(panel, CSS_SCALEPIN); if( scalepin ) panel.removeChild(scalepin);
    let clearpin = get_el_child_with_class(panel, CSS_CLEARPIN); if( clearpin ) panel.removeChild(clearpin);

    panel.innerHTML = "";

    if( clearpin ) panel.insertBefore(clearpin, panel.firstElementChild);
    if( scalepin ) panel.insertBefore(scalepin, panel.firstElementChild);
    if( closepin ) panel.insertBefore(closepin, panel.firstElementChild);
    if( push_pin ) panel.insertBefore(push_pin, panel.firstElementChild);
};
    /*}}}*/

/* ORDER */
/*_ t_cycle_pivot_panel {{{*/
let t_cycle_pivot_panel = function()
{
/*{{{*/
let caller   = "t_cycle_pivot_panel";
let log_this = LOG_MAP.T5_SPREAD;

if( log_this ) log(caller);
/*}}}*/
    /* [pivot_PANEL] {{{*/
if( log_this) log("...pivot_PANEL=["+ get_id_or_tag(pivot_PANEL) +"]");
    if( !pivot_PANEL) return;

    /*}}}*/
    /* [next_visible_panel] {{{*/
    let next_visible_panel; let  next_visible_panel_idx;
    /*...................*/ let         pivot_PANEL_idx;
    for(let i=1; i < TOOL_panels.length; ++i)
    {
        /* PINNED */
        let panel = TOOL_panels[i];
        if(!panel                               ) continue; /* i.e. fly_div may not be there yet ... TODO */
        if( panel.classList.contains(CSS_PINNED)) continue;

        /* SELECTED */
        let map = tools_map_get(panel);
        if(!map.selected) continue;

        if(! next_visible_panel && pivot_PANEL_idx) {  next_visible_panel_idx = i;  next_visible_panel    = panel; }
        if(               panel == pivot_PANEL    ) {         pivot_PANEL_idx = i;                                 }

        if(  next_visible_panel ) break;
    }
if( log_this) log("..........pivot_PANEL #"+        pivot_PANEL_idx+" ["+ get_id_or_tag( pivot_PANEL         ) +"]");
if( log_this) log("...next_visible_panel #"+ next_visible_panel_idx+" ["+ get_id_or_tag(  next_visible_panel ) +"]");

    if( !next_visible_panel ) return;

    /*}}}*/
    /* [dragging_first_panel] {{{*/
/*{{{
    let  dragging_first_panel = (pivot_PANEL == first_visible_panel);
if( log_this) log("...dragging_first_panel "+ dragging_first_panel);

    if( !dragging_first_panel) return;
}}}*/
    /*}}}*/
    /* left-shift following panels {{{*/
/*{{{
if( log_this) t_log_TOOL_panels(caller);
    for(let i=first_visible_panel_idx       ; (i+1) < TOOL_panels.length; ++i)
        TOOL_panels[i] = TOOL_panels[i+1];
    TOOL_panels[TOOL_panels.length-1] = first_visible_panel;
if( log_this) t_log_TOOL_panels(caller, lf4);

    t_TOOL_panels_SLOT_SELECTED();
}}}*/
    /*}}}*/
    /* switch with next visible */
if( log_this) t_log_TOOL_panels(caller);

        TOOL_panels[        pivot_PANEL_idx ] =  next_visible_panel;
        TOOL_panels[ next_visible_panel_idx ] =         pivot_PANEL;

if( log_this) t_log_TOOL_panels(caller, lf4);
};
/*}}}*/
/*_ t_get_TOOL_panels_last_selected_not_pinned_idx {{{*/
let t_get_TOOL_panels_last_selected_not_pinned_idx = function()
{
/*{{{*/
let caller   = "t_get_TOOL_panels_last_selected_not_pinned_idx";
let log_this = LOG_MAP.T5_SPREAD;

if( log_this ) log(caller);
/*}}}*/
    let                               panel_idx = 0;
    for(let i=TOOL_panels.length-1; (!panel_idx) && (i > 0); --i)
    {
        let panel = TOOL_panels[i];                if(!panel       )  continue; /* i.e. fly_div may not be there yet ... TODO */
        if(                  panel.classList.contains( CSS_PINNED  )) continue;
        let   map = tools_map_get(panel);  if(!map || !map.selected ) continue;
        panel_idx = i;
    }
if( log_this) log("...panel_idx #"+ panel_idx+" ["+ get_id_or_tag(  TOOL_panels[panel_idx] ) +"]");
    return panel_idx;
};
/*}}}*/
/*_ t_TOOL_panels_SLOT_SELECTED {{{*/
let t_TOOL_panels_SLOT_SELECTED = function()
{
/*{{{*/
let   caller = "t_TOOL_panels_SLOT_SELECTED";
let log_this = LOG_MAP.T5_SPREAD;

if( log_this) log(caller);
/*}}}*/
if( log_this) t_log_TOOL_panels(caller);

if( log_this) log("%c REORDERING ", lbb+lbH+lf7);
    let free_slots = [];
    for(let i=1; i < TOOL_panels.length; ++i) /* keep hotspot first */
    {
        /* COLLECT A FREE SLOT */
        let                   panel = TOOL_panels[i];
        if(                  !panel                                /*       slot empty */
           ||                 panel.classList.contains(CSS_PINNED) /*     pinned panel */
           || !tools_map_get( panel ).selected                     /* unselected panel */
          ) {
            free_slots.push(i); /* ...first slot where to move next selected panel */
        }
        /* ALLOCATE A SLOT TO SELECTED PANELS */
        else {
            let free_slot = free_slots.shift();
            if( free_slot ) {
if( log_this) log("...free_slot=["+free_slot+" "+SYMBOL_LEFT_ARROW+" "+i+"] .. ["+get_id_or_tag(TOOL_panels[free_slot])+" "+SYMBOL_LEFT_ARROW+" "+get_id_or_tag(TOOL_panels[i])+"]");
                let removed = TOOL_panels[free_slot];                            /* extract  unselected panel */
                /*.........*/ TOOL_panels[free_slot] = TOOL_panels[i];           /* insert     selected panel */
                /*..................................*/ TOOL_panels[i] = removed; /* relocate unselected panel */
            }
            /* OR LEAVE PANEL WHERE IT IS */
        }

    }

if( log_this) t_log_TOOL_panels(caller, lf5);
};
/*}}}*/
/*_ t_log_TOOL_panels {{{*/
let t_log_TOOL_panels = function(_caller, lfx=lf8)
{
log("%c"+_caller+":", lbb+lbH+lfx);
    let s = "";
    for(let i=0; i < TOOL_panels.length; ++i)
        s += LF+i+"."+get_id_or_tag(TOOL_panels[i]);
log(s);
};
/*}}}*/

/*_ t_log_panel_style_zIndex {{{*/
/*{{{*/
let t_log_panel_style_zIndex_logged_once;

/*}}}*/
let t_log_panel_style_zIndex = function(panel, _caller)
{
    if(!t_log_panel_style_zIndex_logged_once) /*{{{*/
    {
        log("%c ZINDEX_ON_GRID............%c"+ ZINDEX_ON_GRID          , lbH+lf8, lbb+lf4);
        log("%c ZINDEX_ABOVE_TOOLS........%c"+ ZINDEX_ABOVE_TOOLS      , lbH+lf8, lbb+lf4);
        log("%c ZINDEX_BELOW_TOOLS........%c"+ ZINDEX_BELOW_TOOLS      , lbH+lf8, lbb+lf3);
        log("%c ZINDEX_TOOL_PANEL_ZERO....%c"+ ZINDEX_TOOL_PANEL_ZERO  , lbH+lf8, lbb+lf3);
        log("%c ZINDEX_PINNED_PANEL_ZERO..%c"+ ZINDEX_PINNED_PANEL_ZERO, lbH+lf8, lbb+lf2);
        log("%c ZINDEX_TARGET_TOOL_ZERO...%c"+ ZINDEX_TARGET_TOOL_ZERO , lbH+lf8, lbb+lf1);

        t_log_panel_style_zIndex_logged_once = true;
    }
    /*}}}*/

    /*.......................................*/ let label  = " TOOL";      let lfx = lf3;

    if( panel == pivot_PANEL                        ) { label += " [pivot_PANEL]"; lfx = lf7; }
    if( panel.classList.contains( CSS_PIVOT_PANEL ) ) { label += " PIVOT_PANEL"  ; lfx = lf7; }
    if( panel.classList.contains( CSS_PINNED      ) ) { label += " PINNED"       ; lfx = lf2; }
    if( panel.classList.contains( "on_grid"       ) ) { label += " on_grid"      ; lfx = lf5; }

log("%c"+_caller+"%c "+label+"%c "+panel.id+".style.zIndex %c"+panel.style.zIndex
    ,lbH         ,lbL+lf8    ,lbR+lfx                     ,lbH+lfx               );
};
/*}}}*/
/* MOVE */
/*_ t_tool_set_top_xy {{{*/
/*{{{*/
const BOX_MARGIN = 24;
let HOTSPOT_C_OX = -50;
let topTool = { x:0, y:0 };
/*}}}*/
let t_tool_set_top_xy = function(_caller, x, y, p)
{
/* {{{*/
    let caller = "t_tool_set_top_xy";
/*
log(caller+"("+x+" , "+y+") .. CALLED BY "+ _caller);
*/
let log_this = LOG_MAP.T5_SPREAD;

/*{{{
if( log_this) t_log_event_status(caller+"("+x+" "+y+ ((p) ? (" p=["+p+"]") : "") +"):"+LF +".. CALLED BY "+ _caller, lf2);
}}}*/
    if(!hotspot) return;
/*}}}*/
    /* NOT WHEN TOOLS ON GRID {{{*/
    if( call_t_grid_IS_ON_GRID(caller) )
    {
if(log_this) log(caller+"("+x+" , "+y+"): IS ON GRID");

        return;
    }
    /*}}}*/
    /* [hiding_tools] .. (HOTSPOT IN GUTTER) {{{*/
    if((x != h_x) || (y != h_y))
    {
        t_tool_set_hotspot_xy(x, y, _caller);

    }
    let hiding_tools
        =  t_gutter_is_XY_IN(x,y)
        || prop_get( EDIT_OR_STAGE ) /* [dom_hide] */
    ;

    if( has_el_class(hotspot, CSS_FREEZED) )
    {
        if(hiding_tools) {
if(log_this) log("%c HOTSPOT ALREADY FREEZED", lf8);
            return;
        }
        else {
if(log_this) log("%c HOTSPOT UNFREEZED", lf2);
if(log_this) log(caller+"("+x+" , "+y+")");
        }
    }

    let panel_not_hidden = [];
    if(hiding_tools && prop_get( EDIT_OR_STAGE ) && has_el_class(headsup_ds, CSS_PINNED))
        panel_not_hidden.push( headsup_ds );

if(log_this && panel_not_hidden) {
    log("...........................hiding_tools=["+               hiding_tools            +"]");
    log(".......................panel_not_hidden=["+    get_n_lbl( panel_not_hidden      ) +"]");
    log("................prop_get(EDIT_OR_STAGE)=["+     prop_get( EDIT_OR_STAGE         ) +"]");
    log("...has_el_class(headsup_ds, CSS_PINNED)=["+ has_el_class( headsup_ds, CSS_PINNED) +"]");
}

    /*}}}*/
    /* TOOLS [css-position] {{{*/
    if(p && (p != hotspot.style.position))
    {
        hotspot              .style.position = p;

        headsup              .style.position = p;
        headsup_w            .style.position = p;
        headsup_ds           .style.position = p;
        headsup_bw           .style.position = p;
        headsup_bz           .style.position = p;

        pat_bag              .style.position = p;
        sel_bag              .style.position = p;
        dom_traversal        .style.position = p;

        test_panel           .style.position = p;
        dev_log_map          .style.position = p;
        dom_load_tags        .style.position = p;

        /* TRANSCRIPTS POSITION .. (when not pinned) */
        if(!transcript1.classList.contains(CSS_PINNED) ) transcript1.style.position = p;
        if(!transcript2.classList.contains(CSS_PINNED) ) transcript2.style.position = p;

        /* UNPIN FIXED {{{*/
        if(p != "fixed") {
            t_set_CSS_PINNED(hotspot      , true);

            t_set_CSS_PINNED(headsup      , true);
            t_set_CSS_PINNED(headsup_w    , true);
            t_set_CSS_PINNED(headsup_ds   , true);
            t_set_CSS_PINNED(headsup_bw   , true);
            t_set_CSS_PINNED(headsup_bz   , true);

            t_set_CSS_PINNED(pat_bag      , true);
            t_set_CSS_PINNED(sel_bag      , true);

            t_set_CSS_PINNED(dom_traversal, true);
            t_set_CSS_PINNED(test_panel   , true);
            t_set_CSS_PINNED(dev_log_map  , true);
            t_set_CSS_PINNED(dom_load_tags, true);
        }
        /*}}}*/

    }
    /*}}}*/
    /* SPREAD GROUPED TOOLS {{{*/
    if( !hiding_tools ) {
        t_tool_spread_xy(caller, x, y);

    }
    /*}}}*/
    /* LAYOUT OR HIDE TOOLS {{{*/
    let x_sign = (x < pivotXY.x) ? 1 : -1;
    let y_sign = (y < pivotXY.y) ? 1 : -1;
    if( t_gutter_is_XY_IN(x,y) ) { x_sign *= -1; y_sign *= -1; }

    if(!t_tools_loaded) t_load_TOOLS_MAP(caller);

    for(let i=1; i < TOOL_panels.length; ++i)
    {
        let panel  = TOOL_panels[i];
        if(!panel) continue; /* i.e. fly_div may not be there yet ... TODO */

        /* 1/3 HIDE TOOLS */
        if(hiding_tools && !panel_not_hidden.includes( panel ))
        {
            add_el_class(panel, CSS_HIDDEN);
        }
        /* 2/3 SHOW PINNED TOOLS */
        else if( panel.classList.contains(CSS_PINNED) )
        {
            let map = tools_map_get(panel);
            if( map && map.selected)
                del_el_class(panel, CSS_HIDDEN);

/*{{{
t_log_panel_style_zIndex(panel, caller+" .. CALLED BY "+_caller);
}}}*/

        }
        /* 3/3 LAYOUT UNPINNED TOOLS */
        else {

            let map;
            if( map = tools_map_get(panel))
            {
                if(map.selected) del_el_class(panel, CSS_HIDDEN);
                else             add_el_class(panel, CSS_HIDDEN);

                if(p) map.p = p;

                if(map.selected)
                {
                    let w = map.w;
                    let h = map.h;

                    t_tool_set_panel_xy_wh(panel, map.x, map.y, w, h, x_sign, y_sign);

                    panel.style.zIndex
                        = (panel == pivot_PANEL)
                        ?  ZINDEX_ABOVE_TOOLS     - 1 /* as the top-most tool */
                        :  ZINDEX_TOOL_PANEL_ZERO + i;
/*{{{
t_log_panel_style_zIndex(panel, caller+" .. CALLED BY "+_caller+" [map.selected]");
}}}*/
                }
            }
        }
    }
    /*}}}*/
    /* pause or resume animation {{{*/
    set_el_class_on_off(hotspot, CSS_FREEZED, hiding_tools);
/*
    let el;
    if(hiding_tools) {
        hotring.style.animationPlayState = "paused";
    }
    else {
        hotring.style.animationPlayState = "running";
    }
*/
    /*}}}*/
    /* [hiding_tools] {{{*/
    t_trapped_dir_show( hiding_tools );

    /*}}}*/
};
/*}}}*/
/*_ t_tool_set_hotspot_xy {{{*/
/*{{{*/
let h_x;
let h_y;

/*}}}*/
let t_tool_set_hotspot_xy = function(x,y,_caller)
{
    /* CONFINE TO VIEWPORT */

    let    vp = t_get_viewport();
    if(x < vp.left  ) x = vp.left;
    if(x > vp.right ) x = vp.right;
    if(y < vp.top   ) y = vp.top;
    if(y > vp.bottom) y = vp.bottom;

    h_x = x; hotspot.style.left = h_x +"px";
    h_y = y; hotspot.style.top  = h_y +"px";

    let has_changed = false;
    if(topTool.x != h_x) { topTool.x = h_x; has_changed = true; }
    if(topTool.y != h_y) { topTool.y = h_y; has_changed = true; }
    if(has_changed) {
        /* DO NOT SAVE TRANSIENT HOTSPOT POSITION */
        if(    !t_store_update_is_pending()
            && !t_gutter_is_XY_IN(h_x, h_y)
            && !prop_get( EDIT_OR_STAGE   )
          )
            t_store_update_post("t_tool_set_hotspot_xy");
    }

if(LOG_MAP.T5_SPREAD) {
    if(has_changed)
        log("t_tool_set_hotspot_xy("+x+" "+y+") .. CALLED BY "+ _caller+":"+LF
           +"...topTool FROM XY=["+ topTool.x  +" "+ topTool.y +"]"+LF
           +".............TO XY=["+       h_x  +" "+       h_y +"]");
    else
        log( "t_tool_set_hotspot_xy("+x+" "+y+") .. CALLED BY "+ _caller+": UNCHANGED");
}

};
/*}}}*/
/*_ t_get_viewport {{{*/
let t_get_viewport = function()
{
    let w_H_or_p_H
        = (hotspot.style.position == "fixed")
        ?  w_H
        :  p_H;

    let margin     = hotring.clientWidth / 2;

    let top        =             -margin;
    let left       =             -margin;
    let right      = w_W        - margin;
    let bottom     = w_H_or_p_H - margin;

/*{{{
logXXX("t_get_viewport: return XY=["+top+" "+left+"] RB=["+right+" "+bottom+"]");
}}}*/
    return { top    : top
        ,    left   : left
        ,    right  : right
        ,    bottom : bottom
    };
};
    /*}}}*/
/*_ t_tool_set_panel_xy {{{*/
let t_tool_set_panel_xy = function(panel, x, y)
{
    t_tool_set_panel_xy_wh(panel, x, y, panel.offsetWidth, panel.offsetHeight);
};
/*}}}*/
/*_ t_tool_set_panel_xy_wh {{{*/
/*{{{*/
const TOOL_ROTATION_STEP        = 10;

/*}}}*/
let t_tool_set_panel_xy_wh = function(panel, x, y, w, h, x_sign=1, y_sign=1)
{
/*{{{*/
let caller = "t_tool_set_panel_xy_wh("+get_n_lbl(panel)+", xy=["+x+" , "+y+"], w=["+w+" "+h+"])";
let log_this = LOG_MAP.T5_SPREAD;

/*}}}*/
    /* [top_left] or [bottom_right] .. f(x_sign, y_sign) {{{*/
    if(x_sign < 0) x -= w;
    if(y_sign < 0) y -= h;
/*
if(log_this) log(caller+": ...from=["+panel.style.top+" "+panel.style.left+"]");
if(log_this) log(caller+": .....to=["+panel.style.top+" "+panel.style.left+"]");
*/
    panel.style.left      = x+"px"  ;
    panel.style.top       = y+"px"  ;

    if(panel != hotspot) {
        let t_x = (x_sign > 0) ? 0 : 100;
        let t_y = (y_sign > 0) ? 0 : 100;
        panel.style.transformOrigin = t_x+"% "+t_y+"% 0";
    }

    /*}}}*/
    /* rotation .. f(this_el_rank) {{{*/
    let touched_idx  = spreaded_tools.indexOf( onWork_PANEL );
    let this_el_idx  = spreaded_tools.indexOf( panel        );
    let this_el_rank = this_el_idx - touched_idx;

/*
    let     rotation = parseInt(this_el_rank * TOOL_ROTATION_STEP);
    panel.style.transform = "rotate("+ rotation +"deg)";
*/

if(log_this) log(caller+": ...this_el_rank=["+this_el_rank+"] / "+spreaded_tools.length+" onWork_PANEL=["+ get_n_lbl(onWork_PANEL) +"]");
    /*}}}*/
};
/*}}}*/

/* SPREAD */
/*_ t_tool_spread_xy {{{*/
let t_tool_spread_xy = function(_caller, x, y)
{
/*{{{*/
let log_this = LOG_MAP.T5_SPREAD;

/*{{{
if( log_this) t_log_event_status("%c t_tool_spread_xy("+x+" "+y+") .. CALLED BY "+ _caller, lf2);
}}}*/

    if(!hotspot) return;
/*}}}*/
    /* [x_sign y_sign] {{{*/
    let x_sign = (x < pivotXY.x) ? 1 : -1;
    let y_sign = (y < pivotXY.y) ? 1 : -1;
    if( t_gutter_is_XY_IN(x,y) ) { x_sign *= -1; y_sign *= -1; }

    x += x_sign * h_W / 2;
    y += y_sign * h_H / 2;

    /*}}}*/
    /* [onWork_PANEL_num dx dy] {{{*/
    if(!t_tools_loaded) t_load_TOOLS_MAP("t_tool_spread_xy");
if(!pivot_PANEL) t_set_pivot_PANEL( onWork_PANEL );

    let xy_ratio = t_set_spread_ratio_at_xy_in_panel(x, y, pivot_PANEL);
/*{{{
logBIG("xy_ratio=["+xy_ratio.x+" "+xy_ratio.y+"]", lf4)
}}}*/

    /*}}}*/
    /*  fully_spread .. (while moving pivot_PANEL) {{{*/
    if(!fully_spread_since_onDown && (onWork_PANEL == pivot_PANEL))
    {
        let fully_spread = ((spread_ratio.x >= 0.99) || (spread_ratio.y >= 0.99));
if( log_this) log("%c"+(fully_spread ? "@@@ fully_spread" : "not fully_spread"), lbH+(fully_spread ? lf4 : lf8));

        if( fully_spread ) {
if( log_this) t_log_event_status("t_tool_spread_xy:"+LF +".. CALLED BY "+ _caller, lf2);

            fully_spread_since_onDown = true;
            t_cycle_pivot_panel();
        }
    }
    /*}}}*/
    /* SPREAD TOOLS AWAY FROM HOTSPOT {{{*/
    let xy = { x:x , y:y };

    for(let i=1; i < TOOL_panels.length; ++i)
    {
        /* PINNED */
        let panel = TOOL_panels[i];
        if(!panel) continue; /* i.e. fly_div may not be there yet ... TODO */
        if( panel.classList.contains(CSS_PINNED)) continue;

        /* SELECTED */
        let map = tools_map_get(panel);
        if(!map         ) continue;
        if(!map.selected) continue;

        let w = map.w;
        let h = map.h;

        let dx = xy_ratio.x * w;
        let dy = xy_ratio.y * h;

/*
if(panel == pat_bag) log("t_tool_spread_xy: pat_bag map.h=["+map.h+"] .. offsetHeight=["+panel.offsetHeight+"]")
*/
        xy = t_tool_spread_panel_xy(panel, xy.x, xy.y, dx, dy, x_sign, y_sign);
/*{{{
logXXX(panel.id+" WY=["+w+" "+h+"] .. xy=["+xy.x+" "+xy.y+"]");
}}}*/
    }
    /*}}}*/
};
/*}}}*/
/*_ t_set_spread_ratio_at_xy_in_panel {{{*/
/*{{{*/
let spread_ratio = { x:0 , y:0 };

/*}}}*/
let t_set_spread_ratio_at_xy_in_panel = function(x, y, moving_panel)
{
/* i.e. spread_ratio := (pivotXY / SUM-OF-ALL-UNPINNED-SELECTED-PANELS-WH) */
let caller = "t_set_spread_ratio_at_xy_in_panel";
/*{{{
logXXX(caller+"("+x+","+y+") has_moved=["+has_moved+"] spread_ratio.x=["+spread_ratio.x+"]");
}}}*/
    /* unchanged {{{*/
    if(!has_moved && spread_ratio.x) {
/*{{{
logXXX("%c "+caller+": !has_moved .. returning spread_ratio", lbb+lbF+lf2);
}}}*/
        return spread_ratio;
    }
    /*}}}*/
    /* [spread_ratio] .. [0 .. (fully_spread=1)] {{{*/
    let panels_wh = t_spread_get_leading_panels_wh_up_to_panel( moving_panel );
    if( panels_wh ) {
/*{{{
log(caller+"%c"+moving_panel.id+"%c FROM "+parseInt(100 * spread_ratio.x)+" x "+ parseInt(100 * spread_ratio.y)+"  %c"+panels_wh.w+" "+panels_wh.h
    ,       lbH+lf8             ,lbH+lf8                                                                          ,lbF+lb7                        );
}}}*/

        let x_ratio = Math.abs(x - pivotXY.x) / panels_wh.w;
        let y_ratio = Math.abs(y - pivotXY.y) / panels_wh.h;

        x_ratio     = Math.min(x_ratio , 1);
        y_ratio     = Math.min(y_ratio , 1);
        x_ratio     = Math.max(x_ratio , 0);
        y_ratio     = Math.max(y_ratio , 0);

        spread_ratio.x = x_ratio;
        spread_ratio.y = y_ratio;

        if(!t_store_update_is_pending()) t_store_update_post(caller);
    }
    /*}}}*/
/*{{{
log(caller+"%c"+moving_panel.id+"%c TO..."+parseInt(100 * spread_ratio.x) +" x "+ parseInt(100 * spread_ratio.y), lbH+lf3, lbH+lf4);
}}}*/
/*{{{
t_spread_log(moving_panel);
}}}*/
    return spread_ratio;
};
/*}}}*/
/*_ t_set_spread_ratio_up_to_panel {{{*/
let t_set_spread_ratio_up_to_panel = function(panel)
{
    /* panel corner .. f(pivot quadrant) */
    let      x = panel.offsetLeft;
    let      y = panel.offsetTop ;
    let x_sign = (x > topTool.x) ? 1 : -1;
    let y_sign = (y > topTool.y) ? 1 : -1;
    if( x_sign < 0) x += onWork_PANEL.offsetWidth;
    if( y_sign < 0) y += onWork_PANEL.offsetHeight;

    x += x_sign * h_W / 2;
    y += y_sign * h_H / 2;

    /*  sum of preceeding fully spread panels */
    let fully_spread_WH = t_spread_get_leading_panels_wh_up_to_panel( panel );

    /* WH ratio to reach panel corner */
    spread_ratio.x = Math.abs(x - topTool.x) / fully_spread_WH.w;
    spread_ratio.y = Math.abs(y - topTool.y) / fully_spread_WH.h;
};
/*}}}*/
/*_ t_spread_log {{{*/
let t_spread_log = function(moving_panel)
{
    t_set_tool_id_value("tools_filter"
                        , moving_panel.id+" "
                        + parseInt(100 * spread_ratio.x)+"*"+parseInt(100 * spread_ratio.y)
                       );

    let msg
        = "HS "+ topTool.x               +" "+ topTool.y              +LF
        + "Pv "+ pivotXY.x               +" "+ pivotXY.y              +LF
        + "Pn "+ moving_panel.offsetLeft +" "+ moving_panel.offsetTop
    ;

logXXX("t_spread_log"+LF+msg);
/*{{{
}}}*/

    t_words_regex_log(msg);
};
        /*}}}*/
/*_ t_spread_get_leading_panels_wh_up_to_panel {{{*/
let              panels_wh = {};
let t_spread_get_leading_panels_wh_up_to_panel = function( moving_panel )
{
    if(!t_tools_loaded) t_load_TOOLS_MAP(caller);

/* {Width Height} .. f(selected tools collated spread area) */
    panels_wh.w = 0;
    panels_wh.h = 0;
    let map_selected_count = 0;
    for(let i=1; i < TOOL_panels.length; ++i)
    {
        /* PINNED */
        let panel = TOOL_panels[i];
        if(!panel) continue; /* i.e. fly_div .. TODO */
        if( panel.classList.contains( CSS_PINNED )) continue;

        /* SELECTED */
        let map = tools_map_get(panel);
        if(!map.selected) continue;

        map_selected_count += 1;

        panels_wh.w += map.w;
        panels_wh.h += map.h;

        if(panel == moving_panel) break;
    }

/*{{{
log("...["+moving_panel.id+"] map_selected_count=["+map_selected_count+"] .. panels_wh=["+panels_wh.w+" "+panels_wh.h+"]");
}}}*/
    return (map_selected_count > 0) ? panels_wh : null;
};
/*}}}*/

/*_ t_tool_spread_panel_xy {{{*/
let t_tool_spread_panel_xy = function(panel, x, y, dx, dy, x_sign, y_sign)
{
    /* panel spread location {{{*/
    let map = tools_map_get(panel);
    map.x = x;
    map.y = y;

/*{{{
logXXX("%c"+"t_tool_spread_panel_xy"+"%c "+panel.id+" %c "+map.x+" "+map.y, lbH, lbC+lf3, lbH+lf8);
}}}*/
    /*}}}*/
    /* CAP PIVOT POINT at 100% {{{*/
    let    w  = map.w;
    let    h  = map.h;
    if(panel == pivot_PANEL) {
        if((spread_ratio.x == 1) || (spread_ratio.y == 1)) {
            let piv_x = (spread_ratio.x == 1) ? (x + x_sign * w) : pivotXY.x;
            let piv_y = (spread_ratio.y == 1) ? (y + y_sign * h) : pivotXY.y;
            t_set_pivotXY(piv_x, piv_y);
        }
/*
*/
    }
    /*}}}*/
    /* return next panel offset .. f(selected) {{{*/
    if( map.selected )
    {
        x += x_sign * Math.min(w, Math.abs(dx));
        y += y_sign * Math.min(h, Math.abs(dy));
    }
    return { x:x , y:y };
    /*}}}*/
};
/*}}}*/

/* STATE */
/*_ are_p1_p2_in_same_quadrant_and_p2_in_corner {{{*/
let are_p1_p2_in_same_quadrant_and_p2_in_corner = function(p1, p2)
{
let log_this = LOG_MAP.T5_SPREAD;
    /* center {{{*/
    let c_x = w_W / 2;
    let c_y = w_H / 2;
if(log_this) {
    log("____________________");
    log("..............p1 ["+ p1.x +" , "+ p1.y +"]");
    log("..............p2 ["+ p2.x +" , "+ p2.y +"]");
    log("..........center ["+  c_x +" , "+  c_y +"]");
}
    /*}}}*/
    /* not same_quadrant {{{*/
    let same_quadrant
        =  ((p1.x >= c_x) && (p2.x >= c_x) || (p1.x <  c_x) && (p2.x <  c_x))
        && ((p1.y >= c_y) && (p2.y >= c_y) || (p1.y <  c_y) && (p2.y <  c_y))
    ;

if(log_this) log("...same_quadrant=["+ same_quadrant +"]");
    if(!same_quadrant) return false;
    /*}}}*/
    /* not p2_in_corner {{{*/
    let p2_in_corner
        =  Math.abs(p2.x - c_x) >= Math.abs(p1.x - c_x)
        && Math.abs(p2.y - c_y) >= Math.abs(p1.y - c_y)
    ;

if(log_this) log("...p2_in_corner=["+ p2_in_corner +"]");
    if(!same_quadrant) return false;
    /*}}}*/
    return true;
};
/*}}}*/
/*_ is_pannel_in_hotspot_quadrant {{{*/
let is_pannel_in_hotspot_quadrant = function(pannel)
{
let log_this = LOG_MAP.T5_SPREAD;

    let px = pannel .offsetLeft + pannel.offsetWidth  / 2;
    let py = pannel .offsetTop  + pannel.offsetHeight / 2;
    let hx = hotspot.offsetLeft      + h_W            / 2;
    let hy = hotspot.offsetTop       + h_H            / 2;

    let same_quadrant
        =  ((px >= pivotXY.x) && (hx >= pivotXY.x) || (px <  pivotXY.x) && (hx <  pivotXY.x))
        && ((py >= pivotXY.y) && (hy >= pivotXY.y) || (py <  pivotXY.y) && (hy <  pivotXY.y))
    ;

if(log_this) {
    log("____________________");
    log("...pivotXY=["+ pivotXY.x +" , "+ pivotXY.y +"]");
    log(".....px py=["+        px +" , "+        py +"]");
    log(".....hx hy=["+        hx +" , "+        hy +"]");
    log("...same_quadrant=["+ same_quadrant         +"]");
}

    return same_quadrant;
};
/*}}}*/
/*_ get_pannel_to_hotspot_factor_xy {{{*/
/*
let get_pannel_to_hotspot_factor_xy = function(pannel)
{
let log_this = LOG_MAP.T5_SPREAD;

    let px = pannel .offsetLeft + pannel.offsetWidth  / 2 - pivotXY.x;
    let py = pannel .offsetTop  + pannel.offsetHeight / 2 - pivotXY.y;
    let hx = hotspot.offsetLeft +      h_W            / 2 - pivotXY.x;
    let hy = hotspot.offsetTop  +      h_H            / 2 - pivotXY.y;

    let fx = hx / px;
    let fy = hy / py;

if(log_this) {
    log("____________________");
    log("...pivotXY=["+ pivotXY.x +" , "+ pivotXY.y +"]");
    log(".....px py=["+ px     +" , "+           py +"]");
    log(".....hx hy=["+ hx     +" , "+           hy +"]");
    log(".....fx fy=["+ fx     +" , "+           fy +"]");
}

    return { x: fx, y: fy };
};
*/
/*}}}*/

/* CACHE */
/* {{{*/
const CACHE_EMPTY = "CACHE_EMPTY";
let w_W = 1280, w_H = 1024;
let h_W =   32, p_H = 1024;
let h_H =   32;

let t_cache_layout_callers = CACHE_EMPTY;
/*}}}*/
/*_ t_cache_init_by {{{*/
let t_cache_init_by = function(_caller)
{
    let log_this = LOG_MAP.EV5_TOOL_CB;

    t_cache_layout_callers
        = (t_cache_layout_callers)
        ?  t_cache_layout_callers+" + "+_caller
        :                        _caller
    ;

if(log_this) log("%c CACHE INIT BY "+ _caller, lbF+lb7);

};
/*}}}*/
/*_ t_cache_empty {{{*/
let t_cache_empty = function(_caller)
{
    let log_this = LOG_MAP.EV5_TOOL_CB;

if(log_this) log("t_cache_empty: t_cache_layout_callers = %c "+t_cache_layout_callers+" %c", lbF+lb7,lbA);

    return (t_cache_layout_callers == CACHE_EMPTY);
};
/*}}}*/
/*_ t_cache_changed {{{*/
let t_cache_changed = function(_caller)
{
    let log_this = LOG_MAP.EV5_TOOL_CB;

if(log_this) log("t_cache_changed: %c CACHE INIT BY ["+t_cache_layout_callers+"] %c .. CALLED BY "+ _caller, lbF+lb7,lbA);

    return (t_cache_layout_callers != "");
};
/*}}}*/
/*_ t_cache_layout .. [w_WH .. p_WH .. h_H .. tools_map.WH] {{{*/
let t_cache_layout = function(_caller)
{
/*_ log_this {{{*/
let log_this = LOG_MAP.EV5_TOOL_CB;

/*{{{
    if(!t_cache_layout_callers) {
if(log_this) log("%c t_cache_layout: ** NO CHANGE SET"   +" .. CALLED BY "+ _caller, lbF+lb2);
        return;
    }
}}}*/
if(log_this) log("%c t_cache_layout .. CALLED BY "+ _caller,lbF+lb5);
/*}}}*/
    /* [window] [page] {{{*/
    t_cache_w_H_w_W_p_H();

    /*}}}*/
    /* [hotring] {{{*/
    if(hotring) {
        h_W = hotring.offsetWidth ;
        h_H = hotring.offsetHeight;

if(log_this) log("...HOTSPOT %c "+ h_W+" x "+h_H +" ", lb7);
    }
    /*}}}*/
    /* TOOLS GEOMETRY {{{*/
    t_update_TOOLS_MAP_GEOMETRY("t_cache_layout .. CALLED BY "+ _caller);

/*
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_2_ACTION,"<em class='cc0'>LAYOUT</em> Window <em class='cc8'>"+w_H+"x"+w_W+"</em>  Page <em class='cc8'>"+p_H+"</em>");
*/
    /*}}}*/
    t_cache_layout_callers = "";
};
/*}}}*/
/*_ t_cache_w_H_w_W_p_H {{{*/
let t_cache_w_H_w_W_p_H = function()
{
    w_H = window.innerHeight;
    w_W = window.innerWidth;

    p_H = get_page_height();

    if(window.scrollbars.visible)
    {
        w_W -= 17;
        w_H -= 17;
    }

/*{{{
logXXX("t_cache_w_H_w_W_p_H");
logXXX("...window:  innerWidth=["+window.innerWidth+"]  outerWidth=["+window.outerWidth+"]");
logXXX("...window: innerHeight=["+window.innerHeight+"] outerHeight=["+window.outerHeight+"]");
logXXX("...window.scrollbars.visible=["+window.scrollbars.visible+"]");
logXXX("...WINDOW %c "+ w_W+" x "+w_H +" %c PAGE %c "+p_H +" ", lb3,lbA, lb4);
console.dir(window)
}}}*/
};
/*}}}*/

/* STYLE */
/*_ t_sync_styles {{{*/
/*{{{*/
const T_SYNC_STYLES_DELAY = 50;
let   t_sync_styles_timer;
let   t_sync_styles_caller_csv;

/*}}}*/
let t_sync_styles = function(_caller)
{
    t_sync_styles_caller_csv = csv_add(t_sync_styles_caller_csv, _caller);

    if(t_sync_styles_timer) clearTimeout(t_sync_styles_timer);
    t_sync_styles_timer   =   setTimeout(t_sync_styles_handler, T_SYNC_STYLES_DELAY);
};
/*}}}*/
/*_ t_sync_styles_handler {{{*/
let t_sync_styles_handler = function()
{
/*{{{*/
let   caller = "t_sync_styles_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    t_sync_styles_timer      = null;
    t_sync_styles_caller_csv = "";
    /* CHECKBOXES {{{*/
    prop_get_MAP().forEach( function(prop,index,array)
                            {
                                set_id_class_on_off(prop.id, CSS_CHECKED,  prop.value);
                            });

    /*}}}*/
    /* UI [dark theme] {{{*/
    let state, id, el;
    state = prop_get( THEME_DARK );

    t_TOOL_SET_set_class_state      (                 CSS_DARK    , state);
    t_set_tool_class_theme_state    (CSS_TARGET_TOOL, CSS_DARK    , state);
    t_set_doc_tool_class_theme_state(CSS_TRANSCRIPT , CSS_DARK    , state);
    /*}}}*/
    /* UI [scrolled or fixed] {{{*/
    state = prop_get( TOOLS_SCROLL );

    t_TOOL_SET_set_class_state      (                 TOOLS_SCROLL, state);
    t_set_tool_class_theme_state    (CSS_TARGET_TOOL, TOOLS_SCROLL, state);
    t_set_doc_tool_class_theme_state(CSS_TRANSCRIPT , TOOLS_SCROLL, state);
    /*}}}*/
    /* UI [trapped or pivoting] {{{*/
    state = prop_get( TOOLS_TRAP );

    if(el = hotspot_c )                           set_el_class_on_off(el, CSS_TRAPPED, state);
    if(el = pivspot_c )                           set_el_class_on_off(el, CSS_TRAPPED, state);
    id = TOOLS_TRAP    ; if(el = prop_get_EL(id)) set_id_class_on_off(id, CSS_TRAPPED, state);

/*{{{
    id = TOOLS_TRAP    ; if(el = prop_get_EL(id))   set_id_class_on_off(id, CSS_CHECKED,  prop_get( TOOLS_TRAP    ));
}}}*/

    /*}}}*/
    /* SCROLL_SMOOTH & OVERFLOW {{{*/
    el = document.getElementsByTagName("HTML")[0] ; set_el_class_on_off(el,  OVERFLOW_VISI, prop_get( OVERFLOW_VISI ));
    el = document.getElementsByTagName("HTML")[0] ; set_el_class_on_off(el,  SCROLL_SMOOTH, prop_get( SCROLL_SMOOTH ));
    el = seeker_PU                                ; set_el_class_on_off(el,  SCROLL_SMOOTH, prop_get( SCROLL_SMOOTH ));

    /*}}}*/
    /* TOOLS CONTENT {{{*/
    if(el = prop_get_EL( THEME_DARK   )) el.innerHTML = (prop_get( THEME_DARK   )) ? SYMBOL_THEME_DARK_IS_ON : SYMBOL_THEME_DARK_IS_OFF;
    if(el = prop_get_EL( TOOLS_SCROLL )) el.innerHTML = (prop_get( TOOLS_SCROLL )) ? SYMBOL_UP_DOWN_ARROW    : SYMBOL_ANCHOR           ;
    if(el = prop_get_EL( WORDING      )) el.innerHTML = (prop_get( WORDING      )) ? SYMBOL_WORDING_IS_ON    : SYMBOL_WORDING_IS_OFF   ;
    if(el = prop_get_EL( TOOLS_EXTRAS )) el.innerHTML = (prop_get( TOOLS_EXTRAS )) ? SYMBOL_EXPAND_IS_ON     : SYMBOL_EXPAND_IS_OFF    ;

    id    = ANCHOR_FREEZE;
    if(el = prop_get_EL(id)) {
        state = (prop_get( WORDING ) || prop_get( ANCHOR_FREEZE ));
        set_id_class_on_off(id,  CSS_CHECKED,  state);
        el.innerHTML
            = state
            ? SYMBOL_NO_ENTRY
            : SYMBOL_SAILBOAT
        ;
    }
    /*}}}*/
    /* WORDING {{{*/
    let cycling    = prop_get   (WORDS_OPCYCLE);
    let cycling_el = prop_get_EL(WORDS_OPCYCLE);
    if( cycling_el )
    {
        if( cycling ) {
            cycling_el.style.backgroundColor
                = prop_get( WORDS_EXACT   ) ? window.getComputedStyle( prop_get_EL( WORDS_EXACT     ) ).backgroundColor
                : prop_get( WORDS_SEGMENT ) ? window.getComputedStyle( prop_get_EL( WORDS_SEGMENT   ) ).backgroundColor
                :                             window.getComputedStyle( prop_get_EL( WORDS_HEAD_TAIL ) ).backgroundColor
            ;
        }
        else {
            cycling_el.style.backgroundColor = "white";
        }

        if     ( prop_get( WORDS_EXACT   ) ) sync_words_opcycle_button( WORDS_EXACT     );
        else if( prop_get( WORDS_SEGMENT ) ) sync_words_opcycle_button( WORDS_SEGMENT   );
        else                                 sync_words_opcycle_button( WORDS_HEAD_TAIL );
    }
    /*}}}*/
};
/*}}}*/
/*_ t_set_doc_tool_class_theme_state {{{*/
let t_set_doc_tool_class_theme_state = function(className, theme, state)
{
/*{{{
logBIG("t_set_doc_tool_class_theme_state("+className+", "+theme+", "+state+")")
}}}*/

    let                     node_list = document.querySelectorAll("."+className);
    for(let i=0;        i < node_list.length; ++i)
    {
/*{{{
logXXX("...set_el_class_on_off("+get_id_or_tag(node_list[i])+", "+theme+", "+state+")");
}}}*/
        set_el_class_on_off(node_list[i], theme, state);
    }
};
/*}}}*/
/*_ t_set_tool_class_theme_state {{{*/
let t_set_tool_class_theme_state = function(className, theme, state)
{
/*{{{
logBIG("t_set_tool_class_theme_state("+className+", "+theme+", "+state+")")
}}}*/

    let                     node_list = shadow_root.querySelectorAll("."+className);
    for(let i=0;        i < node_list.length; ++i)
    {
/*{{{
logXXX("...set_el_class_on_off("+get_id_or_tag(node_list[i])+", "+theme+", "+state+")");
}}}*/
        set_el_class_on_off(node_list[i], theme, state);
    }
};
/*}}}*/

/*}}}*/
/* GRID {{{*/
/*_ t_move_TOOLS_ON_GRID {{{*/
let t_move_TOOLS_ON_GRID = function(_caller)
{
/*{{{
logXXX("t_move_TOOLS_ON_GRID .. CALLED BY "+_caller+"");
}}}*/
    call_t_grid_ON_OFF_CB(true);
};
/*}}}*/
/*_ t_move_TOOLS_OFF_GRID {{{*/
let t_move_TOOLS_OFF_GRID = function(_caller)
{
/*{{{
logXXX("t_move_TOOLS_OFF_GRID .. CALLED BY "+_caller+"");
}}}*/
    call_t_grid_ON_OFF_CB(false);

    dimm_stop(_caller);
};
/*}}}*/
/*_ t_move_TOOLS_TOGGLE_GRID {{{*/
let t_move_TOOLS_TOGGLE_GRID = function(_caller)
{
/*{{{
logXXX("t_move_TOOLS_TOGGLE_GRID .. CALLED BY "+_caller+"");
}}}*/
    call_t_grid_ON_OFF_CB(false);

    dimm_stop(_caller);
};
/*}}}*/
/*_ call_t_grid_ON_OFF_CB javascript/dom_grid.js {{{ */
let call_t_grid_ON_OFF_CB = function(new_state="toggle")
{
    let caller = "call_t_grid_ON_OFF_CB("+new_state+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

    if(new_state == "toggle") new_state = !call_t_grid_IS_ON_GRID(caller);
if( log_this) log("%c "+caller+": new_state=["+new_state+"]",lb2+lbF);

    if(!new_state                                           ) t_raise_pivot_PANEL_delayed(T_RAISE_PIVOT_PANEL_DELAY_SHORT, caller);
    else if(!t_raise_pivot_PANEL_called_since_onDown(caller)) t_flash_unpinned_panels    (caller);

    if(typeof t_grid_ON_OFF_CB == "undefined") log_dom_grid_js_not_loaded(caller);
    else      t_grid_ON_OFF_CB(new_state);

    t_fly_set("");
};
/* }}} */
/*_ call_t_grid_IS_SIZED javascript/dom_grid.js {{{ */
let call_t_grid_IS_SIZED = function(_caller)
{
    if(typeof t_grid_IS_SIZED == "undefined") {
        return false;
    }
    else {
        return t_grid_IS_SIZED("call_t_grid_IS_SIZED .. CALLED BY "+ _caller);
    }
};
/* }}} */
/*_ call_t_grid_IS_ON_GRID javascript/dom_grid.js {{{ */
let call_t_grid_IS_ON_GRID = function(_caller)
{
    if(typeof t_grid_IS_ON_GRID == "undefined")
        return false;
    else
        return t_grid_IS_ON_GRID("call_t_grid_IS_ON_GRID .. CALLED BY "+ _caller);
};
/* }}} */

/*_ call_t_grid_add_observer {{{*/
let call_t_grid_add_observer = function()
{
    if(typeof t_grid_add_observer_callback == "undefined") {
        log_dom_grid_js_not_loaded("call_t_grid_add_observer");
        return;
    }
    else {
        t_grid_add_observer_callback( t_IS_ON_GRID_observerCB );
    }
};
/*}}}*/
/*_ t_IS_ON_GRID_observerCB {{{*/
let t_IS_ON_GRID_observerCB = function(on_grid)
{
/*{{{*/
    let caller = "t_IS_ON_GRID_observerCB("+on_grid+")";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);
/*}}}*/
    /* TOOLS STAGING PHASE {{{*/
    if( on_grid )
    {
        t_target_tool_feed_stop(caller);
        dimm_start_grid(caller);

        if(!t_raise_pivot_PANEL_called_since_onDown(caller))
            t_flash_unpinned_panels(caller);
    }
    /*}}}*/
    /* TOOLS SHOWING PHASE {{{*/
    else {
        dimm_stop(caller);

        t_grid_TOOLS_MAP_changed();

        t_TOOL_SET_eval_wide_or_tall_panel();
    }
    /*}}}*/
};
/*}}}*/
/*_ t_grid_TOOLS_MAP_changed {{{*/
let t_grid_TOOLS_MAP_changed = function()
{
/*{{{*/
let caller = "t_grid_TOOLS_MAP_changed";
let log_this = LOG_MAP.T2_GRID;

if( log_this) log(caller);
/*}}}*/
    t_TOOL_panels_SLOT_SELECTED();

    t_update_TOOLS_MAP_GEOMETRY(caller, 0);

    t_tool_set_top_xy(caller, topTool.x, topTool.y);
};
/*}}}*/
/*}}}*/
/* DIMM {{{*/
/*{{{*/

let dimm_mask       = null;
let dimm_mask_timer = null;

/*}}}*/
/*_ dimm_start {{{*/
const DIMM_CLASS_ARRAY = ["dimm_grid", "dimm_pat_bag", "dimm_target_tool", "dimm_slot_containers"];
const DIMM_STYLE_ARRAY = ["dimm_light", "dimm_dark"];

let dimm_start_pat_bag         = function(_caller) { dimm_start(_caller, ZINDEX_PINNED_PANEL_ZERO, "dimm_pat_bag"        ,  "dimm_light", "fixed" ); };
let dimm_start_grid            = function(_caller) { dimm_start(_caller, ZINDEX_TOOL_PANEL_ZERO  , "dimm_grid"           ,  "dimm_light", "fixed" ); };
let dimm_start_target_tool     = function(_caller) { dimm_start(_caller, ZINDEX_ABOVE_TOOLS      , "dimm_target_tool"    ,  "dimm_dark" , "fixed" ); };
let dimm_start_slot_containers = function(_caller) { dimm_start(_caller, ZINDEX_ABOVE_TOOLS      , "dimm_slot_containers",            "", ""      ); };
let dimm_start                 = function(                      _caller, zIndex                  , dimm_class=""         , dimm_style="", position)
{
    /* dimm_add dimm_class dimm_style {{{*/
    if(!dimm_mask) dimm_add();
    if(dimm_class && !has_el_class(dimm_mask, dimm_class)) set_el_class_removing(dimm_mask, dimm_class, DIMM_CLASS_ARRAY);
    if(dimm_style && !has_el_class(dimm_mask, dimm_style)) set_el_class_removing(dimm_mask, dimm_style, DIMM_STYLE_ARRAY);

    /*}}}*/
    /* zIndex {{{*/
let log_this = LOG_MAP.T2_GRID;
if( log_this) log("dimm_start(zIndex=["+zIndex+"], dimm_class=["+dimm_class+"], dimm_style=["+dimm_style+"]) .. CALLED BY "+ _caller);

    if(zIndex) dimm_mask.style.zIndex = zIndex;

    /*}}}*/
    /* position .. (fixed or absolute) {{{*/
    if( position == "fixed")
    {
        dimm_mask.style.position = "fixed";
        dimm_mask.style.top      = "0";
        dimm_mask.style.left     = "0";

    }
    else if(position == "absolute") {
        dimm_mask.style.position = "absolute";
        dimm_mask.style.left     = window.scrollX +"px";
        dimm_mask.style.top      = window.scrollY +"px";
    }
    /*}}}*/
    /* display block {{{*/
    dimm_mask.style.display = "block";

    add_el_class(document.body, CSS_DIMMED);
    /*}}}*/
    /* width height .. content width {{{*/
    dimm_mask.style.width      = window.innerWidth +"px";

    if( !div_slot_containers_displayed() ) /* TODO .. EXPLAIN WHY */
        dimm_mask.style.height = window.innerHeight+"px";

    /*}}}*/
    /* firstElementChild fullscreen {{{*/
    if(dimm_mask.firstElementChild)
        dimm_mask.firstElementChild.style.width = w_W+"px";

    /*}}}*/
/*{{{
logXXX("dimm_mask.className=["+dimm_mask.className+"]");
}}}*/
};
/*}}}*/
/*_ dimm_stop {{{*/
let dimm_stop  = function(_caller="setTimeout")
{
/*{{{*/
let log_this = LOG_MAP.T2_GRID;

if( log_this) log("dimm_stop .. CALLED BY "+ _caller);
/*}}}*/

    /* clearTimeout {{{*/
    if(dimm_mask_timer) {
        clearTimeout( dimm_mask_timer );
        /*.........*/ dimm_mask_timer = null;
    }
    /*}}}*/
    /* undisplay {{{*/
    if( dimm_mask ) {
        dimm_mask.style.display = "none";
        dimm_mask.innerHTML     = "";

        del_el_class(document.body, CSS_DIMMED);
    }
    /*}}}*/
    /* may go along with a hidden [hotspot] {{{*/
    del_el_class(hotspot, CSS_HIDDEN);

    /*}}}*/
/*{{{
    t_gutter_drag_hotspot_to_LAST_WINDOW_XY();
}}}*/
    t_clr_fullscreen_slot_container();
};
/*}}}*/
/*_ dimm_add {{{*/
let dimm_add = function()
{
let log_this = LOG_MAP.T3_LAYOUT;
if( log_this) log("dimm_add");

    if(dimm_mask) return;

    dimm_mask              = document.createElement("DIV");
    dimm_mask.id           = "dimm_mask";
/*
    shadow_root.appendChild( dimm_mask );
*/
    shadow_root.insertBefore(dimm_mask, shadow_root.firstElementChild);
};
/*}}}*/
/*_ dimm_mask_displayed {{{*/
let dimm_mask_displayed = function()
{
    if(!dimm_mask) return false;
    return (dimm_mask && (dimm_mask.style.display != "none"));
};
/*}}}*/
let div_slot_containers_displayed = function()
{
    if(    !dimm_mask                  )       return false;
    if(    !dimm_mask.firstElementChild)       return false;
    return (dimm_mask.firstElementChild.id == "div_slot_containers");
};
/*_ dimm_mask_is {{{*/
let dimm_mask_is = function(el)
{
    return (el == dimm_mask);
};
/*}}}*/
/*}}}*/
/* BOUNDS {{{*/
/*_ t_sync_layout {{{*/
/*{{{*/
let T_SYNC_LAYOUT_DELAY = 500;
let t_sync_layout_timer = null;
let t_sync_layout_callers = "";
/*}}}*/
let t_sync_layout = function(_caller, delay=T_SYNC_LAYOUT_DELAY)
{
let log_this = LOG_MAP.EV7_DISPATCH;

    if(               t_sync_layout_timer ) {
        clearTimeout( t_sync_layout_timer );
    /*            */  t_sync_layout_timer  = null;
    }
    t_sync_layout_callers += _caller;
if( log_this) log("%c t_sync_layout .. CALLED BY ["+t_sync_layout_callers+"]", lbF+lb7);

    if(delay) t_sync_layout_timer = setTimeout( t_sync_layout_handler, delay);
    else                                        t_sync_layout_handler();
};
/*}}}*/
/*_ t_sync_layout_handler {{{*/
let t_sync_layout_handler = function()
{
/*{{{*/
    let caller = "t_sync_layout_handler(called by "+t_sync_layout_callers+")";
let log_this = LOG_MAP.EV7_DISPATCH || LOG_MAP.T3_LAYOUT;

if(log_this) log(caller);
/*}}}*/

    t_sync_tool_clones( caller );

    /* requires [hotspot] and [tools_map] {{{*/
    t_sync_layout_timer = null;
    t_sync_layout_callers = "";

    if(!t_tools_loaded) t_load_TOOLS_MAP(caller);
    /*}}}*/

    /* IS_ON_GRID {{{*/
    if( call_t_grid_IS_ON_GRID(caller) )
    {
if(log_this) log("- %c TOOLS ON GRID", lb7);
        t_grid_onresize(caller);

        return;
    }
    /*}}}*/
    /* EVENT HANDING IN PROGRESS {{{*/
    if(onWork_EL) {
if(log_this) log("- %c EVENT HANDING IN PROGRESS: %c ["+get_n_lbl(onWork_EL)+"]", lbF, lbF+lb0);

        return;
    }
    /*}}}*/
    /* TOOLS NOT VISIBLE YET {{{*/
    if(dom_tools_html && (dom_tools_html.style.visibility != "visible"))
    {
if(log_this) log("- %c [dom_tools_html] IS NOT visible", lb7);

        return;
    }
    /*}}}*/
    /*...OR...*/
    /* INITIAL TOOLS LAYOUT {{{*/
    if(dom_tools_html && t_cache_empty())
    {
        let msg = "INITIAL LAYOUT";

        t_TOOL_SET_select();
if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_log_stage_msg(STAGE_1_INPUT, msg);

        call_t_grid_add_observer();

        /* REMOVING [off_csv] displayed by [pat_csv] at save time */
/*{{{
log(caller+":");
log("...bak_csv ["+bak_csv+"]");
log("...off_csv ["+off_csv+"]");
log("...pat_csv ["+pat_csv+"]");
log("...sel_csv ["+sel_csv+"]");
}}}*/
/*{{{
logXXX("t_sync_layout_handler:7785:");
logXXX("...pat_csv=["+pat_csv+"]"   );
logXXX("...off_csv=["+off_csv+"]"   );
logXXX("...bak_csv=["+bak_csv+"]"   );
}}}*/
        let tmp_csv  =    String( off_csv );
        let    count = csv_count( off_csv );
        for(let  pos = 1; pos <= count;     ++pos) {
            let pattern = csv_get(tmp_csv ,   pos);
            csv_move_pattern_to_off(      pattern);
        }
/*{{{
log(caller+":");
log("...bak_csv ["+bak_csv+"]");
log("...off_csv ["+off_csv+"]");
log("...pat_csv ["+pat_csv+"]");
log("...sel_csv ["+sel_csv+"]");
log(caller+":");
}}}*/

        t_sel_pat_bag_all();

        t_cache_layout(msg);

        /* INITAL LAYOUT {{{*/
        if( t_gutter_is_XY_IN(topTool.x, topTool.y) )
            t_gutter_hotspot_IS_IN_ON_LOAD();

        t_set_pivotXY(pivotXY.x, pivotXY.y);
        t_raise_pivot_PANEL_delayed(T_RAISE_PIVOT_PANEL_DELAY_LONG, caller);
        t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) );

        let position =  prop_get( TOOLS_SCROLL )  ? "absolute" : "fixed";
        t_tool_set_top_xy(caller, topTool.x, topTool.y, position);

        t_fly_div_magnified_toggle( prop_get( FLY_DIV_MAGNIFIED ) );

if( log_this) log("%c...INJECTING AN INITIAL LAYOUT EVENT HANDLING", lb2);
        t_layout_listener();
        /*}}}*/

        t_target_tool_set_parked(false, msg);

        return;
    }
    /*}}}*/
    /*...OR...*/
    /*...OR...*/
    /* viewport and gutter-margin {{{*/
    let gutter_w = h_W;
    let gutter_h = h_H;

    let viewport = { t:0, l:0, b:0, r:0 };
    viewport.t   = -gutter_w / 3;
    viewport.l   = -gutter_h / 3;
    viewport.r   =  w_W;
    viewport.b   =  w_H;

if(log_this) log("...VIEWPORT TL=[%c "+ viewport.t  +" "+ viewport.l  +" %c] BR=[%c "+ viewport.b +" "+ viewport.r +" %c]"                                                ,lb6,lbA,lb5,lbA);
    /*}}}*/
    /* TOOLS HIDE .. f(t_gutter_is_XY_IN) {{{*/
    if(dom_tools_html && t_gutter_is_XY_IN(topTool.x, topTool.y))
    {
if(log_this) log("- %c HOTSPOT IN GUTTER: HIDING TOOL PANELS", lb7);

if(log_this) log("...topTool: FROM XY=[%c "+ topTool.x  +" "+ topTool.y +" %c]",lb6,lbA);
        topTool.x = Math.max( -w_W, topTool.x      );
        topTool.y = Math.max( -w_H, topTool.y      );
        topTool.x = Math.min(       topTool.x, w_W );
        topTool.y = Math.min(       topTool.y, w_H );
if(log_this) log("...topTool: TO   XY=[%c "+ topTool.x  +" "+ topTool.y +" %c]",lb6,lbA);

        let position =  prop_get( TOOLS_SCROLL )  ? "absolute" : "fixed";
        t_tool_set_top_xy(caller, topTool.x, topTool.y, position);

        t_store_update_post("HOTSPOT IN GUTTER");
        return;
    }
    /*}}}*/
    /* NOT IF NO SELECTED PANEL {{{*/
    let first_tool = t_get_first_selected_tool_panel();
    if(!first_tool) {
if(log_this) log(caller+": %c NO TOOL SELECTED", lb7);

        t_store_update_post("NO TOOL SELECTED");
        return;
    }
    /*}}}*/
    /* COLLECT [spreaded_tools] AND THEIR BOUNDING BOX {{{*/
if(log_this) log("...first_tool=[%c "+get_n_lbl(first_tool)+" %c]", lbF,lbA);

    let map = tools_map_get(first_tool);
    let top_tool_l = map.x;
    let top_tool_t = map.y;
    let top_tool_w = map.w;
    let top_tool_h = map.h;

if(log_this) log("."+get_n_lbl(first_tool)+" XY=["+top_tool_l+" "+top_tool_t+"] WH=["+top_tool_w+" "+top_tool_h+"]");

    let bb_dx_dy = { t:0, l:0, r:0, b:0, dx:0, dy:0 };
    bb_dx_dy.t   = top_tool_t;
    bb_dx_dy.l   = top_tool_l;
    bb_dx_dy.b   = top_tool_t + top_tool_h;
    bb_dx_dy.r   = top_tool_l + top_tool_w;
    bb_dx_dy.dx  = w_W;
    bb_dx_dy.dy  = w_H;
if(log_this) log("....FROM BB TL=[%c "+ bb_dx_dy.t  +" "+ bb_dx_dy.l  +" %c] BR=[%c "+ bb_dx_dy.b +" "+ bb_dx_dy.r +" %c] DXY=[%c "+ bb_dx_dy.dx +" "+ bb_dx_dy.dy +" %c]",lb6,lbA,lb5,lbA,lb2,lbA);

    let some_tools_to_unhide = t_collect_spreaded_tools_bounding_box(bb_dx_dy, viewport);
    /*}}}*/
    /* NO GROUPED TOOLS TO SPREAD .. f(BOUNDING BOX: COLLAPSED) {{{*/
if(log_this) log("spreaded_tools.length=["+spreaded_tools.length+"]");
    if(spreaded_tools.length < 1)
    {
        bb_dx_dy.dx  = 0;
        bb_dx_dy.dy  = 0;
    }

if(log_this) log("......TO BB TL=[%c "+ bb_dx_dy.t  +" "+ bb_dx_dy.l  +" %c] BR=[%c "+ bb_dx_dy.b +" "+ bb_dx_dy.r +" %c] DXY=[%c "+ bb_dx_dy.dx +" "+ bb_dx_dy.dy +" %c]",lb6,lbA,lb5,lbA,lb2,lbA);
    /*}}}*/

    /* PIVOT PANEL MAY HAVE BEEN UNSELECTED .. CHOOSE ANOTHER {{{*/
    let panel = pivot_PANEL;
if(log_this) log("PIVOT [%c "+get_n_lbl(panel)+" %c]", lbF+lb7,lbA);

    if(!t_is_a_selected_panel(panel)) { panel = t_get_next_selected_tool_panel (pivot_PANEL); if(log_this) log("%c NEXT  %c "+get_n_lbl(panel)+"  ", lb3,lbF); }
    if(                      !panel ) { panel = t_get_prev_selected_tool_panel (pivot_PANEL); if(log_this) log("%c PREV  %c "+get_n_lbl(panel)+"  ", lb2,lbF); }
    if(                      !panel ) { panel = t_get_first_selected_tool_panel(           ); if(log_this) log("%c FIRST %c "+get_n_lbl(panel)+"  ", lb1,lbF); }

    if(panel) {
        t_set_pivot_PANEL             ( panel   );
        t_raise_pivot_PANEL           ( caller  );
        t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) );
    }
    /*}}}*/
    /* SOME TOOLS TO UNHIDE .. f(some_tools_to_unhide) {{{*/
    if( some_tools_to_unhide )
    {
if(log_this) log(caller+": %c SOME TOOLS TO UNHIDE: %c "+some_tools_to_unhide, lb7, lbF);

        t_cache_init_by(caller);
        t_cache_layout("Showing some tools");
        t_tool_set_top_xy(caller, topTool.x, topTool.y);

        t_store_update_post("SOME TOOLS TO UNHIDE");
        return;
    }
    /*}}}*/
    /*...OR...*/
    /* ALL TOOLS WITHING VIEWPORT .. f(BOUNDING BOX: UNCHANGED) {{{*/
    if((bb_dx_dy.dx==0) && (bb_dx_dy.dy==0))
    {
if(log_this) log("- %c ALL TOOLS WITHIN VIEWPORT", lb7);

        t_toggle_pivot_PANEL_magnified( prop_get( PIVOT_MAGNIFIED ) ); /* in case layout has changed */

        t_store_update_post("ALL TOOLS WITHIN VIEWPORT");
    }
    /*}}}*/
    /*...OR...*/
    /* NO TOOLS IN VIEWPORT .. f(BOUNDING BOX: EXPANDED) {{{*/
    else {
if(log_this) log("- %c NO TOOLS WITHIN VIEWPORT: BOUNDING BOX: EXPANDED: %c "+t_bounding_box_toString(bb_dx_dy), lbF+lb7);

        let    xy = get_el_xy(first_tool, caller);
        topTool.x = xy.x + bb_dx_dy.dx;
        topTool.y = xy.y + bb_dx_dy.dy;

        topTool.x = Math.max( -w_W, topTool.x      );
        topTool.y = Math.max( -w_H, topTool.y      );
        topTool.x = Math.min(       topTool.x, w_W );
        topTool.y = Math.min(       topTool.y, w_H );
if(log_this) log("...topTool: FROM XY=[%c "+      xy.x +" "+       xy.y +" %c]",lb6,lbA);
if(log_this) log("...topTool: TO   XY=[%c "+ topTool.x  +" "+ topTool.y +" %c]",lb6,lbA);

if(log_this) log(caller+": %c CONFINE TO VIEWPORT: t_tool_set_top_xy("+ topTool.x  +" "+ topTool.y +")", lb7);
        t_cache_init_by(caller);
        t_cache_layout("Layout viewport");
        let position =  prop_get( TOOLS_SCROLL )  ? "absolute" : "fixed";
        t_tool_set_top_xy(caller, topTool.x, topTool.y, position);

        t_store_update_post("CONFINE TO VIEWPORT");
    }
    /*}}}*/
    t_update_panel_magnified();
};
/*}}}*/
/*_ t_expand_bounding_box {{{*/
let t_expand_bounding_box = function(panel, bb_dx_dy, viewport)
{
    let caller = "t_expand_bounding_box("+get_n_lbl(panel)+" , ["+t_bounding_box_toString(bb_dx_dy)+" ])";
let log_this = LOG_MAP.T3_LAYOUT;

if(log_this) log("%c"+caller, lb2);
/*{{{
    let es = panel.style;
if(log_this) log("%c  es.XY=["+parseInt( es.left)+" "+parseInt( es.top)+"]  es.WH=["+parseInt( es.width)+" "+parseInt( es.height)+"]", lb2);
}}}*/
/*{{{
    let cs = window.getComputedStyle(panel);
if(log_this) log("%c  cs.XY=["+parseInt( cs.left)+" "+parseInt( cs.top)+"]  cs.WH=["+parseInt( cs.width)+" "+parseInt( cs.height)+"]", lb2);
    let b  = t + parseInt(cs.height);
    let r  = l + parseInt(cs.width );
}}}*/
/*{{{
    let xy = get_el_xy_computed(panel, "t_expand_bounding_box");
}}}*/

    let  xy = get_el_xy(    panel, "t_expand_bounding_box");
    let map = tools_map_get(panel);
if(log_this) log("%c ....xy=["+parseInt( xy.x   )+" "+parseInt( xy.y  )+"]"                                                          , lb2);
if(log_this) log("%c map.XY=["+parseInt(map.x   )+" "+parseInt(map.y  )+"] map.WH=["+parseInt(map.w    )+" "+parseInt(map.h     )+"]", lb2);

    let w = map.w;
    let h = map.h;

    let t  = xy.y;
    let l  = xy.x;
    let b  = t + parseInt(h);
    let r  = l + parseInt(w);

    /* expand bounding box to include this element */
    if( l < bb_dx_dy.l) bb_dx_dy.l = l;
    if( t < bb_dx_dy.t) bb_dx_dy.t = t;
    if( r > bb_dx_dy.r) bb_dx_dy.r = r;
    if( b > bb_dx_dy.b) bb_dx_dy.b = b;

    /* H-DRAG TO VIEWPORT */
    let dx = 0;
    /* FROM LEFT  */ if(r < viewport.l) dx = viewport.l - r; /* positive H-DRAG */
    /* FROM RIGHT */ if(l > viewport.r) dx = viewport.r - l; /* negative H-DRAG */

    /* V-DRAG TO VIEWPORT */
    let dy = 0;
    /* FROM ABOVE */ if(b < viewport.t) dy = viewport.t - b; /* positive V-DRAG */
    /* FROM BELOW */ if(t > viewport.b) dy = viewport.b - t; /* negative V-DRAG */

    /* TRACK MIN DRAG DISTANCES FROM VIEWPORT */
    let el_dxy =          Math.abs(         dx) + Math.abs(         dy);
    let          bb_dxy = Math.abs(bb_dx_dy.dx) + Math.abs(bb_dx_dy.dy);
    let log_color = "color:#A33;";
    if( el_dxy < bb_dxy) {
        bb_dx_dy.dx = dx;
        bb_dx_dy.dy = dy;
        log_color = "background-color:#F22;";
    }

if(log_this) {
    log("t_expand_bounding_box: "
        +" tl_wh=[ "+            t  +" "+          l  +"] ["+ (         r -          l) +" "+ (         b -          t) +"] dxy=[%c "+ dx          +" "+ dy          +" %c]"
        +" TL_WH=[ "+   bb_dx_dy.t  +" "+ bb_dx_dy.l  +"] ["+ (bb_dx_dy.r - bb_dx_dy.l) +" "+ (bb_dx_dy.b - bb_dx_dy.t) +"] DXY=[%c "+ bb_dx_dy.dx +" "+ bb_dx_dy.dy +" %c]"
        +" "+ get_n_lbl(panel)
        , "color:#A33;"           ,""
        , log_color,"background-color:initial;"
    );
}
    return bb_dx_dy;
};
/*}}}*/
/*_ t_bounding_box_toString {{{*/
let t_bounding_box_toString = function(bb)
{
    return "TL=["+bb.t+" "+bb.l+"] BR=["+bb.b+" "+bb.r+"] dx_dy=["+bb.dx+" "+bb.dy+"]";
};
/*}}}*/
/*}}}*/
/* TOOLS {{{*/
/*_ t_is_a_tool_el {{{*/
let t_is_a_tool_el = function(el, _caller)
{
let log_this = logging_EVENTS;

    if(!el) return   false;

    let result = "";
try {
    /* Element ID */
    if     ((el == seeker_PU) || (el == seeker_CU)               ) { result = el.id;              }
    else if( el.id            &&  el.id.startsWith("seekzone"   )) { result = el.id;              }
    else if( el.id            &&  el.id.startsWith("cb_textArea")) { result = el.id;              }
    /* shadow_root */
    else if( shadow_root && shadow_root.contains(el)             ) { result = "A SHADOW ELEMENT"; }
    /* DOC TOOL */
    else if( has_el_class(el,                 CSS_TOOLBAG_BUTTON)) { result = "A DOC TOOL";       }
    else if( is_el_child_of_class(el,         CSS_TOOLBAG_BUTTON)) { result = "A DOC TOOL CHILD"; }
}
catch(ex) { log("t_is_a_tool_el("+get_n_lbl(el)+"):"+LF+ex); }

if( log_this) log("%c t_is_a_tool_el("+get_n_lbl(el)+") %c CALLED BY "+_caller+"%c ...return %c"+(result || "[]"),lbH, lbH, lbA, lbF);
if( log_this) console.dir(el);
    return result;
};
/*}}}*/
/*_ is_a_tool_container {{{*/
let is_a_tool_container = function(el)
{
    if(!el) return   false;
    let     result = false;
    if(el.parentNode.id == dom_tools_html.id) result =  true;

if(logging_EVENTS) log("is_a_tool_container("+get_n_lbl(el)+"): ...return "+result);
    return result;
};
/*}}}*/
/*_ is_a_movable_TOOL_CHILD {{{*/
let is_a_movable_TOOL_CHILD = function(el)
{
let log_this = logging_EVENTS;

    if(!el) return false;

    let rejected_reason = "";

/*{{{
    if     ( is_headsup_ds_movable_child(el)               ) rejected_reason = "";
}}}*/
    if     (!pat_bag                                       ) rejected_reason = " .. ([pat_bag] IS MISSSING)";
    else if(!pat_bag.contains(el)                          ) rejected_reason = " .. (NOT A [pat_bag] NODE )";
    else if(                 !el.className.startsWith("cc")) rejected_reason = " .. (IS A "+el.className+" SEL ITEM)";

    let result = (rejected_reason == "");

if(log_this) log("is_a_movable_TOOL_CHILD("+get_n_lbl(el)+"): %c...return "+result + rejected_reason, (result ? lb3 : lb8));
    return result;
};
/*}}}*/
/*_ is_a_movable_panel {{{*/
let is_a_movable_panel = function(panel)
{
    if(!panel) return   false;
let log_this = logging_EVENTS;

    let  reject_reason = "";

    if     (shadow_root   &&  !shadow_root.contains(panel)                            ) reject_reason = "NOT a [shadow_root] element";
    else if(dom_grid_html && dom_grid_html.contains(panel)                            ) reject_reason = "IS A [dom_grid_html] PANEL";

    else if(                           seeker_PU == panel                             ) reject_reason = panel.id;
    else if(                           seeker_PU == panel                             ) reject_reason = panel.id;
    else if(                           seeker_CU == panel                             ) reject_reason = panel.id;
    else if(                           seeker_CU == panel                             ) reject_reason = panel.id;

    else if(                          dimm_mask_is( panel            )                ) reject_reason = panel.id;
    else if(                          dimm_mask_is( panel.parentNode )                ) reject_reason = panel.parentNode.id+" CHILD";

    else if(                                        panel.id.startsWith("seekzone"   )) reject_reason = panel.id;
    else if(                                        panel.id.startsWith("cb_textArea")) reject_reason = panel.id;

    let result = (reject_reason == "");

if(log_this) log("%c is_a_movable_panel("+get_n_lbl(panel)+" "+panel.className+"): ...return "+result+" %c "+reject_reason, lb3,lbF);
    return result;
};
/*}}}*/
/*}}}*/
/*}}}*/
/** LAYOUT STATE */
/*{{{*/
/*_ t_is_tool_deployed {{{*/
let t_is_tool_deployed = function(el)
{
    if(!el) return false;
let log_this = LOG_MAP.T3_LAYOUT;

    let reject_reason = "";

    if     (el.classList.contains("hidden")   || el.parentNode.classList.contains("hidden"  )) reject_reason = "hidden";
    else if(el.style.display   == "none"      || el.parentNode.style.display   == "none"     ) reject_reason = "display:none";
    else if(el.classList.contains(CSS_PINNED) || el.parentNode.classList.contains(CSS_PINNED)) reject_reason = CSS_PINNED;

    let result = (reject_reason == "");

if(log_this) log("%c t_is_tool_deployed("+get_n_lbl(el)+" "+el.className+"): ...return "+result+" %c "+reject_reason, lb7,lbF);
    return result;
};
/*}}}*/
/*_ t_is_a_spreaded_tool {{{*/
let t_is_a_spreaded_tool = function(el)
{
let log_this = LOG_MAP.T3_LAYOUT;

    if(!el) return false;
    let reject_reason = "";

    /* may currently be hidden but not pinned */
    if(el.classList.contains(CSS_PINNED) || el.parentNode.classList.contains( CSS_PINNED )) reject_reason = "PINNED";
    let map = tools_map_get(el);                                          if(!map.selected) reject_reason = "NOT SELECTED";

    let result = (reject_reason == "");

if(log_this) log("%c t_is_a_spreaded_tool("+get_n_lbl(el)+" "+el.className+"): ...return "+result+" %c "+reject_reason, lb7,lbF);
    return result;
};
/*}}}*/
/*_ t_collect_spreaded_tools_bounding_box {{{*/
/*{{{*/
let           spreaded_tools = [];
/*}}}*/
let t_collect_spreaded_tools_bounding_box = function(bb_dx_dy, viewport)
{
    let some_tools_to_unhide = "";
    spreaded_tools = [];
    for(let i=1; i < TOOL_panels.length; ++i)
    {
        let panel = TOOL_panels[i];
        if( panel && t_is_a_spreaded_tool(panel))
        {
            spreaded_tools.push(panel);

            if(panel.classList.contains("hidden"))
            {
                some_tools_to_unhide += panel.id+" ";

                del_el_class(panel, CSS_HIDDEN);
            }
            bb_dx_dy = t_expand_bounding_box(panel, bb_dx_dy, viewport);
        }
    }
    return some_tools_to_unhide;
};
/*}}}*/
/*_ t_is_a_selected_panel {{{*/
let t_is_a_selected_panel = function(panel)
{
let log_this = LOG_MAP.T3_LAYOUT;

    let reject_reason = "";

    let      map =  panel ? tools_map_get(panel) : null;      let  logX1 = lbA;
    if     (!map          ) {     reject_reason = "NO SUCH PANEL"; logX1 = lb0; }
    else if(!map.selected ) {     reject_reason =  "NOT SELECTED"; logX1 = lb8; }

    let result = (reject_reason == "");

if(log_this) log("%c t_is_a_selected_panel("+get_n_lbl(panel)+"): ...return "+result+" %c "+reject_reason, lb5,logX1);
    return result;
};
/*}}}*/
/*_ t_get_first_selected_tool_panel t_get_next_selected_tool_panel t_get_prev_selected_tool_panel {{{*/
let t_get_next_selected_tool_panel = function(panel    ) { return t_get_near_selected_tool_panel(panel,  1); };
let t_get_prev_selected_tool_panel = function(panel    ) { return t_get_near_selected_tool_panel(panel, -1); };
let t_get_near_selected_tool_panel = function(panel,dir)
{
    let found_panel = false;

    let n_min = 1; /* SKIP [hotspot] */
    let n_max = TOOL_panels.length;

    for(let n = n_min; n <= n_max; ++n)
    {
        let i = (dir > 0) ? n-1 : (n_max - n);
        let p = TOOL_panels[i];
        if(!found_panel) { found_panel = (p == panel); continue; }
        if(    t_is_a_selected_panel(p)
            && t_is_a_spreaded_tool (p)
        )
            return p;
    }
    return null;
};
let t_get_first_selected_tool_panel = function()
{
    for(let i=1; i< TOOL_panels.length; ++i) {
        let panel = TOOL_panels[i];
        if(    t_is_a_selected_panel(panel)
            && t_is_a_spreaded_tool (panel)
        )
            return panel;
    }
    return null;
};
/*}}}*/
/*_ t_get_NW_NE_SE_SW_from_to {{{*/
let t_get_NW_NE_SE_SW_from_to = function(from_x,from_y, to_x,to_y)
{
    return ((from_y > to_y) ? "N" : "S")
        +  ((from_x > to_x) ? "W" : "E")
    ;
};
/*}}}*/
/*_ t_trapped_dir_show {{{*/
let t_trapped_dir_show = function(hiding_tools)
{
    /* CURRENT TOOLS [nw_ne_se_sw] CORNER */
    let nw_ne_se_sw = t_get_NW_NE_SE_SW_from_to(topTool.x,topTool.y, pivotXY.x, pivotXY.y);
/*{{{
logXXX("t_trapped_dir_show: "+nw_ne_se_sw+" ["+topTool.x+" "+topTool.y+"]");
}}}*/

    /* {{{*/
        /* ROTATION [hotspot_c] [pivspot_c] [tools_trap_el] {{{*/
        let rotate_className = "rotate_"+nw_ne_se_sw;
        if(!has_el_class(hotspot_c, rotate_className))
        {
            /* hotspot_c {{{*/
            del_el_class(    hotspot_c    , CSS_ROTATE_NE);
            del_el_class(    hotspot_c    , CSS_ROTATE_SE);
            del_el_class(    hotspot_c    , CSS_ROTATE_SW);
            del_el_class(    hotspot_c    , CSS_ROTATE_NW);
            add_el_class(    hotspot_c    ,  rotate_className);

            /*}}}*/
            /* pivspot_c {{{*/
            del_el_class(    pivspot_c    , CSS_ROTATE_NE);
            del_el_class(    pivspot_c    , CSS_ROTATE_SE);
            del_el_class(    pivspot_c    , CSS_ROTATE_SW);
            del_el_class(    pivspot_c    , CSS_ROTATE_NW);
            add_el_class(    pivspot_c    ,  rotate_className);

            /*}}}*/
            /* GUI {{{*/
            let tools_trap_el = prop_get_EL(TOOLS_TRAP);
            if( tools_trap_el )
            {
                del_el_class(tools_trap_el, CSS_ROTATE_NE);
                del_el_class(tools_trap_el, CSS_ROTATE_SE);
                del_el_class(tools_trap_el, CSS_ROTATE_SW);
                del_el_class(tools_trap_el, CSS_ROTATE_NW);
                add_el_class(tools_trap_el,  rotate_className);
            }
            /*}}}*/
        }
        /*}}}*/
        /* LAYOUT [hotring] {{{*/
        let layout_className = "layout_"+nw_ne_se_sw;
        if(!has_el_class(hotring, layout_className))
        {
            del_el_class(hotring          , CSS_LAYOUT_NE);
            del_el_class(hotring          , CSS_LAYOUT_SE);
            del_el_class(hotring          , CSS_LAYOUT_SW);
            del_el_class(hotring          , CSS_LAYOUT_NW);
            add_el_class(hotring          ,  layout_className);
        }
        /*}}}*/

        if( hiding_tools ) add_el_class(hotring, CSS_GUTTER);
        else               del_el_class(hotring, CSS_GUTTER);
    /*}}}*/
/*{{{
t_fly(        parseInt(pivotXY.x)
         +"<br>"+ parseInt(pivotXY.y)
         +"<br>"+ nw_ne_se_sw
);
}}}*/
};
/*}}}*/
/*}}}*/
/*_ t_set_CSS_PINNED {{{*/
let t_set_CSS_PINNED = function(tool_el, state)
{
    if(state) {
        add_el_class(tool_el, CSS_PINNED      );
        del_el_class(tool_el, CSS_FULLY_SPREAD); /* mutual exclusion */
    }
    else {
        del_el_class(tool_el, CSS_PINNED      );
    }
};
/*}}}*/
/*_ t_set_CSS_PIVOT_PANEL {{{*/
let t_set_CSS_PIVOT_PANEL = function(tool_el, state)
{
    if(state) {
        add_el_class(tool_el, CSS_PIVOT_PANEL);
        del_el_class(tool_el, CSS_FULLY_SPREAD); /* mutual exclusion */
    }
    else {
        del_el_class(tool_el, CSS_PIVOT_PANEL);
    }
};
/*}}}*/
/*_ t_set_CSS_FULLY_SPREAD {{{*/
let t_set_CSS_FULLY_SPREAD = function(tool_el, state)
{
    if(state) {
        add_el_class(tool_el, CSS_FULLY_SPREAD);
    }
    else {
        del_el_class(tool_el, CSS_FULLY_SPREAD);
    }
};
/*}}}*/
/** LAYOUT GUTTER */
/*{{{*/
/* SET */
/*_ t_gutter_hotspot_IS_IN_ON_LOAD {{{*/
let t_gutter_hotspot_IS_IN_ON_LOAD = function()
{
/*{{{*/
let   caller = "t_gutter_hotspot_IS_IN_ON_LOAD";
let log_this = logging_something();

if(log_this) log("%c "+caller, lbF+lb7);
/*}}}*/

    /* tools_scroll OFF */
    let                 prop = prop_set( TOOLS_SCROLL , false     );
    store_set_state(    prop           , TOOLS_SCROLL , prop.value);
    set_id_class_on_off(prop.el.id     , CSS_CHECKED  , prop.value);
    prop.el.innerHTML = prop.value ? SYMBOL_UP_DOWN_ARROW : SYMBOL_ANCHOR ;

/*
    let position = prop.value ? "absolute" : "fixed";
    t_tool_set_top_xy(caller, topTool.x, topTool.y, position);
*/
};
/*}}}*/
/*_ t_gutter_save_last_hotspot_GUTTER_XY {{{*/
let t_hotspot_last_GUTTER_XY = { x:0, y:0 };

let t_gutter_save_last_hotspot_GUTTER_XY = function(x,y)
{
/*{{{
logXXX("t_gutter_save_last_hotspot_GUTTER_XY("+x+","+y+")");
}}}*/
    t_hotspot_last_GUTTER_XY.x = x;
    t_hotspot_last_GUTTER_XY.y = y;
};
/*}}}*/
/*_ t_gutter_save_last_hotspot_WINDOW_XY {{{*/
let t_gutter_save_last_hotspot_WINDOW_XY = function()
{
    if( t_gutter_is_hotspot_NEAR() ) return;
/*{{{
logXXX("t_gutter_save_last_hotspot_WINDOW_XY");
}}}*/

/*{{{
logBIG("SAVING t_hotspot_last_WINDOW_XY AT hotspot current XY=["+hotspot.offsetLeft+" "+hotspot.offsetTop+"]");
}}}*/
    t_hotspot_last_WINDOW_XY.x = hotspot.offsetLeft;
    t_hotspot_last_WINDOW_XY.y = hotspot.offsetTop ;
/*{{{
logXXX("t_gutter_save_last_hotspot_WINDOW_XY: t_hotspot_last_WINDOW_XY=["+t_hotspot_last_WINDOW_XY.x+" "+t_hotspot_last_WINDOW_XY.y+"]");
}}}*/
};
/*}}}*/
/*_ t_gutter_layout_has_CHANGED {{{*/
let t_hotspot_last_WINDOW_XY = { x:0, y:0 };

let t_gutter_layout_has_CHANGED = function()
{
/*{{{
logXXX("t_gutter_layout_has_CHANGED");
}}}*/
    let     vp = t_get_viewport();
    let margin = hotring.clientWidth;

    /* HIDING SPOT: back to top-left gutter */
    t_hotspot_last_GUTTER_XY.x = vp.left + margin/* / 2*/;
    t_hotspot_last_GUTTER_XY.y = vp.top  + margin/* / 2*/;

    /* STAGING SPOT: confined into viewport */
/*{{{
logBIG("CONFINING t_hotspot_last_WINDOW_XY TO VIEWPORT to XY=["+vp.left+" "+vp.top+"] RB=["+vp.right+" "+vp.bottom+"]");
}}}*/
    t_hotspot_last_WINDOW_XY.x = Math.max(t_hotspot_last_GUTTER_XY.x , vp.left   + margin);
    t_hotspot_last_WINDOW_XY.x = Math.min(t_hotspot_last_GUTTER_XY.x , vp.right  - margin);
    t_hotspot_last_WINDOW_XY.y = Math.max(t_hotspot_last_GUTTER_XY.y , vp.top    + margin);
    t_hotspot_last_WINDOW_XY.y = Math.min(t_hotspot_last_GUTTER_XY.y , vp.bottom - margin);

/*{{{
log_key_val("vp",vp);
log_key_val("t_hotspot_last_GUTTER_XY", t_hotspot_last_GUTTER_XY);
log_key_val("t_hotspot_last_WINDOW_XY", t_hotspot_last_WINDOW_XY);
}}}*/
};
/*}}}*/
/* GET */
/*_ t_gutter_is_XY_IN {{{*/
let t_gutter_is_XY_IN = function(x, y, _margin)
{
  /*if(onWork_PANEL && (onWork_PANEL != hotspot)) return false;*/ /* moving another panel */
  /*if( hotspot.style.transform != "")            return false;*/

/*{{{
    if    ((x == 0) && (y == 0)) return false;
}}}*/

/*{{{
    return (x <= h_W) || (x >= (w_W - h_W))
        || (y <= h_H) || (y >= (w_H - h_H));
}}}*/
    let     vp = t_get_viewport();
    let margin = _margin || hotring.clientWidth;
    return (x <= (vp.left + margin)) || (x >= (vp.right  - margin))
        || (y <= (vp.top  + margin)) || (y >= (vp.bottom - margin));
};
/*}}}*/
/*_ t_gutter_is_hotspot_IN {{{*/
let t_gutter_is_hotspot_IN = function()
{
    let answer = hotspot && t_gutter_is_XY_IN(hotspot.offsetLeft, hotspot.offsetTop);
/*{{{
logXXX("t_gutter_is_hotspot_IN return %c"+ answer+"%c"+hotspot.offsetLeft+"%c"+hotspot.offsetTop, lbH, lbL+lf3, lbR+lf4);
}}}*/
    return answer;
};
/*}}}*/
/*_ t_gutter_is_hotspot_NEAR {{{*/
let t_gutter_is_hotspot_NEAR = function()
{
    let answer = hotspot && t_gutter_is_XY_IN(hotspot.offsetLeft, hotspot.offsetTop, 2 * hotring.clientWidth);
/*{{{
logXXX("t_gutter_is_hotspot_NEAR return %c"+ answer+"%c"+hotspot.offsetLeft+"%c"+hotspot.offsetTop, lbH, lbL+lf3, lbR+lf4);
}}}*/
    return answer;
};
/*}}}*/
/*_ t_gutter_hotspot_WAS_PICKED_FROM_GUTTER {{{*/
let t_gutter_hotspot_WAS_PICKED_FROM_GUTTER = function()
{
    return t_gutter_is_XY_IN(onDown_HSPOT_XY.x ,  onDown_HSPOT_XY.y);
};
/*}}}*/
/*_ t_gutter_drag_hotspot_to_LAST_GUTTER_XY {{{*/
/*_ t_gutter_drag_hotspot_to_LAST_GUTTER_XY {{{*/
let t_gutter_drag_hotspot_to_LAST_GUTTER_XY = function()
{
    let caller = "t_gutter_drag_hotspot_to_LAST_GUTTER_XY";
/*{{{
logXXX(caller);
}}}*/

/*{{{
    t_gutter_save_last_hotspot_WINDOW_XY();
}}}*/

    /* IF NOT IN GUTTER .. MOVE TO LAST GUTTER_XY */
    if(!t_gutter_is_XY_IN(        t_hotspot_last_WINDOW_XY.x, t_hotspot_last_WINDOW_XY.y) )
        t_tool_set_top_xy(caller, t_hotspot_last_GUTTER_XY.x, t_hotspot_last_GUTTER_XY.y);
};
/*}}}*/
/*_ t_gutter_drag_hotspot_to_LAST_WINDOW_XY {{{*/
let t_gutter_drag_hotspot_to_LAST_WINDOW_XY = function()
{
/*{{{
logXXX("t_gutter_drag_hotspot_to_LAST_WINDOW_XY");
}}}*/

    if(   (t_hotspot_last_WINDOW_XY.x == 0)
       && (t_hotspot_last_WINDOW_XY.y == 0)
      ) {
/*{{{
logBIG("INIT t_hotspot_last_WINDOW_XY to [w_W w_H] CENTER");
}}}*/
        t_hotspot_last_WINDOW_XY.x = w_W / 2;
        t_hotspot_last_WINDOW_XY.y = w_H / 2;
    }

    /* IF t_hotspot_last_WINDOW_XY NOT IN GUTTER .. MOVE [hotspot] TO WHERE IT WAS BEFORE IT WAS PUSHED INTO GUTTER */
    if(!t_gutter_is_XY_IN(                                           t_hotspot_last_WINDOW_XY.x, t_hotspot_last_WINDOW_XY.y) )
        t_tool_set_top_xy("t_gutter_drag_hotspot_to_LAST_WINDOW_XY", t_hotspot_last_WINDOW_XY.x, t_hotspot_last_WINDOW_XY.y);
/*{{{
else logBIG("...was there already=["+t_hotspot_last_WINDOW_XY.x+" "+t_hotspot_last_WINDOW_XY.y+"]")
}}}*/
};
/*}}}*/
/*}}}*/
/* USE */
/*_ t_gutter_drag_hotspot_IN {{{*/
let t_gutter_drag_hotspot_IN = function(x,y)
{
/*{{{*/
let   caller = "t_gutter_drag_hotspot_IN";
let log_this = LOG_MAP.EV2_MOVE;

/*}}}*/
    t_gutter_save_last_hotspot_GUTTER_XY(x,y);
    /* HIGLIGHT GUTTER {{{*/
    if(!has_el_class(seekzone, CSS_GUTTER) )
    {
        add_el_class(seekzone, CSS_GUTTER);
        /* GUTTER LEFT .. RIGHT .. TOP .. BOTTOM {{{*/
/*{{{
        let margin       = hotring.clientWidth;

        let along_top    =                  (y < (        margin));
        let along_left   = !along_top    && (x < (        margin));
        let along_bottom = !along_left   && (y > (w_H - 2*margin));
        let along_right  = !along_bottom && (x > (w_W - 2*margin));

        let side_class   = along_top    ? CSS_TOP
            :              along_bottom ? CSS_BOTTOM
            :              along_left   ? CSS_LEFT
            :                             CSS_RIGHT
        ;
if( log_this) log("%c INTO GUTTER %c SHOW [seekzone] %c "+side_class
                  ,lbb+lbH+lf7 ,lbL                 ,lbR            );
        set_el_class(seekzone, "gutter "+ side_class);

        let  s_x = (along_left || along_top    || along_bottom) ?   0 : (w_W - margin);
        let  s_y = (along_top  || along_left   || along_right ) ?   0 : (w_H - margin);
        let  s_w = (along_top  || along_bottom                ) ? w_W : (      margin);
        let  s_h = (along_left || along_right                 ) ? w_H : (      margin);
}}}*/
        /*}}}*/
        /* GUTTER VIEWPORT [seekzone] {{{*/
        let  x =    0;
        let  y =    0;
        let  w =  window.innerWidth;
        let  h =  window.innerHeight;

        t_seekzone1_ON_GUTTER_XYWH(y, x, w, h);

if( log_this) log("%c HOTSPOT INTO GUTTER %c SHOW [seekzone]"
                  ,lbb+lbH+lf7           ,lbL                );
        /*}}}*/
    }
    /*}}}*/
};
/*}}}*/
/*_ t_gutter_drag_hotspot_OUT {{{*/
let t_gutter_drag_hotspot_OUT = function(x, y, _caller)
{
/*{{{*/
let   caller = "t_gutter_drag_hotspot_OUT";
let log_this = LOG_MAP.EV3_UP;

if( log_this) t_log_event_status(caller, lf8);
if( log_this) log("%c"+caller+" .. CALLED BY "+_caller, lbF+lb8);
/*}}}*/
/*{{{
logXXX(".................................has_moved=["+ has_moved                             +"]");
logXXX(".................(onWork_PANEL == hotspot)=["+ (onWork_PANEL == hotspot)             +"]");
logXXX("...has_el_class(hotspot, DOM_EDITING     )=["+ has_el_class(hotspot, DOM_EDITING   ) +"]");
logXXX("...has_el_class(hotspot, MARKED_TO_HIDE  )=["+ has_el_class(hotspot, MARKED_TO_HIDE) +"]");
}}}*/
    /* [dom_hide_done] .. (getting hotspot out from gutter) {{{*/
if( log_this) log("%c [hotspot] NODE TO HIDE .. DRAGGED OFF GUTTER", lbH+lf8);

    /* RESET [hotspot] */
    del_el_class(hotspot , DOM_EDITING   );
    del_el_class(hotspot , MARKED_TO_HIDE);
    del_el_class(seekzone, MARKED_TO_HIDE);

    /* FIXME causes unwanted selection .. explain why this call was there */
    /* FIXME t_call_dom_traversal(); */ /* REFRESH [sel_bag] [pat_bag] */

    t_sync_wording(caller); /* ANCHOR (UN)FREEZE */

    prop_set(EDIT_OR_STAGE, false);

    del_el_class(seekzone, CSS_GUTTER);
    t_seekzone4_hide_handler();
};
/*}}}*/
/*}}}*/
/*}}}*/
/** WORDING */
/*{{{*/
/* CONTAINERS_FULLSCREEN {{{*/
/*{{{*/
const DIMM_MASK_MARGIN = 32;
const DIV_MAGNIFY = "<em class='button_magnify' title='magnify'>"+ SYMBOL_MAGNIFY_LEFT +"</em>";

let div_slot_containers;
let button_PREV/*, button_PREV_LEFT*/;
let button_NEXT/*, button_NEXT_LEFT*/;
let button_MONO;

/*
 :!start explorer "https://developer.mozilla.org/en-US/docs/Web/CSS/white-space"
*/

/*}}}*/
/*_ t_slot_containers_display {{{*/
let t_slot_containers_display = function(slot)
{
/* {{{*/
let caller = "t_slot_containers_display(slot "+slot+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* TODO account for window geometry {{{*/
/*{{{
    let  body_SH = document.body.scrollHeight;
    let  body_CH = document.body.clientHeight;
    let  body_OH = document.body.offsetHeight;
if(log_this) log("...body   [  H] = ["+body_SH +" "+ body_CH +" "+ body_OH +"] .. [Scroll Client Offset]");
}}}*/
if(log_this) log("...window [W H] = ["+w_H     +" "+ w_W                   +"]");
    /*}}}*/
    /* BUILD dimm_mask.innerHTML {{{*/
    if(!dimm_mask) dimm_add();
    dimm_mask.innerHTML = "";
    let       innerHTML = "";
    let           pinsL = "";

    let    num_selected = ccs[slot].num_selected; /* (selection to return to when done) */
    let container_count = 0;
    for(let num = 0;   num <= ccs[slot].nodes.length; ++num)
    {
        /* count more than one num .. in the same container {{{*/
        let container = ccs[slot].containers[num-1];
        let  num_last = num;
        while(    ( num_last <  ccs[slot].nodes.length)
               && (container == ccs[slot].containers[num_last])
             )
            num_last += 1;

        /*}}}*/
        if( ccs[slot].containers[num-1] ) {
            /* container .. (slot paragraph) {{{*/
            container        = ccs[slot].containers[num-1];
            container_count += 1;
            /*}}}*/
            /* geometry {{{*/
            let  container_is_body_single_child = (container == document.body) && (document.body.childNodes.length == 1);
/*
if(log_this) log("...container_is_body_single_child.: "+ container_is_body_single_child);
*/

            let                         cont_CH = container.clientHeight;
            let                         cont_OH = container.offsetHeight;
            let                     container_H = container.scrollHeight;
/*
if(log_this) log("...cont   [  H] = ["+ container_H +" "+ cont_CH +" "+ cont_OH +"] .. [Scroll Client Offset]");
*/

            let content_is_too_big = container_H >= (w_H * 0.9);
/*
if(log_this) log("...content_is_too_big..........: "+ content_is_too_big +"] .. [container_H / window_H] ["+container_H+" / "+w_H+"]");
*/

            /*}}}*/
            /* title .. [title num copy_icon css text] {{{*/
            let title_em
                = (container           .title) ? " <em>"+container           .title+"</em>"
                : !container.parentNode        ? " "
                :  container.parentNode.title  ? " <em>"+container.parentNode.title+"</em>"
                :                                         " ";

            let num_from_to
                = (num_last == num)            ? num : (num +"-"+ num_last);

            let slot_num_selected
                = (num <= num_selected) && (num_selected <= num_last);

            let tooltip
                = SYMBOL_SCISSORS+" "+num_from_to+" Copy paragraph to Clipboard";

            let div_class
                = "class_s_"+slot+"_"+num      + " note"+(container_count % 10)
                + (content_is_too_big          ? " content_is_too_big" : ""   )
                + (slot_num_selected           ? " container_selected" : ""   )
            ;

            let div_copy_content_innerHTML
                = content_is_too_big           ? (ellipsis(container.innerText, 512)  )
                : (container.tagName == "LI")  ? ("<p>"+container.innerHTML+"</p>" +LF)  /* TURN A DANGLING <LI> INTO A <P> */
                :                                (      container.outerHTML           )
            ;

            /*}}}*/
            /* css {{{*/
            /* wrap with containers highlight */
/*{{{
            let css = (container.tagName == "P"      ) ? "preformatted" : "";
            let css = (prop_get( CONTAINERS_HI )) ?             "" : "white-space:pre";
            let css = (prop_get( CONTAINERS_HI )) ? "preformatted" : "";
}}}*/
            let css = "white-space:pre-line";

            /*}}}*/
            /* html {{{*/
            innerHTML
                += " <div class='"+  div_class              +"' style='"+css+"' title='Scroll to this paragraph'>"+LF

                +                    DIV_MAGNIFY            +LF

                +  "  <div class='"+ CSS_BUTTON_COPY        +"' title='"+tooltip+"'>"+LF
                +  "  "            + container_count
                +  "  "            + SYMBOL_CLIPBOARD
                +  "   <em>"       + ccs[slot].pattern      +"</em>"
                +  "   <em>#"      + num_from_to            +"</em> <em>of "+ ccs[slot].nodes.length +"</em>"
                +  "  </div>"                               +LF

                +  "  " + title_em                          +LF

                +  "  <div class='div_copy_content'>"       +LF
                +  "  "+div_copy_content_innerHTML          +LF
                +  "  </div>"                               +LF

                +  " </div>"                                +LF
            ;

            /*}}}*/
        }
        num = num_last; /* .. (done with all selections associated with this container) */
    }
    /*}}}*/
    /* DISPLAY innerHTML {{{*/
    if(innerHTML) {
        /* [window-scroll-to-top] [dimm_mask] [hotspot] [seeker_PU] {{{*/
        t_gutter_drag_hotspot_to_LAST_GUTTER_XY();
        add_el_class(hotspot , CSS_HIDDEN);

        t_window_scrollTo(0, 0);

        /*}}}*/
        /* background dimmed {{{*/
        dimm_start_slot_containers(caller);

        /*}}}*/
        /* [button_COPY_ALL_parent_div] {{{*/
        let tooltip
            = SYMBOL_SCISSORS+" Copy all to Clipboard";

        let button_COPY_ALL_parent_div
            =  " <div     id='button_COPY_ALL_parent_div'>" +LF

            +                        DIV_MAGNIFY            +LF

            +  "  <div class='"    + CSS_BUTTON_COPY        +"' title='"+tooltip+"'>"+LF
            +  "  "                + SYMBOL_CLIPBOARD
            +  "   <em>"           + ccs[slot].pattern      +"</em>"
            +  "   <em>#1 to "     + ccs[slot].nodes.length +"</em>"
            +  "  </div>"                                   +LF

            +  "  <div class='div_copy_content'>"
            +  "  "+ container_count+" Paragraphs containing <em class='cc"+slot+"'>"+ ccs[slot].pattern +"</em>"
            +  "  </div>"+LF
            +  " </div>"+LF
        ;
        /*}}}*/
        /* [div_slot_containers create ] {{{*/
        if(!div_slot_containers)
        {
            div_slot_containers    = document.createElement("DIV");
            div_slot_containers.id = "div_slot_containers";

            button_PREV            = t_slot_containers_get_button("button_prev", SYMBOL_HEAVY_RIGHT_ARROW);
/*{{{
            button_PREV_LEFT       = t_slot_containers_get_button("button_prev", SYMBOL_HEAVY_RIGHT_ARROW);
            add_el_class(button_PREV_LEFT, CSS_LEFT);
}}}*/

            button_NEXT            = t_slot_containers_get_button("button_next", SYMBOL_HEAVY_RIGHT_ARROW);
/*{{{
            button_NEXT_LEFT       = t_slot_containers_get_button("button_next", SYMBOL_HEAVY_RIGHT_ARROW);
            add_el_class(button_NEXT_LEFT, CSS_LEFT);
}}}*/

            button_MONO            = t_slot_containers_get_button("button_mono", SYMBOL_MENU             );
            button_MONO.title = "monospace";
        }

        /*}}}*/
        /* [div_slot_containers content] {{{*/
        div_slot_containers.innerHTML         = ""; /* removes all children */

        div_slot_containers.insertAdjacentHTML("beforeend", button_COPY_ALL_parent_div);
        div_slot_containers.insertAdjacentHTML("beforeend", innerHTML                 );

        /*}}}*/
        /* LAYOUT [dimm_mask] {{{*/

        let v_W = window.innerWidth - DIMM_MASK_MARGIN;
        let v_H = get_page_height();

        dimm_mask.style.position            = "absolute";
        dimm_mask.style.left                =      "0px";
        dimm_mask.style.top                 =      "0px";
        dimm_mask.style.width               =   v_W+"px";
        dimm_mask.style.height              =   v_H+"px";

if( log_this) log("dimm_mask XY=["+dimm_mask.style.left+" "+dimm_mask.style.top+"] WH=["+dimm_mask.style.width+" "+dimm_mask.style.height+"]");
        /*}}}*/
        /* LAYOUT [div_slot_containers] [button_NEXT] [button_PREV] {{{*/
        let x = 0;
        let y = 0;
        let h = v_H - y;
        let w = v_W - x;

        div_slot_containers.style.position  =         "";
        div_slot_containers.style.left      =     x+"px";
        div_slot_containers.style.top       =     y+"px";
        div_slot_containers.style.width     =     w+"px";
        div_slot_containers.style.minHeight =   w_H+"px";

if( log_this) log("div_slot_containers XY=["+div_slot_containers.style.left+" "+div_slot_containers.style.top+"] WminH=["+div_slot_containers.style.width+" "+div_slot_containers.style.minHeight+"]");

        dimm_mask.appendChild( div_slot_containers      );
        dimm_mask.appendChild( button_NEXT ); /*dimm_mask.appendChild( button_NEXT_LEFT );*/
        dimm_mask.appendChild( button_PREV ); /*dimm_mask.appendChild( button_PREV_LEFT );*/
        dimm_mask.appendChild( button_MONO );
        /*}}}*/
        t_seeker_PU_hide("instant");
    }
    /*}}}*/
};
/*}}}*/
/*_ t_slot_containers_get_button {{{*/
let t_slot_containers_get_button = function(className, content)
{
    let el         = document.createElement("EM");

    el.textContent = content;

    add_el_class(el, className);

    return el;
};
/*}}}*/
/*_ t_slot_container_set_fullscreen {{{*/
let       fullscreen_slot_container;
let t_clr_fullscreen_slot_container = function() { t_slot_container_set_fullscreen(null); };
let t_slot_container_set_fullscreen = function(clicked_target)
{
/* {{{*/
let caller = "t_slot_container_set_fullscreen("+get_id_or_tag(clicked_target) || clicked_target+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) t_log_event_status(caller, lf8);
/*}}}*/
    /* EVENT  TARGET */ let slot_container = clicked_target;
    /* MAGNIFY START */ if     (has_el_class(clicked_target, CSS_BUTTON_MAGNIFY         )) slot_container = clicked_target.parentElement;
    /* MAGNIFY STOP  */ else if(            (clicked_target == fullscreen_slot_container)) slot_container = clicked_target;
    /* MAGNIFY PREV  */ else if(has_el_class(clicked_target, CSS_BUTTON_PREV              )) slot_container = fullscreen_slot_container.previousElementSibling || fullscreen_slot_container;
    /* MAGNIFY NEXT  */ else if(has_el_class(clicked_target, CSS_BUTTON_NEXT              )) slot_container = fullscreen_slot_container.nextElementSibling     || fullscreen_slot_container;
    /* MONSPACE      */ else if(has_el_class(clicked_target, CSS_BUTTON_MONO              )) {
if(log_this)
logBIG("flip_el_class(div_slot_containers, CSS_BUTTON_MONOSPACE)");
        flip_el_class(div_slot_containers, CSS_BUTTON_MONOSPACE);
        return;
    }
    /* [fullscreen_slot_container] {{{*/
    if(clicked_target == fullscreen_slot_container)
    {
if(log_this) log("fullscreen_slot_container UNCHANGED");
        return;
    }
    /*}}}*/
    /* [new fullscreen_slot_container] {{{*/
    fullscreen_slot_container = slot_container;

    /*}}}*/
    /* fullscreen CSS {{{*/
    /* TODO: post-refactoring ...setup css propagation for proper cascade styling */
    if(fullscreen_slot_container) add_el_class(dimm_mask          , CSS_FULLSCREEN);
    else                          del_el_class(dimm_mask          , CSS_FULLSCREEN);

    if(fullscreen_slot_container) add_el_class(div_slot_containers, CSS_FULLSCREEN);
    else                          del_el_class(div_slot_containers, CSS_FULLSCREEN);

    /*}}}*/
    /* children {{{*/
    let slot_max = div_slot_containers.children.length;
    let slot_num = -1;
    for(let i=0; i < slot_max; ++i)
    {
        let child =  div_slot_containers.children[i];

        if( child == fullscreen_slot_container) slot_num = i;

        /* [fullscreen] */
        if( child == fullscreen_slot_container) add_el_class(child, CSS_FULLSCREEN);
        else                                    del_el_class(child, CSS_FULLSCREEN);

        /* display */
        child.style.display
            = (!fullscreen_slot_container || (child == fullscreen_slot_container))
            ? "block"
            : "none"
        ;
    }
    /*}}}*/
    /* PREV NEXT {{{*/
    let display_prev = ((slot_num >= 0) && (slot_num > (0         ))) ? "inline" : "none";
    let display_next = ((slot_num >= 0) && (slot_num < (slot_max-1))) ? "inline" : "none";

    if( log_this)
        log_key_val(caller
                    , {       slot_num : slot_num
                        ,     slot_max : slot_max
                        , display_prev : display_prev
                        , display_next : display_next
                    });
    button_PREV.style.display = display_prev; /*button_PREV_LEFT.style.display = display_prev;*/
    button_NEXT.style.display = display_next; /*button_NEXT_LEFT.style.display = display_next;*/
    button_MONO.style.display = display_prev;

    /*}}}*/
    t_window_scrollTo(0, 0);
};
/*}}}*/
/*_ t_slot_containers_magnify {{{*/
let slot_container_magnified_0_to_9 = 2; /* CSS [magnified_0]..[magnified_9] */
let t_slot_containers_magnify = function()
{
/*{{{
logXXX("t_slot_containers_magnify");
logXXX("...slot_container_magnified_0_to_9=["+slot_container_magnified_0_to_9+"]");
console_clear( slot_container_magnified_0_to_9 )
}}}*/

    for(i = 0; i <= 9; ++i)
    {
        let className = "magnified_"+i;
        if(i == slot_container_magnified_0_to_9) add_el_class(div_slot_containers, className);
        else                                     del_el_class(div_slot_containers, className);
    }

};
/*}}}*/
/*_ t_slot_containers_is_showing {{{*/
let t_slot_containers_is_showing = function()
{
    return (dimm_mask.innerHTML != "");
};
/*}}}*/
/*_ t_slot_containers_copy_to_clipboard {{{*/
/*{{{*/
let cb_textArea = null;

/*}}}*/
let t_slot_containers_copy_to_clipboard_outerHTML = function(el) { t_slot_containers_copy_to_clipboard(el,  true); };
let t_slot_containers_copy_to_clipboard_innerHTML = function(el) { t_slot_containers_copy_to_clipboard(el, false); };
let t_slot_containers_copy_to_clipboard           = function(el,   outer_or_inner)
{
/*{{{*/
    let caller = "t_slot_containers_copy_to_clipboard("+get_n_lbl(el)+", "+outer_or_inner+")";
let log_this   = LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller, lbR+lf2);
if( log_this) log("%c"+(outer_or_inner ? "outerHTML" : "innerHTML")+"%c "+ (outer_or_inner ? el.outerHTML : el.innerHTML), lbL, lbR);
/*}}}*/
    /* [cb_textArea] {{{*/
    if(!cb_textArea) {
        cb_textArea    = document.createElement("TEXTAREA");
        cb_textArea.id = "cb_textArea";
        cb_textArea.style.position        = "fixed";
        cb_textArea.style.top             = "1em";
        cb_textArea.style.left            = "1em";
        cb_textArea.style.width           =  "95%";
        cb_textArea.style.height          = "25em";
        cb_textArea.style.backgroundColor = "salmon";
        shadow_root.appendChild(cb_textArea);
/*{{{
      document.body.appendChild(cb_textArea);
      cb_textArea.style.display         = "none";
      cb_textArea.onclick               = function(e) { this.display = "none"; };
}}}*/
    }
    /*}}}*/
    /* A CSS_BUTTON_COPY {{{*/
if( log_this) console_dir(el, "el should be a ["+CSS_BUTTON_COPY+"]");

    /*}}}*/
    /* A COPY ALL BUTTON {{{*/
if( log_this) log("...el.id=["+(el.id == 'button_COPY_ALL_parent_div')+"]");
    if(el.id == 'button_COPY_ALL_parent_div')
    {
        el = dimm_mask.firstElementChild;
    }
    /*}}}*/
    /* BUFFER TEXTAREA SHOW AND FILL WITH CONTENT {{{*/
    cb_textArea.style.display = "block";
    let text_or_html = has_el_class(div_slot_containers, CSS_BUTTON_MONOSPACE);
if( log_this) log("...text_or_html=["+text_or_html+"]");
    cb_textArea.value
        = (outer_or_inner)
        ?  (text_or_html ? el.innerText : el.outerHTML)
        :  (text_or_html ? el.innerText : el.innerHTML)
    ;
    /*}}}*/
    /* COPY TO CLIPBOARD {{{*/
    cb_textArea.select();
if( log_this) log("%c window.getSelection() %c "+window.getSelection(), lbL+lf8, lbR+lf9);

    if( !document.execCommand("copy") )
    {
        log("%c*** COPY TO CLIPBOARD REJECTED ***", lb2);
logXXX("%c USER EVENT CALLBACK REQUIRED ", lbb+lbH+lf2);
/*{{{
}}}*/
    }
    else {
if( log_this) log("%c...COPY TO CLIPBOARD: "+cb_textArea.value.length+" characters ", lbR+lf2);

    }
    /*}}}*/
    /* BUFFER TEXTAREA HIDE AND CLEAR {{{*/
    cb_textArea.style.display = "none";
    cb_textArea.value         = "";

    /*}}}*/
};
/*}}}*/
/*}}}*/
/* CONTAINER SELECT {{{*/
/*_ t_seek_set_container_selected {{{*/
/*{{{*/
let container_selected;
let container_selected_x;

/*}}}*/
let t_seek_set_container_selected = function(container, _caller)
{
/*{{{
logXXX("t_seek_set_container_selected%c("+get_id_or_tag(container)+")", lbH+lf7);
}}}*/
    /* [container_selected] {{{*/
    if(container_selected == container) return;

    if(container_selected) del_el_class(container_selected, CSS_CONTAINER_SELECTED);

    container_selected     = container;

    /*}}}*/
    /* SEEKER FOLLOWS [container_selected] {{{*/
    if(container_selected)
    {
        t_set_onSeekXYL_from_container(container_selected, _caller+" ON ["+get_n_lbl(container_selected)+"]");
    }
    /*}}}*/
    /* add_el_class [container_selected] {{{*/
    if(container_selected) {
        add_el_class(container_selected, CSS_CONTAINER_SELECTED);
        add_el_class(seekzone          , CSS_CONTAINER_SELECTED);

        let xy = get_el_xy(container_selected, "t_seek_set_container_selected");
        if( xy           ) container_selected_x = xy.x;
    }
    else {
        container_selected_x = 0;
        del_el_class(seekzone          , CSS_CONTAINER_SELECTED);
    }
    /*}}}*/
    dom_hide4_scroll_to_last_hidden( container );
};
/*}}}*/
/*_ t_seek_clr_container_selected {{{*/
let t_seek_clr_container_selected = function()
{
    if(!container_selected ) return;
    /* del_el_class [container_selected] {{{*/
    del_el_class(container_selected, CSS_CONTAINER_SELECTED);
    del_el_class(seekzone          , CSS_CONTAINER_SELECTED);

    /*}}}*/
    /* [container_selected] {{{*/
    container_selected = null;

    /*}}}*/
};
/*}}}*/
/*_ t_set_touchedWord_startContainer {{{*/
let t_set_touchedWord_startContainer = function()
{
/*{{{*/
    let caller = "t_set_touchedWord_startContainer";
let log_this   = LOG_MAP.EV3_UP;

if( log_this) log("%c"+caller+" %c FOR SELECTION RANGE "+get_id_or_tag(s_touchedWord_range_parent)+" %c "+       s_touchedWord_slot
                  ,lbb+lbL+lf3 ,lbb+lbC+lf3                                                         ,lbb+lbR+lfX[s_touchedWord_slot]);

/*}}}*/
    /* GET [touched_container] {{{*/
    let slot = s_touchedWord_slot;
    let touched_container;
    for(let num=1; num <= ccs[slot].containers.length; ++num)
    {
        if( is_el_or_child_of_parent_el(s_touchedWord_range_parent, ccs[slot].containers[num-1]) )
        {
            touched_container = ccs[slot].containers[num-1];

if( log_this) log("%c"+caller+" %c "+get_id_or_tag(touched_container)+" %c num "+num
                  ,lbb+lbL+lf3 ,lbb+lbC+lf3                             ,lbb+lbR+lf3 );
            break;
        }
    }
    /*}}}*/
    /* HIGHLIGHT [touched_container] {{{*/
    if(touched_container)
    {
        t_seek_set_container_selected(touched_container, caller);
        t_scrollIntoViewIfNeeded     (touched_container);
    }
    else {
if( log_this) log("%c"+caller+" %c NO [touched_container]"
                  ,lbb+lbL+lf3 ,lbb+lbR+lf2               );
    }
    /*}}}*/
};
/*}}}*/
/*}}}*/
/*}}}*/

/** SCROLL */
/* {{{*/
/*{{{*/
const SCROLLED_INTO_VIEW     = "scrolled_into_view";

const SCROLL_INTO_VIEW_DELAY = 500;
const SCROLL_RECENTER_DELAY  = 500;
const SCROLL_CONTAINER_DELAY = 500;

let t_scrollIntoView_EL;

let t_scrollIntoViewIfNeeded_timer;
let t_scrollIntoViewIfNeeded_DONE_MS;
let t_scroll_recenter_timer;
let t_scroll_recenter_DONE_MS;

/*}}}*/

/*_ t_scrollIntoViewCanceled {{{*/
let t_scrollIntoViewCanceled = function(_caller)
{
/*{{{*/
let log_this = logging_EVENTS;

/*}}}*/

    t_scrollIntoView_EL = null;

    if( t_scroll_recenter_timer )
    {
if( log_this) log("PENDING RECENTER INTERRUPTED BY "+ _caller);
        clearTimeout(t_scroll_recenter_timer);
        t_scroll_recenter_timer = null;
    }

    if( t_scrollIntoViewIfNeeded_timer )
    {
if( log_this) log("PENDING SCROLL INTERRUPTED BY "+ _caller);
        clearTimeout( t_scrollIntoViewIfNeeded_timer );
    }

};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded {{{*/
let t_scrollIntoViewIfNeeded = function(el)
{
/*{{{*/
let   caller = "t_scrollIntoViewIfNeeded";
let log_this = logging_EVENTS;

if( log_this) log("%c "+caller+" %c "+get_id_or_tag(el), lbL+lf4,lbR+lf4);
if( log_this) console_dir(el);
/*}}}*/

    t_scrollIntoViewCanceled(caller);

    t_scrollIntoView_EL = el;

    if(t_scrollIntoView_EL) t_scrollIntoViewIfNeeded_timer = setTimeout(t_scrollIntoViewIfNeeded_handler, SCROLL_INTO_VIEW_DELAY);
    else                    t_scrollIntoViewIfNeeded_timer = null;
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_handler {{{*/
let t_scrollIntoViewIfNeeded_handler = function()
{
/*{{{*/
let   caller = "t_scrollIntoViewIfNeeded_handler";
let log_this = logging_EVENTS;

if( log_this) log("%c "+caller+" %c "+get_id_or_tag(t_scrollIntoView_EL), lbL+lf5,lbR+lf5);
/*}}}*/
    if( !t_scrollIntoView_EL) return;

    /* SCROLL WHERE {{{*/
    t_scrollIntoViewIfNeeded_timer   = null;
    t_scrollIntoViewIfNeeded_DONE_MS = new Date().getTime();

    let xy = t_scrollIntoViewIfNeeded_get_scrollXY( t_scrollIntoView_EL );
    if(!xy) return;
    /*}}}*/
    /* IS NEEDED {{{*/
    if((window.scrollX != xy.x) || (window.scrollY != xy.y))
    {
if( log_this) t_log_event_status("SCROLL INTO VIEW DX=["+window.scrollX+" .. "+xy.x+"] .. DY=["+window.scrollY+" .. "+xy.y+"]", lf5);
/*{{{
logXXX("%c "+caller+": scroll_not_done_yet=["+scroll_not_done_yet()+"]", lbH+lf7);
}}}*/

        t_window_scrollTo(xy.x, xy.y, "smooth"); /* that's only an adjustment */
    }
    /*}}}*/
    /* NOT NEEDED {{{*/
    else {
if( log_this) log("%c SCROLL INTO VIEW NOT NEEDED %c "+window.scrollX+" "+window.scrollY, lbb+lbH+lf5, lbb+lbH+lf5)
    }
    /*}}}*/

    /* XXX .. SHOULD WE ALWAYS ? */
    t_scroll_recenter_timer = setTimeout(t_scrollIntoViewIfNeeded_then_recenter_handler, SCROLL_RECENTER_DELAY);
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_then_recenter_handler {{{*/
let t_scrollIntoViewIfNeeded_then_recenter_handler = function()
{
/*{{{*/
let   caller = "t_scrollIntoViewIfNeeded_then_recenter_handler";
let log_this = logging_EVENTS;

if( log_this) log("%c "+caller+" %c "+get_id_or_tag(t_scrollIntoView_EL), lbL+lf6,lbR+lf6);
/*}}}*/
    /* RECENTER DONE .. POINTER STILL DOWN .. REARM A LONG PRESS {{{*/
    rearm_long_press_listener();

    /*}}}*/
    if( !t_scrollIntoView_EL) return;
    /* SCROLL WHERE {{{*/
    t_scroll_recenter_timer   = null;
    t_scroll_recenter_DONE_MS = new Date().getTime();

    let xy = get_el_xy(t_scrollIntoView_EL, "t_scrollIntoViewIfNeeded_then_recenter_handler");
    if(!xy ) return;

    let e_W = t_scrollIntoView_EL.clientWidth  || t_scrollIntoView_EL.offsetWidth;
    let e_H = t_scrollIntoView_EL.clientHeight || t_scrollIntoView_EL.offsetHeight;

    xy.x    = xy.x  /* container left   */
        +     e_W/2 /* container center */
        -     w_W/2 /*   window  center */
    ;

    xy.y    = xy.y  /* container top    */
        +     e_H/2 /* container middle */
        -     w_H/2 /*   window  middle */
    ;

    /*}}}*/
    /* IS NEEDED .. (not already there) {{{*/
    if((window.scrollX != xy.x) || (window.scrollY != xy.y))
    {
if( log_this) t_log_event_status("SCROLL RECENTER  DX=["+window.scrollX+" .. "+xy.x+"] .. DY=["+window.scrollY+" .. "+xy.y+"]", lf6);
        if( onWork_EL )
        {
/*{{{
logXXX("%c NOT RECENTERING WHEN [onWork_EL] NOT NULL %c"+ get_id_or_tag(onWork_EL), lbb+lbL+lf4, lbb+lbR+lf7);
}}}*/
        }
        else {
/*{{{
logXXX("%c ... RECENTERING WHEN [onWork_EL]  IS NULL", lbb+lbH+lf8);
}}}*/
            t_window_scrollTo(xy.x, xy.y, "smooth"); /* RECENTER ALWAYS SMOOTH */
        }
    }
    /*}}}*/
    /* NOT NEEDED {{{*/
    else {
if( log_this) log("%c SCROLL RECENTER NOT NEEDED %c "+window.scrollX+" "+window.scrollY, lbb+lbH+lf6, lbb+lbH+lf6)

    }
    /*}}}*/
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_is_pending {{{*/
let t_scrollIntoViewIfNeeded_is_pending = function()
{
    return (t_scrollIntoViewIfNeeded_timer != null)
        || (t_scroll_recenter_timer        != null)
    ;
};
/*}}}*/

/*_ t_scrollIntoViewIfNeeded_dimm_mask_container_selected {{{*/
/*{{{*/
let t_scrollIntoViewIfNeeded_dimm_mask_container_selected_timer;

let el_to_mark_SCROLLED_INTO_VIEW;
/*}}}*/
let t_scrollIntoViewIfNeeded_dimm_mask_container_selected = function(el)
{
/*{{{*/
let   caller = "t_scrollIntoViewIfNeeded_dimm_mask_container_selected";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c "+caller+" %c "+get_id_or_tag(el), lbL+lf4,lbR+lf4);
/*}}}*/

    el_to_mark_SCROLLED_INTO_VIEW = el;

    if(    t_scrollIntoViewIfNeeded_dimm_mask_container_selected_timer) clearTimeout( t_scrollIntoViewIfNeeded_dimm_mask_container_selected_timer );
    if(el) t_scrollIntoViewIfNeeded_dimm_mask_container_selected_timer =  setTimeout( t_scrollIntoViewIfNeeded_dimm_mask_container_selected_handler, SCROLL_CONTAINER_DELAY);
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_dimm_mask_container_selected_handler {{{*/
let t_scrollIntoViewIfNeeded_dimm_mask_container_selected_handler = function()
{
/*{{{*/
let   caller = "t_scrollIntoViewIfNeeded_dimm_mask_container_selected_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

    /* SLOT CONTAINERS CURRENTLY DISPLAYED */
    let containers                      =  dimm_mask.firstElementChild;
if( log_this) console_dir(containers    , "dimm_mask.firstElementChild");

    if(!containers                                               ) return;
    if( containers.id                  != "div_slot_containers"  ) return;

    /* FIRST CONTAINER */
    let                       container =  containers.firstElementChild;
if( log_this) console_dir(    container , "containers.firstElementChild");

    /* SELECTED CONTAINER */
    while(container && !has_el_class(container , CSS_CONTAINER_SELECTED))
        container =                  container .  nextElementSibling;

    /* SCROLL INTO VIEW IF NEEDED */
if( log_this) console_dir(container, "container");
    if(container &&  has_el_class(container, CSS_CONTAINER_SELECTED)) t_scrollIntoViewIfNeeded( container );

    t_scrollIntoViewIfNeeded_dimm_mask_container_selected_timer = null;
};
/*}}}*/

/*_ t_scrollIntoViewIfNeeded_get_scrollXY {{{*/
let t_scrollIntoViewIfNeeded_get_scrollXY = function(el)
{
    return t_scrollIntoViewIfNeeded_get_scrollXY_with_options(el, false);
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_get_scrollXY_with_margin {{{*/
let t_scrollIntoViewIfNeeded_get_scrollXY_with_margin = function(el)
{
    return t_scrollIntoViewIfNeeded_get_scrollXY_with_options(el, true);
};
/*}}}*/
/*_ t_scrollIntoViewIfNeeded_get_scrollXY_with_options {{{*/
/*{{{*/
const SCROLLBAR_WIDTH = 16;
const VIEWPORT_MARGIN =
    {     top    :160
        , left   : 16
        , right  : 16 + SCROLLBAR_WIDTH
        , bottom : 80 + SCROLLBAR_WIDTH
    };
/*}}}*/
let t_scrollIntoViewIfNeeded_get_scrollXY_with_options = function(container, with_margin=true)
{
/*{{{*/
let caller = "t_scrollIntoViewIfNeeded_get_scrollXY_with_options";

/*{{{
container.scrollIntoView(true);
- opt_center: (if false): aligned to the nearest edge of the visible area of the scrollable ancestor
- scrollable ancestor...: (node.scrollHeight > node.clientHeight)
container.scrollIntoViewIfNeeded(true);
}}}*/
    /*}}}*/
    /* VIEW {{{*/
    let w_W = window.innerWidth ;
    let w_H = window.innerHeight;

    let view_rect
        = {   left   : window.scrollX       + (with_margin ? VIEWPORT_MARGIN.left   : 16)
            , top    : window.scrollY       + (with_margin ? VIEWPORT_MARGIN.top    : 16)
            , right  : window.scrollX + w_W - (with_margin ? VIEWPORT_MARGIN.right  : 32)
            , bottom : window.scrollY + w_H - (with_margin ? VIEWPORT_MARGIN.bottom : 32)
        };
    /*}}}*/
    /* EL {{{*/
    let xy = get_el_xy(container, caller);
    if(!xy) return null;

    let e_W = container.clientWidth  || container.offsetWidth;
    let e_H = container.clientHeight || container.offsetHeight;

    let container_rect
        = { left   : xy.x
        ,   top    : xy.y
        ,   right  : xy.x + e_W
        ,   bottom : xy.y + e_H
    };

    /*}}}*/
    /* OVER [top left bottom right] {{{*/
    let over_top    = (container_rect.top    < view_rect.top   );
    let over_left   = (container_rect.left   < view_rect.left  );
    let over_bottom = (container_rect.bottom > view_rect.bottom);
    let over_right  = (container_rect.right  > view_rect.right );

    let may_go_left = (container_rect.right  < window.innerWidth); /* i.e. still visible with no left margin */
    /*}}}*/
/*{{{
console_clear(caller)
logXXX(caller+"("+ get_n_lbl(container)+"):");
if(over_top   ) logXXX("over_top"   );
if(over_left  ) logXXX("over_left"  );
if(over_right ) logXXX("over_right" );
if(over_bottom) logXXX("over_bottom");
logXXX("may_go_left=["+may_go_left+"]");

console.dir(container)
console.dir(document.documentElement)
logXXX(".....view_rect=["+JSON.stringify(view_rect)+"]");
logXXX(".....container_rect=["+JSON.stringify(container_rect)+"]");
}}}*/
    /* scrollX scrollY {{{*/
    let scrollX
        = (over_left  ) ? container_rect.left                         - (with_margin ? VIEWPORT_MARGIN.left   : 16)
        : (over_right ) ? container_rect.right   - window.innerWidth  + (with_margin ? VIEWPORT_MARGIN.right  : 32)
        : may_go_left   ?                          0
        :                                          window.scrollX;

    let scrollY
        = (over_top    ) ? container_rect.top                         - (with_margin ? VIEWPORT_MARGIN.top    : 16)
        : (over_bottom ) ? container_rect.bottom - window.innerHeight + (with_margin ? VIEWPORT_MARGIN.bottom : 32)
        :                                          window.scrollY;

    /*}}}*/
    return { x : scrollX , y : scrollY };
};
/*}}}*/
/*}}}*/

/* SLOT SEEK */
/*{{{*/
/*_ t_seek_slot_num_SELECT_EL {{{*/
let t_seek_slot_num_SELECT_EL = function(el)
{
let caller = "t_seek_slot_num_SELECT_EL";
/*{{{
logBIG(caller+"("+get_n_lbl(el)+")", lf1);
}}}*/
    /* [slot] {{{*/
/*  let slot = get_slot_from_id_or_className(el); */
    let slot = t_get_EL_slot(el);
/*{{{
logXXX("...slot=["+ slot +"]");
}}}*/

    if(!slot) return false;
    if(!ccs[slot]) {
logBIG(caller+": SLOT #"+slot+" NOT CURRENLTY INITIALIZED");
    if(t_preventDefault_caller) t_restoreDefault("NOT CURRENLTY INITIALIZED");
/*{{{
}}}*/
        return;
    }
    /*}}}*/
    /* [num] {{{*/
/*  let num = get_num_from_id_or_className_slot(el, slot); */
    let num = t_get_EL_num (el);
/*{{{
logXXX("....num=["+ num  +"]");
}}}*/

    if(!num ) return false;
    /*}}}*/
    /* [seeker_PU] .. CSS_SEEK3_ONJUMPEL {{{*/
    add_el_class(seeker_PU, CSS_SEEK3_ONJUMPEL);

    /*}}}*/
    /* SET ccs[to_slot].num_selected {{{*/
    t_seek_slot_num_SELECT_SLOT_NUM(slot, num);

    t_seeker_move_on_slot_num   (slot, num);

    /*}}}*/
    /* CONTAINER {{{*/
    let container =  get_slot_num_container(slot, num);
    t_seek_set_container_selected(container, caller);

    /*}}}*/
    /* CLEAR WINDOW SELECTION SEEKER {{{*/
    t_window_getSelection_removeAllRanges(caller);

    /*}}}*/
    return true;
};
/*}}}*/
/*_ t_seek_slot_num_SELECT_SLOT_NUM {{{*/
let t_seek_slot_num_SELECT_SLOT_NUM = function(to_slot, to_num)
{
let caller = "t_seek_slot_num_SELECT_SLOT_NUM";
/*{{{
logBIG(caller+"("+to_slot+", "+to_num+")", lf2);
}}}*/
    /* unhighlight current to_slot {{{*/
    let num_selected = ccs[to_slot].num_selected;
    if( num_selected > 0)
        del_el_class(ccs[to_slot].nodes[num_selected-1], CSS_NUM_SELECTED);

    /*}}}*/
    /* highlight selected to_slot {{{*/
    if( to_num > 0) {
        ccs[to_slot].num_selected     = to_num;
        add_el_class(ccs[to_slot].nodes[to_num-1], CSS_NUM_SELECTED);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_seek_slot_num_JUMP_FROM_TO {{{*/
let t_seek_slot_num_JUMP_FROM_TO = function(from_slot, from_num, to_slot, to_num)
{
let caller = "t_seek_slot_num_JUMP_FROM_TO";
/*{{{
logBIG(caller+"(FROM ["+from_slot+" "+from_num+"] TO ["+to_slot+" "+to_num+"]", lf3);
}}}*/
    /* unhighlight current from_slot {{{*/
    let num_selected = ccs[from_slot].num_selected;
    if( num_selected > 0)
        del_el_class(ccs[from_slot].nodes[num_selected-1], CSS_NUM_SELECTED);

    /*}}}*/
    /* highlight abandonned from_slot {{{*/
    if(from_num > 0) {
        add_el_class(ccs[from_slot].nodes[from_num-1], CSS_NUM_SELECTED);
        ccs[from_slot].num_selected     = from_num;
    }

    /*}}}*/
    /* unhighlight landing to_slot {{{*/
    if( to_num > 0)
        del_el_class(ccs[  to_slot].nodes[  to_num-1], CSS_NUM_SELECTED);

    /*}}}*/
};
/*}}}*/
/*_ t_seek_slot_num_CLEAR_SELECTED {{{*/
let t_seek_slot_num_CLEAR_SELECTED = function(_caller)
{
let caller = "t_seek_slot_num_CLEAR_SELECTED";
/*{{{
logBIG(caller+" .. CALLED BY "+_caller, lf4);
}}}*/
    /* del CSS_NUM_SELECTED {{{*/
    for(let slot = 1; slot < ccs.length; ++slot)
    {
        if(               !ccs[slot]) continue;
        let num_selected = ccs[slot].num_selected;
        if( num_selected > 0)
            del_el_class(ccs[slot].nodes[num_selected-1], CSS_NUM_SELECTED);
    }
    /*}}}*/
};
/*}}}*/
/*}}}*/
/* SLOT THUMB */
/*{{{*/
/*_ is_a_thumb_el {{{ */
let is_a_thumb_el = function(node)
{
    let caller = "is_a_thumb_el("+get_n_lbl(node)+")";

    let result
        =  node.id.startsWith("thumb_p_")
        || node.id.startsWith("thumb_s_")
        ;

if(result && logging_EVENTS) log(caller+": ...return "+result);
    return result;
};
/* }}} */

/*_ get_num_from_id_or_className_slot  {{{*/
let get_num_from_id_or_className_slot  = function(node, slot)
{
let   caller = "get_num_from_id_or_className_slot(node.id=["+node.id+"], slot=["+slot+"])";
let log_this = LOG_MAP.T6_SLOT;

    let num = 0;

    /* thumb_p_4_95 */
    /* thumb_s_4_95 */
    /* class_s_4_95 */
    /* 012345678901 */
    /* select4_95   */
    if     ((pfx = "thumb_p_"+slot+"_") && node.id       .startsWith(pfx)) num = parseInt( node.id       .substring(pfx.length) );
    else if((pfx = "thumb_s_"+slot+"_") && node.id       .startsWith(pfx)) num = parseInt( node.id       .substring(pfx.length) );
    else if((pfx = "class_s_"+slot+"_") && node.className.startsWith(pfx)) num = parseInt( node.className.substring(pfx.length) );
    else if((pfx =   "select"+slot+"_") && node.id       .startsWith(pfx)) num = parseInt( node.id       .substring(pfx.length) );

if( log_this) log(caller+": ...return "+((num != 0) ? num : "NOT A SLOT NUM"));
    return num;
};
/*}}}*/
/*_ get_slot_from_id_or_className  {{{*/
let get_slot_from_id_or_className  = function(node)
{
let   caller = "get_slot_from_id_or_className("+ get_n_lbl(node) +" id=["+node.id+"] node.class=["+node.className+"])";
let log_this = LOG_MAP.T6_SLOT;

    let slot   = -1;

    /* ID thumb_p_4_95 */
    /* ID thumb_s_4_95 */
    /* ...012345678... */
    if(      node.id       .startsWith("thumb_p_") ) { slot = parseInt( node.id       .substring(8) ); }
    else if( node.id       .startsWith("thumb_s_") ) { slot = parseInt( node.id       .substring(8) ); }
    else if( node.className.startsWith("class_s_") ) { slot = parseInt( node.className.substring(8) ); }
    /* CLASS select4 */
    /* ......0123456 */
    else {
        if(!node.className.startsWith( "select" ) && node.parentElement) node = node.parentElement;
        if( node.className.startsWith( "select" ) ) {
            slot = parseInt(node.className.substring(6));
        }
    }

    let last_highlight_slot = s_get_last_highlight_slot();
    if(slot <= 0)
        slot = last_highlight_slot;

    slot = ((slot >= 0              )
        &&  (slot <  SELECT_SLOT_MAX))
        ?    slot
        :    last_highlight_slot
    ;

if( log_this) log(caller+": ...return "+((slot != 0) ? slot : "NOT A SLOT"));
    return slot;
};
/*}}}*/

/*_ t_get_onWork_EL_num {{{*/
let t_get_onWork_EL_num = function()
{
    if(!onWork_SEEK_TOOL) return 0;

    let num
        = (      (onWork_EL == seeker_PU)
            ||   (onWork_EL == seeker_CU)
            ||   (onWork_EL.id.startsWith("seekzone"))
            ||   (onWork_EL.id.startsWith("thumb_p_"))
        )
        ?      last_highlight_num
        :      t_get_EL_num (onWork_EL, 0);

/*
logXXX("t_get_EL_num("+get_n_lbl(onWork_EL)+"): ...return ["+num +"] .. last_highlight_num=["+last_highlight_num+"]")
*/
    return num;
};
/*}}}*/
/*_ t_get_onWork_EL_container {{{*/
let t_get_onWork_EL_container = function()
{
    let slot = t_get_EL_slot(onWork_EL); if(!slot) return null;
    let num  = t_get_onWork_EL_num() ; if(!num ) return null;

    let container = ccs[slot].containers[num-1];
log("t_get_onWork_EL_container("+get_n_lbl(onWork_EL)+"): ...return ["+get_id_or_tag(container)+" "+get_n_txt(container) +"]");
    return container;
};
/*}}}*/
/*_ t_get_EL_slot {{{*/
let t_get_EL_slot = function(el)
{
/*{{{*/
let caller = "t_get_EL_slot";
let log_this = LOG_MAP.T6_SLOT;

/*}}}*/
    let slot = -1;
    if(!el) return slot;
    if((el == seeker_PU) || (el == seeker_CU) || (el.id.startsWith("seekzone")))
    {
        slot = s_get_last_highlight_slot();
    }
    else {

        let offset                                  /* 01234567890 */
            = el.id.startsWith("select"    ) ?  6   /* select5_0   */
            : el.id.startsWith("thumb_p_"  ) ?  8   /* thumb_p_5   */
            : el.id.startsWith("thumb_s_"  ) ?  8   /* thumb_s_5   */
            :                                   0
        ;

        let ccX = parseInt( el.id.substring(offset) );
        slot
            = isNaN(ccX    ) ?   0  /* not found     */
            :      (ccX > 0) ? ccX  /*  ccX=[1..9,0] */
            :                   10; /* slot=[1...10] */

    }

if( log_this) log(caller+"("+get_n_lbl(el)+"): ...return ["+slot+"]");
    return slot;
};
/*}}}*/
/*_ t_get_EL_num {{{*/
let t_get_EL_num = function(el, num_default=0)
{
    let offset                                /* 01234567890 */
        = el.id.startsWith("select"    ) ?  8 /* select5_4   */
        : el.id.startsWith("thumb_p_"  ) ? 10 /* thumb_p_5_4 */
        : el.id.startsWith("thumb_s_"  ) ? 10 /* thumb_s_5_4 */
        :                                   0
    ;

    let num = parseInt( el.id.substring(offset) );

    if( isNaN(num) ) num = num_default;

/*
log("t_get_EL_num("+get_n_lbl(el)+"): ...return ["+num +"]");
*/
    return num;
};
/*}}}*/
/*_ t_get_used_slot_dir {{{*/
let t_get_used_slot_dir = function(from_slot, dir)
{
    let slot = from_slot; /* [1..10] */
    for(let step = 1; step <= SELECT_SLOT_MAX; ++step)
    {
        slot = (SELECT_SLOT_MAX + slot + dir) % SELECT_SLOT_MAX;

        if(slot == 0) slot = 10;

        if(ccs[slot] && (ccs[slot].nodes.length > 0)) break;
    }
/*
log("t_get_used_slot_dir("+from_slot+", "+dir+"): ...return "+slot+"");
*/
    return slot;
};
/*}}}*/

/*_ t_clear_slot {{{*/
let t_clear_slot = function(slot)
{
/*{{{*/
let   caller = "t_clear_slot("+slot+")";
let log_this = LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/
    if( logging_something() )
        t_log_transcript_event_bot( "<em class='big'>CLEAR CLICKED SLOT #"+slot+" .. onWork_EL.id=["+onWork_EL.id+"]</em>");

    clear_slot(slot);
    t_onPatternUpdate("CLEARING SLOT <em>"+ slot +"</em>", caller);

    if( prop_get( WORDS_OPCYCLE ) )
    {
if( log_this) log("...words_opcycle POSTING cycle_on_last_cleared_pattern");

        setTimeout(cycle_on_last_cleared_pattern, PATTERN_CYCLE_DELAY);
    }
};
/*}}}*/
/*_ t_clear_slot_sync {{{*/
/*{{{*/
const T_CLEAR_SLOT_SYNC_DELAY            = 500;
let   t_clear_slot_sync_timer            = null;
let   t_clear_slot_sync_cleared_patterns = "";

/*}}}*/
let t_clear_slot_sync = function(slot, pattern, delay=T_CLEAR_SLOT_SYNC_DELAY)
{
    /*{{{*/
    let caller   = "t_clear_slot_sync("+slot+", pattern=["+pattern+"])";
let log_this = LOG_MAP.T6_SLOT;
if( log_this) log("%c "+caller,lb6);

    /*}}}*/
    /* clearTimeout {{{*/
    if(t_clear_slot_sync_timer) {
        clearTimeout( t_clear_slot_sync_timer );
        /*.........*/ t_clear_slot_sync_timer = null;

        if( delay ) {
            delay += 2 * T_CLEAR_SLOT_SYNC_DELAY;
        }
    }

    /*}}}*/

    if((onWork_EL) && (slot == t_get_EL_slot(onWork_EL)))
    {
        t_set_onWork_EL(null, caller);

if( log_this) t_log_event_status(caller, lbb+lf6);
    }

    csv_move_pattern_to_off( pattern );
    t_clear_slot_sync_cleared_patterns += " "+pattern;

    t_clear_slot_sync_timer = setTimeout(t_clear_slot_sync_handler, T_CLEAR_SLOT_SYNC_DELAY);
};
/*}}}*/
/*_ t_clear_slot_sync_handler {{{*/
let t_clear_slot_sync_handler = function()
{
    /*{{{*/
    let caller   = "t_clear_slot_sync_handler: patterns=["+t_clear_slot_sync_cleared_patterns+"]";
let log_this = LOG_MAP.T6_SLOT;
if( log_this) log("%c "+caller,lb6);

    /*}}}*/
    t_clear_slot_sync_timer = null;
/*
     if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) t_fly_pat_off_bak_bin_csv("SOME CLEARED", "want");
*/
    t_onPatternUpdate_no_delay("SOME CLEARED <em class='cc8'>"+ ellipsis_short(t_clear_slot_sync_cleared_patterns) +"</em>", caller);

    t_clear_slot_sync_cleared_patterns = "";
};
/*}}}*/
/*_ cycle_on_last_cleared_pattern {{{*/
const PATTERN_CYCLE_DELAY = 200;

let cycle_on_last_cleared_pattern = function()
{
    let caller = "cycle_on_last_cleared_pattern";
let log_this = LOG_MAP.S2_SELECT;

if(log_this) log(caller+": last_cleared_pattern=["+last_cleared_pattern+"]");

    if( !last_cleared_pattern ) return;

    let next_option
        = prop_get( WORDS_EXACT  ) ? WORDS_SEGMENT
        : prop_get( WORDS_SEGMENT) ? WORDS_HEAD_TAIL
        :                            WORDS_EXACT
    ;
if(log_this) log("...next_option=["+next_option+"]");

    sync_words_opcycle_button( next_option );

    prop_set(next_option, true);

    if(next_option == WORDS_EXACT)
    {
        t_clear( caller );
if(log_this) log_set_TR_SELECT("<em class='big'>CYCLE BACK TO WORDS OPTION "+ t_get_words_options_symbol(next_option)+"</em>");

        t_sync_styles(caller);

        t_store5_save_page_wording();

/*{{{
        if( tools_filter_input ) t_focus( tools_filter_input );
}}}*/

        t_words_regex_log("...");

        return
    }

    if( t_preventDefault_caller )
        t_restoreDefault("WORDING CYCLE");

    t1_prop_id_toggle(next_option);
};
/*}}}*/
/*_ t_get_words_options_symbol {{{*/
let WORDS_EXACT_SYMBOL       = "<em class='cc3'>&equiv;</em>";
let WORDS_SEGMENT_SYMBOL     = "<em class='cc4'>&sub;</em>"  ;
let WORDS_HEAD_TAIL_SYMBOL   = "<em class='cc5'>&isin;</em>" ;
let WORDS_OPCYCLE_SYMBOL     = "<em class='cc9'>\u27F3</em>" ;

let t_get_words_options_symbol = function(option)
{
    switch( option) {
        case WORDS_EXACT     : return WORDS_EXACT_SYMBOL     ;
        case WORDS_SEGMENT   : return WORDS_SEGMENT_SYMBOL   ;
        case WORDS_HEAD_TAIL : return WORDS_HEAD_TAIL_SYMBOL ;
        default              : return "*** WRONG WORDS OPTION ***";
    }
};
/*}}}*/

/*_ sync_words_opcycle_button {{{*/
let sync_words_opcycle_button = function(words_options)
{
    let el = prop_get_EL( WORDS_OPCYCLE );
    switch(words_options)
    {
        case WORDS_EXACT:
        add_el_class(el, WORDS_EXACT    );
        del_el_class(el, WORDS_SEGMENT  );
        del_el_class(el, WORDS_HEAD_TAIL);
        break;

        case WORDS_SEGMENT:
        del_el_class(el, WORDS_EXACT    );
        add_el_class(el, WORDS_SEGMENT  );
        del_el_class(el, WORDS_HEAD_TAIL);
        break;

        case WORDS_HEAD_TAIL:
        del_el_class(el, WORDS_EXACT    );
        del_el_class(el, WORDS_SEGMENT  );
        add_el_class(el, WORDS_HEAD_TAIL);
        break;
    }
};
/*}}}*/

/*}}}*/

/** ANIM */
/*{{{*/
/* PULSE {{{*/
/*_ {{{*/
let PULSE_BLACKLIST_ID_CSV = "tools_node";
const PULSE_IN_DURATION    = 500;
const PULSE_OUT_DURATION   = 500;

let pulsing_id     = "";
let pulsing_id_csv = "";

/*}}}*/
/*_ pulse_id {{{*/
let pulse_id = function(id)
{
    let caller = "pulse_id("+id+")";
if(LOG_MAP.T3_LAYOUT) log(caller);
/*{{{
console.warn(caller);
}}}*/
    if( csv_contains(PULSE_BLACKLIST_ID_CSV, id) ) {
if(LOG_MAP.T3_LAYOUT) log("...IGNORING BLACKLISTED ID");
        return;
    }
    let el;
    el     = get_tool(id);

    if(!el) id = pulse_id_get_alias(id);
    if(!id) return;

if(LOG_MAP.T3_LAYOUT) log(".id_alias=["+id+"]");
    el     = get_tool(id);

    if(!el ) return;
    if(id == pulsing_id) return; /* grouping */

    pulsing_id_csv = csv_add(pulsing_id_csv, id);
/*{{{
csv_log(pulsing_id_csv);
}}}*/

    pulse_id_start();

};
/*}}}*/
/*_ pulse_id_get_alias {{{*/
let pulse_id_get_alias = function(id)
{
    switch(id) {
        default              : return "";
        case       "bag_rot" : return "pat_bag";
        case       "pat_csv" : return "pat_bag";
        case  "tools_filter" : return "sel_bag";
        case     "topTool_XY": return "headsup";
        case "tools_scrollY" : return "thumb_p";
    }
};
/*}}}*/
/*_ pulse_id_start {{{*/
/*{{{*/
const PULSE_START_DELAY = 1000;
let   pulse_id_timer    = null;

/*}}}*/
let pulse_id_start = function()
{
    if(pulse_id_timer) {
        clearTimeout( pulse_id_timer );
        /*.........*/ pulse_id_timer = null;
    }

    set_el_class_on_off(hotwave, CSS_PULSING, true);

    if(!pulsing_id) pulse_id_timer = setTimeout(pulse_id_next_handler, PULSE_START_DELAY);
};
/*}}}*/
/*_ pulse_id_next_handler {{{*/
/*{{{*/
let HOTSPOT_HTML_IDLE       = "\u00BB;";
/*}}}*/
let pulse_id_next_handler = function()
{
    pulsing_id = csv_get(pulsing_id_csv, 1);
    if(!pulsing_id) {
        pulse_id_timer = null; /* done */
        set_el_class_on_off(hotwave, CSS_PULSING, false);
t_fly(HOTSPOT_HTML_IDLE);
        return;
    }
    else {
        let count = csv_count(pulsing_id_csv);
t_fly("<em class='cc"+count+"'>"+pulsing_id+"</em>");
    }

/*{{{
csv_log(pulsing_id_csv);
}}}*/
if(LOG_MAP.T3_LAYOUT) log(".pulse_id_next_handler: .. pulsing_id=["+pulsing_id+"]");

    pulsing_id_csv = csv_del(pulsing_id_csv, pulsing_id);

    set_id_class_on_off(pulsing_id, "pulse_in" , true );

    setTimeout(pulse_id_out_handler, PULSE_IN_DURATION);
};
/*}}}*/
/*_ pulse_id_out_handler {{{*/
let pulse_id_out_handler  = function()
{
    if(!pulsing_id) return;
if(LOG_MAP.T3_LAYOUT) log("..pulse_id_out_handler: pulsing_id=["+pulsing_id+"]");

    set_id_class_on_off(pulsing_id, "pulse_in"    , false);
    set_id_class_on_off(pulsing_id, "pulse_id_out", true );

    setTimeout(pulse_id_done_handler, PULSE_OUT_DURATION);
};
/*}}}*/
/*_ pulse_id_done_handler {{{*/
let pulse_id_done_handler = function()
{
    if(!pulsing_id) return;
if(LOG_MAP.T3_LAYOUT) log("...pulse_id_done_handler: pulsing_id=["+pulsing_id+"]");

    set_id_class_on_off(pulsing_id, "pulse_id_out", false);

    pulse_id_next_handler();
};
/*}}}*/
/*}}}*/
/* MOVE COOLDOWN {{{*/
/*_ move_cooldown_start {{{*/
/*{{{*/
const MOVE_COOLDOWN_DURATION =  500;
const MOVE_COOLDOWN_SHORT    =  100;
let   move_cooldown_timer    = null;

/*}}}*/
let move_cooldown_short = function() { move_cooldown_start( MOVE_COOLDOWN_SHORT ); };
let move_cooldown_start = function(delay=MOVE_COOLDOWN_DURATION)
{
/*{{{
logBIG("COOLDOWN START ("+delay+")", lbH+lfX[delay/100 % 10]);
}}}*/

    if(move_cooldown_timer) clearTimeout(move_cooldown_timer);
    move_cooldown_timer   =   setTimeout(move_cooldown_handler, delay);

    add_el_class(seeker_PU, CSS_ON_COOLDOWN);
};
/*}}}*/
/*_ move_cooldown_handler {{{*/
let move_cooldown_handler = function()
{
/*{{{
logBIG("COOLDOWN END", lbH+lf8);
}}}*/
/*{{{
    if(!seeker_PU) return;
}}}*/

    move_cooldown_timer = null; /* done */
    t_clr_has_moved("move_cooldown_handler");

    del_el_class(seeker_PU, CSS_ON_COOLDOWN);
};
/*}}}*/
/*_ move_cooldown_is_pending {{{*/
let move_cooldown_is_pending = function()
{
    return (move_cooldown_timer != null);
};
/*}}}*/
/*_ move_cooldown_clear_pending {{{*/
let move_cooldown_clear_pending = function()
{
    if(move_cooldown_timer) clearTimeout(move_cooldown_timer);
    move_cooldown_timer = null;
};
/*}}}*/
/*}}}*/
/*XXX*/
/* SEEKER FEEDBACK {{{*/
/*_ t_check_on_seeker_move {{{*/
let t_check_on_seeker_move = function(dx, dy, d_min)
{
/* NO [slot] [num] {{{*/
let caller = "t_check_on_seeker_move";
let log_this = LOG_MAP.S2_SELECT;

    if(!onWork_SEEK_TOOL) return;
    if(!seeker_CU       ) return;

    let slot =  t_get_EL_slot(onWork_EL);
    let  num =  t_get_onWork_EL_num ();

if(log_this) log(caller+": slot=["+slot+"] num=["+ num+"]");
    if(slot <= 0) return;
    if(num  <= 0) return;
/*}}}*/

    t_check_on_seeker_update(dx, dy, d_min, slot, num);
};
/*}}}*/
/*_ t_check_on_seeker_update {{{*/
let t_check_on_seeker_update = function(dx, dy, d_min, slot, num)
{
/*{{{*/
let   caller = "t_check_on_seeker_update(slot "+slot+")";
let log_this = LOG_MAP.T6_SLOT;

/*}}}*/
/*{{{
logXXX(caller+": ...css.length=["+ccs.length+"]");
}}}*/
    if(!ccs[slot]) return;
    /* SEEKER DISPLAY SLOT [NUM AND NUM MAX] {{{*/
    seeker_CU.innerHTML        = num +"<sup>/"+ ccs[slot].nodes.length+"</sup>";

    /*}}}*/
    /* SEEKER STRETCH .. (in dead zone) {{{*/
/*
    let dx_ratio               = 0.01 * dx / d_min;
    let dy_ratio               = 0.01 * dy / d_min;
    seeker_PU.style.marginLeft = (seeker_PU.offsetWidth  * dx_ratio)+"px";
    seeker_PU.style.marginTop  = (seeker_PU.offsetHeight * dy_ratio)+"px";
*/
    /*}}}*/
    /* SEEKER CSS DIR .. f(Up Right Down Left) {{{*/
    let  dir = (Math.abs(onMoveDXY.x) > Math.abs(onMoveDXY.y)) ? ((onMoveDXY.x > 0) ? MOVE_SLOT_NEXT : MOVE_SLOT_PREV)
        :                                                        ((onMoveDXY.y > 0) ? MOVE_NUM_NEXT  : MOVE_NUM_PREV );
if( log_this) log(caller+"("+slot+"): ...dir %c"+ dir, lbb+lbH+lf7);

    t_check_on_seeker_PU_look_dir( dir );
    /*}}}*/
    /* SEEKER CSS COLOR .. f(slot prev next) {{{*/
    /* LOOK AHEAD COLOR
     * 1/2 ON-SLOT   UP-DOWN  .. NUM  +/-
     * 2/2 TO-SLOT LEFT-RIGHT .. SLOT +/-
     */

    for(let i = 1; i <= SELECT_SLOT_MAX; ++i)
        set_id_class_on_off(seeker_PU.id, "slot_color"+i, false);

    let slot_color = slot;
    if((dir == MOVE_SLOT_PREV) || (dir == MOVE_SLOT_NEXT))
    {
        let pre_or_next_slot
            = (dir == MOVE_SLOT_PREV)
            ?  get_prev_populated_slot( slot )
            :  get_next_populated_slot( slot );
if( log_this) log(caller+"("+slot+"): ...pre_or_next_slot %c"+ pre_or_next_slot, lbb+lbH+((dir == MOVE_SLOT_PREV) ? lf5 : lf4));

        if(pre_or_next_slot)
            slot_color = pre_or_next_slot;
    }
    set_id_class_on_off(seeker_PU.id, "slot_color"+slot_color, true);
    set_el_class_on_off(seeker_PU,  SHOW_SEEKZONE , prop_get( SHOW_SEEKZONE ));
    /*}}}*/
};
/*}}}*/
/*_ t_check_on_seeker_PU_look_dir {{{*/
let t_check_on_seeker_PU_look_dir = function( dir )
{
    /* URDL */
    set_id_class_on_off(seeker_PU.id, CSS_SEEKER_PU2_LOOK_UP   , (dir == MOVE_NUM_PREV ));
    set_id_class_on_off(seeker_PU.id, CSS_SEEKER_PU3_LOOK_RIGHT, (dir == MOVE_SLOT_NEXT));
    set_id_class_on_off(seeker_PU.id, CSS_SEEKER_PU4_LOOK_DOWN , (dir == MOVE_NUM_NEXT ));
    set_id_class_on_off(seeker_PU.id, CSS_SEEKER_PU5_LOOK_LEFT , (dir == MOVE_SLOT_PREV));
};
/*}}}*/
/*_ t_check_on_seeker_clear {{{*/
let t_check_on_seeker_clear = function()
{
    if(!seeker_PU) return;

    seeker_PU.style.marginLeft = 0;
    seeker_PU.style.marginTop  = 0;

    t_check_on_seeker_PU_look_dir(null);
};
/*}}}*/
/*}}}*/
/*}}}*/

/** LOG */
/*{{{*/
/* LOG STATE {{{*/
/*_ t_log_set_state {{{*/
/*{{{*/
let div_ccX = 0;

/*}}}*/
let t_log_set_state = function(state)
{
    if(!fly_log) return;

    /* [LOGGING OPTION] takes precedence */
    if(LOG_MAP.EV8_FLOATLOG) state = true;

    if(LOG_MAP.EV8_FLOATLOG) add_el_class(fly_log, CSS_DISABLED);
    else                     del_el_class(fly_log, CSS_DISABLED);

    /* UI button .. (distinct [DISPLAY] and [LOGGING] symbol) */
    fly_log.innerHTML =  state ? (LOG_MAP.EV8_FLOATLOG ? SYMBOL_GEAR : SYMBOL_CHECK_MARK) : SYMBOL_MENU;

    set_id_class_on_off(fly_log.id, CSS_CHECKED , state);

    /* TOOLS UI */
    set_el_class_on_off(fly_div   , CSS_FLOATLOG, state);

    /* TOOLS BEHAVIOR */
    fly_log_checked      = state;
    div_ccX              = 0;

    /* CLEAR [fly_div] */
    t_fly_set("");
};
/*}}}*/
/*_ t_fly_div_magnified_toggle {{{*/
let t_fly_div_magnified_toggle = function(new_state="toggle")
{
/*{{{*/
let   caller = "t_fly_div_magnified_toggle("+new_state+")";
let log_this = (LOG_MAP.EV4_LONG_PRESS || LOG_MAP.T3_LAYOUT);

if( log_this) t_log_event_status(caller, lf9);
/*}}}*/
    prop_set( FLY_DIV_MAGNIFIED , new_state);

    /* switch from [LOAD-TIME-LAYOUT] to [USER-POSITIONING] */
    if(new_state == "toggle")
    {
        fly_div.style.right = "unset";

        let dx = onDown_XY.x - onDown_PANEL_XY.x;
        let dy = onDown_XY.y - onDown_PANEL_XY.y;
        fly_div.style.transformOrigin = dx+"px  "+dy+"px";
    }

    new_state = (new_state == "toggle") ? !has_el_class(fly_div, CSS_MAGNIFIED) : new_state ;
if(log_this) log("...new_state=["+new_state+"]");

    if( new_state ) add_el_class(fly_div, CSS_MAGNIFIED);
    else            del_el_class(fly_div, CSS_MAGNIFIED);

    t_store_update_post("fly_div_magnified "+new_state);

if(log_this) log(caller+": fly_div_magnified: %c "+new_state+" ", (new_state ? lb9 : lb8));
};
/*}}}*/
/*_ t_log_onlayout {{{*/
let t_log_onlayout = function(_caller)
{

    if(!fly_div) return;

    t_fly_div_magnified_toggle( false );

    let xy = store_parseXY("fly_div_XY");
/*{{{
logBIG("t_log_onlayout: store_parseXY('fly_div_XY')=["+xy+"]", lf5);
}}}*/
    if( xy ) {
        fly_div.style.left = xy.x+"px";
        fly_div.style.top  = xy.y+"px";
    }

    /* TOP-LEFT WITHIN 80% */
    if((fly_div.offsetLeft < 0) || (fly_div.offsetLeft > (w_W * 0.8))) fly_div.style.left = "30%"   ;
    if((fly_div.offsetTop  < 0) || (fly_div.offsetTop  > (w_H * 0.8))) fly_div.style.top  = "1em"   ;
};
/*}}}*/
/*_ t_log_onchange {{{*/
let t_log_onchange = function()
{
    if(   fly_div.innerHTML ) {
        add_el_class(fly_div, CSS_PAUSE_ANIMATION    );
        add_el_class(fly_div, CSS_STACKING           );
        t_fly_clr();                                    /* schedule a cleanup */
    }
    else {
        del_el_class(fly_div, CSS_PAUSE_ANIMATION    );
        del_el_class(fly_div, CSS_STACKING           );
        t_del_pin_css_on_panel(fly_div, CSS_CLOSEPIN); /* remove close pin */
    }
};
/*}}}*/
/*}}}*/
/* SEEKZONE LOG {{{*/
/*{{{*/
const HIDE_SEEKZONE_DELAY = 1000;
const CSS_LONGPRESS             = "longpress";
const CSS_MISCLICK              = "misclick";
const CSS_DBLCLICK              = "dblclick";
const CSS_MISCLICK1             = "misclick1";
const CSS_MISCLICK2             = "misclick2";
const CSS_MISCLICK3             = "misclick3";
const CSS_SEEKZONE_ARRAY
    = [   CSS_LONGPRESS
        , CSS_MISCLICK
        , CSS_DBLCLICK
        , CSS_MISCLICK1
        , CSS_MISCLICK2
        , CSS_MISCLICK3
    ];

let t_hide_seekzone_timer;
/*}}}*/
/*  t_seekzone1_show_onDown {{{*/
let t_seekzone1_show_onDown = function()
{
    let container_symbol
        = container_selected
        ? container_selected.tagName+" "+ SYMBOL_HEAVY_RIGHT_ARROW+" "
        : ""
    ;

    let container_msg
        = get_n_txt(onWork_EL) +" "+SYMBOL_BLACK_CIRCLE+" "+get_n_lbl(onWork_EL)
    ;

    let sym;
    let msg;
    switch( onSeekXYL.label )
    {
        case CSS_SEEK1_ONSLOTEL : { sym = SYMBOL_BLACK_R_HAND ; msg = "SEEK SLOT #"+t_get_EL_slot(onWork_EL); } break;
        case CSS_SEEK3_ONJUMPEL : { sym = "ON"                ; msg = get_id_or_tag(onWork_EL)              ; } break;
        case CSS_SEEK5_ONTARGET : { sym = "ON"                ; msg = get_id_or_tag(onWork_EL)              ; } break;
        case CSS_SEEK4_ONSEEKER : { sym = container_symbol    ; msg = container_msg                         ; } break;
        case CSS_SEEK2_ONRESUME : { sym = SYMBOL_GEAR         ; msg = "RESUME"                              ; } break;
        case CSS_SEEK0_ONDOC    : { sym = SYMBOL_BLACK_R_HAND ; msg = "SEEK DOC"                            ; } break;
        default                 : { sym = SYMBOL_CIRCLE       ; msg = onSeekXYL.label || "NOT SEEKING"      ; } break;
    }

    t_seekzone1_show(sym +" "+ msg);
};
/*}}}*/
/*  t_seekzone1_show {{{*/
/*{{{*/
const SEEKSPOT_SPACING        =  2;
const SEEKSPOT_H_MIN          = 32;
const SEEKSPOT_W_MIN          = 32;
const SHOW_SEEKZONE_DELAY     = 500;
const SYMBOL_SEEK_SPOT        = SYMBOL_UP_ARROW;

let   seekspot_caption;
let t_seekzone1_show_msg      = [];
let t_seekzone1_show_msg_last = "";
let t_seekzone1_show_msg_num  = 0;
let t_seekzone1_show_timeout  = 0;

/*}}}*/
let t_seekzone1_show = function(msg="")
{
/*{{{*/
let caller = "t_seekzone1_show";
let log_this = LOG_MAP.EV3_UP;

/*}}}*/
    /* QUEUE SHOW_SEEKZONE MSG {{{*/
    if( prop_get( SHOW_SEEKZONE ) )
    {
        if(prop_get( LOG_SEEKSPOT ) && msg && (t_seekzone1_show_msg_last != msg))
        {
if( log_this) log("%c"+caller+"("+msg+")", lbH+lf1);

            t_seekzone1_show_msg.push(    msg );
            t_seekzone1_show_msg_last  =  msg;
        }
        if(!t_seekzone1_show_timeout && t_seekzone1_show_msg.length)
            t_seekzone1_show_timeout = setTimeout(t_seekzone1_show_handler, SHOW_SEEKZONE_DELAY);
    }
    /*}}}*/
    /* OR CLEANUP MSG HISTORY {{{*/
    else {
        /* HISTORY CLEANUP {{{*/
        if(t_seekzone1_show_msg.length)
        {
if( log_this) log("%c"+caller+"("+msg+"): LOG_SEEKSPOT OFF .. HISTORY CLEANUP", lbH+lf1);
            t_seekzone1_show_msg     = [];
            t_seekzone1_show_msg_num = 0;
        }
        /*}}}*/
        /* SEEKERS CLEANUP {{{*/
        if(seekspot_U.innerHTML || seekspot_D.innerHTML)
        {
            seekspot_U.innerHTML     = "";
            seekspot_D.innerHTML     = "";
        }
        /*}}}*/
    }
    /*}}}*/
};
/*}}}*/
/*_ t_seekzone1_show_handler {{{*/
let t_seekzone1_show_handler = function()
{
/*{{{*/
let   caller = "t_seekzone1_show_handler";
let log_this = LOG_MAP.EV3_UP || LOG_MAP.T6_SLOT;

if( log_this) t_log_event_status(caller, lf8);
if( log_this) log("%c"+SYMBOL_BULB+"%c "+caller+"%c container_selected %c "+ get_id_or_tag(container_selected)+"%c onSeekXYL %c "+onSeekXYL.x+" "+onSeekXYL.y
                  ,lb2             ,lbL         ,lbL                  ,lbR+lf4                                 ,lbL         ,lbR+lf4                         );

    t_seekzone1_show_timeout = null;
/*}}}*/
    if(!prop_get( SHOW_SEEKZONE ) ) {
if( log_this) logBIG("aborted by prop_get(SHOW_SEEKZONE)");
        return;
    }
    /* clear pending hide {{{*/
    if(t_hide_seekzone_timer   ) { clearTimeout(t_hide_seekzone_timer); t_hide_seekzone_timer = null; }

    /*}}}*/
    /* clear previous seek visual feedback {{{*/
/*{{{
    if(container_selected      ) t_seekzone8_clear_feedback();
    if(onWork_EL == target_tool) t_seekzone8_clear_feedback();
}}}*/

    /*}}}*/
    /* DISPLAY TOOLS .. [seekzone] [seekspot_U] [seekspot_D] [seekspot_A] {{{*/

    seekzone.style.borderWidth      = SEEKSPOT_SPACING;

    seekzone.style  .display        = "block";
    seekspot_U.style.display        = "table-cell";
    seekspot_D.style.display        = "table-cell";

    /*}}}*/
    /* AREA .. f(container_selected PAGE-GEOMETRY) {{{*/
    let seek_X    = container_selected ? container_selected_x            : onDown_XY.x;

    let seek_H    = container_selected ? container_selected.scrollHeight : SEEKSPOT_H_MIN;
    let seek_W    = container_selected ? container_selected.scrollWidth  : SEEKSPOT_W_MIN;

    if(container_selected)
        seekzone.style.borderRadius = parseInt(window.getComputedStyle(container_selected).borderRadius) +"px";

    let page_H    = document.body.parentElement.clientHeight;

    let above_H   = Math.max(SEEKSPOT_SPACING, onSeekXYL.y);
    let inset_H   = Math.max(SEEKSPOT_SPACING, seek_H);
    let inset_W   = Math.max(SEEKSPOT_SPACING, seek_W);

    above_H       = Math.min(page_H - inset_H, above_H);

    let below_H   = Math.max(SEEKSPOT_SPACING, page_H - (above_H + inset_H));

    /*}}}*/
    /* POSITION: [seekspot_U seekspot_A seekzone seekspot_D] {{{*/

    seekspot_U.style.height         = (above_H     - SEEKSPOT_SPACING   ) +"px";

    if( prop_get( LOG_SEEKSPOT ) )
    {
        seekspot_A.style.display    = "block";
        seekspot_A.style.top            = (above_H                          ) +"px";
        seekspot_A.style.marginLeft     = (seek_X      - SEEKSPOT_SPACING   ) +"px";
    }

    if(container_selected)
    {
        seekzone.style.left         = (seek_X                           ) +"px";
        seekzone.style.top          = (above_H                          ) +"px";
        seekzone.style.width        = (        inset_W                  ) +"px";
        seekzone.style.height       = (        inset_H                  ) +"px";

        add_el_class(seekzone, CSS_ON_CONTAINER);
    }
    else {
        seekzone.style.left         = (onDown_XY.x                      ) +"px";
        seekzone.style.top          = (onDown_XY.y                      ) +"px";
        seekzone.style.width        = (              seek_W             ) +"px";
        seekzone.style.height       = (              seek_H             ) +"px";

        del_el_class(seekzone, CSS_ON_CONTAINER);
    }

    seekspot_D.style.height         = (                below_H - SEEKSPOT_SPACING   ) +"px";
    /*}}}*/
    /* SHOW [seekspot_caption LOG] .. (above or below) {{{*/
    if( prop_get( LOG_SEEKSPOT ) )
    {
        let msg = t_seekzone1_show_msg.shift();
        if( msg )
        {
            seekspot_caption
                = (seekspot_caption   ==   seekspot_U)
                ? (above_H < (page_H/4)) ? seekspot_D : seekspot_U
                : (below_H < (page_H/4)) ? seekspot_U : seekspot_D
            ;

            let empty_caption = (seekspot_caption == seekspot_D) ? seekspot_U : seekspot_D;
            empty_caption.innerHTML = "";

/*{{{
            if(seekspot_caption == seekspot_U) { add_el_class(seekzone,CSS_CAPTION_U); del_el_class(seekzone,CSS_CAPTION_D); }
            else                               { del_el_class(seekzone,CSS_CAPTION_U); add_el_class(seekzone,CSS_CAPTION_D); }
}}}*/
            let ccx = (++t_seekzone1_show_msg_num) % 10;
log("SHOW_SEEKZONE %c"+t_seekzone1_show_msg_num +"%c"+ msg, lbH+lfX[ccx], lbH+lf9);
            seekspot_caption.innerHTML
                = "<pre><em class='big cc"+ccx+"'>"+t_seekzone1_show_msg_num+"</em> "+(msg ? ("<em class='big cc7'>"+msg+"</em>") : "")
                +          (prop_get( PIN_SEEKSPOT ) ? " <em class='cc8' style='float:right;'>"+SYMBOL_PUSH_PIN+"</em>" : "")
                + LF+     ".. WH ["  + window.innerWidth +" "+ window.innerHeight +"]"
                +         ".. SEEK ["+ onSeekXYL.x       +" "+ onSeekXYL.y        +"]"
                +         ".. XY ["  + onDown_XY.x       +" "+ onDown_XY.y        +"]"
                + LF + "-----------------------------------------------------------"
                + LF + t_log_get_ui_status()
                + LF + t_log_get_ev_status()
                + "</pre>"
            ;

            /* post next message */
            if( t_seekzone1_show_msg.length)
                t_seekzone1_show_timeout = setTimeout(t_seekzone1_show_handler, SHOW_SEEKZONE_DELAY);
        }
    }
    else {
        seekspot_U.style.display = "none";
        seekspot_D.style.display = "none";
    }
    /*}}}*/
};
/*}}}*/

/*_ t_seekzone1_add_onDown_XY {{{*/
let t_seekzone1_add_onDown_XY = function()
{
    let x = onDown_XY.x;
    let y = onDown_XY.y;
/*{{{*/
let   caller = "t_seekzone1_add_onDown_XY";
/*{{{
if(!is_a_DOM_LOAD_featured_function(caller)) return;
}}}*/
let log_this = LOG_MAP.T6_SLOT;

if( log_this) t_log_event_status(caller, lf1);
if( log_this) log("%c"+SYMBOL_BULB+"%c onWork_EL %c "+ get_id_or_tag(onWork_EL)+"%c container_selected %c "+ get_id_or_tag(container_selected)+"%c onSeekXYL %c "+onSeekXYL.x+" "+onSeekXYL.y
                  ,lbb+lf2         ,lbL         ,lbR+lf4                        ,lbL                  ,lbR+lf4                                 ,lbL         ,lbR+lf4                         );
/*}}}*/

    if(t_hide_seekzone_timer ) { clearTimeout(t_hide_seekzone_timer); t_hide_seekzone_timer = null; }

    seekzone.style.display = "block";

    seekzone.style.left    = (x                )+"px";
    seekzone.style.top     = (y                )+"px";
    seekzone.style.width   = (  SEEKSPOT_W_MIN )+"px";
    seekzone.style.height  = (  SEEKSPOT_H_MIN )+"px";

    del_el_class(seekzone, CSS_ON_CONTAINER);

    seekzone.innerHTML     = "";

    add_el_class(seekzone, CSS_PRESSED);
/*{{{
logXXX("seekzone %c "+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/
/*_ t_seekzone2_add_misclick {{{*/
let t_seekzone2_add_misclick = function(pressMS, misclick_MS)
{
/*{{{
logBIG("t_seekzone2_add_misclick", lf2);
}}}*/
/*{{{
    if(!is_a_DOM_LOAD_featured_function("t_seekzone2_add_misclick") ) return;
}}}*/

    if     (pressMS < misclick_MS * 0.25) set_el_class_removing(seekzone, CSS_MISCLICK1, CSS_SEEKZONE_ARRAY);
    else if(pressMS < misclick_MS * 0.50) set_el_class_removing(seekzone, CSS_MISCLICK2, CSS_SEEKZONE_ARRAY);
    else if(pressMS < misclick_MS * 0.75) set_el_class_removing(seekzone, CSS_MISCLICK3, CSS_SEEKZONE_ARRAY);
    else                                  set_el_class_removing(seekzone, CSS_MISCLICK , CSS_SEEKZONE_ARRAY);

/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/
/*_ t_seekzone2_add_dblclick {{{*/
let t_seekzone2_add_dblclick = function(pressMS, misclick_MS)
{
/*{{{
logBIG("t_seekzone2_add_dblclick", lf6);
}}}*/
/*{{{
    if(!is_a_DOM_LOAD_featured_function("t_seekzone2_add_dblclick") ) return;
}}}*/

    set_el_class_removing(seekzone, CSS_DBLCLICK, CSS_SEEKZONE_ARRAY);

/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/
/*_ t_seekzone3_add_longpress  {{{*/
let t_seekzone3_add_longpress = function()
{
/*{{{
logBIG("t_seekzone3_add_longpress", lf7);
}}}*/
/*{{{
    if(!is_a_DOM_LOAD_featured_function("t_seekzone3_add_longpress") ) return;
}}}*/

    set_el_class_removing(seekzone, CSS_LONGPRESS, CSS_SEEKZONE_ARRAY);

/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/

/*_ t_seekzone1_ON_GUTTER_XYWH {{{*/
let t_seekzone1_ON_GUTTER_XYWH = function(x, y, w, h)
{
/*{{{
logXXX("%c t_seekzone1_ON_GUTTER_XYWH(XY["+x+" "+y+"] WH["+w+" "+h+"])", lbH+lf1);
}}}*/
    if(!seekzone) return;

    if(t_hide_seekzone_timer ) { clearTimeout(t_hide_seekzone_timer); t_hide_seekzone_timer = null; }

    seekzone.style.display = "block";
    seekzone.style.left    = x +"px";
    seekzone.style.top     = y +"px";
    seekzone.style.width   = w +"px";
    seekzone.style.height  = h +"px";

    del_el_class(seekzone, CSS_ON_CONTAINER);
    add_el_class(seekzone, CSS_GUTTER);
};
/*}}}*/
/*_ t_seekzone4_hide {{{*/
let t_seekzone4_hide = function(instant=false)
{
    if(!seekzone                        ) return;
/*{{{
    if( seekzone.style.display == "none") return;
}}}*/
    if( t_hide_seekzone_timer           ) return;

/*{{{
logXXX("%c t_seekzone4_hide("+instant+")", lbH+lf4);
}}}*/

    if(!instant) { t_hide_seekzone_timer =   setTimeout(t_seekzone4_hide_handler, HIDE_SEEKZONE_DELAY); }
    else         { t_hide_seekzone_timer = null;        t_seekzone4_hide_handler();                     }
/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/
/*_ t_seekzone4_hide_handler {{{*/
let t_seekzone4_hide_handler = function()
{
/*{{{
logXXX("%c t_seekzone4_hide_handler", lbH+lf4);
}}}*/
    t_hide_seekzone_timer = null;

    if(!seekzone) return;

    t_seekzone8_clear_feedback();

    if(!prop_get( SHOW_SEEKZONE ) || !prop_get( PIN_SEEKSPOT ))
    {
        seekzone  .style.display = "none";
        seekspot_U.style.display = "none";
        seekspot_A.style.display = "none";
        seekspot_D.style.display = "none";
    }
/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/
/*_ t_seekzone8_clear_feedback {{{*/
let t_seekzone8_clear_feedback = function()
{
/*{{{
t_log_event_status("t_seekzone8_clear_feedback", lbH+lf8);
}}}*/
    set_el_class_removing(seekzone, "", CSS_SEEKZONE_ARRAY);

/*{{{
logXXX("seekzone %c"+seekzone.className,lbH+lf7);
}}}*/
};
/*}}}*/

/*}}}*/
/* STAGE LOG {{{*/
/*_ t_log_stage {{{*/
let t_log_stage = function(stage, something_clicked, pattern_clicked, e_target, parent_div)
{
    let innerHTML = ""
        +       " <em class='cc"+stage.color+"'>"+  strip_UL( stage.level    ) +"</em>"
        +       " <em class='cc"+stage.color+"'>"+  strip_UL( stage.context  ) +"</em>"
        +       " <em class='cc"+stage.color+"'>"+  strip_UL( stage.action   ) +"</em>"
        +   ( pattern_clicked
            ? ( " <em class='cc"+stage.color+"'>"+            e_target.title   +"</em>")
            : ( " <em class='cc"+stage.color+"'>"+ get_n_lbl( parent_div     ) +"</em>"))
    ;

    t_log_stage_msg((something_clicked ? STAGE_1_INPUT : STAGE_2_ACTION), innerHTML);
};
/*}}}*/
/*_ t_log_stage_msg {{{*/
/*{{{*/
const STAGE_0_NONE   = "stage_0_none";

const STAGE_1_INPUT  = "stage_1_input" ;
const STAGE_2_ACTION = "stage_2_action";
const STAGE_3_RESULT = "stage_3_result";

const STAGE_1_MISSED = "stage_1_missed";
const STAGE_2_MISSED = "stage_2_missed";
const STAGE_3_MISSED = "stage_3_missed";
const STAGE_1_MORE   = "stage_1_more"  ;
const STAGE_3_MORE   = "stage_3_more"  ;

/*}}}*/
let t_log_stage_msg = function(stage, msg)
{
    /*{{{*/
let log_this = LOG_MAP.EV8_FLOATLOG;

if( log_this) log("%c t_log_stage_msg("+stage+" , "+msg+") ", lbF+lb7);
    /*}}}*/
    /* prev_div {{{*/
    let prev_div
        = (fly_div.childNodes.length > 0)
        ?  fly_div.childNodes[fly_div.childNodes.length-1]
        : null;
if( log_this) log("...childNodes.length=["+fly_div.childNodes.length+"]");

if( log_this && prev_div) log("%c prev_div=["+strip_html(prev_div.innerHTML)+"]", lbH);
    /*}}}*/
    /* prev_stage {{{*/
    let prev_stage
        = has_el_class(prev_div, STAGE_1_INPUT ) ? STAGE_1_INPUT
        : has_el_class(prev_div, STAGE_2_ACTION) ? STAGE_2_ACTION
        : has_el_class(prev_div, STAGE_3_RESULT) ? STAGE_3_RESULT
        :                                          STAGE_0_NONE;
if( log_this) log("......prev_stage=["+ prev_stage +"]");

    /*}}}*/
    /* is_prev_stage_continuation {{{*/
    let ui_status = t_log_get_ui_status();
    let ev_status = t_log_get_ev_status();
    let is_prev_stage_continuation
        =  (        stage == prev_stage    )
        || (   (ui_status == SAME_UI_STATUS)
            && (ev_status == SAME_EV_STATUS));

if( log_this) log("...is_prev_stage_continuation=["+is_prev_stage_continuation+"]");
    /*}}}*/
    /* PREV STAGE MISSED {{{*/
    if( !is_prev_stage_continuation ) {
        let prev_stage_missed = "";
        switch( stage ) {
            case STAGE_1_INPUT : if(prev_stage != STAGE_3_RESULT) prev_stage_missed = STAGE_3_MISSED; break;
            case STAGE_2_ACTION: if(prev_stage != STAGE_3_RESULT) prev_stage_missed = STAGE_3_MISSED; break;
            case STAGE_3_RESULT: if(prev_stage != STAGE_3_RESULT) prev_stage_missed = STAGE_3_MISSED; break;
        }
        if(prev_stage == STAGE_0_NONE)                            prev_stage_missed = STAGE_1_MISSED;

        if(prev_stage_missed)
            add_el_class(prev_div, prev_stage_missed);
    }
    else {
        flip_el_class(   prev_div    , STAGE_3_MISSED); /* no bot radius */
        if(              prev_stage == STAGE_3_RESULT)
            add_el_class(prev_div    , STAGE_3_MORE  ); /* bottom dashed */
    }
    /*}}}*/
    /* THIS STAGE MISSED {{{*/
    let stage_missed = "";
    switch(stage) {
        case     STAGE_0_NONE  :                                          stage_missed = STAGE_3_MISSED+" "+STAGE_3_MISSED;   break;
        case     STAGE_1_INPUT : if( is_prev_stage_continuation )         stage_missed = STAGE_1_MORE  ;                      break;
        case     STAGE_2_ACTION: if(!is_prev_stage_continuation )         stage_missed = STAGE_1_MISSED;                      break;
        case     STAGE_3_RESULT: if(!is_prev_stage_continuation )         stage_missed = STAGE_1_MISSED+" "+STAGE_2_MISSED;   break;
    }
if( log_this) log("...stage_missed=["+stage_missed+"]");
    /*}}}*/
    /* symbol {{{*/
    let symbol = "";
    switch(stage) {
        case STAGE_1_INPUT : symbol = SYMBOL_STAGE1_INPUT ; break;
        case STAGE_2_ACTION: symbol = SYMBOL_STAGE2_ACTION; break;
        case STAGE_3_RESULT: symbol = SYMBOL_STAGE3_RESULT; break;

    }
    /*}}}*/
    /* color {{{*/
    if(!is_prev_stage_continuation)
        div_ccX = (div_ccX + 1) % 10;

    /*}}}*/
    /* tooltip {{{*/
    let title = strip_html(ui_status + LF + ev_status);

    /*}}}*/
    /* message {{{*/
    t_fly_add("<div class='cc"+div_ccX+" "+stage+" "+stage_missed+"' title='"+title+"'>"+symbol+" "+msg+"</div>");

    /*}}}*/
    /* default stage close {{{*/
    if(stage != STAGE_3_RESULT) {
        if(t_log_stage_close_timer) clearTimeout(t_log_stage_close_timer);
        t_log_stage_close_timer   =   setTimeout(t_log_stage_close_handler, T_LOG_STAGE_CLOSE_DELAY);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_log_stage_close_handler {{{*/
/*{{{*/
const T_LOG_STAGE_CLOSE_DELAY = T_STANDBY1_DELAY + 500;
let t_log_stage_close_timer;

/*}}}*/
let t_log_stage_close_handler = function()
{
let log_this = LOG_MAP.EV8_FLOATLOG;

    let last_div
        = (fly_div.childNodes.length > 0)
        ?  fly_div.childNodes[fly_div.childNodes.length-1]
        : null;
if( log_this) log("t_log_stage_close_handler: ...childNodes.length=["+fly_div.childNodes.length+"]");
    if(!last_div) return;

/* last_stage {{{*/
    let last_stage
        = has_el_class(last_div, STAGE_1_INPUT ) ? STAGE_1_INPUT
        : has_el_class(last_div, STAGE_2_ACTION) ? STAGE_2_ACTION
        : has_el_class(last_div, STAGE_3_RESULT) ? STAGE_3_RESULT
        :                                          STAGE_0_NONE;
if( log_this) log("......last_stage=["+ last_stage +"] ["+last_div.textContent+"]");

    if(last_stage != STAGE_3_RESULT) add_el_class(last_div, STAGE_3_MISSED);

/*}}}*/
/* last_div.classList {{{*/
/*
    if(    !last_div.classList.contains(STAGE_1_INPUT )
        && !last_div.classList.contains(STAGE_1_MISSED)) add_el_class(last_div, STAGE_1_MISSED);

    if(    !last_div.classList.contains(STAGE_2_ACTION)
        && !last_div.classList.contains(STAGE_2_MISSED)) add_el_class(last_div, STAGE_2_MISSED);

    if(    !last_div.classList.contains(STAGE_3_RESULT)
        && !last_div.classList.contains(STAGE_3_MISSED)) add_el_class(last_div, STAGE_3_MISSED);
*/
/*}}}*/
};
/*}}}*/
/*}}}*/
/* INFO LOG {{{*/
/*_ t_log_behavior {{{*/
let t_log_behavior = function()
{
    /* activate doc playground or tool transcript */
    if(!t_doc_div_clear("doc_log_div") )
        t_tools_panel_select(transcript2);

    t_clear();
    t9_load_BEHAVIOR();
};
/*}}}*/
/*_ t_log_regex {{{*/
let t_log_regex = function()
{
    /* activate doc playground or tool transcript */
    if(!t_doc_div_clear("doc_log_div") )
        t_tools_panel_select(transcript2);

    let sample;
    let html = "";
    html += "<hr><em class='cc1'>get_first_word:</em>"; /*{{{*/
    sample = "word_1 word_2 word_3";
    html += "<br>SAMPLE=<div class='eso_div'>"+             sample                 +"</div>";
    html += "RESULT=<div class='eso_div'>"+ get_first_word( sample, "t_log_regex") +"</div>";

    /*}}}*/
    html += "<hr><em class='cc1'>get_first_word:</em>"; /*{{{*/
    sample += "--- !! @@ ## $$ %% ~~ ^^ ** (( ))"+          sample;
    html += "<br>SAMPLE=<div class='eso_div'>"+             sample                 +"</div>";
    html += "RESULT=<div class='eso_div'>"+ get_first_word( sample, "t_log_regex") +"</div>";

    /*}}}*/
    html += "<hr><em class='cc1'>get_word_at_offset:</em>"; /*{{{*/

    let ruler_tens = "_________1_________2_________3_________4_________5_________6_________7_________8_________9_______100_______110___";
    let ruler_unit = "123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123";
    let ruler_off  = "|_|_____|___|_____|___|_____|___|__|_|_____|___|_____||___|||______|___|___________________________________|___||";
    sample         = "Le papillon qui est la forme 'adulte' de la chenille, éclos durant l'été entre juin et septembre selon le climat.";

    if( !IN_WEBVIEW ) ruler_off = vbar_to_up_arrow(           ruler_off );
/*
sample = character_entities_to_char( sample );
sample = character_entities_to_hex ( sample );
*/
/*

dom_util.js:545 Le papillon qui est la forme 'adulte' de la chenille, ?clos durant l'?t? entre juin et septembre selon le climat.
dom_util.js:552 Le XXXaXXXillon qui est la forme 'adulte' de la chenille, ?clos durant l'?t? entre juin et seXXXtembre selon le climat.


*/
    html
        += "<div style='font-size:150%' class='cc0'>"
        +  sample     +"<br>"
        +  ruler_off  +"<br>"
        +  ruler_unit +"<br>"
        +  ruler_tens
        +  "</div>"
    ;

    let offset;
    html
        += "<div style='float:left'>"
        +  " <em class='cc8'>offset "+mPadStart(offset =  1, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset =  3, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset =  9, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 13, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 19, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 33, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  "</div>"
    ;
    html
        += "<div style='float:left'>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 36, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 38, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 44, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 48, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 54, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 55, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  "</div>"
    ;

    html
        += "<div style='float:left'>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 59, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 60, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 61, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 68, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset = 72, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset =108, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset =112, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  " <em class='cc8'>offset "+mPadStart(offset =113, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em><br>"
        +  "</div>"
    ;

    html
        += "<div style='float:left'>"
        +  " <em class='cc8'>offset "+mPadStart(offset = -5, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em>"
        +  " <em class='cc8'>offset "+mPadStart(offset =150, 3)+"</em> <em class='cc4'>"+ get_word_at_offset(sample, offset) +"</em>"
        +  "</div>"
    ;

    html += "<br style='clear:both;'>";
    /*}}}*/
    html += "<hr><em class='cc1'>strip_CR_LF:</em>"; /*{{{*/
    sample = "...LINE1 ENDING WITH CR"+CR+"...LINE2 ENDING WITH CRLF"+CR+LF+"...LINE3 ENDING WITH LF"+LF;
    html += "<br>SAMPLE=<div class='eso_div'>"+                 sample    +"</div>";
    html += "RESULT=<div class='eso_div'>"+       strip_CR_LF(  sample  ) +"</div>";

    /*}}}*/
    html += "<hr><em class='cc1'>trim_empty_lines(alnum_filter=false):</em>"; /*{{{*/
    sample
        += "NEXT LINE: only space chars='"+LF
        +  "             "+LF
        +  "'"+LF
        +  "NEXT LINE: only non-word chars='"+LF
        +  "--- !! @@ ## $$ %% ~~ ^^ ** (( ))"+LF
        +  "'"+LF
    ;

    html += "<br>SAMPLE=<div class='eso_div'>"+                 sample         +"</div>";
    html += "RESULT=<div class='eso_div'>"+  trim_empty_lines(  sample, false) +"</div>";

    /*}}}*/
    html += "<hr><em class='cc1'>trim_empty_lines(alnum_filter=true):</em>"; /*{{{*/
    html += "<br>SAMPLE=<div class='eso_div'>"+                 sample        +"</div>";
    html += "RESULT=<div class='eso_div'>"+  trim_empty_lines(  sample, true) +"</div>";

    /*}}}*/
    if     (t_is_a_selected_panel( transcript2 )) log_set_TR_RESULT    ( html );
    else if(doc_log_div                         ) t_log_transcript_info( html );
};
/*}}}*/
/*}}}*/
/* EVENT LOG {{{*/
/* {{{*/
let   SAME_EV_STATUS = ".. same EVENT";
let   SAME_UI_STATUS = ".. same ITEMS";
let t_last_ev_status;
let t_last_ui_status;
/*}}}*/
/*_ t_log_event_status {{{*/
let t_log_event_status = function(_caller, l_x)
{
/*{{{
    let l_l = l_x ? l_x : (lbL    );
    let l_c = l_x ? l_x : (lbC+lf8);
    let l_r = l_x ? l_x : (lbR+lf8);

    log(  "%c"+ _caller               + LF
        + "%c"+ t_log_get_ui_status() + LF
        + "%c"+ t_log_get_ev_status()
        ,  l_l+lbH
        ,  l_c
        ,  l_r
    );
}}}*/
/*{{{
    let status = {
        ui_status : t_log_get_ui_status(),
        ev_status : t_log_get_ev_status()
    };
    log_key_val(_caller, status);
console.groupCollapsed("%c"+SYMBOL_RIGHT+" "+_caller+" %c STATUS:", lbL+l_x, lbR+l_x);
}}}*/
    let l_l = _caller.includes(LF) ? lbH : lbL;
console.groupCollapsed("%c"+_caller+" %c STATUS ", l_l+l_x, lbR+l_x);
    log_key_val_group("UI", t_log_get_ui_status_object(), lf5, false);
    log_key_val_group("EV", t_log_get_ev_status_object(), lf6, false);
console.trace();
console.groupEnd();

};
/*}}}*/
/*_ t_log_clr_status {{{*/
let t_log_clr_status = function()
{
    t_event_consumed_cause   = "";
    t_preventDefault_caller  = "";
    t_last_ui_status         = "";
    t_last_ev_status         = "";
};
/*}}}*/
/*_ t_log_get_ui_status {{{*/
let t_log_get_ui_status = function()
{
    let caller = "t_log_get_ui_status";

    let o = t_log_get_ui_status_object();

    let ui_status
        = " onWork_EL.......: "+ o.onWork_EL
        +                   " "+ o.ui_details       + LF
        + " onWork_SEEK_TOOL: "+ o.onWork_SEEK_TOOL + LF
        + " onWork_PANEL....: "+ o.onWork_PANEL     + LF
        + " .pivot_PANEL....: "+ o. pivot_PANEL
    ;

    if( t_last_ui_status      != ui_status)
        t_last_ui_status       = ui_status;
    return t_last_ui_status;
};
/*}}}*/
/*_ t_log_get_ev_status {{{*/
let t_log_get_ev_status = function()
{
    let caller = "t_log_get_ev_status";

    let o = t_log_get_ev_status_object();

    let ev_status
        =  "EVENT CAPTURED BY "+ o.captured_by    + LF
        +  "EVENT CONSUMED BY "+ o.consumed_by    + LF
        +  ".....................has_moved: "+ o.has_moved                   + LF
        +  "...has_been_scrolled_by_script: "+ o.has_been_scrolled_by_script + LF
        +  "................window.scrollY: "+ o.window_scrollY              + LF
        +  ".....................onSeekXYL: "+ o.onSeekXYL                   + LF
        +                                      o.onSeek_XY_label
    ;

    if( t_last_ev_status  != ev_status)
        t_last_ev_status   = ev_status;
    return t_last_ev_status;
};
/*}}}*/
/*_ t_log_get_ui_status_object {{{*/
let t_log_get_ui_status_object = function()
{
    let caller = "t_log_get_ui_status_object";

    /* SEEK TOOL */
    let ui_details  = "";
    if(                   (onWork_SEEK_TOOL    )) { ui_details  = "A SEEK TOOL ("+get_n_lbl(onWork_SEEK_TOOL)+")"; }
    else if(              (onWork_MOVABLE_CHILD)) { ui_details  = "A MOVABLE CHILD"; }
    else if(t_is_onSeekEL(onWork_EL           )) { ui_details  = "A SEEK EL"      ; }

    if(ui_details && t_seeker_PU_is_active()) {
        let on_off_screen
            = t_node_is_off_screen(seeker_PU)
            ? "OFF SCREEN" : "ON SCREEN";        ui_details += " .. seeker_PU "+ on_off_screen;
    }

    /* SOME TOOL */
    if(!ui_details)
    {
        if(t_is_a_tool_el ( onWork_EL, caller ))
        {
            ui_details
                = (onWork_EL.tagName != "DIV") ? "["+ onWork_EL.textContent +"]"
                : (onWork_EL == target_tool  ) ? "A TARGET TOOL"
                :                                "A TOOL BAG"
            ;
        }
        else {
            ui_details  = "NOT A TOOL";
        }
    }

    let ui_status_object
        = { onDown_EL           :  get_n_lbl( onDown_EL           )
          , onWork_EL           :  get_n_lbl( onWork_EL           )
          , ui_details          :             ui_details
          , onWork_PANEL        :  get_n_lbl( onWork_PANEL        )
          , onWork_SEEK_TOOL    :  get_n_lbl( onWork_SEEK_TOOL    )
          , onWork_EL_last_used :  get_n_lbl( onWork_EL_last_used )
          , target_tool         :  get_n_lbl( target_tool         )
          , pivot_PANEL         :  get_n_lbl( pivot_PANEL         )
        };

/*{{{
log_key_val("ui_status_object", ui_status_object)
}}}*/
    return ui_status_object;
};
/*}}}*/
/*_ t_log_get_ev_status_object {{{*/
let t_log_get_ev_status_object = function()
{
    let caller = "t_log_get_ev_status_object";

    let ev_status_object
        = {                 captured_by  : (t_preventDefault_caller ? (t_preventDefault_caller                                                      ) :   "")
          ,                 consumed_by  : (t_event_consumed_cause  ? (t_event_consumed_cause                                                       ) :   "")
          ,                   has_moved  :                            (has_moved                   ? has_moved.replace(":",":"+LF+SYMBOL_RIGHT_ARROW) : "NO")
          , has_been_scrolled_by_script  :                            (has_been_scrolled_by_script ? has_been_scrolled_by_script                      : "NO")
          ,              window_scrollY  :                             window.scrollY
          ,                   onSeekXYL  : "<em class='cc8'>"+strip_CR_LF(onSeekXYL.label)+"</em> XY=["+onSeekXYL.x+" "+onSeekXYL.y+"]"
        };

    if(t_preventDefault_caller != "")
        ev_status_object["t_preventDefault_caller"] = t_preventDefault_caller;

/*{{{
log_key_val("ev_status_object", ev_status_object)
}}}*/
    return ev_status_object;
};
/*}}}*/
/*}}}*/
/* TRANSCRIPTS LOG {{{*/
/*_ t_log_transcript {{{*/
let t_log_transcript_event_top = function(html) { t_log_transcript(html, "doc_evt_div", "log_sep_top"); };
let t_log_transcript_event_bot = function(html) { t_log_transcript(html, "doc_evt_div", "log_sep_bot"); };
let t_log_transcript_info      = function(html) { t_log_transcript(html, "doc_log_div", ""           ); };
let t_log_transcript           = function(                         html,  div_id,       log_class   )
{
    /* [t_fly] {{{*/
    if(    LOG_MAP.EV7_DISPATCH
       && (LOG_MAP.EV8_FLOATLOG || fly_log_checked)
      ) {
        let stage
            = (log_class == "log_sep_top") ? STAGE_1_INPUT
            : (log_class != "log_sep_bot") ? STAGE_2_ACTION
            : /*.............log_sep_bot..*/ STAGE_3_RESULT
        ;
        t_fly_add("<div class='"+stage+"'>"+html+"</div>");
    }
    /*}}}*/
/*{{{
logXXX("t_log_transcript");
logXXX("...div_id....................=["+ div_id    +"]");
logXXX("...log_class.................=["+ log_class +"]");
logXXX("...html......................=["+ html      +"]");
}}}*/
    /* TO [transcript1] [transcript2] {{{*/
    if(div_id == "doc_evt_div")
    {
        if(    (onWork_EL    !=      transcript1)
            && (onWork_PANEL !=      transcript1)
            && t_is_a_selected_panel(transcript1)
        )
            log_add_TR_EVENT(html);
    }
    else {
        if(    (onWork_EL         != transcript2)
            && (onWork_PANEL      != transcript2)
            && t_is_a_selected_panel(transcript2)
        )
            log_add_TR_LAYOUT(html);
    }
    /*}}}*/
    /* TO [doc_evt_div] [doc_log_div] {{{*/
    if(div_id == "doc_evt_div") t_doc_div_add("doc_evt_div", "<div class='"+log_class+"'>"+html+"</div>");
    else                        t_doc_div_add("doc_log_div", "<div class='"+log_class+"'>"+html+"</div>");
    /*}}}*/
    if     (log_class == "log_sep_top") log_sep_top(html);
    else if(log_class == "log_sep_bot") log_sep_bot(html);
};
/*}}}*/
/*}}}*/
/* DOCUMENT LOG {{{*/
/*{{{*/
const DOC_EVT_DIV_EMPTY  = "<span style='font-size:500%;'>"+SYMBOL_GEAR+"</span>";
const DOC_LOG_DIV_EMPTY  = "<span style='font-size:500%;'>"+SYMBOL_BULB+"</span>";
const DOC_EVT_DIV_HEADER = "<span style='font-size:200%;'>"+SYMBOL_GEAR+"</span>";
const DOC_LOG_DIV_HEADER = "<span style='font-size:200%;'>"+SYMBOL_BULB+"</span>";

let   doc_evt_div;
let   doc_log_div;

/*}}}*/
/*_ t_doc_div_clear {{{*/
let t_doc_div_clear = function(div_id)
{
    let doc_div = null;
    switch(div_id)
    {
        case "doc_evt_div":
        if(  !doc_evt_div ) doc_evt_div = document.getElementById(div_id);
        if(  !doc_evt_div ) return false;
        doc_div           = doc_evt_div;
        break;

        case "doc_log_div":
        if(  !doc_log_div ) doc_log_div = document.getElementById(div_id);
        if(  !doc_log_div ) return false;
        doc_div           = doc_log_div;
        break;
    }
    doc_div.innerHTML
        = (doc_div == doc_log_div) ? DOC_LOG_DIV_EMPTY
        : (doc_div == doc_evt_div) ? DOC_EVT_DIV_EMPTY
        :                            ""
    ;
    doc_div.cleared   = "cleared";
    return true;
};
/*}}}*/
/*_ t_doc_div_add {{{*/
let t_doc_div_add = function(div_id, html)
{
    if( !html.trim()) return;

    let doc_div = null;
    switch(div_id)
    {
        case "doc_evt_div":
        if(  !doc_evt_div ) doc_evt_div = document.getElementById("doc_evt_div");
        if(  !doc_evt_div ) return false;
        doc_div           = doc_evt_div;

        break;

        case "doc_log_div":
        if(  !doc_log_div ) doc_log_div = document.getElementById("doc_log_div");
        if(  !doc_log_div ) return false;
        doc_div           = doc_log_div;

        break;
    }

    if( doc_div.cleared ) {
        doc_div.cleared        = ""      ;
        doc_div.innerHTML      = (div_id == "doc_evt_div") ? DOC_EVT_DIV_HEADER : DOC_LOG_DIV_HEADER;
        t_add_closepin_on_panel( doc_div );
    }

    doc_div.innerHTML += html;

    return true;
};
/*}}}*/
/*}}}*/
/*}}}*/

/** FLY */
/*{{{*/
/* LOG FLY {{{*/
/*_ t_fly_pat_off_bak_bin_csv {{{*/
/*{{{*/
let t_log_pat_off_bak_bin_csv_prev;

/*}}}*/
let t_fly_pat_off_bak_bin_csv = function(phase_update_pushed_staged, have_want_done)
{
    /* csv_count [pat off bak bin] {{{*/
    let pat_c  = csv_count(pat_csv);
    let off_c  = csv_count(off_csv);
    let bak_c  = csv_count(bak_csv);
    let bin_c  = csv_count(bin_csv);

    /*}}}*/
    /* [same_result_msg] {{{*/
    let same_result_msg = "";
    switch(phase_update_pushed_staged)
    {
        case SYMBOL_UPDATE: {
            t_log_pat_off_bak_bin_csv_prev = { pat_c:pat_c , off_c:off_c , bak_c:bak_c , bin_c:bin_c };
        }
        break;

        case SYMBOL_STAGE : {
            if(    (pat_c == t_log_pat_off_bak_bin_csv_prev.pat_c)
                && (off_c == t_log_pat_off_bak_bin_csv_prev.off_c)
                && (bak_c == t_log_pat_off_bak_bin_csv_prev.bak_c)
                && (bin_c == t_log_pat_off_bak_bin_csv_prev.bin_c)
            )
                same_result_msg = "AS ASSIGNED";
            else
                t_log_pat_off_bak_bin_csv_prev = { pat_c:pat_c , off_c:off_c , bak_c:bak_c , bin_c:bin_c };
        }
        break;

        case SYMBOL_RESULT: {
            if(    (pat_c == t_log_pat_off_bak_bin_csv_prev.pat_c)
                && (off_c == t_log_pat_off_bak_bin_csv_prev.off_c)
                && (bak_c == t_log_pat_off_bak_bin_csv_prev.bak_c)
                && (bin_c == t_log_pat_off_bak_bin_csv_prev.bin_c)
            )
                same_result_msg = "AS STAGED";

            t_log_pat_off_bak_bin_csv_prev = null;
        }
        break;

        default:
        log("t_fly_pat_off_bak_bin_csv: BACKSTAGE PHASE ["+phase_update_pushed_staged+"]");
        break;
    }
    /*}}}*/
    /* t_fly {{{*/
    let html = "";

    if(same_result_msg)
    {
        let phase_color     = (phase_update_pushed_staged == SYMBOL_STAGE) ? "cc6" :  "cc4";
        if(!html) html      = " <em  class='have "+ phase_color +"'>"+ same_result_msg +"</em>";
    }
    else {
        if(pat_c && off_c) {
            html+=            " <em  class='"+ have_want_done +" cc1'>pat "+ pat_c
                +             " <sup class='"+ have_want_done +" cc5'>off "+ off_c +"</sup>"
                +             "</em>";
        }
        else {
            if(pat_c) html += " <em  class='"+ have_want_done +" cc1'>pat "+ pat_c +"</em>";
            if(off_c) html += " <em  class='"+ have_want_done +" cc5'>off "+ off_c +"</em>";
        }
        if(bak_c) html     += " <em  class='"+ have_want_done +" cc2'>bak "+ bak_c +"</em>";
        if(bin_c) html     += " <em  class='"+ have_want_done +" cc0'>bin "+ bin_c +"</em>";

        if(!html) html      = " <em  class='have cc8'>ALL BAGS EMPTY</em>";
    }

    t_fly( phase_update_pushed_staged + html);
    /*}}}*/

/*{{{
csv_log(bak_csv, phase_update_pushed_staged+": bak_csv [x"+csv_count(bak_csv)+"] ")
if(log_this) if(sel_csv) csv_log(sel_csv, "sel_csv [x"+csv_count(sel_csv)+"] "); else log("%c sel_csv [x"+csv_count(sel_csv)+"] %c UNCHANGED ["+sel_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(pat_csv) csv_log(pat_csv, "pat_csv [x"+csv_count(pat_csv)+"] "); else log("%c pat_csv [x"+csv_count(pat_csv)+"] %c UNCHANGED ["+pat_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(off_csv) csv_log(off_csv, "off_csv [x"+csv_count(off_csv)+"] "); else log("%c off_csv [x"+csv_count(off_csv)+"] %c UNCHANGED ["+off_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(bak_csv) csv_log(bak_csv, "bak_csv [x"+csv_count(bak_csv)+"] "); else log("%c bak_csv [x"+csv_count(bak_csv)+"] %c UNCHANGED ["+bak_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(bin_csv) csv_log(bin_csv, "bin_csv [x"+csv_count(bin_csv)+"] "); else log("%c bin_csv [x"+csv_count(bin_csv)+"] %c UNCHANGED ["+bin_csv+"]", lbF+lb9, lbF+lb0);
if(log_this) if(alt_csv) csv_log(alt_csv, "alt_csv [x"+csv_count(alt_csv)+"] "); else log("%c alt_csv [x"+csv_count(alt_csv)+"] %c UNCHANGED ["+alt_csv+"]", lbF+lb9, lbF+lb0);
}}}*/
};
/*}}}*/
/*_ t_fly {{{*/
let t_fly = function(html)
{
/*{{{
logXXX("%c t_fly %c"+strip_html(html), lbL+lf2, lbR+lf2);
}}}*/
    /* TODO log("%c "+html+" ", lbF+lb0);*/

    t_fly_add("<div class='stage_0_log'>"+ html +"</div>");
};
/*}}}*/
/*_ t_fly_add {{{*/
/*{{{*/
let T_CLR_FLY_DIV_POSTPONED_DELAY =  500;
let T_CLR_FLY_DIV_CLEANUP_DELAY   = 3000; /* can be shortened by user with a click on any [t_log_stage_msg] item */
let t_clr_fly_div_postponed = false;
/*}}}*/
let t_fly_add = function(innerHTML)
{
    if(!innerHTML) return;
    if(!fly_div  ) return;

    fly_div.insertAdjacentHTML("beforeend", innerHTML);

    t_log_onchange();
};
/*}}}*/
/*_ t_fly_set {{{*/
let t_fly_set = function(innerHTML)
{

    t_clear_panel_pined_innerHTML( fly_div );

    fly_div.innerHTML = innerHTML;

    t_log_onchange();
};
/*}}}*/
/*_ t_fly_clr {{{*/
/*{{{*/
const T_FLOATLOG_STACK_MAX = 16;
let t_log_clr_innerHTML_timer;

/*}}}*/
let t_fly_clr = function()
{
    /* clearTimeout {{{*/
    t_fly_clr_cancel();

    if(!fly_div.innerHTML) return;
    /*}}}*/
    /* MARK "removing" entries .. (beyond T_FLOATLOG_STACK_MAX) {{{*/
    if(LOG_MAP.EV8_FLOATLOG || fly_log_checked)
    {
        let more_on_stage = false;
        let      closepin = get_el_child_with_class(fly_div, CSS_CLOSEPIN);
        let    next_child =                                  (closepin ? 1 : 0);
        let    stack_size = fly_div.childNodes.length      - (closepin ? 1 : 0);

/*{{{
logXXX(".....closepin=["+ get_id_or_tag(closepin) +"]");
logXXX("...next_child=["+ next_child              +"]");
logXXX("...stack_size=["+ stack_size              +"]");
}}}*/

        let removing_count = 0;
        while((stack_size > T_FLOATLOG_STACK_MAX) || (more_on_stage && (stack_size > 0)))
        {
            let child  = fly_div.childNodes[next_child++];
            if( child == closepin) continue;

            add_el_class(child, CSS_REMOVING);
            removing_count += 1;

            --stack_size;
            more_on_stage
                =        has_el_class(fly_div.childNodes[next_child], STAGE_1_MORE  )
                ||       has_el_class(fly_div.childNodes[next_child], STAGE_3_MORE  )
                || (    !has_el_class(fly_div.childNodes[next_child], STAGE_1_INPUT )
                    &&  !has_el_class(fly_div.childNodes[next_child], STAGE_1_MISSED))
            ;
        }
/*{{{
logXXX("t_fly_clr: fly_div.childNodes.length=["+fly_div.childNodes.length+"]");
}}}*/
        if(removing_count > 0)
            t_log_clr_innerHTML_timer = setTimeout(t_fly_clr_handler, T_CLR_FLY_DIV_CLEANUP_DELAY);
    }
    /*}}}*/
    /* OR JUST FADE AND POST CLEANUP HANDLER {{{*/
    else {
        let fading_count = 0;
        for(let i=0; i < fly_div.childNodes.length; ++i) {
            add_el_class(fly_div.childNodes[i], CSS_FADING);
            fading_count += 1;
        }
/*
log("t_clr_fly_div_postponed = "+t_clr_fly_div_postponed);
*/
        let delay = t_clr_fly_div_postponed
            ?       T_CLR_FLY_DIV_POSTPONED_DELAY
            :       T_CLR_FLY_DIV_CLEANUP_DELAY;
        if(fading_count > 0)
            t_log_clr_innerHTML_timer   = setTimeout( t_fly_clr_handler, delay);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_log_clr_innerHTML_is_pending {{{*/
let t_log_clr_innerHTML_is_pending = function()
{
    return (t_log_clr_innerHTML_timer != null);
};
/*}}}*/
/*_ t_fly_clr_cancel {{{*/
let t_fly_clr_cancel = function()
{
    if(!t_log_clr_innerHTML_timer ) return;

    clearTimeout( t_log_clr_innerHTML_timer );
    /*.........*/ t_log_clr_innerHTML_timer = null;
};
/*}}}*/
/*_ t_fly_clr_div {{{*/
let t_fly_clr_div = function(e_target)
{
/*{{{
logXXX("%c t_fly_clr_div: %c e_target=["+get_n_lbl(e_target)+"]", lbL, lbR+lf9);
}}}*/
    /*
     * CLEAR FROM TOP    .. removing old history
     * CLEAR FROM BOTTOM .. shaving recent history
     * ....................(up to some older specific stage of interest)
     */
    let fly_div_child_nb = fly_div.childNodes.length;
    if(!fly_div_child_nb) return;

    let last_child_clicked = (e_target == fly_div.childNodes[fly_div_child_nb - 1]);
/*{{{
logXXX("...last_child_clicked=["+last_child_clicked+"]");
}}}*/

    if( last_child_clicked ) t_fly_clr_bot();
    else                     t_fly_clr_top();
};
/*}}}*/
/*_ t_fly_clr_top {{{*/
let t_fly_clr_top = function()
{
/*{{{
logXXX("%c t_fly_clr_top", lb5);
}}}*/
    let stack_size = fly_div.childNodes.length;
    if( stack_size == 0) return;

    let more_on_stage = false;
    let      closepin = get_el_child_with_class(fly_div, CSS_CLOSEPIN);
    let    next_child =                                   closepin ? 1 : 0;
        let removing_count = 0;
    do {
        let child  = fly_div.childNodes[next_child++];
        if( child == closepin) continue;
        add_el_class(child, CSS_REMOVING);
            removing_count += 1;

        --stack_size;
        child     = fly_div.childNodes[next_child];
        more_on_stage
            =        has_el_class(child, STAGE_1_MORE  )
            ||       has_el_class(child, STAGE_3_MORE  )
            || (    !has_el_class(child, STAGE_1_INPUT )
                &&  !has_el_class(child, STAGE_1_MISSED))
        ;
    }
    while(more_on_stage && (stack_size > 0));
/*{{{
logXXX("t_fly_clr_top: fly_div.childNodes.length=["+fly_div.childNodes.length+"]");
}}}*/

    if(removing_count > 0)
        t_log_clr_innerHTML_timer = setTimeout(t_fly_clr_handler, 0);
};
/*}}}*/
/*_ t_fly_clr_bot {{{*/
let t_fly_clr_bot = function()
{
/*{{{
logXXX("%c t_fly_clr_bot", lb6);
}}}*/
    let stack_size = fly_div.childNodes.length;
    if( stack_size == 0) return;

    let more_on_stage = false;
    let      closepin = get_el_child_with_class(fly_div, CSS_CLOSEPIN);
    let    prev_child = stack_size - 1;
        let removing_count = 0;
    do {
        let child  = fly_div.childNodes[prev_child--];
        if( child == closepin) continue;
        add_el_class(child, CSS_REMOVING);
            removing_count += 1;

        --stack_size;
        child     = fly_div.childNodes[prev_child];
        more_on_stage
            =        has_el_class(child, STAGE_3_RESULT) /* last of previous bunch */
            ||      !has_el_class(child, STAGE_3_MISSED)
            &&      !has_el_class(child, STAGE_0_NONE  ) /* stand-alone */
        ;
    }
    while(more_on_stage && (stack_size > 0));
/*{{{
logXXX("t_fly_clr_bot: fly_div.childNodes.length=["+fly_div.childNodes.length+"]");
}}}*/

    if(removing_count > 0)
        t_log_clr_innerHTML_timer   = setTimeout(t_fly_clr_handler, 0);
};
/*}}}*/
/*_ t_fly_clr_handler {{{*/
let t_fly_clr_handler = function(_caller="timer")
{
/*{{{*/
let log_this = LOG_MAP.EV8_FLOATLOG;

if( log_this) log("t_fly_clr_handler .. CALLED BY "+ _caller);
/*}}}*/

    /* clearTimeout {{{*/
    t_fly_clr_cancel();

    /*}}}*/
    /* POSTPONE cleanup .. f(some onWork_EL selected) {{{*/
    if(/*TODO (_caller == "timer") &&*/ (onWork_EL != null))
    {
if( log_this) log("HOTSPOT CLEANUP POSTPONED BY %c"+get_n_lbl(onWork_EL), lbF+lb0);
        t_clr_fly_div_postponed   = true;
        t_log_clr_innerHTML_timer = setTimeout( t_fly_clr_handler, T_CLR_FLY_DIV_POSTPONED_DELAY);

        return;
    }
/*
log("%c HOTSPOT CLEANUP NOT POSTPONED", lbF+lb0);
*/
    /*}}}*/
    if(LOG_MAP.EV8_FLOATLOG || fly_log_checked) {
        /* REMOVE "removing" entries {{{*/
        let child_removed;
let count =              fly_div.childNodes.length;
        for(let i=0; i < fly_div.childNodes.length; i += (child_removed ? 0 : 1))
        {
            child_removed = false;
            let child = fly_div.childNodes[i];
            if( has_el_class(child, CSS_REMOVING) )
            {
                fly_div.removeChild(child);
                child_removed = true;
/*{{{
log("#"+i+" / "+count+" ....removed: "+get_id_or_tag(child))
}}}*/
         }
         else {
/*{{{
log("#"+i+" / "+count+" not removed: "+get_id_or_tag(child))
}}}*/
            }
        }
        /*}}}*/
/*{{{
logXXX("t_fly_clr_handler: fly_div.childNodes.length=["+fly_div.childNodes.length+"]");
}}}*/
        if(fly_div.childNodes.length < 2) {
            let closepin = get_el_child_with_class(fly_div, CSS_CLOSEPIN);
            if( closepin ) {
/*{{{
logXXX("REMOVING LONE CLOSEPIN");
}}}*/
                fly_div.removeChild( closepin );
            }
        }
    }
    else {
        /* DO THE CLEANUP {{{*/
if( log_this) log("HOTSPOT CLEANUP TRIGGERED BY "+ _caller+"");

        t_clr_fly_div_postponed   = false;
        t_fly_set("");

        /*}}}*/
    }

};
/*}}}*/
/*}}}*/
/*}}}*/

/** TARGET */
/*{{{*/
/* DIRECTION {{{*/
const CSS_LAYOUT_NE             = "layout_NE";
const CSS_LAYOUT_NW             = "layout_NW";
const CSS_LAYOUT_SE             = "layout_SE";
const CSS_LAYOUT_SW             = "layout_SW";

const CSS_POINT_EE              = "point_EE";
const CSS_POINT_SE              = "point_SE";
const CSS_POINT_SW              = "point_SW";
const CSS_POINT_WW              = "point_WW";
const CSS_POINT_NW              = "point_NW";
const CSS_POINT_NE              = "point_NE";
const CSS_POINT_00              = "point_00";
const CSS_POINT_XX
    = [   CSS_POINT_EE
        , CSS_POINT_SE
        , CSS_POINT_SW
        , CSS_POINT_WW
        , CSS_POINT_NW
        , CSS_POINT_NE
        , CSS_POINT_00
    ];

const CSS_ROTATE_NE             = "rotate_NE";
const CSS_ROTATE_NW             = "rotate_NW";
const CSS_ROTATE_SE             = "rotate_SE";
const CSS_ROTATE_SW             = "rotate_SW";
/*}}}*/
/* .. (LOG_MAP T3_LAYOUT EV3_UP) {{{*/
const TARGET_MAX              = 10;
const TARGET_SEL_TEXT_LEN_MAX = 128;

let target_tool;
/*}}}*/
/*_ [target_tools_map] ARRAY .. set get {{{*/

let target_tools_map = [];

let target_tools_map_set = function(tt_num, tt)
{
    target_tools_map.push({ tt_num:tt_num , tt:tt });
};

let target_tools_map_get = function(tt_num)
{
    for(let i=0; i < target_tools_map.length; ++i) {
        if(tt_num == target_tools_map[i].tt_num) {
            return   target_tools_map[i].tt    ;
        }
    }
    return null;
};
/*}}}*/
/*_ t_target_tool_sync_pastable {{{*/
let t_target_tool_sync_pastable = function()
{
    let pastable = t_get_current_sel_text();
    for(let tt_num=1; tt_num <= TARGET_MAX; ++tt_num)
    {
        let tt = target_tools_map_get(tt_num);
        if(tt && has_el_class(tt, CSS_PINNED))
            set_el_class_on_off(tt, "pastable", pastable);
    }
};
/*}}}*/
/*_ t_target_tool_set_parked {{{*/
/*{{{*/
const T_SEEKER_SET_PARKED_DELAY = 5000;

let   t_target_tool_set_parked_timer;
/*}}}*/
let t_target_tool_set_parked = function(parked, _caller)
{
/*{{{
                logXXX("t_target_tool_set_parked(parked "+parked+") .. CALLED BY "+_caller)//FIXME_PARKED
}}}*/

/*{{{ //FIXME_PARKED
    if( parked && t_target_tool_all_parked()) return;
    if(!parked && t_target_tool_not_parked()) return;

    log_key_val_group( "t_target_tool_set_parked(parked "+ parked+") .. "+_caller
                       , {                       parked  : parked
                           ,     target_tools_map_length : target_tools_map.length
                           ,   t_target_tool_all_parked  : t_target_tool_all_parked()
                           ,   t_target_tool_not_parked  : t_target_tool_not_parked()
                       }
                       , (parked ? lf8 : lf3)
                       , true
                     );
}}}*/

    if(t_target_tool_set_parked_timer) clearTimeout(t_target_tool_set_parked_timer);
       t_target_tool_set_parked_timer = null;

    /* ALL DONE .. WHEN DEFAULT STABLE STATE RESTORED */
    if( parked && t_target_tool_all_parked()) return;

    let delay = parked
        ?        T_SEEKER_SET_PARKED_DELAY
        :        0
    ;
    t_target_tool_set_parked_timer   =   setTimeout(function() { t_target_tool_set_parked_handler(parked, _caller); }, delay);
};
/*}}}*/
/*//FIXME_PARKED*/
/*_ t_target_tool_all_parked {{{*/
let t_target_tool_all_parked = function()
{
    let    tt =  target_tools_map_get(1);
    return tt ?  has_el_class(tt, "parked") : false
};
/*}}}*/
/*_ t_target_tool_not_parked {{{*/
let t_target_tool_not_parked = function()
{
    let    tt =  target_tools_map_get(1);
    return tt ? !has_el_class(tt, "parked") :  true;
};
/*}}}*/
/*//FIXME_PARKED*/
/*_ t_target_tool_set_parked_handler {{{*/
let t_target_tool_set_parked_handler = function(parked, _caller)
{
/*{{{
log("%c t_target_tool_set_parked_handler(parked "+parked+") .. "+_caller, (parked ? lf8 : lf3))//FIXME_PARKED
}}}*/
    if(!t_target_tool_set_parked_timer) return; /* has been canceled */

    for(let tt_num=1; tt_num <= TARGET_MAX; ++tt_num)
    {
        let tt = target_tools_map_get(tt_num);
        if(tt && has_el_class(tt, CSS_PINNED))
            set_el_class_on_off(tt, "parked", parked);
    }
    /* consume */
    t_target_tool_set_parked_timer = null;

    /* then auto park */
    if(!parked) t_target_tool_set_parked(true, "HANDLER");
};
/*}}}*/
/*_ t_target_get_sel_text {{{*/
let t_target_get_sel_text = function()
{
    let sel_text  = ellipsis(onDown_SEL_TEXT, TARGET_SEL_TEXT_LEN_MAX);

    return sel_text;
};
/*}}}*/
/*_ t_target_tool_new_XY_SEL_TEXT {{{*/
let t_target_tool_new_XY_SEL_TEXT = function(x, y, sel_text)
{
/*{{{*/
let caller = "t_target_tool_new_XY_SEL_TEXT";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller+"("+sel_text+")");
/*}}}*/

    let tt = t_target_tool_new(x, y);
    if(!tt ) return;

    /* paste selection */
    tt.date_MS = new Date().getTime();
    let    msg = trim_WORDS(sel_text) || sel_text;
    tt.msg     = ellipsis(msg, TARGET_SEL_TEXT_LEN_MAX);

    /* layout pad content */
    t_update_target_tool_pad( tt );

    /* enter lifted mode */
    t_target_tool_set_lifted(true);

    /* MOVE CREATED TARGET */
    t_set_onWork_EL(tt, caller);
    tt.clicked  = "handle";
    add_tool_pointermove_listener(caller);

    /* schedule a storage update */
    t_store_update_post(caller);

    return tt;
};
/*}}}*/
/*  t_target_tool_cycle_dir_class XXX checked by dom_target.html */
/*  t_target_tool_log {{{*/
let t_target_tool_log = function(tt, msg="", lfx)
{
    if(!tt) return;
    log_key_val_group( "target_tools tt_num["+tt.num+"] "+msg
                       , {   tt_num    : tt.num
                           , tt_id     : tt.id
                           , clicked   : tt.clicked
                           , className : tt.className
                           , date_MS   : tt.date_MS+" .. "+new Date(tt.date_MS)
                           , msg       : tt.msg
                           , title     : target_tool.title
                       }
                       , (lfx||lf8)
                       , true
                     );
};
/*}}}*/
/*  t_target_tool_get {{{*/
let t_target_tool_get = function(tt_num)
{
    let tt = target_tools_map_get(tt_num     ); /* FROM CACHE */
    if(!tt) {
        tt =    t_add_target_tool(tt_num,"tt"); /* CREATE NEW */
        target_tools_map_set     (tt_num, tt ); /* ADD CACHED */

/*{{{
t_log_panel_style_zIndex(tt, "TT GET: "+tt.num);
}}}*/
    }
    return tt;
};
/*}}}*/
/*  t_target_tool_new {{{*/
let t_target_tool_new = function(fixed_x, fixed_y)
{
/*{{{*/
let   caller = "t_target_tool_new("+fixed_x+", "+fixed_y+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* PICK NOT PINNED [tt_num] {{{*/
    let tt_num;
    for(tt_num = 1; tt_num <= TARGET_MAX; ++tt_num)
    {
        let tt = target_tools_map_get(tt_num);
        if(!tt || !has_el_class(tt, CSS_PINNED))
            break;
    }
    /*}}}*/
    /* WARN [TARGET_MAX] {{{*/
    if(tt_num > TARGET_MAX)
    {
        t_fly_add("<div class='stage_0_log'><em class='cc4'>tt_num > TARGET_MAX</em> .. <em class='big cc2'></div>");
/*{{{
        t_fly("<em class='cc4'>tt_num > TARGET_MAX</em> .. <em class='big cc2'>"+TARGET_MAX+"</em>");
}}}*/
        t_target_tool_feed();

        return;
    }
    /*}}}*/
    /* PLACE NEW OR UNPINNED [tt] {{{*/
    let tt = t_target_tool_get( tt_num );
    add_el_class(tt, "parked");
/*{{{
    t_target_tool_reorder(caller);
}}}*/


    let x = fixed_x + window.scrollX;
    let y = fixed_y + window.scrollY - TARGET_TOOL_HALF_HEIGHT;
/*{{{
    tt.style.left     = window.scrollX + fixed_x+"px";
    tt.style.top      = window.scrollY + fixed_y+"px";
}}}*/
    t_pin_tool_at_XY(tt, x, y);
    t_store_update_post(caller);

    let thumb_p     = 100 * tt.offsetTop / get_page_height();
    let thumb_p_str = get_thumb_p_str(thumb_p);
    tt.title        = thumb_p_str;

    /*}}}*/
    /* CENTER [targe_tool] {{{*/
    t_target_tool_scrollTo(tt_num, fixed_x, fixed_y);

    /*}}}*/
    return tt;
};
/*}}}*/
/*_ t_target_tool_set_lifted {{{*/
let t_target_tool_set_lifted = function(state)
{
    let some_was_changed;
    for(let tt_num=1; tt_num <= TARGET_MAX; ++tt_num)
    {
        let tt = target_tools_map_get(tt_num);
        if(!tt) continue;
        some_was_changed
            =   some_was_changed
            || (state != has_el_class(tt, CSS_LIFTED))
        ;
        set_el_class_on_off(tt, CSS_LIFTED, state);
        if(state) t_update_target_tool_tt_dat(tt);
    }
/*{{{
logXXX("t_target_tool_set_lifted("+state+"): ...return some_was_changed=["+some_was_changed+"]");
}}}*/
    return some_was_changed;
};
/*}}}*/
/*  t_set_target_tool_from_el .. CURRENT [target_tool] {{{*/
let t_set_target_tool_from_el = function(from_el)
{
/*{{{*/
let  caller = "t_set_target_tool_from_el("+get_n_lbl(from_el)+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* new_target_tool {{{*/
    let new_target_tool = get_el_parent_with_class(from_el, CSS_TARGET_TOOL);

    if(!new_target_tool) return false;

    /*}}}*/
    /* previous target_tool {{{*/
    if( target_tool ) del_el_class(target_tool, CSS_SEEK_TARGET);
/*{{{
    if( target_tool ) del_el_class(target_tool, CSS_PRESSED);
    if( target_tool ) setTimeout(function() { del_el_class(target_tool, CSS_PRESSED); }, 250);
}}}*/

    /*}}}*/
    /* CLICK [handle] {{{*/
    target_tool = new_target_tool;

    if( get_el_parent_with_class(from_el, "handle"))
    {
if( log_this) log("%c target_tool CLICK HANDLE", lbH+lf4);

        target_tool.clicked = "handle";
    }
    /*}}}*/
    /* CLICK [pad] {{{*/
    else {
if( log_this) log("%c target_tool CLICK PAD", lbH+lf3);

        if( has_el_class(from_el, "tt_pin") )
            target_tool.clicked = "tt_pin";
        else
            target_tool.clicked = "pad";

        add_el_class(target_tool, CSS_SEEK_TARGET);
        s_clear_last_highlight_slot();
    }
    /*}}}*/
    /* UPDATE [tt_dat] {{{*/
    t_update_target_tool_tt_dat(target_tool);

    /*}}}*/
if( log_this) t_target_tool_log(target_tool, lf9);
    return true
};
/*}}}*/
/*  t_target_tool_unpin_tt_num {{{*/
let t_target_tool_unpin_tt_num = function(tt_num)
{
/*{{{*/
let   caller = "t_target_tool_unpin_tt_num";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+"("+tt_num+")", lbH+lf5);
/*}}}*/
    /* UNPIN tt {{{*/
    for(let i=0; i < target_tools_map.length; ++i)
    {
        if(target_tools_map[i].tt_num == tt_num)
        {
            let  tt = target_tools_map[i].tt;
if( log_this) log("...unchecking tt.num["+tt.num+"] .. tt_num["+tt_num+"] .. tt.id=["+tt.id+"]");

            t_set_CSS_PINNED(tt, false);
            tt.style.display = "none";

            tt.date_MS = 0;

/*{{{
            t_target_tool_reorder(caller);
}}}*/

            t_store_update_post(caller);
            break;
        }
    }
    /*}}}*/
};
/*}}}*/
/*  t_move_seeker_PU_on_target_tool {{{*/
let t_move_seeker_PU_on_target_tool = function(tt)
{
/*{{{
    t_seeker_move_above_XY(seeker_PU, tt.offsetLeft, tt.offsetTop);
}}}*/
/*{{{
    let x_sign = (onMoveDXY.x >= 0) ? 1 : -1;
    let y_sign = (onMoveDXY.y >= 0) ? 1 : -1;

    let x = onDown_XY.x + x_sign * Math.min(32, Math.abs(onMoveDXY.x));
    let y = onDown_XY.y + y_sign * Math.min(32, Math.abs(onMoveDXY.y));
}}}*/

    if(!t_seeker_PU_is_active())
        t_seeker_PU_show();

    let x = tt.offsetLeft - onDown_SCROLL_XY.x;
    let y = tt.offsetTop  - onDown_SCROLL_XY.y;

    t_seeker_move_on_target_tool(tt, x,y);
};
/*}}}*/
/*  t_seek_next_target_tool {{{*/
let t_seek_next_target_tool = function(tt_from, dir=1)
{
/*{{{*/
    let caller = "t_seek_next_target_tool";
let log_this = LOG_MAP.T3_LAYOUT;

/*{{{
logXXX(caller+"("+tt_from.id+" , "+dir+")");
}}}*/
/*}}}*/
    let tt = !dir
        ?    tt_from
        :    t_get_next_pinned_target_tool(tt_from, dir);
    if( tt ) {
        /* [CSS_SEEK_TARGET] ON [tt] {{{*/
if( log_this) log("%c"+caller+"%c"+tt.num, lbL+lf3, lbR+lf4);

        t_set_onWork_EL(tt, caller);

        add_el_class(tt, CSS_SEEK_TARGET);

        t_move_seeker_PU_on_target_tool(tt);

        /*}}}*/
        /* [WINDOW SCROLL TO] NEW CURRENT TARGET TOOL {{{*/
        let tt_num = t_target_tool_get_targetNum_of(tt);
        let   fixed_x = tt.offsetLeft - onDown_SCROLL_XY.x;
        let   fixed_y = tt.offsetTop  - onDown_SCROLL_XY.y;

        t_target_tool_scrollTo(tt_num, fixed_x, fixed_y);
        /*}}}*/
    }
    /* OR HIDE seeker_PU {{{*/
    else if( t_seeker_PU_is_active() )
    {
        t_seeker_PU_hide("instant");
    }
    /*}}}*/
};
/*}}}*/
/*  t_get_next_pinned_target_tool {{{*/
let t_get_next_pinned_target_tool = function(tt_from, dir)
{
/*{{{*/
    let caller = "t_get_next_pinned_target_tool";
let log_this = LOG_MAP.T3_LAYOUT;

/*}}}*/
    /* [tt_from] index {{{*/
    if(!dir) return tt_from;

    let idx_from
        = t_target_tool_get_targetNum_of(tt_from)
        + dir /* next */
        - 1   /* make it zero-based to deal with modulo */
    ;

    /*}}}*/
    /* next PINNED {{{*/
    let tt;
    for(let step = 0; step < TARGET_MAX; ++step) /* may wrap */
    {
        let tt_num = 1 + (idx_from + step*dir + TARGET_MAX) % TARGET_MAX;
        tt         = t_target_tool_get(tt_num);

        if( has_el_class(tt, CSS_PINNED) )     break;
        else                               tt = null;
    }
    /*}}}*/
if( log_this) log("%c"+caller+"("+tt_from.id+" dir="+dir+") %c return "+(tt ? tt.num : "null"), lbL+lf9, lbR+(tt ? lf3:lf2));
    return tt;
};
/*}}}*/
/*  t_get_pinned_target_tool_count {{{*/
let t_get_pinned_target_tool_count = function()
{
    let count = 0;
    for(let i=0; i < target_tools_map.length; ++i)
    {
        let  tt    = target_tools_map[i].tt;
        count     += has_el_class(tt, CSS_PINNED) ? 1 : 0;
    }
    return count;
};
/*}}}*/
/*  t_seeker_move_on_target_tool {{{ */
let t_seeker_move_on_target_tool = function(tt, fixed_x, fixed_y)
{
/* {{{*/
let   caller = "t_seeker_move_on_target_tool("+fixed_x+" "+fixed_y+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/
    /* [seeker_CU] content {{{*/
    let tt_num = t_target_tool_get_targetNum_of( tt );

    seeker_CU.innerHTML
        = (prop_get(TOOLS_EXTRAS) ? "<sup>"+SYMBOL_LEFT_ARROW+"</sup>" : "")
        + tt_num
    ;
    /*}}}*/
    /* [seeker_CU] style {{{*/
    set_el_class(seeker_CU, "cc"+(tt_num % 10));

    /*}}}*/
/*{{{
    let xy = get_el_xy(tt, caller);

    let x = onDown_XY.x + onMoveDXY.x;
    let y = onDown_XY.y + onMoveDXY.y;

    t_seeker_move_above_XY(seeker_PU, xy.x, xy.y);
}}}*/
    /* center seekerPU at target_tool handle tip */
    fixed_y += TARGET_TOOL_HALF_HEIGHT + seeker_PU.offsetHeight / 6;
    t_seeker_move_above_XY(seeker_PU, fixed_x+onDown_SCROLL_XY.x, fixed_y+onDown_SCROLL_XY.y);
};
/*}}}*/
/*_ t_target_tool_get_targetNum_of {{{*/
let t_target_tool_get_targetNum_of = function(el)
{
    for(let i=0; i < target_tools_map.length; ++i) {
        let tt     = target_tools_map[i].tt;
        if( tt.id == el.id) return tt.num;
    }
    return 0; /* not a tt_num */
};
/*}}}*/
/*  t_target_tool_scrollTo {{{*/
const TARGET_TOOL_HALF_HEIGHT = 36;
let t_target_tool_scrollTo = function(tt_num, fixed_x, fixed_y)
{
/*{{{*/
let   caller = "t_target_tool_scrollTo";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) t_log_event_status(caller+"(tt_num=["+tt_num+"], fixed_xy=["+fixed_x+" "+fixed_y+"])", lf5);
/*}}}*/
    /* ELECT CURRENT TARGET_TOOL {{{*/
    let tt = t_target_tool_get( tt_num );

    t_set_target_tool_from_el(tt);
/*{{{
    setTimeout(function() { del_el_class(tt, CSS_PRESSED); }, 250);
}}}*/
    /*}}}*/
    /* CENTER [tt] {{{*/
    let xy = get_el_xy(tt, caller);
    let  x = Math.floor(xy.x                      );
    let  y = Math.floor(xy.y + tt.offsetHeight / 2);

    if( !t_is_xy_in_viewport(x, y) )
    {
        let scrollBehavior
            = t_is_xy_near_viewport(x, y)
            ? "smooth"
            : "" /* use current default */
        ;

        x -= w_W / 2;
        y -= w_H / 2;

        x  = Math.max(0, x);
        y  = Math.max(0, y);

        t_window_scrollTo(x, y, scrollBehavior);
    }
    /*}}}*/
};
/*}}}*/
/* CREATE */
/*  t_add_target_tool {{{*/
let t_add_target_tool = function(tt_num, id, zIndex=ZINDEX_TARGET_TOOL_ZERO)
{
/*{{{*/
let   caller = "t_add_target_tool("+tt_num+" id=["+id+"])";
let log_this = LOG_MAP.T3_LAYOUT;

/*}}}*/

    let tt            = document.createElement("DIV");
    tt.num            = 1+ (tt_num-1) % TARGET_MAX; /* (0..9) */
/*{{{
    tt.id             = "target_tool_"+tt_num;
}}}*/
    tt.id             = id+"_"+tt_num;
    tt.className      = CSS_TARGET_TOOL +" fg"+(tt.num % 10);
    tt.style.display  = "none";
    tt.style.position = "absolute";
    tt.style.zIndex   = zIndex + tt_num;

    tt.title          = tt.id;
    tt.innerHTML
        = "<span  class='handle'>&nbsp;"
        + " <span class='tt_dir'>"+SYMBOL_CLOCKWISE_OPEN_CIRCLE+"</span>"
        + "</span>"
        + "<div   class='pad bg"+(tt.num % 10)+"'>"
        +  "<span class='tt_pin'>"+ SYMBOL_TT_PIN +"</span>"
        + "</div>"
    ;

    dom_tools_html.appendChild(tt);

if( log_this) log(caller+"%c"+ tt.id, lbH+lf5);
    return tt;
};
/*}}}*/
/*  t_pin_tt_at_XY_position_date_MS_msg {{{*/
let t_pin_tt_at_XY_position_date_MS_msg = function(tt, x,y ,position,date_MS, msg)
{
    t_pin_tool_at_XY(tt, x,y, position);

    tt.date_MS = date_MS;
    tt.msg     = msg;

    t_set_CSS_PINNED(tt, true);
    tt.style.display = "block";

    /*
     * LOADING ALL PINNED [target_tool]
     * THE CALLER SHOULD TAKE CARE OF THE ORDERING WHEN DONE
     * NEED ORDERING .. CHANGED [PINNED-TIME-DATE]
     */
};
/*}}}*/
/*  t_target_tool_cycle_dir_class XXX checked by dom_target.html */
/*  t_target_tool_cycle_dir_class {{{*/
let t_target_tool_cycle_dir_class = function(tt,dir)
{
/*{{{
logXXX("t_target_tool_cycle_dir_class("+tt.id+", dir=["+dir+"])");
}}}*/
    let prev_class = set_el_class_removing(tt, "", CSS_POINT_XX);
/*{{{
logBIG("...prev_class=["+prev_class+"]");
}}}*/

    let next_class;
    switch(dir)
    {
    default:
    case "CYCLE":
    next_class
        = (prev_class == ""          ) ? CSS_POINT_SE
        : (prev_class == CSS_POINT_EE) ? CSS_POINT_SE /* CLOCKWISE */
        : (prev_class == CSS_POINT_SE) ? CSS_POINT_SW
        : (prev_class == CSS_POINT_SW) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_WW) ? CSS_POINT_NW
        : (prev_class == CSS_POINT_NW) ? CSS_POINT_NE
        : /*____________ CSS_POINT_NE */ CSS_POINT_EE
    ;
    break;

    case    "UP": /* can swtich from SW or SE or EE */
    next_class
        = (prev_class == ""          ) ? CSS_POINT_NE
        : (prev_class == CSS_POINT_EE) ? CSS_POINT_NE
        : (prev_class == CSS_POINT_SE) ? CSS_POINT_EE
        : (prev_class == CSS_POINT_SW) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_WW) ? CSS_POINT_NW
        : (prev_class == CSS_POINT_NW) ? CSS_POINT_NW
        : /*____________ CSS_POINT_NE */ CSS_POINT_NE
    ;
   break;

    case  "DOWN":
    next_class
        = (prev_class == ""          ) ? CSS_POINT_SE
        : (prev_class == CSS_POINT_EE) ? CSS_POINT_SE
        : (prev_class == CSS_POINT_SE) ? CSS_POINT_SE
        : (prev_class == CSS_POINT_SW) ? CSS_POINT_SW
        : (prev_class == CSS_POINT_WW) ? CSS_POINT_SW
        : (prev_class == CSS_POINT_NW) ? CSS_POINT_WW
        : /*____________ CSS_POINT_NE */ CSS_POINT_EE
    ;
   break;

    case "RIGHT":
    next_class
        = (prev_class == ""          ) ? CSS_POINT_EE
        : (prev_class == CSS_POINT_EE) ? CSS_POINT_EE
        : (prev_class == CSS_POINT_SE) ? CSS_POINT_EE
        : (prev_class == CSS_POINT_SW) ? CSS_POINT_SE
        : (prev_class == CSS_POINT_WW) ? CSS_POINT_EE
        : (prev_class == CSS_POINT_NW) ? CSS_POINT_NE
        : /*____________ CSS_POINT_NE */ CSS_POINT_EE
    ;
      break;

    case  "LEFT":
    next_class
        = (prev_class == ""          ) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_EE) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_SE) ? CSS_POINT_SW
        : (prev_class == CSS_POINT_SW) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_WW) ? CSS_POINT_WW
        : (prev_class == CSS_POINT_NW) ? CSS_POINT_WW
        : /*____________ CSS_POINT_NE */ CSS_POINT_NW
    ;
     break;

    }

/*{{{
logBIG("...next_class=["+next_class+"]");
}}}*/

    if(next_class) add_el_class(tt, next_class);

};
/*}}}*/
/*  t_set_target_tool_pointing .. TODO .. [CLEANUP THIS POINT + SWITCH MESS] {{{*/
let t_set_target_tool_pointing = function(tt, pointing_E, pointing_N, switching_N, switching_S, switching_E, switching_W)
{
    /* remove direction className */
    set_el_class_removing(tt, "", CSS_POINT_XX);

    let dir_class;

    if     (switching_N  ) dir_class = pointing_E ? CSS_POINT_NE : CSS_POINT_NW; /* NORTH-SOUTH .. keeping current EAST-WEST */
    else if(switching_S  ) dir_class = pointing_E ? CSS_POINT_SE : CSS_POINT_SW;

    else if(switching_E  ) dir_class = pointing_N ? CSS_POINT_NE : CSS_POINT_SE; /* EAST-WEST   .. keeping current NORTH-SOUTH */
    else /* switching_W */ dir_class = pointing_N ? CSS_POINT_NW : CSS_POINT_SW;

    if(dir_class)        add_el_class(tt, dir_class);

};
/*}}}*/
/* EVENT */
/*  t_target_tool_CB {{{*/
let t_target_tool_CB = function(tt)
{
/*{{{*/
let   caller = "t_target_tool_CB";
let log_this = LOG_MAP.EV3_UP || LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller, lbH+lf3);
/*}}}*/
    /* state {{{*/
    let sel_text       = t_get_current_sel_text() || onDown_SEL_TEXT;

    let state_clicked_page     = !onWork_PANEL && !t_is_a_tool_el(tt) && !onWork_SEEK_TOOL;
    let state_tt_feed_deployed = dimm_mask_displayed();

    let state_onTarget         = (target_tool != undefined) &&     (tt  ==  target_tool );
    let state_target_clicked   = (target_tool != undefined) ?               target_tool.clicked  : ""       ;
    let state_clicked_handle   = state_onTarget             &&             (target_tool.clicked == "handle");
    let state_clicked_pad      = (target_tool != undefined) &&             (target_tool.clicked == "pad"   );
    let state_clicked_tt_pin   = (target_tool != undefined) &&             (target_tool.clicked == "tt_pin");
    let state_target_lifted    = (target_tool != undefined) && has_el_class(target_tool,         CSS_LIFTED);

    let state_clicked_tt_feed  = (target_tool != undefined) &&      has_el_class(target_tool,     "tt_feed");

    /*}}}*/
    /* action {{{*/
    let action_tt_pin_unpin            =  state_clicked_tt_pin;
    let action_tt_feed_select          =  state_clicked_tt_feed && !state_clicked_tt_pin;
    let action_pad_selection_paste     = !state_clicked_tt_feed &&  state_target_clicked && (sel_text != "");
    let action_handle_or_lifted_toggle = !state_clicked_tt_feed && (state_target_lifted  ||  state_clicked_handle);
    let action_pad_not_lifted_choose   = !state_clicked_tt_feed &&  state_clicked_pad    && !state_target_lifted;

    /*}}}*/
    /*{{{*/
    if(log_this) {
        if(target_tool)
            t_target_tool_log(target_tool, lf6);

        log_key_val(    "state"
                              , {   sel_text       : "["+ellipsis_short(sel_text)+"]"
                                  , onWork_PANEL           : get_n_lbl(onWork_PANEL)

                                  , state_clicked_page     : state_clicked_page
                                  , state_tt_feed_deployed : state_tt_feed_deployed

                                  , state_onTarget         : state_onTarget
                                  , state_target_clicked   : state_target_clicked
                                  , state_clicked_handle   : state_clicked_handle
                                  , state_clicked_pad      : state_clicked_pad
                                  , state_clicked_tt_pin   : state_clicked_tt_pin
                                  , state_target_lifted    : state_target_lifted

                                  , state_clicked_tt_feed  : state_clicked_tt_feed

                              }
                              , lf5, false
                         );

        log_key_val(    "action"
                              , {   action_tt_pin_unpin            : action_tt_pin_unpin
                                  , action_tt_feed_select          : action_tt_feed_select
                                  , action_pad_selection_paste     : action_pad_selection_paste
                                  , action_handle_or_lifted_toggle : action_handle_or_lifted_toggle
                                  , action_pad_not_lifted_choose   : action_pad_not_lifted_choose
                              }
                              , lf4, false
                         );
    }
    /*}}}*/
    /* transition {{{*/
    let      transition;
    if     ( action_tt_pin_unpin            ) { t_target_tool_unpin_tt_num( target_tool.num    ); transition = "PIN"                +" .. UNPIN TARGET"   ; }
    else if( action_tt_feed_select          ) { t_target_tool_feed_select ( target_tool        ); transition = "FEED"               +" .. STOP CHOOSER"   ; }
    else if( action_pad_selection_paste     ) { t_target_tool_feed        ( target_tool        ); transition = "PAD WITH SELECTION" +" .. PASTE SELECTION"; }
    else if( action_pad_not_lifted_choose   ) { t_target_tool_feed        (                    ); transition = "PAD"                +" .. START CHOOSER"  ; }
    else if( action_handle_or_lifted_toggle ) { t_target_tool_set_lifted  (!state_target_lifted); transition = "HANDLE OR LIFTED"   +" .. TOGGLE LIFTED "+(state_target_lifted ? "OFF" : "ON"); }

    /*}}}*/
    /* NO MORE TARGET .. STOP CHOOSER {{{*/
    if(action_tt_pin_unpin && state_tt_feed_deployed && !t_target_tool_feed_deploy())
    {
        t_target_tool_feed_stop(caller);
        dimm_stop(caller);
    }
    /*}}}*/
if(log_this) log("%c transition .. %c"+(transition ? transition : "NONE"), lbb+lbH+lf4, lbb+lbH+lf6);
    return transition;
};
/*}}}*/
/*  t_update_target_tool_pad {{{*/
const SECONDS_MS =  1000;
const MINUTES_MS =  60 * SECONDS_MS;
const   HOURS_MS =  60 * MINUTES_MS;
const    DAYS_MS =  24 *   HOURS_MS;
const  MONTHS_MS =  30 *    DAYS_MS;
const   YEARS_MS = 365 *  MONTHS_MS;

let t_update_target_tool_pad = function(tt)
{
/*{{{*/
let   caller = "t_update_target_tool_pad";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this)
    log(caller+"%c"+tt.id+"%c tt.num=["+tt.num+"] %c date_MS=["+tt.date_MS+"] %c msg=["+tt.msg+"]"
        ,        lbL+lf8   ,lbC+lf3               ,lbR+lf3                    ,lbH+lf9            );
/*}}}*/
    /* tt_num {{{*/
    let tt_num = (tt.num == 10) ? "X" : tt.num;

    /*}}}*/
    /* tt_msg {{{*/
    let tt_msg = tt.msg || "";

    /*}}}*/
    /* tt_size {{{*/
    let tt_size
        = "weight3 "
        +(    (tt_msg.length <=  5) ? "size4"
            : (tt_msg.length <= 15) ? "size3"
            : (tt_msg.length <= 25) ? "size2"
            :                         "size1"
         );
    /*}}}*/

    let handle = tt.firstElementChild;
    let    pad = handle.nextElementSibling;
/*{{{
    let      c = "RTABSrtabs".substring(tt.num-1,tt.num);
}}}*/
    pad.innerHTML
        =  "<span class='tt_num'>"            + tt_num          +"</span>"
        +  "<span class='tt_pin'>"            + SYMBOL_TT_PIN   +"</span>"
        +  "<span class='tt_msg "+tt_size+"'>"+ tt_msg          +"</span>"
        +  "<span class='tt_dat'>"                              +"</span>"
        +  "<span class='tt_paste'>"          + SYMBOL_TT_PASTE +"</span>"
    ;
    pad.className
        = "pad bg"+(tt.num % 10)
    ;

/*{{{
log_key_val_group( tt.id
                   , {   tt_num : tt_num
                       , tt_size: tt_size
                       , tt_msg : tt_msg
                       , tt_dat : strip_html(tt_dat)
                       , tt_pad : strip_html(pad.innerHTML)
                   }, lf9, false);
t_target_tool_log(tt);
}}}*/

    t_update_target_tool_tt_dat(tt);

    t_store_update_post(caller);
};
/*}}}*/
/*  t_update_target_tool_tt_dat {{{*/
let t_update_target_tool_tt_dat = function(tt)
{
/*{{{*/
let   caller = "t_update_target_tool_tt_dat";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this)
    log(caller+"%c"+tt.id+"%c tt.num=["+tt.num+"] %c date_MS=["+tt.date_MS+"] %c msg=["+tt.msg+"]"
        ,        lbL+lf8   ,lbC+lf3               ,lbR+lf3                    ,lbH+lf9            );
/*}}}*/
    let tt_num = (tt.num == 10) ? "X" : tt.num;

    let delay = "";
    if( tt.date_MS )
    {
        let date   = new Date(tt.date_MS);
        let now    = new Date();

        let diff   = now - date;

        let span = {};
        span["years"  ] =  Math.floor(diff /   YEARS_MS); diff -=   YEARS_MS * span.years;
        span["months" ] =  Math.floor(diff /  MONTHS_MS); diff -=  MONTHS_MS * span.months;
        span["days"   ] =  Math.floor(diff /    DAYS_MS); diff -=    DAYS_MS * span.days;
        span["hours"  ] =  Math.floor(diff /   HOURS_MS); diff -=   HOURS_MS * span.hours;
        span["minutes"] =  Math.floor(diff / MINUTES_MS); diff -= MINUTES_MS * span.minutes;
        span["seconds"] =  Math.floor(diff / SECONDS_MS);

        let dy = span.years;
        let dm = span.months;
        let dd = span.days;
        let dh = span.hours;
        let dn = span.minutes;
        let ds = span.seconds;
        delay = ""
            + " <span>"
            + (dy ? ("<span class='weight1 size1'>"+ dy +"y </span>") : "")
            + (dm ? ("<span class='weight3 size1'>"+ dm +"m </span>") : "")
            + (dd ? ("<span class='weight2 size1'>"+ dd +"d </span>") : "")
            + (dh ? ("<span class='weight3 size3'>"+ dh +"h </span>") : "")
            + (dn ? ("<span class='weight2 size2'>"+ dn +"m </span>") : "")
            + (ds ? ("<span class='weight3 size1'>"+ ds +"s </span>") : "")
            + "</span>"
        ;
    }

    if(delay)
    {
        let handle = tt.firstElementChild;
        let    pad = handle.nextElementSibling;
        let tt_dat = get_el_child_with_class(pad, "tt_dat");
        tt_dat.innerHTML = delay;
/*{{{
logBIG("delay=["+strip_html(delay)+"]");
}}}*/
    }
};
/*}}}*/
/*  t_target_tool_reorder {{{*/
let t_target_tool_reorder = function(_caller)
{
/*{{{*/
let  caller = "t_target_tool_reorder";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+"%c CALLED BY "+ _caller, lbL+lf6,lbR+lf6);
/*}}}*/
/*{{{*/
if(log_this) {
    log("%c NOT SORTED ON DATE .. target_tools_map.size=["+target_tools_map.size+"]...", lbb+lf3);

    for(let i=0; i < target_tools_map.length; ++i) {
        let tt_num = target_tools_map[i].num;
        let tt     = target_tools_map[i].tt;
        if(tt.date_MS) log("tt_num=["+tt_num+"] .. tt.date_MS=["+tt.date_MS+"] "+new Date(tt.date_MS));
    }
}
/*}}}*/
    /* Array sort on date {{{*/
    targets = [];
    for(let i=0; i <  target_tools_map.length; ++i)
        targets.push( target_tools_map[i].tt );

    targets
        = targets.sort(
                       function(a,b) {
                           if(!a.date_MS)             return  1; /* undefined a to the   end */
                           if(!b.date_MS)             return -1; /*   defined a to the start */
                           if( a.date_MS > b.date_MS) return  1;
                           if( a.date_MS < b.date_MS) return -1;
                           else                       return  0;
                       }
                      );
    /*}}}*/
    /* renumber collection {{{*/
    target_tools_map = [];
    let tt_num = 0;
    for(let i=0; i < targets.length; ++i)
    {
        let tt = targets[i];
        tt.num =       1+i;
        t_update_target_tool_pad(tt);
        target_tools_map_set(tt.num, tt);
    }
    /*}}}*/
/*{{{*/
if(log_this) {
    log("%c SORTED ON DATE .. targets.length=["+targets.length+"]...", lbb+lf4);

    for(let i=0; i <  target_tools_map.length; ++i) {
        let tt_num =  target_tools_map[i].num;
        let tt     =  target_tools_map[i].tt;
        if( tt.date_MS) log("tt_num=["+tt_num+"] .. tt.num=["+tt.num+"] tt.date_MS=["+tt.date_MS+"] "+new Date(tt.date_MS));
    }
}
/*}}}*/
};
/*}}}*/
/* FEED */
/*  t_target_tool_feed {{{*/
/*{{{*/
let tt_feed_array = [];
let tt_to_feed;
/*}}}*/
let t_target_tool_feed = function(tt_for)
{
/*{{{*/
let   caller = "t_target_tool_feed("+get_n_lbl(tt_for)+")";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) t_log_event_status(caller, lf7);
/*}}}*/

    if( t_seeker_PU_is_active() )
        t_seeker_PU_hide("instant");

    tt_to_feed
        = (tt_for && !has_el_class(tt_for, "tt_feed")) ? tt_for
        : null;

    if(tt_for)
    {
        t_target_tool_feed_select( tt_for );
    }
    else {
        if(!tt_feed_array.length)
            t_target_tool_feed_init_tt_feed_array();

        dimm_start_target_tool(caller);
        t_target_tool_feed_repin();
        t_target_tool_feed_select(); /* clear TT_FEED_SELECTED */
        t_target_tool_feed_collapse();
        t_target_tool_feed_re_point();
        t_target_tool_feed_deploy();
    }

/* TODO ...deal with CLIPBOARD Promise */
};
/*}}}*/
/*_ t_target_tool_feed_init_tt_feed_array {{{*/
let t_target_tool_feed_init_tt_feed_array = function()
{
    for(let tt_num = 1; tt_num <= 10; ++tt_num)
    {
        let tt = t_add_target_tool(tt_num, "tt_feed", ZINDEX_ABOVE_TOOLS);

        /* overload */
        tt.style.position = "fixed";
        tt.innerHTML
            = "<span  class='handle'>&nbsp;"
            + "</span>"
            + "<div   class='pad bg"+(tt_num % 10)+"'>"
            +  "<span class='tt_pin'>"+ SYMBOL_WASTEBASKET +"</span>"
            + "</div>"
        ;

        add_el_class(tt, "tt_feed");

        tt_feed_array.push(tt);

/*{{{
t_log_panel_style_zIndex(tt, "TT FEED INIT: "+tt.id);
}}}*/
    }
};
/*}}}*/
/*_ t_target_tool_feed_re_point {{{*/
let t_target_tool_feed_re_point = function()
{
/*{{{
logBIG("t_target_tool_feed_re_point");
}}}*/
    for(let tt_num = 1; tt_num <= 10; ++tt_num)
    {
        let tt_feed = tt_feed_array[tt_num-1];

        if     (tt_num < 3) set_el_class_removing(tt_feed, CSS_POINT_NE, CSS_POINT_XX);
        else if(tt_num < 5) set_el_class_removing(tt_feed, CSS_POINT_EE, CSS_POINT_XX);
        else if(tt_num < 6) set_el_class_removing(tt_feed, CSS_POINT_SE, CSS_POINT_XX);
        else if(tt_num < 7) set_el_class_removing(tt_feed, CSS_POINT_SW, CSS_POINT_XX);
        else if(tt_num < 9) set_el_class_removing(tt_feed, CSS_POINT_WW, CSS_POINT_XX);
        else                set_el_class_removing(tt_feed, CSS_POINT_NW, CSS_POINT_XX);
    }
};
/*}}}*/
/*_ t_target_tool_feed_deploy {{{*/
let t_target_tool_feed_deploy = function()
{
/*{{{*/
let caller = "t_target_tool_feed_deploy";
let log_this = LOG_MAP.T3_LAYOUT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller);
/*}}}*/
/*{{{
}}}*/
    /* [center radius] {{{*/
    t_cache_w_H_w_W_p_H();
    let center_x  = w_W / 2;
    let center_y  = w_H / 2;
    let radius    = Math.min(w_W,w_H) / 4;
/*{{{
logXXX("center ["+center_x+" "+center_y+"] .. radius ["+radius+"]");
}}}*/

    let deg_delta = 360 / 12;
    let deg_start = -90 + deg_delta; /*..............ONE O'CLOCK */
    let rad_delta = deg_delta * Math.PI / 180;
    let rad_start = deg_start * Math.PI / 180;
/*{{{
logXXX("deg_start=["+    deg_start +"]");
logXXX("deg_delta=["+    deg_delta +"]");
logXXX("...rad_delta=["+ rad_delta +"]");
logXXX("...rad_start=["+ rad_start +"]");
}}}*/

    /*}}}*/
/*{{{
if(tt_to_feed) logBIG("tt_to_feed=["+get_n_lbl(tt_to_feed)+"]");
}}}*/
    let tt_feed_deployed = 0;
    for(let tt_num=1; tt_num <= tt_feed_array.length; ++tt_num)
    {
        let        tt_feed = tt_feed_array[tt_num-1];
        if(!tt_feed) continue;
        let    tt_feed_handle = tt_feed.firstElementChild;
        let       tt_feed_pad = tt_feed_handle.nextElementSibling;

        if(tt_to_feed) {
            tt_feed_deployed += t_target_tool_feed_provision(tt_num, tt_feed_handle, tt_feed_pad);
        }
        else {
            tt_feed_deployed += t_target_tool_feed_clone(tt_num, tt_feed_handle, tt_feed_pad);
        }

/* SHOW [CLIPBOARD] {{{
    let clipboard = document.execCommand("paste");
    let clipboard = navigator.clipboard.readText();
    let clipboard = window.getSelection();
}}}*/

        /* t_pin_tool_at_XY(NEW OR LAST) {{{*/
        let rad_angle = rad_start + rad_delta * (tt_num-1);

        let deg_angle = Math.floor(0.5 + rad_angle / Math.PI * 180) % 360;

        let      tt_x = center_x + radius * Math.cos(rad_angle);
        let      tt_y = center_y + radius * Math.sin(rad_angle);
/*{{{
logXXX("...rad_angle=["+rad_angle+"]");
logXXX("...deg_angle=["+deg_angle+"]");
logXXX("... Math.sin(rad_angle)=["+ Math.sin(rad_angle)+"]");
logXXX("...["+tt_x+" "+tt_y+"]");
        tt_feed.style.position = "fixed";
}}}*/
        t_pin_tool_at_XY(tt_feed, tt_x,tt_y);
        tt_feed.style.zIndex = ZINDEX_ABOVE_TOOLS + tt_num;
        /*}}}*/
    }

if( log_this) log(caller+": ...return tt_feed_deployed=["+tt_feed_deployed+"]");
    return tt_feed_deployed;
};
/*}}}*/
/*_ t_target_tool_feed_provision {{{*/
let t_target_tool_feed_provision = function(tt_num, tt_feed_handle, tt_feed_pad)
{
/*{{{*/
let caller = "t_target_tool_feed_provision";
let log_this = LOG_MAP.T3_LAYOUT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+"(tt_num=["+tt_num+"], tt_feed_handle=["+get_n_lbl(tt_feed_handle)+"], tt_feed_pad=["+get_n_lbl(tt_feed_pad)+"])");
/*}}}*/
    let tt_feed_deployed = 0;
            /* FIRST .. [onDown_SEL_TEXT] {{{*/
            if((tt_num == 1) && onDown_SEL_TEXT)
            {
                /* tt_feed_handle {{{*/
                add_el_class(tt_feed_handle, "size4");
                tt_feed_handle.innerText = SYMBOL_CLIPBOARD;

                /*}}}*/
                /* tt_feed_pad {{{*/
                let msg = t_target_get_sel_text();
                let tt_class
                    =    (msg.length <=  5) ? "size5"
                       : (msg.length <= 10) ? "size4"
                       : (msg.length <= 15) ? "size3"
                       : (msg.length <= 25) ? "size2"
                       :                      "size1"
                     ;

                tt_feed_pad   .innerHTML = "<span class='clipboard "+tt_class+"'>"+msg+"</span>";
                /*}}}*/
                tt_feed_deployed += 1;
            }
            /*}}}*/
            /* SECOND .. CURRENT [tt_to_feed.msg] {{{*/
            else if(tt_num == 2)
            {
                /* tt_feed_handle {{{*/
                if(tt_to_feed) {
                    add_el_class(tt_feed_handle, "size4");
                    let num = (tt_to_feed.num < 10) ? tt_to_feed.num : "X";
                    tt_feed_handle.innerHTML
                        = "<span class='fg"+tt_to_feed.num+"'>"+num+"</span>";
                    tt_feed_deployed += 1;
                }
                /*}}}*/
                /* tt_feed_pad {{{*/

                let tt_to_feed_div      = tt_to_feed.querySelectorAll("DIV")[0];
                let tt_to_feed_msg_span = tt_to_feed_div.lastElementChild;
                let msg                 = tt_to_feed_msg_span.innerHTML;
                let tt_class            = tt_to_feed_msg_span.className;
/*{{{
logXXX("tt_to_feed_div........["+ get_n_lbl(tt_to_feed_div     ) +"]");
logXXX("tt_to_feed_msg_span...["+ get_n_lbl(tt_to_feed_msg_span) +"]");
logXXX("2/10 CURRENT [tt_to_feed.msg]");
logXXX("msg...................["+ msg      +"]");
logXXX("tt_class..............["+ tt_class +"]");
}}}*/
                tt_feed_pad.innerHTML    =  "<span class='"+tt_class+"'>"+ msg +"</span>";
                /*}}}*/
            }
            /*}}}*/
            /* OTHERS .. TODO [tt_num] {{{*/
            else {
                let     num = (tt_num < 10) ? tt_num : "X"      ;
                let flipped = (tt_num <  6) ?     "" : "flipped";
                tt_feed_handle.innerHTML
                    = "<span class='"+flipped+" fg"+tt_num+"'>"+num+".</span>";

                tt_feed_pad.innerHTML
                    =  "<span>TODO</span>";
            }
            /*}}}*/
    return tt_feed_deployed;
};
/*}}}*/
/*_ t_target_tool_feed_clone {{{*/
let t_target_tool_feed_clone = function(tt_num, tt_feed_handle, tt_feed_pad)
{
/*{{{*/
let caller = "t_target_tool_feed_clone";
let log_this = LOG_MAP.T3_LAYOUT || LOG_MAP.EV5_TOOL_CB;

if( log_this) log(caller+"(tt_num=["+tt_num+"], tt_feed_handle=["+get_n_lbl(tt_feed_handle)+"], tt_feed_pad=["+get_n_lbl(tt_feed_pad)+"])");
/*}}}*/
    let tt_feed_deployed = 0;
            /* tt_feed_handle .. tt_num {{{*/
            add_el_class(tt_feed_handle, "size4");
            let     num = (tt_num < 10) ? tt_num : "X";
            let flipped = (tt_num <  6) ?     "" : "flipped";
            tt_feed_handle.innerHTML
                = "<span class='"+flipped+" fg"+tt_num+"'>"+num+".</span>";
/*{{{
            if(tt_num > 6) add_el_class(tt_feed_handle, "flipped");
            else           del_el_class(tt_feed_handle, "flipped");
}}}*/
            /*}}}*/
            /* tt_feed_pad .. PINNED-PAD or EMPTY {{{*/
            let tt = target_tools_map_get(tt_num);
            if( tt && has_el_class(tt, CSS_PINNED)) {
                let tt_div       = tt.querySelectorAll("DIV")[0];
                tt_feed_pad.innerHTML    = tt_div.innerHTML;
                tt_feed_deployed += 1;
/*{{{
t_target_tool_log(tt, "is PINNED", lf7);
}}}*/
            }
            else {
                tt_feed_pad.innerHTML   = "";
            }
            /*}}}*/
    return tt_feed_deployed;
};
/*}}}*/
/*_ t_target_tool_feed_collapse {{{*/
let t_target_tool_feed_collapse = function(tt)
{
    /* CHECK DEPLOYED STATE {{{*/
let state_tt_feed_deployed = tt_feed_array.length && dimm_mask_displayed();
if(!state_tt_feed_deployed) return;

/*}}}*/
/* COLLAPSE ONTO [tt_to_feed] or current [target_tool] {{{*/

let css_point_dir = CSS_POINT_00;

/*{{{
if( !has_el_class(tt, CSS_PINNED) ) tt = null;
}}}*/
if( tt )
    css_point_dir
        = has_el_class(tt, CSS_POINT_EE) ? CSS_POINT_EE
        : has_el_class(tt, CSS_POINT_SE) ? CSS_POINT_SE
        : has_el_class(tt, CSS_POINT_SW) ? CSS_POINT_SW
        : has_el_class(tt, CSS_POINT_WW) ? CSS_POINT_WW
        : has_el_class(tt, CSS_POINT_NW) ? CSS_POINT_NW
        : has_el_class(tt, CSS_POINT_NE) ? CSS_POINT_NE
        : ""
;
/*}}}*/
/* DEFAULT TO WINDOW CENTER {{{*/
let x = tt ? (tt.offsetLeft - window.scrollX) : w_W / 2;
let y = tt ? (tt.offsetTop  - window.scrollY) : w_H / 2;

/*}}}*/
/* SET POSITION AND DIRECTION {{{*/
for(let tt_num=1; tt_num<=10; ++tt_num)
{
    let tt_feed             = tt_feed_array[tt_num-1];

    tt_feed.style.left      = x+"px"  ;
    tt_feed.style.top       = y+"px"  ;
    tt_feed.style.zIndex    = ZINDEX_TARGET_TOOL_ZERO;

    set_el_class_removing(tt_feed, css_point_dir, CSS_POINT_XX);
    t_set_CSS_PINNED     (tt_feed, false);
}
/*}}}*/
};
/*}}}*/
/*_ t_target_tool_feed_select {{{*/
/*{{{*/
const TT_FEED_SELECTED  = "tt_feed_selected";

/*}}}*/
let t_target_tool_feed_select = function(tt_feed_to_select)
{
/*{{{*/
let  caller = "t_target_tool_feed_select";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if( log_this) log(caller+"("+get_n_lbl(tt_feed_to_select)+")");
/*}}}*/
for(let tt_num=1; tt_num<=10; ++tt_num)
{
    let tt  = tt_feed_array[tt_num-1];
    if( tt == tt_feed_to_select) add_el_class(tt, TT_FEED_SELECTED);
    else                         del_el_class(tt, TT_FEED_SELECTED);
}
if(tt_feed_to_select)
{
    t_target_tool_feed_stop(caller);
    dimm_stop(caller);
}
};
/*}}}*/
/*_ t_target_tool_feed_stop {{{*/
let t_target_tool_feed_stop = function(_caller)
{
/*{{{*/
let  caller = "t_target_tool_feed_stop";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if( log_this) log(caller+": ...tt_to_feed=["+get_n_lbl(tt_to_feed)+"]");
/*}}}*/
    /* FEED [tt_to_feed] from [selected tt_feed] */
    let tt_seeked_to;

    /* PASTE [sel_text] INTO [tt_to_feed] {{{*/
    if(tt_to_feed)
    {

        /* paste and consume selection */
        tt_to_feed.date_MS = new Date().getTime();
        let sel_text = t_get_current_sel_text() || onDown_SEL_TEXT;

        /* new selection */
        if( sel_text )
        {
            if(tt_to_feed.msg)
                tt_to_feed.msg_bak = tt_to_feed.msg;

            tt_to_feed.msg = trim_WORDS( sel_text ) || sel_text;

if( log_this) log("%c save.current..msg=["+tt_to_feed.msg_bak +"]", lf3);
if( log_this) log("%c change........msg=["+tt_to_feed.msg     +"]", lf4);
        }
        /* empty selection */
        else {
            let current_msg = tt_to_feed.msg;

            /* restore saved */
            if(tt_to_feed.msg_bak) {
                tt_to_feed.msg = tt_to_feed.msg_bak;
if( log_this) log("%c restore saved msg=["+tt_to_feed.msg_bak +"]", lf5);
            }
            else {
                tt_to_feed.msg     = "";
if( log_this) log("%c missing saved msg=["+tt_to_feed.msg_bak +"]", lf2);
            }

            /* save current */
            if( current_msg ) {
                tt_to_feed.msg_bak = current_msg;
if( log_this) log("%c save.current..msg=["+tt_to_feed.msg_bak +"]", lf3);
            }
        }

        t_window_getSelection_removeAllRanges(caller);
        onDown_SEL_TEXT = "";

        t_update_target_tool_pad(tt_to_feed);
    }
    /*}}}*/
    /* OR SEEK TT_FEED_SELECTED [tt_feed] {{{*/
    else if(tt_feed_array.length)
    {
        for(let tt_num=1; tt_num<=10; ++tt_num)
        {
            let tt_feed = tt_feed_array[tt_num-1];
            if(has_el_class(tt_feed, TT_FEED_SELECTED))
            {
                tt_seeked_to = t_target_tool_get( tt_num );
                if( has_el_class(tt_seeked_to, CSS_PINNED) )
                {
                    t_seek_next_target_tool(tt_seeked_to, 0);
                    t_target_tool_feed_collapse(tt_seeked_to);
                }
                else {
                    t_target_tool_feed_collapse();
                }

                setTimeout(t_target_tool_feed_unpin_handler, 1000);

                break;
            }
        }
    }
    /*}}}*/

    if(!tt_seeked_to)
        setTimeout(t_target_tool_feed_unpin_handler, 0);

    t_target_tool_set_lifted(false);

    /* hide tt_feed_array */
};
/*}}}*/
/*_ t_target_tool_feed_unpin_handler {{{*/
let t_target_tool_feed_unpin_handler = function()
{
    if(!tt_feed_array.length) return;

    for(let tt_num=1; tt_num<=10; ++tt_num)
    {
        let              tt = tt_feed_array[tt_num-1];
        t_set_CSS_PINNED(tt , false);
        tt.style.display    = "none";
        tt.style.zIndex     = ZINDEX_ABOVE_TOOLS + tt_num;
    }
};
/*}}}*/
/*_ t_target_tool_feed_repin {{{*/
let t_target_tool_feed_repin = function()
{

    for(let tt_num=1; tt_num<=10; ++tt_num)
    {
        let tt = tt_feed_array[tt_num-1];
        t_set_CSS_PINNED(tt, true);
        tt.style.display = "block";
    }
};
/*}}}*/
/*}}}*/

/* SEEKER */
/*{{{*/
/*{{{*/

let seeker_CD;
let seeker_CU;
let seeker_PD;
let seeker_PU;

let seekzone;
let  seekspot_A;
let  seekspot_U;
let  seekspot_D;
/*}}}*/
/*_ [seeker_PU] .. show hide fade .. sync {{{*/
/*{{{*/
const T_SEEKER_PU_HIDE_LONG_DELAY = 5000;
const T_SEEKER_PU_HIDE_FAST_DELAY = 5000;
const T_SEEKER_PU_FADE_DELAY      = 3000;
const T_SEEKER_SYNC_DELAY         = 500;

let   t_seeker_sync_timer;
let   t_seeker_PU_fade_timer;
let   t_seeker_PU_hide_timer;
/*}}}*/
/*_ t_seeker_sync {{{*/
let t_seeker_sync = function()
{
    if(t_seeker_sync_timer) clearTimeout(t_seeker_sync_timer);
    t_seeker_sync_timer   =   setTimeout(t_seeker_sync_handler, T_SEEKER_SYNC_DELAY);
};

let t_seeker_sync_handler = function()
{
    t_seeker_sync_timer = null;

    if     (  t_seeker_PU_is_active() ) t_seeker_PU_show();
    else if( !scroll_check_timeout    ) t_seekzone4_hide("instant");
};

let t_seeker_sync_is_pending = function()
{
    return (t_seeker_sync_timer != null);
};
/*}}}*/
/*_ t_seeker_PU_show {{{*/
let t_seeker_PU_show = function()
{
    if(logging_EVENTS) log("t_seeker_PU_show");

    if(t_seeker_PU_hide_timer) {
        clearTimeout( t_seeker_PU_hide_timer );
        /*.........*/ t_seeker_PU_hide_timer = null;
    }

    if(t_seeker_PU_fade_timer) {
        clearTimeout( t_seeker_PU_fade_timer );
        /*.........*/ t_seeker_PU_fade_timer = null;
    }

    del_el_class(seeker_PU, CSS_FADING);
    del_el_class(seeker_PU, CSS_HIDING);

/*{{{
    set_el_class_on_off(seeker_PU,  SHOW_SEEKZONE , prop_get( SHOW_SEEKZONE ));
}}}*/

    seeker_PU.style.display = "block";

    /* SCHEDULE AUTO-HIDE */
    t_seeker_PU_hide();
};
/*}}}*/
/*_ t_seeker_PU_hide {{{*/
let t_seeker_PU_hide = function(instant="")
{
/*{{{*/
let   caller = "t_seeker_PU_hide";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if(log_this) log(caller);
/*}}}*/
    if(!t_seeker_PU_is_active() ) return;

    if(t_seeker_PU_hide_timer     ) { clearTimeout(t_seeker_PU_hide_timer); t_seeker_PU_hide_timer = null; }
    if(t_seeker_PU_fade_timer     ) { clearTimeout(t_seeker_PU_fade_timer); t_seeker_PU_fade_timer = null; }

    /*FIXME*/
    let delay
        = instant                   ? 0
        : prop_get( SHOW_SEEKZONE ) ? T_SEEKER_PU_HIDE_FAST_DELAY
        :                             T_SEEKER_PU_HIDE_LONG_DELAY
    ;

/*{{{
logXXX(caller+"("+instant+"): %c delay %c"+delay+"] %c prop_get( SHOW_SEEKZONE ) %c"+prop_get( SHOW_SEEKZONE )+" %c container %c"+container_selected;
    ,                         lbL     ,lbR         ,lbL                              ,lbR                                 ,lbL         ,lbR                   )
}}}*/

    /* HIDE AND FADE TRANSITIONS */
    if( delay ) {
        t_seeker_PU_hide_timer =   setTimeout(t_seeker_PU_hide_handler, delay);
        t_seeker_PU_fade_timer =   setTimeout(t_seeker_PU_fade_handler, T_SEEKER_PU_FADE_DELAY);
    }
    /* HIDE TRANSITON ONLY */
    else {
        t_seeker_PU_hide_handler(instant);
    }

};
/*}}}*/
/*_ t_seeker_PU_fade_handler {{{*/
let t_seeker_PU_fade_handler = function()
{
/*{{{*/
let   caller = "t_seeker_PU_fade_handler";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if(log_this) log(caller);
/*}}}*/

    t_seeker_PU_fade_timer = null;

    add_el_class(seeker_PU, CSS_FADING);
    del_el_class(seeker_PU, CSS_HIDING);
};
/*}}}*/
/*_ t_seeker_PU_hide_handler {{{*/
let t_seeker_PU_hide_handler = function(instant="")
{
/*{{{*/
let   caller = "t_seeker_PU_hide_handler("+instant+")";
let log_this = LOG_MAP.EV2_MOVE || LOG_MAP.T6_SLOT;

if(log_this) log(caller);
/*}}}*/

    if(!instant ) {
if( log_this) log("...t_seeker_PU_hide_timer=["+ t_seeker_PU_hide_timer +"]");
        if(!t_seeker_PU_hide_timer) return;
    }
    t_seeker_PU_hide_timer = null;

    del_el_class(seeker_PU, CSS_FADING);
    add_el_class(seeker_PU, CSS_HIDING);

    seeker_PU.style.display = "none";

    if(!prop_get( SHOW_SEEKZONE ) || !prop_get( PIN_SEEKSPOT ) || dimm_mask_displayed())
    {
        t_seekzone4_hide("instant");
    }
    else {
        seekspot_A.style.display = "none";
/*{{{
        if(!prop_get( LOG_SEEKSPOT ) ) {
            seekspot_U.innerHTML     = "";
            seekspot_D.innerHTML     = "";
        }
}}}*/
    }

    t_seek_clr_container_selected();

    t_seek_slot_num_CLEAR_SELECTED(caller);

    s_clear_last_highlight_slot();
};
/*}}}*/
/*}}}*/
/*_ [seeker_PD] .. show hide {{{*/
/*{{{*/
const T_SEEKER_PD_DISPLAY_NONE_DELAY = 500;
let   t_seeker_PD_hide_timer;

/*}}}*/
/*_ t_seeker_PD_hide {{{*/
let t_seeker_PD_hide = function()
{
    if( !seeker_PD ) return;
    /*if(logging_EVENTS) log("t_seeker_PD_hide");*/

    if(t_seeker_PD_hide_timer) clearTimeout(t_seeker_PD_hide_timer);
    t_seeker_PD_hide_timer   =   setTimeout(t_seeker_PD_hide_handler, T_SEEKER_PD_DISPLAY_NONE_DELAY);
};
/*}}}*/
/*_ t_seeker_PD_show {{{*/
let t_seeker_PD_show = function()
{
    let caller = "t_seeker_PD_show";

    if( !seeker_PD ) return;
    if(logging_EVENTS) log(caller);

    if(t_seeker_PD_hide_timer) {
        clearTimeout( t_seeker_PD_hide_timer );
        /*.........*/ t_seeker_PD_hide_timer = null;
    }

    t_sync_seek_back(caller);

    del_el_class(seeker_PD, CSS_FADING);
    del_el_class(seeker_PD, CSS_HIDING);

    seeker_PD.style.display = "block";
};
/*}}}*/
/*_ t_seeker_PD_hide_handler {{{*/
let t_seeker_PD_hide_handler = function()
{
    if( !seeker_PD ) return;
    if(logging_EVENTS) log("t_seeker_PD_hide_handler");

    t_seeker_PD_hide_timer = null;

    del_el_class(seeker_PD, CSS_FADING);
    add_el_class(seeker_PD, CSS_HIDING);

    seeker_PD.style.display = "none";

};
/*}}}*/
/*}}}*/
/*_ t_is_onSeekEL {{{ */
let regexp_SELECT_ID = new RegExp("select[0-9]+_[0-9]+");
let t_is_onSeekEL = function(node)
{
/*{{{*/
    if(!node) return false;

    let picked_node = null;
/*}}}*/
    /* ON SEEKER {{{*/
    if((node == seeker_PU) || (node == seeker_CU))/* || (node.id.startsWith("seekzone")))*/
    {
        picked_node = node;
    }
    /*}}}*/
    /* ON SLOT {{{*/
    else {
        for(    picked_node  = node
              ; picked_node != null
              ; picked_node  = picked_node.parentNode
           ) {
            if(       !picked_node.id                          ) continue;
            if( String(picked_node.id).match(regexp_SELECT_ID) )    break;
        }
    }
    /*}}}*/
    let result = (picked_node != null);
/*
logXXX(caller+": ...return "+ result + (picked_node ? " ["+picked_node.id+"]" : ""));
*/
    return result;
};
/* }}} */

/* MOVE */
/*_ t_seeker_move_on_last_highlight_slot_num {{{*/
let t_seeker_move_on_last_highlight_slot_num = function()
{
    if(LOG_MAP.S3_SLOT) log("t_seeker_move_on_last_highlight_slot_num");

    let last_highlight_slot  = s_get_last_highlight_slot();
    if( last_highlight_slot >= 0)
        t_seeker_move_on_slot_num(last_highlight_slot, last_highlight_num);
};
/*}}}*/
/*_ t_seeker_move_on_slot_num {{{ */
/*{{{*/
let seeker_thumbs;

/*}}}*/
let t_seeker_move_on_slot_num = function(slot, num, visible=true)
{
/* {{{*/
let   caller = "t_seeker_move_on_slot_num";
let log_this = LOG_MAP.S3_SLOT;

if( log_this) log(caller+"(slot=["+slot+"], num=["+num+"], visible=["+visible+"])");

if( !seeker_PU || !seeker_PD || !seeker_CD || !seeker_CU) return;
/*}}}*/
    /* CLEAR WINDOW SELECTION {{{*/
    t_window_getSelection_removeAllRanges(caller);

    /*}}}*/
    /* [seeker_CU] content {{{*/
    seeker_CU.innerHTML = num +"<sup>/"+ ccs[slot].nodes.length+"</sup>";

    /*}}}*/
    /* [seeker_CU] style {{{*/
    set_el_class(seeker_CU
                 ,   "cc"+(      slot % SELECT_SLOT_MAX) /* 1 2 3 4 5 6 7 8 9  0 */
                 + " num"+(1+(num+11) % 12             ) /* 1 2 3 4 5 6 7 8 9 10 11 12 */
                );

    /*}}}*/
    /* [seeker_CD] content {{{*/
    /* ARROW */
    if(!seeker_thumbs)
    {
        seeker_CD.innerHTML = ""
        /*{{{
            + "<span class='seeker_handle    top'>A-Z+"+SYMBOL_UP+"</span>"
            }}}*/
            + "<span class='seeker_handle  left' ></span>"
            + "<div     id='seeker_thumbs'       ></div>"
            + "<span class='seeker_handle  right'></span>"
        /*{{{
            + "<span class='seeker_handle bottom'>"+SYMBOL_UP_ARROW+"</span>"
            }}}*/
        ;
        seeker_thumbs = get_tool("seeker_thumbs");
    }

    /* THUMBS */
    if(seeker_thumbs)
    {
        let                        slot_first_id = "thumb_s_"+slot+"_1";
        let seeker_thumbs_includes_slot_first_id = seeker_thumbs.innerHTML.includes( slot_first_id );
        if(LOG_MAP.S3_SLOT) log("...seeker_thumbs_includes_slot_first_id=["+seeker_thumbs_includes_slot_first_id+"]");
        if(!seeker_thumbs_includes_slot_first_id)
            seeker_thumbs.innerHTML = t_get_3_sel_bag_thumbs_EM(slot,"thumb_s");
    }
    /*}}}*/
    /* SEEKER ON invisible node {{{*/
    if(!visible) {
        add_el_class(seeker_PU, CSS_ON_HIDEN_NODE);
        add_el_class(seeker_PD, CSS_ON_HIDEN_NODE);
    }
    /*}}}*/
    /* MOVE TO .. (visible node) {{{*/
    else {
        /*{{{
log(caller);
try { log("... ccs[slot].nodes     ["+ (num-1) +"]=["+ ccs[slot].nodes     [num-1] +"]"); } catch(ex) {}
try { log("... ccs[slot].containers["+ (num-1) +"]=["+ ccs[slot].containers[num-1] +"]"); } catch(ex) {}
}}}*/
        /*{{{
console.dir(ccs);
log("............num..=["+ num           +"]");
log("...parseInt(num))=["+ parseInt(num) +"]");
log("node = ccs["+slot+"].nodes["+(num-1)+"]");
console.dir(node);
}}}*/
        /*{{{
    let node
        =  ccs[slot].containers[num-1]
        ?  ccs[slot].containers[num-1]
        :  ccs[slot].nodes     [num-1]
    ;
}}}*/
        let node = ccs[slot].nodes [num-1];
        if( node ) {
            let xy = get_el_xy(node, caller);
            if((xy.x > 0) || (xy.y > 0))
            {
                let node_W = node.offsetWidth;
                let node_H = node.offsetHeight;

                let node_L = xy.x;
                let node_C = node_L + node_W/2;
                let node_T = xy.y;
                let node_B = node_T + node_H;

                /* show at leat one seeker */
                if(!t_seeker_PU_is_active() && t_seeker_PD_is_hiding())
                    t_seeker_PU_show();

                /* [seeker_PU] ABOVE */
                t_seeker_move_above_XY(seeker_PU, node_C, node_T);

                /* [seeker_PD] BELOW */
                t_seeker_move_below_XY(seeker_PD, node_C, node_B);

                del_el_class(seeker_PU, CSS_ON_HIDEN_NODE);
                del_el_class(seeker_PD, CSS_ON_HIDEN_NODE);
            }
        }
    }
    /*}}}*/
    /* t_seek_set_container_selected {{{*/
    let clicked_target = get_slot_num_container(slot, num);

    t_seek_set_container_selected(clicked_target, caller);

    if(visible) {
        if(body_zoom_percent == 100)
            t_scrollIntoViewIfNeeded(clicked_target);
    }

    /*}}}*/
    t_sync_seek_back(caller);
    /*
console_dir(ccs[slot], caller+" ccs["+slot+"]")
     */
};
/*}}}*/
/*_ t_seeker_move_above_XY {{{*/
let t_seeker_move_above_XY = function(tool, x, y)
{
    x *= (body_zoom_percent  / 100);
    y *= (body_zoom_percent  / 100);
/*{{{
logBIG("t_seeker_move_above_XY("+get_n_lbl(tool)+", "+x+" "+y+"): body_zoom_percent=["+body_zoom_percent+"]");
}}}*/
    /* postpone hiding */
    if(t_seeker_PU_hide_timer && (tool == seeker_PU))
    {
/*{{{
logXXX("...rescheduling seeker_PU HIDING");
}}}*/
        t_seeker_PU_hide();
    }

    let      tool_W = tool.offsetWidth ;
    let      tool_H = tool.offsetHeight;
    tool.style.left = (x-tool_W/2)+"px";
    tool.style.top  = (y-tool_H  )+"px";
};
/*}}}*/
/*_ t_seeker_move_below_XY {{{*/
let t_seeker_move_below_XY= function(tool, x, y)
{
    x *= (body_zoom_percent  / 100);
    y *= (body_zoom_percent  / 100);
/*{{{
logBIG("t_seeker_move_below_XY("+get_n_lbl(tool)+", "+x+" "+y+"): body_zoom_percent=["+body_zoom_percent+"]");
}}}*/
    let      tool_W = tool.offsetWidth ;
    let      tool_H = tool.offsetHeight;
    tool.style.left = (x-tool_W/2)+"px";
    tool.style.top  = (y         )+"px";

};
/*}}}*/

/* STATE */
/*_ t_seeker_PU_is_active {{{*/
let t_seeker_PU_is_active = function()
{
/*{{{*/
let   caller = "t_seeker_PU_is_active";
let log_this = logging_EVENTS;

/*}}}*/

    let reject_reason = "";

    if     ( seeker_PU.style.display    != "block"   ) reject_reason = "[seeker_PU] NOT DISPLAYED";
    else if( seeker_PU.classList.contains("hiding"  )) reject_reason = "[seeker_PU] IS HIDING" ;
/*{{{
    else if( seeker_PU.classList.contains(CSS_FADING)) reject_reason = "[seeker_PU] IS FADING";
    else if( t_node_is_off_screen(seeker_PU)         ) reject_reason = "[seeker_PU] OFF SCREEN ";
}}}*/

    let is_active = (reject_reason == "");

if(!is_active && log_this)
    log(caller+": ...return "+is_active+" %c "+reject_reason,lb2);
    return is_active;
};
/*}}}*/
/*_ t_seeker_PD_is_hiding {{{*/
let t_seeker_PD_is_hiding = function()
{
    return !seeker_PD
        ||  seeker_PD.classList.contains("hiding")
        ||  seeker_PD.style.display   != "block";
    ;
};
/*}}}*/
/*_ t_node_is_off_screen {{{*/
let t_node_is_off_screen = function(node)
{
    let caller = "t_node_is_off_screen(node=["+get_n_lbl(node)+"])";
    if(LOG_MAP.T3_LAYOUT) log(caller);

    /* xy_wh */
    let   xy = get_el_xy(node, caller);
    let node_T = xy.y - window.scrollY;
    let node_L = xy.x - window.scrollX;
    let node_W = node.offsetWidth;
    let node_H = node.offsetHeight;

    /* bottom right */
    let node_B = node_T + node_H;
    let node_R = node_L + node_W;

    /* location in viewport */
    let reject_reason = "";

    if(           (node_T < 0          )) reject_reason = "["+get_n_lbl(node)+"] IS OFF TOP"   ;
    if(!reject_reason && (node_L < 0   )) reject_reason = "["+get_n_lbl(node)+"] IS OFF LEFT"  ;
    if(!reject_reason && (node_B > w_H )) reject_reason = "["+get_n_lbl(node)+"] IS OFF BOTTOM";
    if(!reject_reason && (node_R > w_W )) reject_reason = "["+get_n_lbl(node)+"] IS OFF RIGHT" ;

    let result = (reject_reason != "");

    if(logging_EVENTS) log(caller+": ...return "+result+" %c "+reject_reason,lb2);
    return result;
};
/*}}}*/

/*_ t_sync_seek_back {{{*/
/*{{{*/
const T_SYNC_SEEKER_ARROW_DELAY = 750;
const T_SYNC_SEEKER_DELAY       = 500;
let   t_sync_seeker_timeout;

/*}}}*/
/*_ t_sync_seek_back {{{*/
let t_sync_seek_back = function(_caller)
{
    /*{{{
logXXX("%c t_sync_seek_back("+_caller+")", lbH+lf7);
}}}*/
    if(t_sync_seeker_timeout) clearTimeout(t_sync_seeker_timeout);
    t_sync_seeker_timeout   =   setTimeout(t_sync_seek_back_handle, T_SYNC_SEEKER_DELAY);
};
/*}}}*/
/*_ t_sync_seek_back_handle {{{*/
let t_sync_seek_back_handle = function()
{
    let caller = "t_sync_seek_back_handle";
    /*{{{
logXXX("%c"+caller, lbb+lbH+lf7);
}}}*/
    /* [seeker_handle] nodes */
    let el, node_list;
    if(shadow_root)  node_list = shadow_root.querySelectorAll(".seeker_handle");
    else             node_list = document   .querySelectorAll(".seeker_handle");
    for(let i=0; i < node_list.length; ++i) {
        let     el = node_list[i];
        /*{{{
console_dir(el, caller+"seeker_handle #"+i)
}}}*/
        /* ARROW [LEFT..RIGHT] .. f(back) {{{*/
        if(      has_el_class(el, CSS_LEFT )
                 ||   has_el_class(el, CSS_RIGHT)
          ) {
            if( el.innerText != SYMBOL_DOWN_ARROW) el.innerText = SYMBOL_DOWN_ARROW;

            del_el_class(el, CSS_PRESSED);

            if( prop_get( SEL_BACK )) add_el_class(el, CSS_BACK);
            else                      del_el_class(el, CSS_BACK);

            setTimeout(t_sync_sel_back, T_SYNC_SEEKER_ARROW_DELAY);
        }
        /*}}}*/
        /* ...(top) remove pat_sort clone {{{
        else if( has_el_class(el, CSS_TOP) )
        {
            el.innerHTML   = pat_sort.innerHTML;
            if( t_are_pat_sorted() ) add_el_class(el, CSS_CHECKED);
            else                     del_el_class(el, CSS_CHECKED);
        }
        }}}*/
        /* ...[show_seekzone] toggle .. (bottom) {{{
        else if( has_el_class(el, CSS_BOTTOM )) {
            if(      prop_get(  LOG_SEEKSPOT )) add_el_class(el  , CSS_CHECKED);
            else                                del_el_class(el  , CSS_CHECKED);
        }
        }}}*/
    }
};
/*}}}*/
/*}}}*/
/*_ t_sync_sel_back {{{*/
let t_sync_sel_back = function()
{
    if(LOG_MAP.T3_LAYOUT) log("t_sync_sel_back");

    if( prop_get( SEL_BACK ) )
    {
        add_el_class(sel_bag      , CSS_BACK);
        add_el_class(seeker_CD    , CSS_BACK);
        add_el_class(seeker_thumbs, CSS_BACK);
    }
    else {
        del_el_class(sel_bag      , CSS_BACK);
        del_el_class(seeker_CD    , CSS_BACK);
        del_el_class(seeker_thumbs, CSS_BACK);
    }

};
/*}}}*/
/*_ t_words_regex_log {{{*/
/*{{{*/
let words_regex;

/*}}}*/
let t_words_regex_log = function(innerText)
{
    if(!words_regex) words_regex = get_tool("words_regex");
    words_regex.title            = innerText;
    words_regex.innerText        = ellipsis(innerText, 64);
};
/*}}}*/
/*}}}*/

/** CLONES */
/*{{{*/
/*{{{*/
const CCX_CLASSLIST = [
      "cc1"
    , "cc2"
    , "cc3"
    , "cc4"
    , "cc5"
    , "cc6"
    , "cc7"
    , "cc8"
    , "cc9"
    , "cc0"
];

/*}}}*/
/*  t3_load_PLAYGROUND_PANELS {{{*/
let t3_load_PLAYGROUND_PANELS = function()
{
/*{{{*/
let   caller = "t3_load_PLAYGROUND_PANELS";
let log_this = LOG_MAP.T1_DOM_LOAD;

if( log_this) log("%c"+SD3+"%c "+caller, lbS+lf3, lbH+lf3);
/*}}}*/
    /* [dom_hide_tools_panel] {{{*/
    if( panel = document.getElementById("dom_hide_tools_panel"))
    {
        if(!panel.innerHTML) panel.innerHTML = "<em class='cc1'>HIDE TOOLS</em>";
        t2_clone_DOC_SLIDER(panel, SITE_OR_PAGE   , "bg4");
        t2_clone_DOC_SLIDER(panel, MASK_OR_HIDE   , "bg3");
        t2_clone_DOC_SLIDER(panel, EDIT_OR_STAGE  , "bg2");
        t2_clone_DOC_SLIDER(panel, DOM_HIDE1_RESET, "bg1");
        t2_clone_DOC_SLIDER(panel, DENY_OR_ALLOW  , "bg0");
    }
    /*}}}*/
    /* [dom_hide_select_panel] {{{*/
    if(panel = document.getElementById("dom_hide_select_panel"))
    {
        let id, label, el;
        if(!panel.innerHTML) panel.innerHTML = "<em class='cc2'>HIDE SELECT</em>";
        id = "dom_hide1_collect_nodes_1"      ; label = "collect_nodes_1"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide1_collect_nodes_2"      ; label = "collect_nodes_2"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide1_collect_nodes_3"      ; label = "collect_nodes_3"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide1_collect_nodes_4"      ; label = "collect_nodes_4"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide1_container_clicked"    ; label = "container_clicked"    ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide4_scroll_to_last_hidden"; label = "scroll to last hidden"; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1","input",label); if(el) prop_set_EL(id, el);
    }
    /*}}}*/
    /* [dom_hide_store_panel] {{{*/
    if(panel = document.getElementById("dom_hide_store_panel"))
    {
        let id, label, el;
        if(!panel.innerHTML) panel.innerHTML = "<em class='cc3'>HIDE STORE</em>";
        id = "dom_hide2_store_save"   ; label = "store_save"   ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide1_reset"        ; label = "store_reset"  ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide2_store_reload" ; label = "store_reload" ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4","input",label); if(el) prop_set_EL(id, el);
        id = "dom_hide5_start_history"; label = "start_history"; el = t2_clone_panel_id_bg_type_label(panel,id,"bg6","input",label); if(el) prop_set_EL(id, el);
    }
    /*}}}*/
    /* [dom_target_tool_panel] {{{*/
    if(panel = document.getElementById("dom_target_tool_panel"))
    {
        let id, label, el;
        if(!panel.innerHTML) panel.innerHTML = "<em class='cc3'>target_tool</em>";
        id = "t_target_tool_reorder"  ; label = "REORDER"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2","input",label); if(el) prop_set_EL(id, el);

    }
    /*}}}*/


    t2_load_PLAYGROUND_clones_panel();
};
/*}}}*/
/*_ t2_clone_DOC_SLIDER {{{*/
let t2_clone_DOC_SLIDER = function(panel, id, className)
{
    /* [id] {{{*/
    let box               = document.createElement("DIV");
    panel.appendChild( box );
    box.className         = "box cb_slider_cap toolbag_button "+className;
    /*}}}*/
    /* input {{{*/
    let input             = document.createElement("INPUT");
    box.appendChild( input );
    input.type            = "checkbox";
    input.id              = id;
    input.name            = "check";
    input.className       = "cc2";
    /*}}}*/
    /* thumb {{{*/
    let label0            = document.createElement("LABEL");
    box.appendChild( label0 );
    label0.htmlFor        = id;

    /*}}}*/
    /* track {{{*/
    let label1            = document.createElement("LABEL");
    box.appendChild( label1 );
    label1.htmlFor        = id;
    /*}}}*/
    t1_clone_id_state_CB(id, false); /* initialize */
};
/*}}}*/
/* t2_load_PLAYGROUND_clones_panel {{{*/
let         playground_clones_panel = false;
let t2_load_PLAYGROUND_clones_panel = function()
{
/*{{{*/
let caller = "t2_load_PLAYGROUND_clones_panel";
let log_this = LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

/*}}}*/
    /* look for playground_clones_panel {{{*/
    playground_clones_panel = document.getElementById("playground_clones_panel");
    if(!playground_clones_panel)
    {
if( log_this) log("FOUND NO DOC TOOL CLONES PANEL [playground_clones_panel]");

        return;
    }

if(log_this) console_dir(playground_clones_panel, caller+": FOUND DOC TOOL CLONES PANEL");
    /*}}}*/
    /* add control buttons {{{*/
    let panel = playground_clones_panel;
    let id, el;
    id = "t_target_tool_reorder"; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);
    id = "SEEK"                 ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "em"  );
    id = CSS_SEEK1_ONSLOTEL     ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);
    id = CSS_SEEK2_ONRESUME     ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);
    id = CSS_SEEK3_ONJUMPEL     ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);
    id = CSS_SEEK4_ONSEEKER     ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);
    id = CSS_SEEK5_ONTARGET     ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg1", "input"); if(el) prop_set_EL(id, el);

    id = "HIDE"                 ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2", "em"   );
    id = "container_clicked"    ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2", "input"); if(el) prop_set_EL(id, el);
    id = "reset"                ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2", "input"); if(el) prop_set_EL(id, el);
    id = "scroll_to_last_hidden"; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2", "input"); if(el) prop_set_EL(id, el);

    id = "COLLECT"              ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3", "em"   );
    id = "collect_nodes_1"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3", "input"); if(el) prop_set_EL(id, el);
    id = "collect_nodes_2"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3", "input"); if(el) prop_set_EL(id, el);
    id = "collect_nodes_3"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg3", "input"); if(el) prop_set_EL(id, el);
    id = "collect_nodes_4"      ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg2", "input"); if(el) prop_set_EL(id, el);

    id = "STORE"                ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4", "em"   );
    id = "store_reload"         ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4", "input"); if(el) prop_set_EL(id, el);
    id = "store_save"           ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4", "input"); if(el) prop_set_EL(id, el);
    id = "start_history"        ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg4", "input"); if(el) prop_set_EL(id, el);

    id = "MISC1"                ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5", "em"   );
    id = "RELOAD"               ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5", "input"); if(el) prop_set_EL(id, el);
    id = "show_seekzone"        ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5", "input"); if(el) prop_set_EL(id, el);
    id = "pin_seekspot"         ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5", "input"); if(el) prop_set_EL(id, el);
    id = "log_seekspot"         ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg5", "input"); if(el) prop_set_EL(id, el);

    id = "MISC2"                ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg6", "em"   );
    id = "theme_dark"           ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg6", "input"); if(el) prop_set_EL(id, el);
    id = "pat_sort"             ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg6", "input"); if(el) prop_set_EL(id, el);
    id = "console_clear"        ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg6", "input"); if(el) prop_set_EL(id, el);

    id = "PROPERTIES"           ; el = t2_clone_panel_id_bg_type_label(panel,id,"bg7", "em"   );

    /*}}}*/
};
/*}}}*/
/*_ t2_clone_panel_id_bg_type_label {{{*/
let t2_clone_panel_id_bg_type_label = function(panel, id, bg, type, label)
{
/*{{{*/
let caller = "t2_clone_panel_id_bg_type_label("+id+" , "+bg+" , "+type+")";
let log_this = LOG_MAP.T1_DOM_LOAD || LOG_MAP.T3_LAYOUT;

/*}}}*/

    let el;

    el = get_tool_clone(id);
    if( el ) {
if( log_this) log("%c"+caller+"%c TOOL ALREADY CLONED ["+id+"]", lbL+lf8, lbR+lf3);
        return null;
    }

    let title = id;

    el = get_tool_embedded(id);
    if( el ) {
if( log_this) log("%c"+caller+"%c TOOL ALREADY EMBEDDED ["+id+"]", lbL+lf8, lbR+lf4);
        type  = "span"; /* placeholder */
        title =  "placeholder for ["+id+"]";
    }

    label = underline_to_space(label || id);

    let tool_innerHTML
        = (type == "input")
        ?  (  "<input type='checkbox'     id='"+ id    +"' name='check' />"
            + "<label                    for='"+ id    +"'>"
            +  "<div class='small     middle'>"+ label +"</div>"
            + "</label>"
           )
        : (   "<"+type+" class='box_label'>"+ label +"</"+type+">");

    let div
        = document.createElement("DIV");

    let div_class
        = (type == "input")
        ? "box  cb_filled_pin "+ bg +" toolbag_button"
        : bg
        ;

    div.innerHTML
        =    "<div class='"+div_class+"' title='"+title+"'>"
        +     tool_innerHTML
        +    "</div>";

    panel.appendChild( div );

    el = div.firstElementChild.firstElementChild;

if( log_this) console_dir(el, caller+" ...return:");
    return  el;
};
/*}}}*/
/*_ get_tool_clone {{{*/
let get_tool_clone = function(id)
{
    if(!id               ) return null;
    if( id.includes(" ") ) return null;
    let el
        = playground_clones_panel
        ? playground_clones_panel.querySelector("#"+id)
        : null;

/*{{{
if(el) console_dir(el, "get_tool_clone("+id+") ...return:");
}}}*/
    return el;
};
/*}}}*/
/*_ get_tool_embedded {{{*/
let get_tool_embedded = function(id)
{
    if(!id               ) return null;
    if( id.includes(" ") ) return null;
    let el
        = document.querySelector("#"+id)
    ;

/*{{{
if(el) console_dir(el, "get_tool_embedded("+id+") ...return:");
}}}*/
    return el;
};
/*}}}*/
/*XXX*/
/*_ t1_clone_id_state_CB {{{*/
let t1_clone_id_state_CB = function(id, checked)
{
/*{{{*/
let caller = "t1_clone_id_state_CB("+id+" , checked=["+checked+"])";
let log_this = LOG_MAP.T3_LAYOUT || LOG_MAP.EV5_TOOL_CB;

/*}}}*/
    /* SLIDER TRACK + THUMB {{{*/
    let clone_el = document.getElementById(id);
    if(!clone_el ) return false;

    let el_thumb = clone_el.labels ? clone_el.labels[0] : null;
    let el_track = clone_el.labels ? clone_el.labels[1] : null;

    if( el_thumb && el_track)
    {
        let                a =   id.split("_or_");
        if(a.length  != 2) a =   id.split("_"   );
        if(a.length  != 2) a = [ id      ,"OFF" ];
        if(a.length  == 2) {

            let label_ON  = a[0].toUpperCase();
            let label_OFF = a[1].toUpperCase();

if( log_this) log("%c"+id+"  "+checked+" %c ON..OFF=["+label_ON +".."+label_OFF+"]", lbL+lf3, lbR+lf5);
if( log_this) log(caller+": %c"+id      +" %c"+label_OFF                 +" %c"+label_ON
                  ,         lbb+lbH+lf9   ,lbH+(!checked ? lbb : "")+lf8   ,lbH+( checked ? lbb : "")+lf2);

            el_thumb.innerHTML = checked ? "<em class='bg8'>"+ label_ON  +"</em>" : "<em class='bg2'>"+ label_OFF +"</em>" ;
            el_track.innerHTML = checked ?                     label_OFF          :                     label_ON           ;

        }
        else {
if( log_this) log("%c"+caller+"%c *** no match with [cb_slider_cap] ID '_or_' naming separator feature", lbL, lbR+lf2);
        }
    }
    /*}}}*/
    /* NOT A SLIDER {{{*/
    else {
if( log_this) log("%c"+caller+"%c ... not a [cb_slider_cap] .. thumb+track labels not found"           , lbL, lbR+lf8);
        t1_clone_id_state_CB_PULSE(id, checked);
    }
    /*}}}*/
    /* PARENT BACKGROUND .. (stylesheet/checkbox.css) {{{*/
    set_el_class_on_off(clone_el.parentElement, CSS_ON, checked);

    /*}}}*/
};
/*}}}*/
/*_ t1_clone_id_state_CB_PULSE {{{*/
let t1_clone_id_state_CB_PULSE = function(input_id, checked)
{
    let       checkbox = document.getElementById(input_id);
/*{{{
console_dir(checkbox,"t1_clone_id_state_CB_PULSE("+input_id+", "+checked+")");
}}}*/

    checkbox.checked = true;

    setTimeout( function() { t1_prop_id_clone_OFF(checkbox); }, 2000);
};
let t1_prop_id_clone_OFF = function(checkbox)
{
    checkbox.checked = false;
};
/*}}}*/
/*_ t_sync_tool_clones .. called by (prop_tools_CB t1_prop_id_toggle t_onPatternUpdate_done t_sync_layout_handler) {{{*/
/*{{{*/
const T_SYNC_TOOL_CLONES_DELAY = 500;

let t_sync_tool_clones_timeout;
/*}}}*/
let t_sync_tool_clones = function(_caller)
{
/*{{{*/
let   caller = "t_sync_tool_clones";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log("%c"+caller+"%c CALLED BY "+ _caller, lbL+lf6,lbR+lf6);
/*}}}*/
/*{{{
logBIG(caller+" *** HANDLER NOT CALLED ***", lbH+lf2);
return;
}}}*/
    if(t_sync_tool_clones_timeout) clearTimeout(t_sync_tool_clones_timeout);
    t_sync_tool_clones_timeout   =   setTimeout(t_sync_tool_clones_handler, T_SYNC_TOOL_CLONES_DELAY);
};
/*}}}*/
/*_ t_sync_tool_clones_handler {{{*/
let t_sync_tool_clones_handler = function()
{
/*{{{*/
let   caller = "t_sync_tool_clones_handler";
let log_this = LOG_MAP.T3_LAYOUT;

if( log_this) log(caller);
/*}}}*/

    let id;

    id = KEY_LOG_IPC       ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_IPC                   ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    id = KEY_LOG_EVENTS    ; if(el = document.getElementById(id)) set_el_class_removing(el, logging_EVENTS            ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    id = KEY_LOG_HIGHLIGHT ; if(el = document.getElementById(id)) set_el_class_removing(el, logging_HIGHLIGHT         ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    id = KEY_LOG_TOOLBAR   ; if(el = document.getElementById(id)) set_el_class_removing(el, logging_TOOLBAR           ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);

    id = "EV0_LISTEN"      ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV0_LISTEN        ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    id = "EV1_DOWN"        ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV1_DOWN          ? CSS_CC1 : CSS_CC8, CCX_CLASSLIST);
    id = "EV2_MOVE"        ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV2_MOVE          ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id = "EV3_UP"          ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV3_UP            ? CSS_CC3 : CSS_CC8, CCX_CLASSLIST);
    id = "EV4_LONG_PRESS"  ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV4_LONG_PRESS    ? CSS_CC4 : CSS_CC8, CCX_CLASSLIST);
    id = "EV5_TOOL_CB"     ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV5_TOOL_CB       ? CSS_CC5 : CSS_CC8, CCX_CLASSLIST);
    id = "EV6_CHANGED"     ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV6_CHANGED       ? CSS_CC6 : CSS_CC8, CCX_CLASSLIST);
    id = "EV7_DISPATCH"    ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV7_DISPATCH      ? CSS_CC7 : CSS_CC8, CCX_CLASSLIST);
    id = "EV8_FLOATLOG"    ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP.EV8_FLOATLOG      ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);

    id =  "S1_RANGE"       ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. S1_RANGE         ? CSS_CC1 : CSS_CC8, CCX_CLASSLIST);
    id =  "S2_SELECT"      ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. S2_SELECT        ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  "S3_SLOT"        ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. S3_SLOT          ? CSS_CC3 : CSS_CC8, CCX_CLASSLIST);

    id =  "T0_STORE"       ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T0_STORE         ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    id =  "T1_DOM_LOAD"    ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T1_DOM_LOAD      ? CSS_CC1 : CSS_CC8, CCX_CLASSLIST);
    id =  "T2_GRID"        ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T2_GRID          ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  "T3_LAYOUT"      ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T3_LAYOUT        ? CSS_CC3 : CSS_CC8, CCX_CLASSLIST);
    id =  "T4_PIVOT"       ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T4_PIVOT         ? CSS_CC4 : CSS_CC8, CCX_CLASSLIST);
    id =  "T5_SPREAD"      ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T5_SPREAD        ? CSS_CC5 : CSS_CC8, CCX_CLASSLIST);
    id =  "T6_SLOT"        ; if(el = document.getElementById(id)) set_el_class_removing(el, LOG_MAP. T6_SLOT          ? CSS_CC6 : CSS_CC8, CCX_CLASSLIST);

    id =  CONTAINERS_HI    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get( CONTAINERS_HI ) ? CSS_CC1 : CSS_CC8, CCX_CLASSLIST);
    id =  WORDS_EXACT      ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC3 : CSS_CC8, CCX_CLASSLIST);
    id =  WORDS_SEGMENT    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC4 : CSS_CC8, CCX_CLASSLIST);
    id =  WORDS_HEAD_TAIL  ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC5 : CSS_CC8, CCX_CLASSLIST);
    id =  WORDS_OPCYCLE    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);

    let id_array = t_get_words_drop_affix_array();
    for(let i=0; i < id_array.length; ++i)
    {
        id = id_array[i]   ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC9 : CSS_CC8, CCX_CLASSLIST);
    }

    id =  SCROLL_SMOOTH    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);

    id =  SHOW_SEEKZONE    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get( SHOW_SEEKZONE ) ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  PIN_SEEKSPOT     ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get( PIN_SEEKSPOT  ) ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  LOG_SEEKSPOT     ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get( LOG_SEEKSPOT  ) ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);

    id =  DENY_OR_ALLOW    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  EDIT_OR_STAGE    ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  DOM_HIDE1_RESET  ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  MASK_OR_HIDE     ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);
    id =  SITE_OR_PAGE     ; if(el = document.getElementById(id)) set_el_class_removing(el, prop_get(id)              ? CSS_CC2 : CSS_CC8, CCX_CLASSLIST);

    /* [dom_grid] .. (DOC TOOLS PLAYGROUND) */
    id = "dom_grid_headsup"; if(el = document.getElementById(id)) set_el_class(el, CSS_COLLAPSED, LOG_MAP.T2_GRID);
};
/*}}}*/
/*}}}*/

/* IPC */
/*{{{*/
/*_ t_handle_ipc_message {{{*/
let t_handle_ipc_message = function(ipc)
{
    if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c t_handle_ipc_message(ipc)"                        , IPC_LOG_COLOR, lbA);

    /* [ipc.start] .. (ON-OFF) {{{*/
    if((typeof ipc.start != "undefined"))
    {
        if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c EXTENSION INSTRUCTION DETECTED"                   , IPC_LOG_COLOR, lbF);

        let script_loaded = t_ipc_handle_start(ipc.start);

        if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c TOOLS LOADED AND WAITING "+script_loaded          , IPC_LOG_COLOR, lbF);
    }
    /*}}}*/
    /* [ipc.theme] {{{*/
    else if(typeof ipc.theme != "undefined")
    {
        t_ipc_handle_theme( ipc.theme );
    }
    /*}}}*/
};
/*}}}*/
/*_ t_ipc_handle_start {{{*/
let t_ipc_handle_start = function(start)
{
    if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c t_ipc_handle_start("+start+")"                    , IPC_LOG_COLOR, lbA);
    /* ON {{{*/
    if(start == "ON")
    {
        if(!t_ipc_is_IPC_SCRIPT_loaded() )
        {
            if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c LOADING "                                         , IPC_LOG_COLOR, lbF);

            t_load();
            let script_loaded = ((typeof DOM_TOOLS_CSS_TAG != "undefined") && DOM_TOOLS_CSS_TAG);
            if(LOG_IPC) console.log("...DOM_TOOLS_CSS_TAG=["+ DOM_TOOLS_CSS_TAG +"]");
            if(LOG_IPC) console.log(".......script_loaded=["+ script_loaded     +"]");
            return script_loaded;
        }
        else {

            /* RELOAD */
            if(dom_tools_html && (dom_tools_html.style.visibility = "hidden"))
            {
                if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c RELOADING "                                       , IPC_LOG_COLOR, lbF);
                t_reload();
            }
            /* ALREADY LOADED */
            else {
                if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c ALREADY LOADED .. RE-SENDING "+TOOLS4_DEPLOYED    , IPC_LOG_COLOR, lbF);
                let ipc
                    = {    t_load : TOOLS4_DEPLOYED
                        ,      caller : DOM_TOOLS_JS_TAG+".t_ipc_handle_start"
                    };
                t_send_IPC( ipc );
            }

            return true;
        }
    }
    /*}}}*/
    /* OFF {{{*/
    else {
        if( t_ipc_is_IPC_SCRIPT_loaded() )
        {
            if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c UNLOADING "                                       , IPC_LOG_COLOR, lbF);

            t_unload();
        }
        else {
            if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c NOT YET LOADED"                                   , IPC_LOG_COLOR, lbF);

            t_wait_for_startup_message_from_extension( DOM_TOOLS_JS_ID );
        }

        return true;
    }
    /*}}}*/
};
/*}}}*/
/*_ t_ipc_handle_theme {{{*/
let t_ipc_handle_theme = function(theme)
{
    if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c t_ipc_handle_theme("+theme+")"                    , IPC_LOG_COLOR, lbA);

    let t_theme = "theme_"+theme.toUpperCase();
    if(LOG_IPC) console.log("...calling t1_prop_id_toggle("+t_theme+")");
    t1_prop_id_toggle(t_theme);
};
/*}}}*/
let IPC_SCRIPT_ID = DOM_TOOLS_JS_ID;
let IPC_LOG_COLOR = lb3;
/* IPC {{{*/
/*{{{*/
let IPC_EXTENSION_ID = "background_js";
let LOG_IPC          = true;

let IPC_MSG_COLOR    = lbF+IPC_LOG_COLOR;
/*}}}*/

/* IPC: EventListener */
/*_ t_ipc_add_message_listener {{{*/
let t_ipc_add_message_listener = function(script_id)
{
    t_ipc_listener_id = script_id;
    if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": ADDING IPC MESSAGE LISTENER ", IPC_MSG_COLOR);

    window.addEventListener   ("message", t_ipc_message_CB, false);
};
/*}}}*/
/*_ t_ipc_del_message_listener {{{*/
let t_ipc_del_message_listener = function(script_id)
{
    if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": DELETING IPC MESSAGE LISTENER", IPC_MSG_COLOR);

    window.removeEventListener("message", t_ipc_message_CB, false);
};
/*}}}*/
/*_ t_ipc_message_CB {{{*/
let t_ipc_message_CB = function(event)
{
    /* MESSAGE ORIGIN {{{*/
    if(!window.location.href.startsWith( event.origin ))
    {
        /*
if(LOG_IPC) console.log("...not same origin: window.location.href=["+window.location.href+"]");
if(LOG_IPC) console.log("...not same origin: ........event.origin=["+event.origin        +"]");
         */
        return;
    }
    if(LOG_IPC) console.log("%c"+t_ipc_listener_id+".t_ipc_message_CB", IPC_MSG_COLOR);
    if(LOG_IPC) console.dir(event);
    /*}}}*/
    /* IPC MESSAGE {{{*/
    let message = event.data;
    if(LOG_IPC) console.log("%c"+t_ipc_listener_id+".t_ipc_message_CB: %c "+message+" ", IPC_MSG_COLOR, lbF);
    let ipc = t_get_IPC( message );
    if(!ipc ) return;

    if(typeof     ipc.LOG_IPC != "undefined") {
        LOG_IPC = ipc.LOG_IPC;
        console.log("%c t_ipc_message_CB: %c LOG_IPC="+LOG_IPC+" ", IPC_MSG_COLOR, lbF+(LOG_IPC ? lb2 : lb8));

        return;
    }
    /*}}}*/
    /* SCRIPT MESSAGE {{{*/
    t_handle_ipc_message( ipc );

    /*}}}*/
};
/*}}}*/

/* IPC: MutationObserver */
/*_ t_ipc_add_MutationObserver {{{*/
/*{{{*/
let t_ipc_MutationObserver;
/*}}}*/
let t_ipc_add_MutationObserver = function(script_id)
{
    /* SCRIPT ID {{{*/
    t_ipc_listener_id = script_id;
    if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": ADDING IPC MutationObserver", IPC_MSG_COLOR);

    /*}}}*/
    /* LISTEN {{{*/
    t_ipc_MutationObserver = new MutationObserver( t_ipc_MutationObserver_CB );

    let config = { attributes            :  true /* attributes                          */
        ,          characterData         :  true /* data                                */
        ,          childList             : false /* additions and removals of s child   */
        ,          subtree               : false /* target and target's descendants     */
        ,          attributeOldValue     :  true /* attribute value before the mutation */
        ,          characterDataOldValue :  true /* data before the mutation            */
        ,          attributeFilter       : [IPC_EXTENSION_ID]
    };

    t_ipc_MutationObserver.observe(document.body, config);
    /*}}}*/
};
/*}}}*/
/*_ t_ipc_del_MutationObserver {{{*/
let t_ipc_del_MutationObserver = function(script_id)
{
    /* STOP OBSERVING {{{*/
    if(t_ipc_MutationObserver)
    {
        if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": DISCONNECTING MutationObserver", IPC_MSG_COLOR);
        t_ipc_MutationObserver.disconnect();
        t_ipc_MutationObserver = null;
    }
    else {
        if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": MutationObserver NOT CONNECTED", IPC_MSG_COLOR);
    }
    /*}}}*/
};
/*}}}*/
/*_ t_ipc_MutationObserver_CB {{{*/
let t_ipc_MutationObserver_CB = function(mutations)
{
    /* LOG {{{
mutations.forEach(
    function(mutation) {
        if(LOG_IPC) console.log(t_ipc_listener_id+": MutationObserver:");
        if(LOG_IPC) console.log(".................type=["+mutation.type               +"]");
        if(LOG_IPC) console.log("........attributeName=["+mutation.attributeName      +"]");
        if(LOG_IPC) console.log(".............oldValue=["+mutation.oldValue           +"]");
        if(LOG_IPC) console.log("...attributeNamespace=["+mutation.attributeNamespace +"]");
        if(LOG_IPC) console.dir(mutation);
    }
);
}}}*/
    /* HANDLE MESSAGE {{{*/
    let message = document.body.attributes[IPC_EXTENSION_ID]
        ?         document.body.attributes[IPC_EXTENSION_ID].textContent : "";
    if(LOG_IPC) console.log(t_ipc_listener_id+".t_ipc_MutationObserver_CB: ...message=["+message+"]");

    let ipc = t_get_IPC( message );
    if( ipc ) t_handle_ipc_message( ipc );
    /*}}}*/
};
/*}}}*/

/* IPC: Util */
/*{{{*/

let t_ipc_listener_id;
/*}}}*/
/*_ t_ipc_is_IPC_SCRIPT_loaded {{{*/
let t_ipc_is_IPC_SCRIPT_loaded = function()
{
    /* DOM_TOOLS_JS_ID {{{*/
    if(typeof DOM_TOOLS_JS_ID != "undefined")
    {
        if(typeof shadow_root != "undefined") {
            if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c already loaded .. f(shadow_root)"                 , IPC_LOG_COLOR, lbA);
            return true;
        }
        else {
            return false;
        }
    }
    /*}}}*/
    /* DOM_LOAD_ID {{{*/
    if(typeof DOM_LOAD_ID     != "undefined")
    {
        let id = "dom_host_css_tag";            /* i.e. one of the inlined data js code */
        let el = document.getElementById(id);
        if( el ) {
            if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c already loaded .. f("+el.id+")"                   , IPC_LOG_COLOR, lbA);
            return  true;
        }
        else {
            return false;
        }
    }
    /*}}}*/
};
/*}}}*/

/*_ t_get_IPC {{{*/
/*{{{*/
/*
let t_get_IPC_sequence_number = 0;
 */
/*}}}*/
let t_get_IPC = function(message)
{
    if(!message) return null;

    let ipc = null;
    try {
        ipc = JSON.parse(message);
        let idata = ""; Object.keys(ipc).forEach( function(key) { idata += "["+key+" = "+ipc[key]+"]"+LF; });
        if(LOG_IPC) console.log("%c t_get_IPC(message)", IPC_MSG_COLOR);
        if(LOG_IPC) console.log("%c "+idata+" ",                   lbF);

    }
    catch(ex) {
        if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": t_get_IPC:"                            ,     lb2);
        if(LOG_IPC) console.log("%c "+t_strip_CR_LF(message)                                      , lbF+lb0);
        if(LOG_IPC) console.log("%c 0123456789_123456789_123456789_123456789_123456789_123456789_", lbF+lb8);
        if(LOG_IPC) console.log("%c 0_________1_________2_________3_________4_________5_________6", lbF+lb8);
        if(LOG_IPC) console.log("%c *** "+ex,                                                           lb2);
    }
    /*
if(ipc.sequence_number) t_get_IPC_sequence_number = ipc.sequence_number;
     */
    if(ipc && (typeof ipc.cancelreq != "undefined"))
    {
        let removing = (ipc.cancelreq == "ON") ? "(REMOVING) " : "";
        t_handle_scripts(removing);
        return null;
    }
    else {
        return ipc;
    }
};
/*}}}*/
/*_ t_send_IPC {{{*/
let t_send_IPC = function(ipc)
{
    if(LOG_IPC) console.log("%c t_send_IPC ", IPC_MSG_COLOR);

    let t_get_IPC_sequence_number = parseInt(new Date().getTime() / 1000) % 86400; /* seconds per day */

                                             ipc.sequence_number = t_get_IPC_sequence_number;

                                             let idata = ""; Object.keys(ipc).forEach( function(key) { idata += "["+key+" = "+ipc[key]+"]"+LF; });
                                             if(LOG_IPC) console.log("%c "+idata+" ", lbF);

                                             let ipc_json = JSON.stringify( ipc );
                                             document.body.setAttribute(IPC_SCRIPT_ID, ipc_json);
    };
/*}}}*/
/*_ t_strip_CR_LF {{{*/
let t_regexp_CR = new RegExp("\\r", "g");
let t_regexp_LF = new RegExp("\\n", "g");
let t_strip_CR_LF = function(text)
{
    return text
        .   replace(t_regexp_CR,  "")
        .   replace(t_regexp_LF, " ")
        .   trim()
    ;
};
/*}}}*/

/*_ t_handle_scripts {{{*/
let t_handle_scripts = function(removing)
{
    /* *** console.clear is not a function .. ? */
    try {
        if(LOG_IPC) console.clear();
        if(LOG_IPC) console.log("%c CLEARED BY t_handle_scripts ", IPC_MSG_COLOR);
    } catch(ex) {};

    let elements = document .getElementsByTagName("SCRIPT");
    if(LOG_IPC) console.log("%c "+ elements.length +" SCRIPT ELEMENTS: "+removing, lbF);

    for(let i=0; i < elements.length; ++i)
    {
        let s_el = elements[i];
        let p_el = elements[i].parentNode;
        try {
            /*
if(LOG_IPC) console.log((i+1)+"="+get_n_lbl( s_el ) + " parent=["+ get_n_lbl(p_el) +"]");
if(LOG_IPC) console.log((i+1)+"="+get_n_lbl( s_el ) + " parent=["+ get_n_lbl(p_el) +"]");
if(LOG_IPC) console.dir(s_el);
if(LOG_IPC) console.log((i+1)+".....baseURI: "+ s_el.baseURI   );
if(LOG_IPC) console.log((i+1)+"...outerHTML: "+ s_el.outerHTML );
             */
            if(LOG_IPC) console.log((i+1)+".........src: "+ s_el.src       );
        }
        catch(ex) {}

        if(removing) s_el.remove();
    }
};
/*}}}*/
/*_ t_ipc_contains_a_startup_message {{{*/
let t_ipc_contains_a_startup_message = function(ipc)
{
    let result
        =  (typeof ipc.start != "undefined")
        && (       ipc.start == "ON"       )
    ;

    if(LOG_IPC) console.log("t_ipc_contains_a_startup_message ...return %c"+ result, IPC_MSG_COLOR);
    return result;
};
/*}}}*/
/*_ t_wait_for_startup_message_from_extension {{{*/
const WAITING_FOR_STARTUP_MESSAGE = "TOOLS WAITING";/* FOR A STARTUP MESSAGE FROM EXTENSION";*/
let t_wait_for_startup_message_from_extension = function(_caller)
{
    if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c "+WAITING_FOR_STARTUP_MESSAGE, IPC_LOG_COLOR, lbF);

    let ipc = { t_load : WAITING_FOR_STARTUP_MESSAGE
        ,   caller : _caller
    };
    t_send_IPC( ipc );

    if(!t_ipc_listener_id) {
        t_ipc_add_MutationObserver(IPC_SCRIPT_ID);
        /*t_ipc_add_message_listener(IPC_SCRIPT_ID);*/
    }
};
/*}}}*/

/*}}}*/

if(LOG_IPC) console.log("%c "+DOM_TOOLS_JS_ID+" LOADING DONE ", lbH+lf5);

/* STAND-ALONE OR EXTENSION STARTUP MESSAGE RECEIVED {{{*/
let extension_signature
    = document.body.attributes[IPC_EXTENSION_ID]
    ? document.body.attributes[IPC_EXTENSION_ID].textContent
    : "";
if(LOG_IPC) console.log("...calling   t_load");

t_load();
/*}}}*/

console.log("");
/*}}}*/

/*}}}*/
//# sourceURL=dom_tools.js
`
)
 .replace(/%u/g,"\\u")
;
/*}}}*/
 
/* LOAD DATA */
/*{{{*/
/* ECC .. (copy-paste 181108 from javascript/dom_log.js) {{{*/
const lbA  = "background-color:inherit;   color:inherit;";

const lbF  = "font-size:120%; font-weight:500; border:2px solid white;";
const lbb  = "font-size:150%; font-weight:900; margin:0 0 0 0;";
const lbB  = "font-size:300%; font-weight:900; margin:0 0 0 0;";
const lbS  = "font-size:800%; font-weight:900; margin:0 0 0 0;";

const lbH  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0 1ex 1ex   0; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #000 0%, #223 50%, #000 100%);";
const lbL  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0   0   0 1ex; padding:0 .5em 0 .5em; border-radius:1em   0   0 1em; background:linear-gradient(to   left, #333 0%           ,#445 100%);";
const lbR  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0 1ex   0   0; padding:0 .5em 0 .5em; border-radius:  0 1em 1em   0; background:linear-gradient(to  right, #333 0%           ,#544 100%);";
const lbC  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0   0   0   0; padding:0 .5em 0 .5em; border-radius:  0   0   0   0;";

const lb1  = "background-color:#964B00; color:black;";
const lb2  = "background-color:#FF0000; color:black;";
const lb3  = "background-color:#FFA500; color:black;";
const lb4  = "background-color:#FFFF00; color:black;";
const lb5  = "background-color:#9ACD32; color:black;";
const lb6  = "background-color:#6495ED; color:black;";
const lb7  = "background-color:#EE82EE; color:black;";
const lb8  = "background-color:#A0A0A0; color:black;";
const lb9  = "background-color:#FFFFFF; color:black;";
const lb0  = "background-color:#000000; color:gray;";
const lbX = [ lb0 ,lb1 ,lb2 ,lb3 ,lb4 ,lb5 ,lb6 ,lb7 ,lb8 ,lb9 ];

const lf1  = "color:#964B00;";
const lf2  = "color:#FF0000;";
const lf3  = "color:#FFA500;";
const lf4  = "color:#FFFF00;";
const lf5  = "color:#9ACD32;";
const lf6  = "color:#6495ED;";
const lf7  = "color:#EE82EE;";
const lf8  = "color:#A0A0A0;";
const lf9  = "color:#FFFFFF;";
const lf0  = "color:#000000;";
const lfX = [ lf0 ,lf1 ,lf2 ,lf3 ,lf4 ,lf5 ,lf6 ,lf7 ,lf8 ,lf9 ];

/*}}}*/
/* dom_load {{{*/
dom_load = function()
{
/*{{{
if(LOG_IPC) console.log(DOM_LOAD_ID+": document.contentType=["+document.contentType+"]");
}}}*/

    let dom_load_success = true; /* the optimist at work */

    try {
        window.addEventListener('error', load_onerror, false);

        if( document.contentType.includes("xml") ) {
            if( !load_css_pi( DOM_HOST_CSS_ID  , dom_host_css_data   ) ) dom_load_success = false;
            if( !load_css_pi( DOM_TOOLS_CSS_ID , dom_tools_css_data  ) ) dom_load_success = false;
        }
        else {
            if( !load_css   ( DOM_HOST_CSS_ID  , dom_host_css_data   ) ) dom_load_success = false;
            if( !load_css   ( DOM_TOOLS_CSS_ID , dom_tools_css_data  ) ) dom_load_success = false;
            if( !load_css   ( DOM_GRID_CSS_ID  , dom_grid_css_data   ) ) dom_load_success = false;
        }

        if( !load_js        ( "dom_log_js"     , dom_log_js_data     ) ) dom_load_success = false;
        if( !load_js        ( "dom_util_js"    , dom_util_js_data    ) ) dom_load_success = false;
        if( !load_js        ( "dom_store_js"   , dom_store_js_data   ) ) dom_load_success = false;
        if( !load_js        ( "dom_hide_js"    , dom_hide_js_data    ) ) dom_load_success = false;
        if( !load_js        ( "dom_select_js"  , dom_select_js_data  ) ) dom_load_success = false;
        if( !load_js        ( "dom_wording_js" , dom_wording_js_data ) ) dom_load_success = false;
        if( !load_js        ( "dom_grid_js"    , dom_grid_js_data    ) ) dom_load_success = false;
        if( !load_html      ( "dom_tools_html" , dom_tools_html_data ) ) dom_load_success = false;
        if( !load_js        ( "dom_prop_js"    , dom_prop_js_data    ) ) dom_load_success = false;
        if( !load_js        ( "dom_tools_js"   , dom_tools_js_data   ) ) dom_load_success = false;

    }
    catch(ex) {
        console.dir(ex);
        dom_load_success = false;
    }
    finally {
        window.removeEventListener('error', load_onerror, false);
    }
    return dom_load_success;
};

let load_onerror = function(e)
{
    console.log("load_onerror:");

    console.log("e:");
    console.dir( e);

    try { console.log("e.error..."+ e.error  ); } catch(ex) { console.log(ex); }
    try { console.dir("e.target.."+ e.target ); } catch(ex) { console.log(ex); }
    console.log(e.target);
    try { console.log("e.message."+ e.message); } catch(ex) { console.log(ex); }
    try { console.log("e.name...."+ e.name   ); } catch(ex) { console.log(ex); }
    try { console.log("e.type...."+ e.type   ); } catch(ex) { console.log(ex); }

};
/*}}}*/
/* dom_check_scheme_arg {{{*/
/*{{{*/
const DOM_DATA_LENGTH_MIN = 100;
const TOOLS2_SANITY_CHECK_FAILED = "TOOLS SANITY CHECK FAILED";

/*}}}*/
let dom_check_scheme_arg = function(caller, scheme_id, scheme_arg)
{
    let is_file    =             scheme_arg.startsWith("file:");
    let is_content = !is_file || scheme_arg.startsWith("data:");

    /* unchecked content */
    if( !is_content ) {
if(LOG_IPC) console.log("__"+caller+": %c "+scheme_id+" = "+scheme_arg, lf5);
        return true;
    }

if(LOG_IPC) console.log("__"+caller+": %c "+scheme_id+" = "+scheme_arg.length+" bytes", lf5);

    if(scheme_arg.length > DOM_DATA_LENGTH_MIN) {
        return true;
    }
    else {
console.log("%c *** "+TOOLS2_SANITY_CHECK_FAILED+"%c on %c"+scheme_id+" ", lbL+lf2, lbC+lf8, lbR+lf3);

        /* share failure diagnostic */
        if(typeof send_IPC != "undefined")
        {
            let msg = DOM_LOAD_ID+": \""+scheme_id+"\" "+TOOLS2_SANITY_CHECK_FAILED;
            let ipc = { t_load:msg, caller:DOM_LOAD_TAG };
            send_IPC( ipc );
        }

        return false;
    }
};
/*}}}*/
/* load_js {{{*/
load_js = function(id, scheme_arg) {
    if( !dom_check_scheme_arg("load_js", id, scheme_arg) ) return false;
    if( document.getElementById(id) ) return;
    let el    = document.createElement("script");
    el.id     = id;
    el.type   = "text/javascript";
    el.src    = scheme_arg;
    el.async  = false;
    el.defer  = true;
    el.addEventListener("error", load_onerror);
    document.getElementsByTagName("head")[0].appendChild(el);
/*console_dir(el);*/
    return true;
};
/*}}}*/
/* load_css {{{*/
load_css = function(id, scheme_arg) {
    if( !dom_check_scheme_arg("load_css", id, scheme_arg) ) return false;
    if( document.getElementById(id) ) return;
    let el    = document.createElement("link");
    el.id     = id;
    el.type   = "text/css";
    el.href   = scheme_arg;
    el.rel    = "stylesheet";
    el.addEventListener("error", load_onerror);
    document.getElementsByTagName("head")[0].appendChild(el);

/*{{{
console.log("%c...CSS Rule tag = "+get_el_sheet_first_rule_text_content(el)+"]", lf8);
}}}*/

    return true;
};
/*}}}*/
/* load_css_pi {{{*/
load_css_pi = function(id, scheme_arg) {
    if( !dom_check_scheme_arg("load_css_pi", id, scheme_arg) ) return false;
    if( document.getElementById(id) ) return;
    let el    = document.createProcessingInstruction("xml-stylesheet", "href='"+ scheme_arg +"' type='text/css'");
    el.id     = id;
    el.addEventListener("error", load_onerror);
    document.insertBefore(el, document.firstChild);
/*console_dir(el);*/
    return true;
};
/*}}}*/
/* load_html {{{*/
load_html = function(id, html) {
    if( !dom_check_scheme_arg("load_html", id, html) ) return false;
    if( document.getElementById(id) ) return;
    let el       = document.createElement("DIV");
    el.id        = id;
    el.addEventListener("error", load_onerror);
    el.innerHTML = unescape(html);
/*
el.style.visibility = "hidden";
*/
el.style.display    = "none";

    document.body.appendChild (el);
/*console_dir(el);*/
    return true;
};
/*}}}*/
/*_ get_el_sheet_first_rule_text_content {{{*/
let get_el_sheet_first_rule_text_content = function(el)
{
    let tag = "";
    try {
        if( el) {
            let txt = el.sheet.cssRules[0].cssText;
            let x_1 = txt.indexOf    ('"');
            let x_2 = txt.lastIndexOf('"');
            txt     = txt.substring(x_1+1, x_2);
            tag     = txt.includes(el.id) ? "SHEET: "+txt : "";
        }
    }
    catch(ex) {
        console.log("%c get_el_sheet_first_rule_text_content("+el.id+"):"+ ex, lbH+lf2);
    }
    return tag;
};
/*}}}*/
/*}}}*/

/* IPC */
/*{{{*/
/*_ t_handle_ipc_message {{{*/
let t_handle_ipc_message = function(ipc)
{
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c t_handle_ipc_message(ipc)"                        , IPC_LOG_COLOR, lbA);
    /* 1/3 - ALREADY LOADED {{{*/
    if( t_ipc_is_IPC_SCRIPT_loaded() )
    {
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c SCRIPT ALREADY LOADED"                            , IPC_LOG_COLOR, lbF);

        return true;
    }
    /*}}}*/
    /* 2/3 - NOT STARTED BY IPC MESSAGE {{{*/
    if(    (typeof ipc.start == "undefined")
        || (       ipc.start != "ON"       )
    ) {
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c NOT STARTED BY IPC MESSAGE "                      , IPC_LOG_COLOR, lbF);

        t_wait_for_startup_message_from_extension( IPC_SCRIPT_ID );
        return false;
    }
    /*}}}*/
    /* 3/3 - HANDLE A START UP MESSAGE .. (stop listening and load script) {{{*/
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c STARTED BY IPC MESSAGE "                          , IPC_LOG_COLOR, lbF);

    /* STOP LISTENING IPC MESSAGES */
    if(t_ipc_listener_id)
    {
        t_ipc_del_message_listener();
        t_ipc_del_MutationObserver();
        t_ipc_listener_id = null;

    }
    /* AND LOAD SCRIPT */
if(LOG_IPC) console.log("...calling dom_load");

    dom_load(DOM_LOAD_ID);

    if( t_ipc_is_IPC_SCRIPT_loaded() )
        t_wait_for_startup_message_from_extension( IPC_SCRIPT_ID );

    return true;
    /*}}}*/
};

/*}}}*/
let IPC_SCRIPT_ID = DOM_LOAD_ID;
let IPC_LOG_COLOR = lb3;
/* IPC {{{*/
/*{{{*/
let IPC_EXTENSION_ID = "background_js";
let LOG_IPC          = true;

let IPC_MSG_COLOR    = lbF+IPC_LOG_COLOR;
/*}}}*/

/* IPC: EventListener */
/*_ t_ipc_add_message_listener {{{*/
let t_ipc_add_message_listener = function(script_id)
{
t_ipc_listener_id = script_id;
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": ADDING IPC MESSAGE LISTENER ", IPC_MSG_COLOR);

window.addEventListener   ("message", t_ipc_message_CB, false);
};
/*}}}*/
/*_ t_ipc_del_message_listener {{{*/
let t_ipc_del_message_listener = function(script_id)
{
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": DELETING IPC MESSAGE LISTENER", IPC_MSG_COLOR);

window.removeEventListener("message", t_ipc_message_CB, false);
};
/*}}}*/
/*_ t_ipc_message_CB {{{*/
let t_ipc_message_CB = function(event)
{
/* MESSAGE ORIGIN {{{*/
if(!window.location.href.startsWith( event.origin ))
{
/*
if(LOG_IPC) console.log("...not same origin: window.location.href=["+window.location.href+"]");
if(LOG_IPC) console.log("...not same origin: ........event.origin=["+event.origin        +"]");
*/
    return;
}
if(LOG_IPC) console.log("%c"+t_ipc_listener_id+".t_ipc_message_CB", IPC_MSG_COLOR);
if(LOG_IPC) console.dir(event);
/*}}}*/
/* IPC MESSAGE {{{*/
let message = event.data;
if(LOG_IPC) console.log("%c"+t_ipc_listener_id+".t_ipc_message_CB: %c "+message+" ", IPC_MSG_COLOR, lbF);
let ipc = t_get_IPC( message );
if(!ipc ) return;

if(typeof     ipc.LOG_IPC != "undefined") {
    LOG_IPC = ipc.LOG_IPC;
    console.log("%c t_ipc_message_CB: %c LOG_IPC="+LOG_IPC+" ", IPC_MSG_COLOR, lbF+(LOG_IPC ? lb2 : lb8));

    return;
}
/*}}}*/
/* SCRIPT MESSAGE {{{*/
t_handle_ipc_message( ipc );

/*}}}*/
};
/*}}}*/

/* IPC: MutationObserver */
/*_ t_ipc_add_MutationObserver {{{*/
/*{{{*/
let t_ipc_MutationObserver;
/*}}}*/
let t_ipc_add_MutationObserver = function(script_id)
{
/* SCRIPT ID {{{*/
t_ipc_listener_id = script_id;
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": ADDING IPC MutationObserver", IPC_MSG_COLOR);

/*}}}*/
/* LISTEN {{{*/
t_ipc_MutationObserver = new MutationObserver( t_ipc_MutationObserver_CB );

let config = { attributes            :  true /* attributes                          */
    ,          characterData         :  true /* data                                */
    ,          childList             : false /* additions and removals of s child   */
    ,          subtree               : false /* target and target's descendants     */
    ,          attributeOldValue     :  true /* attribute value before the mutation */
    ,          characterDataOldValue :  true /* data before the mutation            */
    ,          attributeFilter       : [IPC_EXTENSION_ID]
};

t_ipc_MutationObserver.observe(document.body, config);
/*}}}*/
};
/*}}}*/
/*_ t_ipc_del_MutationObserver {{{*/
let t_ipc_del_MutationObserver = function(script_id)
{
/* STOP OBSERVING {{{*/
if(t_ipc_MutationObserver)
{
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": DISCONNECTING MutationObserver", IPC_MSG_COLOR);
    t_ipc_MutationObserver.disconnect();
    t_ipc_MutationObserver = null;
}
else {
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": MutationObserver NOT CONNECTED", IPC_MSG_COLOR);
}
/*}}}*/
};
/*}}}*/
/*_ t_ipc_MutationObserver_CB {{{*/
let t_ipc_MutationObserver_CB = function(mutations)
{
/* LOG {{{
mutations.forEach(
    function(mutation) {
        if(LOG_IPC) console.log(t_ipc_listener_id+": MutationObserver:");
        if(LOG_IPC) console.log(".................type=["+mutation.type               +"]");
        if(LOG_IPC) console.log("........attributeName=["+mutation.attributeName      +"]");
        if(LOG_IPC) console.log(".............oldValue=["+mutation.oldValue           +"]");
        if(LOG_IPC) console.log("...attributeNamespace=["+mutation.attributeNamespace +"]");
        if(LOG_IPC) console.dir(mutation);
    }
);
}}}*/
/* HANDLE MESSAGE {{{*/
let message = document.body.attributes[IPC_EXTENSION_ID]
    ?         document.body.attributes[IPC_EXTENSION_ID].textContent : "";
if(LOG_IPC) console.log(t_ipc_listener_id+".t_ipc_MutationObserver_CB: ...message=["+message+"]");

let ipc = t_get_IPC( message );
if( ipc ) t_handle_ipc_message( ipc );
/*}}}*/
};
/*}}}*/

/* IPC: Util */
/*{{{*/

let t_ipc_listener_id;
/*}}}*/
/*_ t_ipc_is_IPC_SCRIPT_loaded {{{*/
let t_ipc_is_IPC_SCRIPT_loaded = function()
{
/* DOM_TOOLS_JS_ID {{{*/
if(typeof DOM_TOOLS_JS_ID != "undefined")
{
    if(typeof shadow_root != "undefined") {
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c already loaded .. f(shadow_root)"                 , IPC_LOG_COLOR, lbA);
        return true;
    }
    else {
        return false;
    }
}
/*}}}*/
/* DOM_LOAD_ID {{{*/
if(typeof DOM_LOAD_ID     != "undefined")
{
    let id = "dom_host_css_tag";            /* i.e. one of the inlined data js code */
    let el = document.getElementById(id);
    if( el ) {
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c already loaded .. f("+el.id+")"                   , IPC_LOG_COLOR, lbA);
        return  true;
    }
    else {
        return false;
    }
}
/*}}}*/
};
/*}}}*/

/*_ t_get_IPC {{{*/
/*{{{*/
/*
let t_get_IPC_sequence_number = 0;
*/
/*}}}*/
let t_get_IPC = function(message)
{
if(!message) return null;

let ipc = null;
try {
    ipc = JSON.parse(message);
    let idata = ""; Object.keys(ipc).forEach( function(key) { idata += "["+key+" = "+ipc[key]+"]"+LF; });
if(LOG_IPC) console.log("%c t_get_IPC(message)", IPC_MSG_COLOR);
if(LOG_IPC) console.log("%c "+idata+" ",                   lbF);

}
catch(ex) {
if(LOG_IPC) console.log("%c "+t_ipc_listener_id+": t_get_IPC:"                            ,     lb2);
if(LOG_IPC) console.log("%c "+t_strip_CR_LF(message)                                      , lbF+lb0);
if(LOG_IPC) console.log("%c 0123456789_123456789_123456789_123456789_123456789_123456789_", lbF+lb8);
if(LOG_IPC) console.log("%c 0_________1_________2_________3_________4_________5_________6", lbF+lb8);
if(LOG_IPC) console.log("%c *** "+ex,                                                           lb2);
}
/*
if(ipc.sequence_number) t_get_IPC_sequence_number = ipc.sequence_number;
*/
if(ipc && (typeof ipc.cancelreq != "undefined"))
{
    let removing = (ipc.cancelreq == "ON") ? "(REMOVING) " : "";
    t_handle_scripts(removing);
    return null;
}
else {
    return ipc;
}
};
/*}}}*/
/*_ t_send_IPC {{{*/
let t_send_IPC = function(ipc)
{
if(LOG_IPC) console.log("%c t_send_IPC ", IPC_MSG_COLOR);

    let t_get_IPC_sequence_number = parseInt(new Date().getTime() / 1000) % 86400; /* seconds per day */

    ipc.sequence_number = t_get_IPC_sequence_number;

    let idata = ""; Object.keys(ipc).forEach( function(key) { idata += "["+key+" = "+ipc[key]+"]"+LF; });
if(LOG_IPC) console.log("%c "+idata+" ", lbF);

    let ipc_json = JSON.stringify( ipc );
    document.body.setAttribute(IPC_SCRIPT_ID, ipc_json);
};
/*}}}*/
/*_ t_strip_CR_LF {{{*/
let t_regexp_CR = new RegExp("\\r", "g");
let t_regexp_LF = new RegExp("\\n", "g");
let t_strip_CR_LF = function(text)
{
return text
    .   replace(t_regexp_CR,  "")
    .   replace(t_regexp_LF, " ")
    .   trim()
;
};
/*}}}*/

/*_ t_handle_scripts {{{*/
let t_handle_scripts = function(removing)
{
/* *** console.clear is not a function .. ? */
try {
if(LOG_IPC) console.clear();
if(LOG_IPC) console.log("%c CLEARED BY t_handle_scripts ", IPC_MSG_COLOR);
} catch(ex) {};

let elements = document .getElementsByTagName("SCRIPT");
if(LOG_IPC) console.log("%c "+ elements.length +" SCRIPT ELEMENTS: "+removing, lbF);

for(let i=0; i<elements.length; ++i)
{
    let s_el = elements[i];
    let p_el = elements[i].parentNode;
    try {
/*
if(LOG_IPC) console.log((i+1)+"="+get_n_lbl( s_el ) + " parent=["+ get_n_lbl(p_el) +"]");
if(LOG_IPC) console.log((i+1)+"="+get_n_lbl( s_el ) + " parent=["+ get_n_lbl(p_el) +"]");
if(LOG_IPC) console.dir(s_el);
if(LOG_IPC) console.log((i+1)+".....baseURI: "+ s_el.baseURI   );
if(LOG_IPC) console.log((i+1)+"...outerHTML: "+ s_el.outerHTML );
*/
if(LOG_IPC) console.log((i+1)+".........src: "+ s_el.src       );
    }
    catch(ex) {}

    if(removing) s_el.remove();
}
};
/*}}}*/
/*_ t_ipc_contains_a_startup_message {{{*/
let t_ipc_contains_a_startup_message = function(ipc)
{
let result
    =  (typeof ipc.start != "undefined")
    && (       ipc.start == "ON"       )
;

if(LOG_IPC) console.log("t_ipc_contains_a_startup_message ...return %c"+ result, IPC_MSG_COLOR);
return result;
};
/*}}}*/
/*_ t_wait_for_startup_message_from_extension {{{*/
const WAITING_FOR_STARTUP_MESSAGE = "TOOLS WAITING";/* FOR A STARTUP MESSAGE FROM EXTENSION";*/
let t_wait_for_startup_message_from_extension = function(_caller)
{
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c "+WAITING_FOR_STARTUP_MESSAGE, IPC_LOG_COLOR, lbF);

let ipc = { t_load : WAITING_FOR_STARTUP_MESSAGE
        ,   caller : _caller
    };
    t_send_IPC( ipc );

    if(!t_ipc_listener_id) {
        t_ipc_add_MutationObserver(IPC_SCRIPT_ID);
      /*t_ipc_add_message_listener(IPC_SCRIPT_ID);*/
    }
};
/*}}}*/

/*}}}*/

if(LOG_IPC) console.log("%c "+DOM_LOAD_ID+" LOADING DONE ", lbH+lf5);

/* STAND-ALONE OR WAIT FOR EXTENSION STARTUP MESSAGE {{{*/
let IPC_check_extension_signature = function()
{
    /* BODY-ATTR [IPC_EXTENSION_ID] .. (a body attribute set by a browser extension) {{{*/
    if(typeof document.body.attributes[IPC_EXTENSION_ID] != "undefined")
    {
        let         lxx = "font-size:800%; color:#6495ED;";
        let SYMBOL_GEAR = "\u2699";
if(LOG_IPC) console.log("%c"+SYMBOL_GEAR+" %c"+IPC_SCRIPT_ID+" %c EXTENSION SIGNATURE DETECTED", lxx, IPC_LOG_COLOR, lbF);

        extension_signature = document.body.attributes[IPC_EXTENSION_ID].textContent;

if(LOG_IPC) console.log("%c["+IPC_EXTENSION_ID+"]%c = %c"+extension_signature, IPC_MSG_COLOR, lbA, lbF+lb0);
    }
    /*}}}*/
    /* EXTENSION SIGNATURE DETECTED .. (wait for a startup-message) {{{*/
    if(extension_signature)
    {
        let ipc =  t_get_IPC( extension_signature );
        t_handle_ipc_message(ipc);
    }
    /*}}}*/
    /* EXTENSION SIGNATURE NOT FOUND .. (stand-alone instant load) {{{*/
    else {
if(LOG_IPC) console.log("%c "+IPC_SCRIPT_ID+" %c NO EXTENSION DETECTED: STAND-ALONE INSTANT LOAD " , IPC_LOG_COLOR, lbF);

        if     (typeof   t_load != "undefined") { if(LOG_IPC) console.log("...calling   t_load");   t_load(DOM_LOAD_ID); }
        else if(typeof dom_load != "undefined") { if(LOG_IPC) console.log("...calling dom_load"); dom_load(DOM_LOAD_ID); }
    }
    /*}}}*/
};
if(LOG_IPC) console.log("%c "+DOM_LOAD_ID+" %c : %c ...setTimeout(IPC_check_extension_signature, 2000) ", lbF+lb5,lbA, lbF+lb0);
let extension_signature = "";
setTimeout(IPC_check_extension_signature, 2000);
/*}}}*/

/*}}}*/
})();
//# sourceURL=dom_load..js

