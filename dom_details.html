<!DOCTYPE html>
<html>
 <head>
  <title>dom_details</title>
  <!-- META {{{ -->
  <meta id="meta_http_equiv"    http-equiv="content-type"  content="text/html" charset="utf-8">
  <meta                         http-equiv="Cache-control" content="no-cache">
  <meta                         http-equiv="pragma"        content="no-cache">
  <!-- }}} -->
  <!-- [link] CSS {{{-->
  <link id='grid_container' type='text/css' href='stylesheet/grid_container.css' rel='stylesheet'/>
  <link id='ecc_css'        type='text/css' href='stylesheet/ecc.css'            rel='stylesheet'/>
  <link id="index"          type="text/css" href="stylesheet/index.css"          rel="stylesheet"/>
  <link id="playground_css" type="text/css" href="stylesheet/playground.css"     rel="stylesheet"/>
  <link                     type="text/css" href="stylesheet/dom_host.css"       rel="stylesheet"/>
  <link                     type="text/css" href="stylesheet/checkbox.css"       rel="stylesheet"/>
  <link                     type="text/css" href="stylesheet/dom_grid.css"       rel="stylesheet"/>
  <!--}}}-->
  <!-- SCRIPT SRC {{{-->


<!--{{{
}}}-->
<!--{{{
  <script id="dom_util_js"         src="script/dom_util.js"         defer></script>
  <script id="dom_log_js"          src="script/dom_log.js"          defer></script>
  <script id="dom_fly_js"          src="script/dom_fly.js"          defer></script>
  <script id="dom_store_js"        src="script/dom_store.js"        defer></script>
  <script id="dom_prop_js"         src="script/dom_prop.js"         defer></script>
  <script id="dom_i18n_js"         src="script/dom_i18n.js"         defer></script>
  <script id="dom_data_js"         src="script/dom_data.js"         defer></script>
  <script id="dom_slot_js"         src="script/dom_slot.js"         defer></script>
  <script id="dom_select_js"       src="script/dom_select.js"       defer></script>
}}}-->

  <script id="dom_details_log_js"  src="script/dom_details_log.js"  defer></script>
  <script id="dom_details_util_js" src="script/dom_details_util.js" defer></script>
  <script id="dom_details_js"      src="script/dom_details.js"      defer></script>

  <script id="dom_wot_log_js"      src="script/dom_wot_log.js"      defer></script>
  <script id="dom_wot_util_js"     src="script/dom_wot_util.js"     defer></script>
  <script id="dom_wot_js"          src="script/dom_wot.js"          defer></script>
  <script id="dom_sentence"        src="script/dom_sentence.js"     defer></script>

 <!--}}}-->
<!-- SCRIPT INIT {{{ -->
<script>
    DOM_LOAD_ID       = "dom_details_html"; DOM_LOAD_TAG  = DOM_LOAD_ID+" (211120:15h:33)";
    DOM_LOAD_PANELS   = "";
    document.getElementsByTagName("html")[0].id  = DOM_LOAD_ID;

    function script_INIT() {
        document.getElementsByTagName("title")[0].innerText = DOM_LOAD_ID.toLowerCase();
        document.getElementsByTagName("h1"   )[0].innerHTML = "<em class='cc4'>"+DOM_LOAD_TAG+"</em>";

//      script_REQUIRE();
    }
</script>
<!--}}}-->
<!-- SCRIPT REQUIRE {{{-->
<script>
    /*➔ localStorage {{{*/
    let localStorage_delItem = function(key    ) { /*...*/ localStorage.removeItem(key    );                                    }; /* eslint-disable-line no-unused-vars */
    let localStorage_getItem = function(key    ) { return  localStorage.getItem   (key    );                                    }; /* eslint-disable-line no-unused-vars */
    let localStorage_setItem = function(key,val) { if(val) localStorage.setItem   (key,val); else localStorage.removeItem(key); }; /* eslint-disable-line no-unused-vars */
    /*}}}*/
    let t_WOT_SPLIT;
    let details_load_open_state;

    //t t_util;
    //t t_data;
    //t t_store;
    let t_tools;

    let script_REQUIRE = function()
    {
        console.log(`%c
            ┌──────────────────────────────────────────────────────────────────────────┐
            │ let ............... t_WOT_SPLIT                                          │
            │ let ... details_load_open_state                                          │
            └──────────────────────────────────────────────────────────────────────────┘
            `, "background : linear-gradient(to right, #500, #200);");

        t_WOT_SPLIT             = dom_wot.t_WOT_SPLIT;

    //  t_util                  = dom_util;

    //  t_data                  = {};
    //  t_data.CSS_LINE_NUM     = dom_data.CSS_LINE_NUM;
    //  t_data.LF               = dom_data.LF          ;
    //  t_data.LINES_WOT        = dom_data.LINES_WOT   ;

    //  t_store                 = {};
    //  t_store.t_store_getBool = dom_store.t_store_getBool;

        t_tools                 = {};
        t_tools.t_get_tool      = function(id) { return document.querySelector("#"+id); };

        details_load_open_state = dom_details.details_load_open_state;
    };

</script>
<!--}}}-->
<!-- SCRIPT check_load_html_results {{{ -->
 <script>
  const lbH  = "font-weight:900; line-height:1.5em; border:1px solid gray; margin:   0 1ex 1ex   0; padding:0 .5em 0 .5em; border-radius:1em 1em 1em 1em; background:linear-gradient(to bottom, #555 0%, #223 80%, #454 100%);";
  const lf2  = "color:#FF0000;";
  const lf5  = "color:#9ACD32;";
  const lf8  = "color:#A0A0A0;";
  const dom_data_SYMBOL_CHECK_MARK  = "\u2714";
  const dom_data_SYMBOL_NOT_CHECKED = "\u237B";
  function check_load_html_results()
  {
   console.log("%c"+DOM_LOAD_TAG, lbH+lf5);
   let id;                                   let missing_ids  = "";
// if(typeof DOM_LOG_JS_TAG          === 'undefined') missing_ids += "\n DOM_LOG_JS_TAG"         ;
// if(typeof DOM_UTIL_JS_TAG         === 'undefined') missing_ids += "\n DOM_UTIL_JS_TAG"        ;

   if(typeof DOM_DETAILS_JS_TAG      === 'undefined') missing_ids += "\n DOM_DETAILS_JS_TAG"     ;
   if(typeof DOM_DETAILS_LOG_JS_TAG  === 'undefined') missing_ids += "\n DOM_DETAILS_LOG_JS_TAG" ;
   if(typeof DOM_DETAILS_UTIL_JS_TAG === 'undefined') missing_ids += "\n DOM_DETAILS_UTIL_JS_TAG";

   if(typeof DOM_WOT_JS_TAG          === 'undefined') missing_ids += "\n DOM_WOT_JS_TAG"         ;
   if(typeof DOM_WOT_LOG_JS_TAG      === 'undefined') missing_ids += "\n DOM_WOT_LOG_JS_TAG"     ;
   if(typeof DOM_WOT_UTIL_JS_TAG     === 'undefined') missing_ids += "\n DOM_WOT_UTIL_JS_TAG"    ;

   if(missing_ids) {
    let lbb = "font-size:150%; font-weight:900; margin:0 0 0 0;";
    let lf2 = "color:#FF0000;";
    console.log("%c"+dom_data_SYMBOL_NOT_CHECKED+"%c"+missing_ids+"%c is missing", lbH+lf2, lf2, lf8);
    alert(         "MISSING IDs:\n"+missing_ids);
   }
  }

  function check_missing_id(id)
  {
   let      shadow_root = tools.t_get_shadow_root();
   let el = shadow_root
       ?    shadow_root.querySelector("#"+id)
       :    document   .querySelector("#"+id);
   if(!el ) return "\n#"+id;
   console.log("%c"+dom_data_SYMBOL_CHECK_MARK+"%c"+el.textContent,lbH+lf8,lf8);
   return "";
  }

  setTimeout(check_load_html_results, 500);
 </script>
<!--}}}-->
<!-- SCRIPT IMPORT {{{-->
<script>
let dom_modules_IMPORT = function()
{
/*..........................................................................................*/
/*....................................... dom_data     EXPORT-ONLY                    /* 05 */
/*..........................................................................................*/
let log_this = true;
if(log_this) console.log("dom_modules_IMPORT");
if(typeof dom_log     != "undefined")     dom_log     .t_log_IMPORT     (log_this);   /* 06 */
if(typeof dom_util    != "undefined")     dom_util    .t_util_IMPORT    (log_this);   /* 07 */
if(typeof dom_store   != "undefined")     dom_store   .t_store_IMPORT   (log_this);   /* 11 */
if(typeof dom_details != "undefined")     dom_details .t_details_IMPORT (log_this);   /* 08 */
if(typeof dom_wot     != "undefined")     dom_wot     .t_wot_IMPORT     (log_this);   /* 14 */
};
//setTimeout(dom_modules_IMPORT,0);
</script>
 <!--}}}-->
<!-- style {{{-->
 <style>
  body    { margin: 5px; background :  #111;       color : #EED;                                 }
  button  { margin: 5px; background :  #333;       color : #EED;                                 }
  h1      { margin: 5px;      clear : right;      margin :  1em; user-select : none;             }
  li      { margin: 5px;                                                                         }
  summary {             user-select : none;                                                      }
  .todo   {                   color :   red; font-family : "Comic sans ms"; font-weight: bolder; }
 </style>
<!--}}}-->
 </head>
 <body onload='script_INIT();'>
 <h1 title="onclick .. reload" onclick='document.location.reload();'>...</h1>
<hr>
 <button onclick='document.location.reload();' title="reset & reload">&#x21BB;                 </button>
<!-- BUTTONS {{{-->
 <em class="todo">TODO: scroll into view only if not already visible</em>
 <hr>
 <button onclick='dom_modules_IMPORT();'                        >dom_modules_IMPORT()</button>

 <a id="details_close" title="details_close"          class="em5 action" onclick='dom_details.details_close_opened(     );'                         ><label> ▲        details_close_opened          </label></a>
 <a id="details_open"  title="details_open"           class="em5 action" onclick='dom_details.details_open_closed (     );'                         ><label> ▼        details_open_closed           </label></a>
 <a id="details_radio" title="details radio behavior" class="em5 action" onclick='dom_details.details_radio_toggle(event);'><input type="checkbox" /><label> &#x21F6; details_radio_toggle &#x25B6; </label></a>
 <br>

 <button            onclick='dom_wot.t_WOT_SPLIT()                ; this.innerHTML = "✔ "+this.innerHTML;'>dom_wot.t_WOT_SPLIT();                </button>
 <br>

 <button            onclick='dom_details.details_onload(); this.innerHTML = "✔ "+this.innerHTML;'>dom_details.onload();</button>
 <br>

 <a href="#fold_44" onclick='this.innerHTML = "✔ "+ this.innerHTML;'                                      >#fold_44 /* LOAD */                   </a>

<!--}}}-->
<hr>
<!-- dom_details_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_details.js       | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_details_html" open class="folded_code"><summary> <B>dom_details</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_details                                                              │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* eslint-disable no-warning-comments   */

/* globals console                      */
/* globals document                     */
/* globals localStorage, setTimeout     */

/* globals dom_log                      */
/* globals dom_util                     */
/* globals dom_store                    */

/* exported dom_details, DOM_DETAILS_JS_TAG */

const DOM_DETAILS_JS_ID        = "dom_details_js";
const DOM_DETAILS_JS_TAG       = DOM_DETAILS_JS_ID  +" (211119:17h:51)";  /* eslint-disable-line no-unused-vars */
/*}}}*/
let dom_details         = (function() {
"use strict";
let   DOM_DETAILS_LOG   = false;
let   DOM_DETAILS_TAG   = false;
/*{{{*/
const DETAILS_RADIO_ID = "details_radio";

/*}}}*/

/*➔ t_details_IMPORT {{{*/
/* eslint-disable no-unused-vars */
let t_details_IMPORT    = function(log_this)
{
    details_INTERN();

    DOM_DETAILS_LOG     = DOM_DETAILS_LOG   || localStorage_getItem("DOM_DETAILS_LOG");
    DOM_DETAILS_TAG     = DOM_DETAILS_TAG   || localStorage_getItem("DOM_DETAILS_TAG");
};
/*}}}*/
/*_   details_INTERN {{{*/
/*{{{*/

/* dom_log {{{*/
let lb0="", lb1="", lb2="", lb3="", lb4="", lb5="", lb6="", lb7="", lb8="", lb9="", lbX="";
let lbA="", lbB="", lbC="", lbF="", lbH="", lbL="", lbR="", lbS="", lbb=""                ;
let lf0="", lf1="", lf2="", lf3="", lf4="", lf5="", lf6="", lf7="", lf8="", lf9="", lfX="";

let log=console.log, logBIG=log, log_key_val, log_key_val_group;


/*}}}*/
/* dom_util {{{*/
let add_el_class;
let del_el_class;
let get_el_child_with_tag;
let get_el_sibling_with_tag;
let get_id_or_tag;
let get_id_or_tag_and_className;
let get_nodeXPath;
let get_tool;
let is_el_or_child_of_parent_el;

/*}}}*/
/* dom_store {{{*/

let localStorage_delItem = (key    ) =&gt;           localStorage.removeItem(key    );                                       /* eslint-disable-line no-unused-vars */
let localStorage_getItem = (key    ) =&gt;           localStorage.getItem   (key    );                                       /* eslint-disable-line no-unused-vars */
let localStorage_setItem = (key,val) =&gt; { if(val) localStorage.setItem   (key,val); else localStorage.removeItem(key); }; /* eslint-disable-line no-unused-vars */

/*}}}*/

/*}}}*/
let   details_INTERN    = function()
{
/*{{{*/
let caller = "details_INTERN";

/*}}}*/
    /* dom_log {{{*/
    let dom_log_js
        = (typeof dom_log != "undefined")
        ?         dom_log
        :         dom_details_log;  /* script/dom_details_log.js */ /* eslint-disable-line no-undef */

    if( dom_log_js )
    {
        if(dom_log_js.LOG_BG_CSS) {
            ({ lb0, lb1, lb2, lb3, lb4, lb5, lb6, lb7, lb8, lb9, lbX } = dom_log_js.LOG_BG_CSS);
            ({ lf0, lf1, lf2, lf3, lf4, lf5, lf6, lf7, lf8, lf9, lfX } = dom_log_js.LOG_FG_CSS);
            ({ lbA, lbB, lbC, lbF, lbH, lbL, lbR, lbS, lbb           } = dom_log_js.LOG_XX_CSS);
        }

        ({  log
         ,  logBIG



         ,  log_key_val
         ,  log_key_val_group

        } = dom_log_js);

if(DOM_DETAILS_LOG || DOM_DETAILS_TAG) logBIG(caller+": ["+dom_log_js.name+"]" , 4);
    }
    else {

logBIG(caller+": [dom_log UNDEFINED]"   , 2);
    }
    /*}}}*/
    /* dom_util {{{*/
    let dom_util_js
        = (typeof dom_util != "undefined")
        ?         dom_util
        :         dom_details_util; /* script/dom_details_util.js */ /* eslint-disable-line no-undef */

    if( dom_util_js )
    {
        ({  add_el_class
         ,  del_el_class
         ,  get_el_child_with_tag
         ,  get_el_sibling_with_tag
         ,  get_id_or_tag
         ,  get_id_or_tag_and_className
         ,  get_nodeXPath
         ,  get_tool
         ,  is_el_or_child_of_parent_el
        } = dom_util_js);

if(DOM_DETAILS_LOG || DOM_DETAILS_TAG) logBIG(caller+": ["+dom_util_js.name+"]"    , 4);
    }
    else {

logBIG(caller+": [dom_util UNDEFINED]"      , 2);
    }
    /*}}}*/
    /* dom_store {{{*/
    if(typeof dom_store != "undefined")
    {
        localStorage_getItem =          dom_store.t_store_getItem;
        localStorage_setItem =          dom_store.t_store_set_value;
        localStorage_delItem = (key) =&gt; dom_store.t_store_set_value(key,null);

if(DOM_DETAILS_LOG || DOM_DETAILS_TAG) logBIG(caller+": ["+dom_store.name+"]"      , 4);
    }
    /*}}}*/

};
/* eslint-enable no-unused-vars */
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ 1. LISTEN TOGGLE DETAILS OPEN STATE       [localStorage details_id_open] │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
let details_handler = (function() {
/*➔ details_onload {{{*/
let details_onload = function()
{
/*{{{*/
let caller = "details_onload";
let log_this = DOM_DETAILS_LOG;

if(log_this) logBIG(caller, 8);
/*}}}*/
    /* ➔ RESTORE ONLOAD [open] STATE .. f(localStorage) {{{*/
    let        details_array = document.querySelectorAll("DETAILS");
    Array.from(details_array).forEach( (el) =&gt; {
        let open = el.id &amp;&amp; localStorage_getItem(el.id+"_open");
        if( open ) {
            el.open = true;
if(log_this) log("➔ "+el.id+(el.open ? " OPENED":" NOT OPENED"));
        }
    });

    /*}}}*/
    /* 1. LISTEN TO DETAILS EVENT {{{*/
    Array.from(details_array).forEach( (el) =&gt; {
        if(!el.id) return;
        el.addEventListener("mousedown", details_onmousedown);
        el.addEventListener("toggle"   , details_ontoggle   );
    });

    /*}}}*/
    /* 2. DETAILS RADIO-BEHAVIOR {{{*/
    details_radio_set_from_localStorage();

    /*}}}*/
    /* 3. OPEN LINKS HASH TARGETS DETAILS-CONTAINERS {{{*/
    details_add_hash_link_onclick_listener();

    /*}}}*/
};
/*}}}*/
 /*_ details_onmousedown {{{*/
/*{{{*/
 let details_onmousedown_shiftKey;
 let details_onmousedown_altKey;

/*}}}*/
 let details_onmousedown = function(e)
 {
     details_onmousedown_shiftKey  = e.shiftKey;
     details_onmousedown_altKey    = e.altKey;
//log("➔ details_onmousedown_shiftKey=["+ details_onmousedown_shiftKey +"]")
//log("➔ details_onmousedown_altKey..=["+ details_onmousedown_altKey   +"]")
 };
 /*}}}*/
/*_ details_ontoggle {{{*/
/*{{{*/
const DETAILS_ONTOGGLE_COOLDOWN = 500;

let   details_ontoggle_timeStamp;
/*}}}*/
let details_ontoggle = function(e)
{
if(details_ontoggle_listener_mutex) return;
/*{{{*/
let caller = "details_ontoggle";
let log_this= DOM_DETAILS_LOG;

    let details_el = e.target;
    if(!details_el ) return;

if( log_this) log(caller+"("+e.target.tagName+") .. open=["+e.target.open+"] ➔ details_el=["+(details_el.id || details_el.firstElementChild.textContent)+"] .. open=["+details_el.open+"]");
/*}}}*/
    /* STORAGE {{{*/
    if(details_el.id) {
        // [localStorage]
        if(details_el.open) localStorage_setItem(details_el.id+"_open", "true");
        else                localStorage_delItem(details_el.id+"_open"        );

        // [COOKIE]
//      if(details_el.open) set_cookie(details_el.id+"_open", "true");
//      else                del_cookie(details_el.id+"_open"        );
    }
    /*}}}*/
    /* IGNORE TOGGLE PROPAGATION CALLBACKS {{{*/
    //   let this_MS      = new Date().getTime();
    let elapsed      = (e.timeStamp - details_ontoggle_timeStamp).toFixed(0);
    if( elapsed      &lt; DETAILS_ONTOGGLE_COOLDOWN)
    {
if(log_this) log("%c...ON COOLDOWN: elapsed=["+elapsed+"ms]", "color:#888;");

        return;
    }
if(log_this) log("%c..."+details_el.tagName+" #"+details_el.id+" .. open "+details_el.open+" .. elapsed=["+elapsed+"]" , (details_el.open ? "color:lightgreen;":"color:red;"));

    details_ontoggle_timeStamp = e.timeStamp;
    /*}}}*/
    /* ONLOAD ➔ DO NOT CLOSE OTHERS .. return {{{*/
    if(details_onmousedown_shiftKey == undefined) return;

    /*}}}*/
    /* 1/2 - ALT ➔ PROPAGATE SAME OPEN STATE TO OTHERS {{{*/
    if( details_onmousedown_altKey )
    {
        let state = details_el.open ? "open" : "close";

        details_ontoggle_set_siblings_state(details_el, state);
    }
    /*}}}*/
    /* 2/2 - JUST CLOSED OR SHIFT-MODIFIER ➔ DO NOT CLOSE OTHERS {{{*/
    else {

        let close_others_behavior
            =  details_radio_el
            &amp;&amp; (    details_radio_el.checked
                 || details_radio_el              .classList.contains("checked")
                 || details_radio_el.parentElement.classList.contains("checked")
               );

        let reversed
            =   close_others_behavior &amp;&amp; details_onmousedown_shiftKey;

        let close_others
            =  (close_others_behavior &amp;&amp; ( details_el.open &amp;&amp; !reversed)) ? "OPENED ➔ [NO SHIFT] ➔ CLOSE OTHERS"
            :  (close_others_behavior &amp;&amp; (!details_el.open &amp;&amp;  reversed)) ? "CLOSED ➔ [++ SHIFT] ➔ CLOSE OTHERS"
            :  false;

/*{{{*/
if(log_this) {
    let style =           "border: "+(close_others_behavior ? "2px solid orange" : "1px solid gray")+";"
        +                  "color: "+(close_others          ?              "red" : "gray"          )+";"
        +       "background-color: "+(reversed              ?             "#808" : "black"         )+";"
    ;
    log(" ➔ %c["+ close_others +"]", style);
}
/*}}}*/

        if     (!details_el.open ) details_ontoggle_close_children    ( details_el         );
        else if( close_others    ) details_ontoggle_set_siblings_state( details_el, "close");
    }
    /*}}}*/
};
/*}}}*/
/*_ details_ontoggle_set_siblings_state {{{*/
let details_ontoggle_set_siblings_state = function(details_el,state)
{
/*{{{*/
let   caller = "details_ontoggle_set_siblings_state";
let log_this = DOM_DETAILS_LOG;

if(log_this || DOM_DETAILS_TAG) logBIG(caller+"("+get_id_or_tag_and_className(details_el)+", "+state+")");
/*}}}*/
    /* [details_parent] {{{*/
    let details_parent
        = (details_el.parentElement.tagName == "LI")
        ?  details_el.parentElement.parentElement // hop to OL or UL
        :  details_el.parentElement;

if(log_this) log("%c...details_parent: ["+(details_parent.id || details_parent.tagName)+"]", "background-color:#800;");
    /*}}}*/
    /* set siblings state {{{*/
    for(let i=0; i&lt;details_parent.children.length; ++i)
    {
        //  details_sibling {{{
        let details_sibling  = details_parent.children[i];
        if( details_sibling.tagName == "LI") details_sibling = details_sibling.children[0];
//log("...["+ details_sibling.tagName + (details_sibling.id ? (" "+details_sibling.id) : "")+"]")

        //}}}
        // skip just opened or closed details_el {{{
        if(details_sibling == details_el) continue;

        //}}}
        /* close other sibling {{{*/
        if(details_sibling.tagName == "DETAILS")
        {
            details_sibling.open = (state == "open");

            if(details_sibling.id)
            {
                if(details_sibling.open) localStorage_setItem(details_sibling.id+"_open", "true");
                else                     localStorage_delItem(details_sibling.id+"_open"        );
//              del_cookie(          details_sibling.id+"_open");
            }
        }
        /*}}}*/
    }
    /*}}}*/
};
/*}}}*/
/*_ details_ontoggle_close_children {{{*/
let details_ontoggle_close_children = function(parent_details)
{
/*{{{*/
let   caller = "details_ontoggle_close_children";
let log_this = DOM_DETAILS_LOG;

if( log_this) logBIG(caller+"("+get_id_or_tag_and_className(parent_details)+") .. open=["+parent_details.open+"]", 2);
/*}}}*/

    let el_array
        = Array.from( parent_details.querySelectorAll("DETAILS[open]") );

    el_array.forEach( (child_details) =&gt; {

        child_details.open = false;

        if(child_details.id)
        {
            let key = child_details.id+"_open";
            localStorage_delItem( key );
        }
    });
};
/*}}}*/
return { details_onload };
})();

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ 2. DETAILS RADIO-BEHAVIOR                   [localStorage details_radio] │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*➔ details_radio_toggle {{{*/
let details_radio_toggle = function(e)
{
/*{{{*/
//log("details_radio_toggle")
//log("DOM_DETAILS_LOG=["+DOM_DETAILS_LOG+"]")

if(DOM_DETAILS_LOG) log("details_radio_toggle("+e.target.tagName+")");
/*}}}*/
    /* INPUT {{{*/
    let { input , details_radio_el } = get_details_radio_checkbox(e);

    /*}}}*/
    /* GET CURRENT STATE {{{*/
    let state
        = input
        ? ((e.target != input) ? input.checked : !input.checked)
        : details_radio_el.classList.includes("checked");

    /*}}}*/
    /* NEW TOGGLE STATE {{{*/
    state = !state;

    if( input &amp;&amp; (!e || (input != e.target))) /* update if not the event initiator */
        input.checked = state;

    /*}}}*/
    /* ➔ [TOGGLE details_radio_el.checked] {{{*/
    if( details_radio_el )
    {
        if(state) add_el_class(details_radio_el, "checked"); /* state [false ➔  true] */
        else      del_el_class(details_radio_el, "checked"); /* state [ true ➔ false] */
    }

    /*}}}*/
    /* STORE NEW STATE {{{*/
    if(state) localStorage_setItem(DETAILS_RADIO_ID, "true");
    else      localStorage_delItem(DETAILS_RADIO_ID        );

    /*}}}*/
/*{{{*/
if(DOM_DETAILS_LOG || DOM_DETAILS_TAG)
    log_key_val_group("details_radio_toggle: ...state=["+state+"]"
        , { state
          , input
          , details_radio_el
          , e
          , e_target : (e ? e.target : "")
        }
        , (state ? 4:8)
        , false);
/*}}}*/
};
/*}}}*/
/*_ details_radio_set_from_localStorage {{{*/
let details_radio_set_from_localStorage = function()
{
/*{{{*/
if(DOM_DETAILS_LOG) log("details_radio_set_from_localStorage");

/*}}}*/
    /* UI [input] [details_radio_el] {{{*/
    let { input , details_radio_el } = get_details_radio_checkbox();

    if(!input) return;
    /*}}}*/
    /* GET STORED STATE {{{*/
    let state = localStorage_getItem( DETAILS_RADIO_ID );

    /*}}}*/
    /* SHOW STATE {{{*/
    if( input )
        input.checked = state;

    if(state) add_el_class(input.parentElement, "checked");
    else      del_el_class(input.parentElement, "checked");
    /*}}}*/
/*{{{*/
if(DOM_DETAILS_LOG)
    log_key_val_group("details_radio_set_from_localStorage: ...state=["+state+"]"
        , { state
          , input
          , details_radio_el
        }
        , (state ? 4:8)
        , false);
/*}}}*/
};
/*}}}*/
/*_ get_details_radio_checkbox {{{*/
/*{{{*/
let details_radio_el;

/*}}}*/
let get_details_radio_checkbox = function(e)
{
/*{{{*/
let caller = "get_details_radio_checkbox";

/*}}}*/
    /* Clicked target or DETAILS_RADIO_ID {{{*/
    if(!details_radio_el)
        details_radio_el = get_tool( DETAILS_RADIO_ID );

    let el
        = (e)
        ?  e.target
        :  details_radio_el;

if(DOM_DETAILS_LOG) log(caller+": ["+DETAILS_RADIO_ID+"] ➔ el=["+get_id_or_tag(el)+"]");
    if(!el) return {};

    /*}}}*/
    /* [input] {{{*/
    let input
        =                         ((el.tagName == "INPUT") &amp;&amp; el)
        || get_el_child_with_tag  ( el          , "INPUT")
        || get_el_sibling_with_tag( el          , "INPUT");


    /*}}}*/
/*{{{*/
if(DOM_DETAILS_LOG)
    log_key_val_group(caller+": ...return ["+(input ? input.tagName : "")+"]"
        , { e
          , e_target         : (e ? e.target : "")
          , el
          , details_radio_el : get_nodeXPath( details_radio_el )+" ["+get_id_or_tag( details_radio_el )+"]"
          , input            : get_nodeXPath( input            )+" ["+get_id_or_tag( input            )+"]"
        }
        , 4
        , true);
/*}}}*/
    return { input , details_radio_el };
};
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ 3. OPEN LINKS HASH TARGETS DETAILS-CONTAINERS     ➔ [put target in view] │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*➔ details_has_closed_el_parent {{{*/
let details_has_closed_el_parent = function(el)
{
    let   details_el = el.parentElement;
    while(details_el)
    {
        /* OPENED PARENT DETAILS {{{*/
        if(details_el.nodeName == "DETAILS")
        {
/*{{{
            let el_in_a_visible_summary
                =    ( el.nodeName        == "SUMMARY")
                ||   ( el.parentElement   == details_el);
}}}*/
            /* a details summary is still visible when closed */
            let details_el_summary
                = details_el.firstElementChild;

            let el_in_a_visible_summary
                = is_el_or_child_of_parent_el(el, details_el_summary);

            if(   !details_el.open
               &amp;&amp; !el_in_a_visible_summary)
                return true;
        }
        /*}}}*/
        details_el = details_el.parentElement;
    }
    return false;
};
/*}}}*/
/*➔ details_open_closed_el_parent {{{*/
let details_open_closed_el_parent = function(el)
{

    let   details_el = el.parentElement;
    while(details_el)
    {
        if(details_el.nodeName == "DETAILS")
        {
            if(!details_el.open)
            {
if(DOM_DETAILS_LOG) logBIG("details_open_closed_el_parent("+get_id_or_tag_and_className(el)+") ➔ open details_el "+get_nodeXPath(details_el));

                details_el.open = true;
            }
        }
        details_el = details_el.parentElement;
    }
    el.open = true;
};
/*}}}*/
/*_ details_add_hash_link_onclick_listener {{{*/
let details_add_hash_link_onclick_listener = function(el=document)
{
/*{{{*/
let caller = "details_add_hash_link_onclick_listener";

if(DOM_DETAILS_LOG) log(caller+"(el "+get_id_or_tag_and_className(el)+")");
/*}}}*/
    /* [details_hash_link_onclick] {{{*/
    let           details_hash_links = document.querySelectorAll("A[href^='#']");
    Array.from(   details_hash_links)
        .forEach((details_hash_link ) =&gt; {
            /**/  details_hash_link.addEventListener("click", details_hash_link_onclick);
        });
    /*}}}*/
if(DOM_DETAILS_LOG || DOM_DETAILS_TAG) logBIG(caller+": "+details_hash_links.length+" details_hash_links", 7);
};
/*}}}*/
/*_ details_hash_link_onclick {{{*/
let details_hash_link_onclick = function(e)
{
let caller = "details_hash_link_onclick";

    let        link = e.target;
    if(              !link.hash) return;

    let  name_or_id = link.hash.substr(1);
    let   id_target = document.getElementById(          name_or_id     );
    let name_target = document.querySelector ( "[name="+name_or_id+"]" );
    let link_target = id_target || name_target;

if(DOM_DETAILS_LOG)
    log_key_val(caller
                , {  name_or_id
                   , id_target
                   , name_target
                   , link_target
                });
if(DOM_DETAILS_LOG) log("%c"+caller+" %c"+name_or_id+"%c➔%c"+get_nodeXPath(link_target), lbH+lf3, lbH, lbL+lf4, lbR+lf5);


    if( link_target )
        details_open_closed_el_parent( link_target );

};
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ ➔ OPEN-CLOSE ALL DETAILS CONTAINERS                                      │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*➔ details_close_opened {{{*/
let details_close_opened = function()
{
    prevent_details_ontoggle_listener();
    let       el_array = Array.from( document.querySelectorAll("DETAILS[open]") );
    if(       !el_array.length) {
if(DOM_DETAILS_LOG) log("FOUND NO OPENED DETAILS TO CLOSE");
        return;
    }
if(DOM_DETAILS_LOG) log("CLOSING "+el_array.length+" OPENED DETAILS");

    el_array.forEach( (el) =&gt; { el.open = false; });

    setTimeout(restore_details_ontoggle_listener, 0);
};
/*}}}*/
/*➔ details_open_closed {{{*/
let details_open_closed = function()
{
    prevent_details_ontoggle_listener();
    let       el_array = Array.from( document.querySelectorAll("DETAILS:not([open])") );
    if(       !el_array.length) {
if(DOM_DETAILS_LOG) log("FOUND NO OPENED DETAILS TO OPEN");
        return;
    }
if(DOM_DETAILS_LOG) log("OPENING "+el_array.length+" CLOSED DETAILS");

    el_array.forEach( (el) =&gt; { el.open =  true; });

    setTimeout(restore_details_ontoggle_listener, 0);
};
/*}}}*/
/*_ prevent_details_ontoggle_listener {{{*/
/*{{{*/
const DETAILS_ONTOGGLE_LISTENER_DELAY = 500;
let   details_ontoggle_listener_mutex;

/*}}}*/
let prevent_details_ontoggle_listener = function()
{
    /* sync .. (effective on call) */
if(DOM_DETAILS_LOG) logBIG("prevent_details_ontoggle_listener",7);
    details_ontoggle_listener_mutex   =  true;
};
/*}}}*/
/*_ restore_details_ontoggle_listener {{{*/
let restore_details_ontoggle_listener = function()
{
    /* async .. (effective on calling thread termination) */
    setTimeout(function() {
if(DOM_DETAILS_LOG) logBIG("restore_details_ontoggle_listener",6);
            details_ontoggle_listener_mutex = false;
        }
        , DETAILS_ONTOGGLE_LISTENER_DELAY);
};
/*}}}*/


/* EXPORT */
/*{{{*/
/*➔ t_details_set_state {{{*/
let t_details_set_state = function(label,state)
{
    if(    state != undefined)
    {
        if(state) localStorage.setItem   (label, "true");
        else      localStorage.removeItem(label        );
        return !!state;
    }
    else {
        return    localStorage.getItem   (label        );
    }
};
/*}}}*/
return { name    : "dom_details"
    ,    logging : (state) =&gt; { DOM_DETAILS_LOG = dom_details.t_details_set_state("DOM_DETAILS_LOG", state); return DOM_DETAILS_LOG; }
    ,    tagging : (state) =&gt; { DOM_DETAILS_TAG = dom_details.t_details_set_state("DOM_DETAILS_TAG", state); return DOM_DETAILS_TAG; }
    ,    t_details_IMPORT
    ,    t_details_set_state
    /*   --------------------------------- CALLERS:       */
    ,    details_onload                 : details_handler.details_onload
    ,    details_radio_toggle           /* RADIO-BEHAVIOR */
    ,    details_has_closed_el_parent   /* dom_seek       */
    ,    details_open_closed_el_parent  /* dom_seek       */
    ,    details_close_opened           /* HTML TOOL      */
    ,    details_open_closed            /* HTML TOOL      */
};
/*}}}*/
}());

/*
:e  $APROJECTS/XPH/lib/t_details.js
:cd %:h/..|pwd
*/

</pre> <!--}}}-->
</details>
<!--}}}-->
<!-- dom_details_log_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_details_log.js   | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_details_log_html" open class="folded_code"><summary> <B>dom_details_log</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_details_log                                                          │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* globals console */

/* exported dom_details_log, DOM_DETAILS_LOG_JS_TAG */

/* eslint-disable no-warning-comments */
/* eslint-disable dot-notation        */

const DOM_DETAILS_LOG_JS_ID     = "dom_details_log_js";
const DOM_DETAILS_LOG_JS_TAG    = DOM_DETAILS_LOG_JS_ID  +" (210928:14h:50)";
/*}}}*/
let dom_details_log      = (function() {
"use strict";

let   log                = console.log;
let   logBIG             = (msg)    =&gt; log("%c"+msg, "font-size:150%; font-weight:100;");



let   log_key_val        = (name,o) =&gt; { console.log(name+":"); console.dir(o); };
let   log_key_val_group  = log_key_val;


return { name : "dom_details_log"
    ,    log
    ,    logBIG




    ,    log_key_val
    ,    log_key_val_group
};

}());

</pre> <!--}}}-->
</details>
<!--}}}-->
<!-- dom_details_util_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_details_util.js  | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_details_util_html" open class="folded_code"><summary> <B>dom_details_util</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_details_util                                                         │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* globals window, document, Document, Node, console */

/* exported dom_details_util, DOM_DETAILS_UTIL_JS_TAG */

/* eslint-disable no-warning-comments */
/* eslint-disable dot-notation        */

const DOM_DETAILS_UTIL_JS_ID    = "dom_details_util_js";
const DOM_DETAILS_UTIL_JS_TAG   = DOM_DETAILS_UTIL_JS_ID  +" (211029:22h:47)";
/*}}}*/
let dom_details_util    = (function() {
"use strict";

let add_el_class        = function(el, className) { if(!el || !el.classList) return      ; if(   !el.classList.contains( className )) el.classList.add   ( className ); };
let del_el_class        = function(el, className) { if(!el || !el.classList) return      ; if(    el.classList.contains( className )) el.classList.remove( className ); };
let has_el_class        = function(el, className) { if(!el || !el.classList) return false; return el.classList.contains( className );                                   };
/*_ get_el_child_with_tag {{{*/
let get_el_child_with_tag = function(parent,tag)
{
    for(let     c  = 0; c &lt; parent.children.length; ++c) {
        let child  = parent.children[c];
        if((child != null) &amp;&amp; (child.tagName == tag))
            return child;
    }
    return null;
};
/*}}}*/
/*_ get_el_sibling_with_tag {{{*/
let get_el_sibling_with_tag = function(el,tag)
{
    for(let     c  = 0; c &lt; el.parentElement.children.length; ++c) {
        let child  =        el.parentElement.children[c];
        if((child != null) &amp;&amp; (child.tagName == tag) &amp;&amp; (child != el))
            return child;
    }
    return null;
};
/*}}}*/
/*_ get_id_or_tag {{{ */
let get_id_or_tag = function(node)
{
    return !node           ? ("null_node"                        )
        :   node.id        ? ("#"+ node.id                       )
        :   node.className ? (node.tagName+"."+ node.classList[0])
        :                    (node.tagName                       )
    ;
};
/*}}}*/
/*_ get_id_or_tag_and_className {{{ */
let get_id_or_tag_and_className = function(node)
{
    let result
        = !node           ? ("null_node"                        )
        :  node.id        ? ("#"+ node.id                       )
        :  node.className ? (node.tagName+"."+ node.classList[0])
        :                   (node.tagName                       )
    ;
    return result+((node &amp;&amp; node.className) ? (" "+node.className) : "");

};
/*}}}*/
/*➔ get_nodeXPath {{{*/
let get_nodeXPath = function(node)
{
    if(node instanceof Document) return "/";

    let  node_type_pos_array;
    for( node_type_pos_array = []
    ;    node &amp;&amp; !(node instanceof Document)
    ;    node =   (node.nodeType == Node.ATTRIBUTE_NODE)
              ?    node.ownerElement
              :    node.parentNode
    ) {
        let node_type_pos = {};

        /* TYPE */
        switch( node.nodeType ) {
            case Node.TEXT_NODE                   : node_type_pos.name =                   "text()" ; break;
            case Node.ATTRIBUTE_NODE              : node_type_pos.name =       "@" + node.nodeName  ; break;
            case Node.PROCESSING_INSTRUCTION_NODE : node_type_pos.name = "processing-instruction()" ; break;
            case Node.COMMENT_NODE                : node_type_pos.name =                "comment()" ; break;
            case Node.ELEMENT_NODE                : node_type_pos.name =             node.nodeName  ; break;
        }

        /* POS */
        node_type_pos.position = get_nodeName_rank( node );

        node_type_pos_array.push( node_type_pos );
    }

    let nodeXPath = "";
    for(let i=node_type_pos_array.length-1; i &gt;= 0; i -= 1)
    {
        let node_type_pos   = node_type_pos_array[i];
        nodeXPath += node_type_pos.name ? ("/"+node_type_pos.name) : ".";
        if((node_type_pos.position != null) &amp;&amp; (node_type_pos.position != "1"))
            nodeXPath += "["+ node_type_pos.position+"]";
    }

    return nodeXPath.toLowerCase();
};
/*}}}*/
/*_ get_nodeName_rank {{{*/
let get_nodeName_rank = function(node)
{
    if(node.nodeType == Node.ATTRIBUTE_NODE) return null;

    let rank = 1;
    for(let prev_node =      node.previousElementSibling
    ;       prev_node
    ;       prev_node = prev_node.previousElementSibling
    ) {
        if(prev_node.nodeName == node.nodeName)
            rank += 1;
    }
    return rank;
 };
/*}}}*/
/*_ is_el_or_child_of_parent_el {{{*/
let is_el_or_child_of_parent_el = function(el, parent_el)
{
    if(!parent_el) return false;

    while(el &amp;&amp; (el != parent_el))
        el     = el.parentElement;

    return (el == parent_el);
};
/*}}}*/
/*_ get_el_parent_clipped {{{*/
let get_el_parent_clipped = function(el)
{
    while(  el ) {
        let cs = window.getComputedStyle(el);
        if( cs.clip
        &amp;&amp; (cs.clip     != "auto")
        &amp;&amp; (cs.clip     != "none")) return el;

        if( cs.clipPath
        &amp;&amp; (cs.clip     != "auto")
        &amp;&amp; (cs.clipPath != "none")) return el;

        el = el.parentElement;
    }
    return null;
};
/*}}}*/
/*_ get_shadow_root {{{*/
let get_shadow_root = function()
{
    let    shadow_host = document.getElementById("shadow_host");
    let    shadow_root = shadow_host ? shadow_host.shadowRoot : null;

    return shadow_root;
};
/*}}}*/
/*_ get_tool {{{*/
let get_tool = function(id)
{
    if( id.includes(" ") ) return null;
    let selector
        = (id.charAt(0) != ".") &amp;&amp; (id.charAt(0) != "#")
        ?  "#"+id
        :      id;

    let el;
    try {
        let shadow_root      = get_shadow_root();
        if( shadow_root ) el = shadow_root.querySelector( selector );
        if(!el          ) el = document   .querySelector( selector );
    }
    catch(ex) { console.log("selector=["+selector+"]"); console.warn(ex); }

/*{{{
console.log("t_get_tool("+id+"): ...return ["+(el ? (el.id || el.tagName) : null)+"]");
}}}*/
    return el;
};
/*}}}*/

return { name : "dom_details_util"
    ,    add_el_class
    ,    del_el_class
    ,    get_el_child_with_tag
    ,    get_el_sibling_with_tag
    ,    get_id_or_tag
    ,    get_id_or_tag_and_className
    ,    get_nodeXPath
    ,    get_el_parent_clipped
    ,    get_tool
    ,    has_el_class
    ,    is_el_or_child_of_parent_el
};

}());

</pre> <!--}}}-->
</details>
<!--}}}-->
<hr>
<!-- dom_wot_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_wot.js           | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_wot_html" open class="folded_code"><summary> <B>dom_wot</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_wot                                                   (WALL OF TEXT) │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* eslint-disable no-warning-comments   */

/* globals console                      */
/* globals document, Node, NodeFilter   */
/* globals localStorage                 */

/* globals dom_log                      */
/* globals dom_util                     */
/* globals dom_store                    */
/* globals dom_tools                    */

/* exported dom_wot, DOM_WOT_JS_TAG */

const DOM_WOT_JS_ID      = "dom_wot_js";
const DOM_WOT_JS_TAG     = DOM_WOT_JS_ID  +" (211119:18h:11)";
/*}}}*/
let dom_wot             = (function() {
"use strict";
let   DOM_WOT_LOG       = false;
let   DOM_WOT_TAG       = false;

/*➔ t_wot_IMPORT {{{*/
/* eslint-disable no-unused-vars */
let t_wot_IMPORT        = function(log_this)
{
    wot_INTERN();

    DOM_WOT_LOG         = DOM_WOT_LOG       || localStorage_getItem("DOM_WOT_LOG");
    DOM_WOT_TAG         = DOM_WOT_TAG       || localStorage_getItem("DOM_WOT_TAG");
};
/*}}}*/
/*_   wot_INTERN {{{*/
/*{{{*/
/* dom_data {{{*/
const CSS_LINE_NUM = "line_num";
const LF           = String.fromCharCode(10);
const LINES_WOT    = "lines_wot"    ;

/*}}}*/
/* dom_log {{{*/
let lb0="", lb1="", lb2="", lb3="", lb4="", lb5="", lb6="", lb7="", lb8="", lb9="", lbX="";
let lbA="", lbB="", lbC="", lbF="", lbH="", lbL="", lbR="", lbS="", lbb=""                ;
let lf0="", lf1="", lf2="", lf3="", lf4="", lf5="", lf6="", lf7="", lf8="", lf9="", lfX="";

let log=console.log, logBIG=log, logXXX, log_caller, log_json_one_liner, log_key_val, log_key_val_group;

let console_dir=console.dir;
/*}}}*/
/* dom_util {{{*/

/* DOM */
let add_el_class;
let has_el_class;
let get_el_title;
let get_id_or_tag;

/* REGEX */
let escapeHTML;
let strip_CR_LF;
let get_first_word;

/* STRING */
let ellipsis;
let mPadStart;

/* RTabs */
let is_marked_to_hide;

/*}}}*/
/* dom_store {{{*/

let localStorage_delItem = (key    ) =&gt;           localStorage.removeItem(key    );                                       /* eslint-disable-line no-unused-vars */
let localStorage_getItem = (key    ) =&gt;           localStorage.getItem   (key    );                                       /* eslint-disable-line no-unused-vars */
let localStorage_setItem = (key,val) =&gt; { if(val) localStorage.setItem   (key,val); else localStorage.removeItem(key); }; /* eslint-disable-line no-unused-vars */

/*}}}*/
/* dom_tools {{{*/
let t_get_tool = (id) =&gt; document.getElementById(id);

/*}}}*/
/*}}}*/
let   wot_INTERN        = function()
{
/*{{{*/
let caller = "wot_INTERN";

/*}}}*/
    /* dom_log {{{*/
    let dom_log_js
        = (typeof dom_log != "undefined")
        ?         dom_log
        :         dom_wot_log;      /* script/dom_wot_log.js */ /* eslint-disable-line no-undef */

    if( dom_log_js )
    {
        if(dom_log_js.LOG_BG_CSS) {
            ({ lb0, lb1, lb2, lb3, lb4, lb5, lb6, lb7, lb8, lb9, lbX } = dom_log.LOG_BG_CSS);
            ({ lf0, lf1, lf2, lf3, lf4, lf5, lf6, lf7, lf8, lf9, lfX } = dom_log.LOG_FG_CSS);
            ({ lbA, lbB, lbC, lbF, lbH, lbL, lbR, lbS, lbb           } = dom_log.LOG_XX_CSS);
        }

        ({  log
         ,  logBIG
         ,  logXXX
         ,  log_caller
         ,  log_json_one_liner
         ,  log_key_val
         ,  log_key_val_group
         ,  console_dir
        } = dom_log_js);

if(DOM_WOT_LOG || DOM_WOT_TAG) logBIG(caller+": ["+dom_log_js.name+"]" , 4);
    }
    else {

logBIG(caller+": [dom_log UNDEFINED]"   , 2);
    }
    /*}}}*/
    /* dom_util {{{*/
    let dom_util_js
        = (typeof dom_util != "undefined")
        ?         dom_util
        :         dom_wot_util;     /* script/dom_wot_util.js */ /* eslint-disable-line no-undef */

    if( dom_util_js )
    {
        ({  add_el_class        /* DOM */
         ,  get_el_title
         ,  get_id_or_tag
         ,  has_el_class
         ,  strip_CR_LF         /* REGEX */
         ,  escapeHTML
         ,  get_first_word
         ,  ellipsis            /* STRING */
         ,  mPadStart
         ,  is_marked_to_hide   /* RTabs */
        } = dom_util_js);

if(DOM_WOT_LOG || DOM_WOT_TAG) logBIG(caller+": ["+dom_util_js.name+"]"    , 4);
    }
    else {

logBIG(caller+": [dom_util UNDEFINED]"      , 2);
    }
    /*}}}*/
    /* dom_store {{{*/
    if(typeof dom_store != "undefined")
    {
        localStorage_getItem =          dom_store.t_store_getItem;
        localStorage_setItem =          dom_store.t_store_set_value;
        localStorage_delItem = (key) =&gt; dom_store.t_store_set_value(key,null);

if(DOM_WOT_LOG || DOM_WOT_TAG) logBIG(caller+": ["+dom_store.name+"]"      , 4);
    }
    /*}}}*/
    /* dom_tools {{{*/
    if(typeof dom_tools != "undefined")
    {
        t_get_tool       = dom_tools.t_get_tool;

if(DOM_WOT_LOG || DOM_WOT_TAG) logBIG(caller+": ["+dom_tools.name+"]"      , 4);
    }
    /*}}}*/
};
/* eslint-enable no-unused-vars */
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ ➔ FOLD                                                                   │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*{{{*/
const FOLD_OPEN   = "{{{";
const BRACE_OPEN  =   "{";
const BRACE_CLOSE =   "}";
const FOLD_CLOSE  = "}}}";
/*_ is_line_fold_open {{{*/
/*{{{
let logged_count = 0; const LOGGED_COUNT_MAX = 100;
}}}*/
let is_line_fold_open = function(line)
{
    let result = line.includes( FOLD_OPEN ) ;
/*{{{
if(logged_count++ &lt; LOGGED_COUNT_MAX) log("is_line_fold_open("+line+") ...return "+result+"");
}}}*/
    return result;
};
/*}}}*/
/*_ is_line_fold_close {{{*/
/*{{{*/
const LEVELS = "123456789";

/*}}}*/
let is_line_fold_close = function(line)
{
    let result = line.includes( FOLD_CLOSE ) ;

    /* look for implicit-closing marker level */
    if(!result)
    {
        let idx    = line.indexOf(     FOLD_OPEN       );
        if( idx ) {
            let s  = line.charAt(idx + FOLD_OPEN.length);
            if((s != "") &amp;&amp; (LEVELS.indexOf(s) &gt;= 0)) /* (level number match not handled yet) */
                result = true;
        }
    }
/*{{{
if(logged_count++ &lt; LOGGED_COUNT_MAX) log("is_line_fold_close("+line+") ...return "+result+"");
}}}*/
    return result;
};
/*}}}*/
/*_ is_line_brace_open {{{*/
let is_line_brace_open = function(line)
{
    let result =  !line.startsWith(" ") &amp;&amp; line.endsWith( BRACE_OPEN );
/*{{{
if(logged_count++ &lt; LOGGED_COUNT_MAX) log("is_line_brace_open("+line+") ...return "+result+"");
}}}*/
    return result;
};
/*}}}*/
/*_ is_line_brace_close {{{*/
let is_line_brace_close = function(line)
{
    let result = line.startsWith( BRACE_CLOSE );
/*{{{
if(logged_count++ &lt; LOGGED_COUNT_MAX) log("is_line_brace_close("+line+") ...return "+result+"");
}}}*/
    return result;
};
/*}}}*/
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ ➔ SPLIT WOT                                                              │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*➔ t_WOT_SPLIT {{{*/
/*{{{*/
const WALL_OF_TEXT_PARENT   = "wall_of_text_parent";
const WALL_OF_TEXT_SPLIT    = "wall_of_text_split";
const WALL_OF_TEXT_BLOCK    = "wall_of_text_block";
const WALL_OF_TEXT_FOLD     = "wall_of_text_fold";
const WOT_P_LINES_MIN       =    1;
const WOT_LENGTH            =  256;
const PAR_LENGTH_MAX        = 2048;
const REPORTED_COUNT_MAX    =    8;

const regexp_REGIONFOLD     = new RegExp("#region (\\S+).*");
const regexp_FUNCTION_JS    = new RegExp("\\/\\*[_ ]*(\\S+).*\\{\\{\\{\\*\\/");
/*........................................../  * _   (FFFF)    ^  ^  ^       */
const regexp_FUNCTION_LUA   = new RegExp(    "--[_ ]*(\\S+).*\\{\\{\\{");
/*............................................-- _   (FFFF)    ^  ^  ^ */

let   wot_split_done = false;
/*}}}*/
let t_WOT_SPLIT = function() /* eslint-disable-line complexity */
{
    /* [wot_split_done] {{{*/
    if( wot_split_done ) return;

    wot_split_done = true;
    /*}}}*/
/*{{{*/
let   caller = "t_WOT_SPLIT";
let log_this = DOM_WOT_LOG;

if( log_this) console.time(caller);
/*}}}*/
    /* SPLIT UP WALL OF TEXT NODES {{{*/
    pre_innerHTML_to_innerText();

    reported_count      = 0;
    reported_filters    = [];

    let            root = document.body;
    let   mDomTraversal = document.createNodeIterator(root, NodeFilter.SHOW_TEXT, mNodeFilter_wall_of_text_block);
    let text_node_array = get_wall_of_text_node_array( mDomTraversal );

if( log_this) log("%c"+caller+" %c "+text_node_array.length+" TEXT NODES FILTER_ACCEPT'ed", lbH, lbH+lf3);
/*{{{
}}}*/
    /*}}}*/
    /* REPLACE BIG CHUNCKS OF TEXT WITH A BUNCH OF SMALLER PARAGRAPHS {{{*/
    let node_count = 0;
    let char_count = 0;
    let LF_count   = 0;

    let line_num   = 1;
    let trailNoEOL = "";
    let innerHTML;
    for(let i = 0; i &lt; text_node_array.length; ++i)
    {
        /* SPLIT INTO LINES {{{*/

        /* prepend previous truncated-trailer */
        let text_node   = text_node_array[i];

        let textContent = trailNoEOL + text_node.textContent;
        char_count     += textContent.length;

        /* next truncated-trailer -- FIXME drops last line from MISSING-EOL-DOS-FILES */
        trailNoEOL
            = textContent.endsWith(LF)
            ? ""
            : textContent.substring( textContent.lastIndexOf(LF)+1 );

        let lines      = textContent.split(LF);
        LF_count      += lines.length;

        let last_line  = lines[lines.length-1];

        if( last_line == trailNoEOL) lines.pop(); /* drop truncated line .. (missing EOL) */

/*{{{*/
if(log_this &amp;&amp; (i &lt; 2))
    log_key_val_group("line_num %c"+ line_num
                      , {         textContent_length : textContent.length
                          ,               trailNoEOL : "["+trailNoEOL+"] .. length=["+ trailNoEOL.length+"]"
                          ,               last_line  : "["+last_line +"] .. length=["+ last_line .length+"]"
                          ,  last_line_eq_missingEOL : (last_line == trailNoEOL)
                          ,                STARTWITH : textContent.substring(0                  ,80)
                          ,                ENDS_WITH : textContent.substring(textContent.length -80)
                      }
                      , false);
/*}}}*/
        /*}}}*/
        /* EMPTY PARENT .. (on first node) {{{*/
        let               parent = text_node.parentNode;
        if(              !parent ) continue; /* already removed .. already handled */
        if( !has_el_class(parent, WALL_OF_TEXT_PARENT) )
        {
            parent.innerHTML = "";
            add_el_class(parent, WALL_OF_TEXT_PARENT);
        }
        /*}}}*/
/*{{{*/
if( log_this) {
    log("%c"+i, lbb+lbH+lf3);
    console_dir("parent has "+ parent.children.length+" children", parent   );
    console_dir("text_node", text_node);
    log("%c "+get_id_or_tag(parent) +" "+ parent.textContent.length+" characters", lbH);
}
/*}}}*/
        /* REFILL PARENT {{{*/
        let fold_open  = is_line_fold_open (text_node.textContent);
        let fold_close = is_line_fold_close(text_node.textContent);
        if( fold_open &amp;&amp; fold_close)  [line_num , innerHTML] = get_FOLD_EL_innerHTML(lines, line_num);
        else                          [line_num , innerHTML] = get_lines_innerHTML  (lines, line_num);

        parent.innerHTML += innerHTML;
        node_count += 1;
        /*}}}*/
/*{{{*/
if( log_this) console_dir("...parent has "+parent.children.length+" children", parent);
if( log_this) log(caller+": %c node_count=["+node_count+"] %c LF_count=["+LF_count+"] %c char_count=["+char_count+"]"
                  ,        lbL                            ,lbC                       ,lbR                            );
/*}}}*/
    }
    /*}}}*/
    /* Show results in [split_wot] button tooltip {{{*/
    let split_wot = t_get_tool("split_wot");
    if( split_wot )
        split_wot.title
            = get_el_title( split_wot )
                +LF +(LF_count ? (LF_count+" lines have been parsed") : "Found no WOT to parse"); /* TODO i18N */
    /*}}}*/
/*{{{*/
if( log_this &amp;&amp; node_count) console.timeEnd(caller);

if( log_this)
    if(node_count) log("%c"+caller+"%c"+node_count+" WALLS OF TEXT %c "+char_count+" characters %c "+LF_count+" LF"
                       ,lbH+lf7    ,lbb+lbH+lf7                   ,lbH+lf7                     ,lbH+lf9            );
/*}}}*/
};
/*}}}*/
/*➔ t_WOT_FOLD_EL {{{*/
let t_WOT_FOLD_EL = function(el)
{
    el.textContent = ""+ el.textContent; /* replace children */ /* eslint-disable-line no-self-assign */
    let lines      = el.textContent.split(LF);
    let line_num   = 1;
    let innerHTML;
    [line_num , innerHTML] = get_FOLD_EL_innerHTML(lines, line_num);

    el.innerHTML   = innerHTML;
};
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ ➔ SPLIT HTML                                                             │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*_ get_lines_innerHTML {{{*/
let get_lines_innerHTML = function(lines, line_num) /* eslint-disable-line complexity */
{
    let with_line_num = localStorage_getItem( LINES_WOT ); /* prop may not be ready yet */

    let innerHTML = "";
    let    l = 0;
    while((l &lt; lines.length))
    {
        /* new paragraph {{{*/

        let paragraph = "";
        let par_lines = 0;

        let this_line = lines[l  ];

        let fold_open  = is_line_fold_open (this_line); let fold_close  ;
        let brace_open = is_line_brace_open(this_line); let brace_close ;

        let may_add_next_line;
        /*}}}*/
        do {
            /* this_line next_line {{{*/
            this_line = lines[l  ];
            let next_line = lines[l+1] || "";

            /*}}}*/
            /* stop before a new fold {{{*/
            if(par_lines &gt; WOT_P_LINES_MIN) {
                if( is_line_fold_open  (this_line)) break;
                if( is_line_brace_open (this_line)) break;
            }

            /*}}}*/
            /* pick line {{{*/
            let h_line = escapeHTML(this_line);
            /*{{{
if(h_line.includes("#region")) log(h_line);
}}}*/
            h_line     = h_line.replace(regexp_REGIONFOLD   , "&lt;span class='"+WALL_OF_TEXT_BLOCK+"'&gt;$1&lt;/span&gt; "+h_line);
            h_line     = h_line.replace(regexp_FUNCTION_JS  , "&lt;span class='"+WALL_OF_TEXT_BLOCK+"'&gt;$1&lt;/span&gt; "+h_line);
            h_line     = h_line.replace(regexp_FUNCTION_LUA , "&lt;span class='"+WALL_OF_TEXT_BLOCK+"'&gt;$1&lt;/span&gt; "+h_line);

            /*}}}*/
            /* region {{{*/
            if( h_line.includes(  "#region" ) ) /* C# */
            {
                h_line = h_line.replace("'&gt;", " region'&gt;#region ");

            }
            /*}}}*/
            /* function {{{*/
            else if( next_line )
            {
                if(      next_line.includes  (  " function(" ) /* javascript */
                      || next_line.includes  (  "function "  ) /* LUA */
                      || next_line.includes  (  "private "   ) /* C# */
                      || next_line.includes  (  "protected " )
                      || next_line.includes  (  "public "    )
                      || next_line.includes  (  "static "    )
                      || next_line.includes  (  "void "      )
                  )
                    h_line = h_line.replace("'&gt;", " function'&gt;");

            }
            else {
                h_line = "&lt;span class='text_line'&gt;"+h_line+"&lt;/span&gt;";
            }
            /*}}}*/
            /* details..summary {{{*/
            if(      h_line.includes(FOLD_OPEN) &amp;&amp; !h_line.includes(FOLD_CLOSE)) h_line =        "&lt;details&gt;&lt;summary&gt;"+h_line+"&lt;/summary&gt;";
            else if(!h_line.includes(FOLD_OPEN) &amp;&amp;  h_line.includes(FOLD_CLOSE)) h_line = h_line+"&lt;/details&gt;";
            /*}}}*/
            /* p_line .. paragraph {{{*/
            if(with_line_num) {
                let p_line = "&lt;span class='"+CSS_LINE_NUM+"'&gt;"+mPadStart(line_num, 6)+" &lt;/span&gt;"+(h_line || "")+LF;
                paragraph += p_line;
            }
            else {
                paragraph += (h_line || "")+LF;
            }

            par_lines += 1;
            line_num  += 1;
            /*}}}*/
            /* stop after close fold {{{*/
            if(par_lines &gt; WOT_P_LINES_MIN) {
                fold_close  = is_line_fold_close ( this_line );
                brace_close = is_line_brace_close( this_line );
            }

            /*}}}*/
            /* or consider next line .. checking paragraph length so far {{{*/
/*{{{
            let this_line_length   = this_line.trim().length;
}}}*/
            l += 1;

            let next_p_len =  paragraph.length + next_line.length;
            may_add_next_line
                =      (     lines.length  &gt; l)
                &amp;&amp; (   ( next_line.length == 0)
                       || (next_p_len        &lt;= PAR_LENGTH_MAX));

            /*}}}*/
        } while(may_add_next_line &amp;&amp; !fold_close &amp;&amp; !brace_close);
        /* add paragraph {{{*/
        let className
            = WALL_OF_TEXT_SPLIT
            + ((       ( fold_open &amp;&amp;  fold_close)
                    || (brace_open &amp;&amp; brace_close)
               )
               ?    (" "+WALL_OF_TEXT_FOLD)
               :    ""
              )
        ;

        if(paragraph.length) innerHTML += "&lt;pre class='"+className+"'&gt;"+paragraph+"&lt;/pre&gt;";
        /*}}}*/
    }
    return [line_num , innerHTML];
};
/*}}}*/
/*_ get_FOLD_EL_innerHTML {{{*/
let get_FOLD_EL_innerHTML = function(lines,line_num) /* eslint-disable-line complexity */
{
    let with_line_num     = localStorage_getItem( LINES_WOT ); /* prop may not be ready yet */
    let innerHTML         = "";
    let    l              = 0;
    while((l &lt; lines.length))
    {
        let paragraph     = "";

        let this_line     = lines[l  ];

        let may_add_next_line;
        do {
            this_line     = lines[l  ];
            let next_line = lines[l+1] || "";
            let h_line    = escapeHTML(this_line);

            let fold_close = is_line_fold_close(this_line);
            let fold_open  = is_line_fold_open (this_line);

            if(fold_open) {
                h_line
                    = (fold_close ? "&lt;/details&gt;" : "")
                    + "&lt;details id='fold_"+l+"' class='"+WALL_OF_TEXT_SPLIT+"'&gt;"
                    +  "&lt;summary&gt;"+h_line+"&lt;/summary&gt;"
                    +  "&lt;pre&gt;"
                ;
            }
            else if( fold_close )
            {
                h_line
                    =             h_line
                    + "&lt;/pre&gt;"
                    + "&lt;/details&gt;"
                ;
            }

            /* p_line .. paragraph {{{*/
            if(with_line_num) {
                let p_line = "&lt;span class='"+CSS_LINE_NUM+"'&gt;"+mPadStart(line_num, 6)+" &lt;/span&gt;"+(h_line || "")+LF;
                paragraph += p_line;
            }
            else {
                paragraph += (h_line || "")+LF;
            }
            l            += 1;
            line_num     += 1;

            /*}}}*/
            may_add_next_line
                =      (     lines.length  &gt; l)
                &amp;&amp; (   ( next_line.length == 0));

        } while(may_add_next_line);
        if(paragraph.length) innerHTML += paragraph;
    }

    return [line_num , innerHTML];
};
/*}}}*/
/*_ get_wall_of_text_node_array {{{*/
let get_wall_of_text_node_array = function(mDomTraversal)
{
    let   node_array = [];
    let   node;

    while(node = mDomTraversal.nextNode())
        node_array.push(node);
/*
log("get_wall_of_text_node_array: return node_array.length=["+node_array.length+"]");
*/
    return node_array;
};
/*}}}*/
/*_ pre_innerHTML_to_innerText {{{*/
let pre_innerHTML_to_innerText = function()
{
    let pre_list = document.getElementsByTagName("PRE");
    let pre_count = 0;
    let pre;

    while(pre = pre_list[pre_count++])
        pre.textContent = ""+ pre.textContent; /* eslint-disable-line no-self-assign */

    /* textContent gets the content of all elements
     * Setting textContent on a node removes all of the node's children
     * and replaces them with a single text node with the given string value
     */
};
/*}}}*/
/*_ mNodeFilter_wall_of_text_block {{{*/
/*{{{*/
let reported_count;
let reported_filters;

/*}}}*/
let mNodeFilter_wall_of_text_block = function(node) /* eslint-disable-line complexity */
{
/*{{{*/
let   caller = "mNodeFilter_wall_of_text_block";
let log_this = DOM_WOT_LOG;

/*}}}*/
    /* FILTER DOM NODES {{{*/
    let check_result = NodeFilter.FILTER_ACCEPT;
    let      details = "";

    let npar = node.parentNode;

    /* FILTER_REJECT .. (skip this node and all its children) ______________________ */
    if     ((!npar                     )                                                ) { check_result = NodeFilter.FILTER_REJECT; details = "NODE HAS NO PARENT" ; }
    else if(( npar.tagName  == "SCRIPT")                                                ) { check_result = NodeFilter.FILTER_REJECT; details = "SCRIPT TEXT"        ; }
    else if(( npar.tagName  ==  "STYLE")                                                ) { check_result = NodeFilter.FILTER_REJECT; details = "STYLE TEXT"         ; }

    /* FILTER_SKIP .... (skip this node but not its children) ______________________ */
    else if(( npar.tagName   !=   "PRE") &amp;&amp; (node.nodeType != Node.TEXT_NODE)           ) { check_result = NodeFilter.FILTER_SKIP  ; details = "NOT A TEXT NODE"    ; }
    /* _______________________________________________ PRE or TEXT to split ________ */
    else if((!node.textContent                    ) /* TEXT NONE ___________________ */ ) { check_result = NodeFilter.FILTER_SKIP  ; details = "NO TEXT CONTENT"    ; }
    else if(( node.textContent.length &lt; WOT_LENGTH) /* TEXT SHORT __________________ */ ) { check_result = NodeFilter.FILTER_SKIP  ; details = "["+ node.textContent.length+" char] &lt;  [WOT_LENGTH "+WOT_LENGTH+"]"; }
    else if(!get_first_word(      node.textContent) /* TEXT WORDS NONE _____________ */ ) { check_result = NodeFilter.FILTER_SKIP  ; details = "["+ node.textContent.length+" char] .. HAS NO WORDS"; }

    /* FILTER_REJECT _______________________________________________________________ */
    else if(  is_marked_to_hide(node)               /* HIDDEN NODE _________________ */ ) { check_result = NodeFilter.FILTER_REJECT; details = "NODE MARKED TO HIDE"; }

    /* FILTER_ACCEPT */
    else                                                                                  { check_result = NodeFilter.FILTER_ACCEPT; details = "["+ node.textContent.length+" char]"; }

    /*}}}*/
/*{{{*/
if(        log_this
   &amp;&amp; (    node.textContent.length  &gt; 32                )
   &amp;&amp; (   (reported_count           &lt; REPORTED_COUNT_MAX)
       || !reported_filters.includes( check_result      )
      )
  ) {
    reported_count += 1;
    if(!reported_filters.includes( check_result ) ) reported_filters.push( check_result );

    let result
        = (check_result == NodeFilter.FILTER_REJECT) ? "REJECT"
        : (check_result == NodeFilter.FILTER_SKIP  ) ? "__SKIP"
        : (check_result == NodeFilter.FILTER_ACCEPT) ? "ACCEPT"
        :                                               check_result;
    let lfx
        = (check_result == NodeFilter.FILTER_REJECT) ? lf2
        : (check_result == NodeFilter.FILTER_SKIP  ) ? lf8
        : (check_result == NodeFilter.FILTER_ACCEPT) ? lf4
        :                                              lf7;

    log(caller+":%c WOT ("+reported_count+"/"+REPORTED_COUNT_MAX+"...) "+ npar.tagName +"["+npar.textContent.length+"c]."+ node.nodeName +"%c"+result+"%c"+details+"%c "+strip_CR_LF(ellipsis(node.textContent, 64))
        ,        lbL                                                                                                                      ,lbR+lfx    ,lbL         ,lbR                                                          );
}
/*}}}*/
    return check_result;
};
/*}}}*/

/* ➔ EXPORT */
/*{{{*/
/*_ t_wot_set_state {{{*/
let t_wot_set_state = function(label,state)
{
    if(    state != undefined)
    {
        if(state) localStorage.setItem   (label, "true");
        else      localStorage.removeItem(label        );
        return !!state;
    }
    else {
        return    localStorage.getItem   (label        );
    }
};
/*}}}*/

return { name    : "dom_wot"
    ,    logging : (state) =&gt; { DOM_WOT_LOG = dom_wot.t_wot_set_state("DOM_WOT_LOG", state); return DOM_WOT_LOG; }
    ,    tagging : (state) =&gt; { DOM_WOT_TAG = dom_wot.t_wot_set_state("DOM_WOT_TAG", state); return DOM_WOT_TAG; }
    ,    t_wot_IMPORT
    ,    t_wot_set_state

    ,    t_WOT_FOLD_EL
    ,    t_WOT_SPLIT
    ,    t_WOT_SPLIT_done : () =&gt; wot_split_done
    /* DEBUG */
    ,    htot             : () =&gt; pre_innerHTML_to_innerText()
};
/*}}}*/
}());

</pre> <!--}}}-->
</details>
<!--}}}-->
<!-- dom_wot_log_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_wot_log.js       | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_wot_log_html" open class="folded_code"><summary> <B>dom_wot_log</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_wot_log                                               (WALL OF TEXT) │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* globals console */

/* exported dom_wot_log, DOM_WOT_LOG_JS_TAG */

/* eslint-disable no-warning-comments */
/* eslint-disable dot-notation        */

const DOM_WOT_LOG_JS_ID         = "dom_wot_log_js";
const DOM_WOT_LOG_JS_TAG        = DOM_WOT_LOG_JS_ID  +" (210928:16h:57)";
/*}}}*/
let dom_wot_log          = (function() {
"use strict";

let log                = console.log;
let logBIG             = (msg)    =&gt; log("%c"+msg, "font-size:150%; font-weight:100;");
let logXXX             = (msg)    =&gt; log("XXX "+msg);
let log_caller         = console.trace;
let log_json_one_liner = (o) =&gt; log( JSON.stringify(o) );
let log_key_val        = (name,o) =&gt; { console.log(name+":"); console.dir(o); };
let log_key_val_group  = log_key_val;
let CS                 = "color:#666; background:#111; border:0px solid #445; border-radius:1em;";
let console_dir        = function(a1,a2=null) {
    let o   = (a2) ? a2 : a1;
    let msg = (a2) ? a1 : null;
    if( msg )
        console.log ("%c"+msg+":",CS);
    console.dir  (o);
};

return { name : "dom_wot_log"
    ,    log
    ,    logBIG
    ,    logXXX
    ,    log_caller
    ,    log_json_one_liner
    ,    log_key_val
    ,    log_key_val_group
    ,    console_dir
};

}());

</pre> <!--}}}-->
</details>
<!--}}}-->
<!-- dom_wot_util_html {{{-->
<!--
mazR:/^<pre> *<!--{{{--/+,/^<\/pre> *..--}}}--/-d|s/^/\r\r/
}j!!cat %:h/script/dom_wot_util.js      | sed -e 's/&/\&amp;/g' -e 's/</\&lt;/g' -e 's/>/\&gt;/g'
-->
<details id="dom_wot_util_html" open class="folded_code"><summary> <B>dom_wot_util</B> </summary>
<pre> <!--{{{-->

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ dom_wot_util                                              (WALL OF TEXT) │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* jshint esversion: 9, laxbreak:true, laxcomma:true, boss:true {{{*/
/* globals console */

/* exported dom_wot_util, DOM_WOT_UTIL_JS_TAG */

/* eslint-disable no-warning-comments */
/* eslint-disable dot-notation        */

const DOM_WOT_UTIL_JS_ID      = "dom_wot_util_js";
const DOM_WOT_UTIL_JS_TAG     = DOM_WOT_UTIL_JS_ID  +" (210928:15h:45)";
/*}}}*/
let dom_wot_util        = (function() {
"use strict";

const LOG_MAP           = {};
let log                 = console.log;

/* DOM */
let add_el_class        = function(el, className) { if(!el || !el.classList) return      ; if(   !el.classList.contains( className )) el.classList.add   ( className ); };
let has_el_class        = function(el, className) { if(!el || !el.classList) return false; return el.classList.contains( className );                                   };
/*  get_el_title {{{*/
let get_el_title = function(el)
{
    if(!el) return "";

    while( el ) {
        if(el.title                   ) return el.title;
        if(el.attributes["data-title"]) return el.attributes["data-title"].textContent;

        el =       el.parentElement;
    }

    return "";
};
/*}}}*/
/* get_id_or_tag {{{ */
let get_id_or_tag = function(node)
{
    return !node           ? ("null_node"                        )
        :   node.id        ? ("#"+ node.id                       )
        :   node.className ? (node.tagName+"."+ node.classList[0])
        :                    (node.tagName                       )
    ;
};
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ REGEX                                                                    │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* escapeHTML {{{*/
/*{{{*/
let escapeHTML_chars
    = {   "&lt;"                   : "&amp;lt;"
        , "&gt;"                   : "&amp;gt;"
        , "&amp;"                   : "&amp;amp;"
        , '"'                   : "&amp;quot;" /* eslint-disable-line quotes */
        , "'"                   : "&amp;apos;"
    };

/*}}}*/
let escapeHTML = function (text)
{
    let result = text.replace(/[&lt;&gt;&amp;"]/g, function(character) { return escapeHTML_chars[character]; });
    return result;
};
/*}}}*/
/* get_first_word {{{*/
/*{{{*/
const regexp_FIRST_WORD         = new RegExp("(\\w+)"                                   , "i");

/*}}}*/
let get_first_word = function(text, _caller)
{
let log_this = LOG_MAP.S1_RANGE;
/*
    return strip_CR_LF( text.trim() )
        .  replace(regexp_FIRST_WORD, "$1");
    return text;
*/
    regexp_FIRST_WORD.lastIndex = 0;

    let matches = regexp_FIRST_WORD.exec( text );

    let  result = (matches) ? matches[0] : "";

if( log_this) log("get_first_word(text=["+text+"], caller=["+_caller+"]): "+ regexp_FIRST_WORD +" .. return ["+result+"]");
    return result;
};
/*}}}*/
/* strip_CR_LF {{{*/
/*{{{*/
const regexp_CR                 = new RegExp("\\r"                          , "g");
const regexp_LF                 = new RegExp("\\n"                          , "g");

/*}}}*/
let strip_CR_LF = function(text)
{
    return text
        .   replace(regexp_CR,  "")
        .   replace(regexp_LF, " ")
        .   trim()
    ;
};
/*}}}*/
/*_ show_CR_LF {{{*/
/*{{{*/
const SYMBOL_DOWN_LEFT_ARROW        = "\u21B5";

/*}}}*/
let show_CR_LF = function(text)
{
    return text
        .   replace(regexp_CR,  "")
        .   replace(regexp_LF, SYMBOL_DOWN_LEFT_ARROW)
        .   trim()
    ;
};
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ STRING                                                                   │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/* ellipsis {{{*/
/*{{{*/
const HORIZONTAL_ELLLIPSIS = "\u2026";
const ELLIPSIS_DEFAULT_LEN = 96;

/*}}}*/
let ellipsis = function(_msg, len=ELLIPSIS_DEFAULT_LEN)
{
    let msg = show_CR_LF( String(_msg) );
    return (msg.length    &lt;= len)
        ?   msg
        :   msg.substring(0, len-3)+HORIZONTAL_ELLLIPSIS
    ;
};
/*}}}*/
/* mPadStart .. mPadEnd {{{*/
let mPadStart = function(s,l,c=" ") { s = String(s); while(s.length &lt; l) s = c+s; return s; };

let mPadEnd   = function(s,l,c=" ") { s = String(s); while(s.length &lt; l) s = s+c; return s; };
/*}}}*/

/*┌──────────────────────────────────────────────────────────────────────────┐*/
/*│ RTabs                                                                    │*/
/*└──────────────────────────────────────────────────────────────────────────┘*/
/*  is_marked_to_hide {{{*/
/*{{{*/
const MARKED_TO_HIDE        = "marked_to_hide";

/*}}}*/
let is_marked_to_hide = function( node )
{
    return has_el_class(node, MARKED_TO_HIDE);

};
/*}}}*/

return { name : "dom_wot_util"
    /* DOM */
    ,    add_el_class
    ,    has_el_class
    ,    get_el_title
    ,    get_id_or_tag
    /* REGEX */
    ,    escapeHTML
    ,    get_first_word
    ,    strip_CR_LF
    /* STRING */
    ,    ellipsis
    ,    mPadEnd
    ,    mPadStart
    /* RTabs */
    ,    is_marked_to_hide
};

}());

</pre> <!--}}}-->
</details>
<!--}}}-->
<hr>

</body>
</html>
<!--
==============================================================================================
:n % script/dom_details* script/dom_wot*
:!start explorer %
==============================================================================================
}!!ls -l script/dom_details.js script/dom_details_log.js script/dom_details_util.js
}!!ls -l script/dom_wot.js     script/dom_wot_log.js     script/dom_wot_util.js
==============================================================================================


 vim: sw=4
-->


